2025-09-18 00:00:51.386 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/ExpenseVouchers - application/json 753
2025-09-18 00:00:51.393 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/ExpenseVouchers - 307 0 null 6.633ms
2025-09-18 00:00:51.401 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/ExpenseVouchers - null null
2025-09-18 00:00:51.405 +03:00 [INF] CORS policy execution successful.
2025-09-18 00:00:51.407 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/ExpenseVouchers - 204 null null 6.2305ms
2025-09-18 00:00:51.410 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/ExpenseVouchers - application/json 753
2025-09-18 00:00:51.418 +03:00 [INF] CORS policy execution successful.
2025-09-18 00:00:51.419 +03:00 [INF] Request started
2025-09-18 00:00:51.420 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-18 00:00:51.421 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.CreateExpenseVoucherDto) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-18 00:00:51.476 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 00:00:51.559 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__id_0='f8cd0c63-50d7-4a69-a344-bc53be110f77'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 00:00:51.602 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 00:00:51.911 +03:00 [ERR] Failed executing DbCommand (49ms) [Parameters=[@p0='e589e89b-d47b-471f-5068-08ddf62d4911', @p1='500.00' (Precision = 18) (Scale = 2), @p2=NULL (DbType = Guid), @p3='f8cd0c63-50d7-4a69-a344-bc53be110f77', @p4='EXP-081' (Nullable = false) (Size = 20), @p5='d00cf078-c1ff-4feb-ae37-d66a827ae438', @p6='3fa85f64-5717-4562-b3fc-2c963f66afa6' (Nullable = true), @p7='Vendor' (Size = 450), @p8='2025-09-17T21:00:51.6011300Z', @p9='00000000-0000-0000-0000-000000000000', @p10=NULL (Size = 4000), @p11='EGP' (Nullable = false) (Size = 3), @p12='2025-09-17T13:07:31.9820000Z', @p13='Dummy expense voucher' (Size = 4000), @p14='1.0' (Precision = 18) (Scale = 6), @p15='True', @p16='False', @p17='f8cd0c63-50d7-4a69-a344-bc53be110f77', @p18=NULL (DbType = DateTime2), @p19=NULL (DbType = Guid), @p20='7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe' (Nullable = true), @p21=NULL (DbType = Guid), @p22=NULL (DbType = DateTime2), @p23=NULL (DbType = Guid), @p24='0', @p25='Draft' (Nullable = false) (Size = 450), @p26=NULL (DbType = Guid), @p27='Expense' (Nullable = false) (Size = 450), @p28=NULL (DbType = DateTime2), @p29=NULL (Size = 4000), @p30='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56', @p31='BankAccount' (Nullable = false) (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Vouchers] ([Id], [Amount], [BankAccountId], [CategoryAccountId], [Code], [CompanyId], [CounterpartyId], [CounterpartyType], [CreatedAt], [CreatedBy], [CreatedById], [CurrencyCode], [Date], [Description], [FxRate], [IsActive], [IsDeleted], [JournalAccountId], [PostedAt], [PostedBy], [RecurrenceId], [RecurringScheduleId], [ReversedAt], [ReversedBy], [Revision], [Status], [TreasuryId], [Type], [UpdatedAt], [UpdatedById], [WalletId], [WalletType])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-09-18 00:00:51.938 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:a5c69a2e-23bc-41f1-a1cb-83aa26a1edca
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:a5c69a2e-23bc-41f1-a1cb-83aa26a1edca
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-18 00:00:51.958 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-18 00:00:51.960 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 535.987ms
2025-09-18 00:00:51.962 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-18 00:00:51.963 +03:00 [INF] Request completed successfully with status code 400
2025-09-18 00:00:51.964 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/ExpenseVouchers - 400 null application/json; charset=utf-8 554.4822ms
2025-09-18 00:02:32.055 +03:00 [INF] Starting web host...
2025-09-18 00:02:32.557 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 00:02:32.561 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 00:02:32.668 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 00:02:32.669 +03:00 [INF] Hosting environment: Development
2025-09-18 00:02:32.670 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 00:02:36.215 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 00:02:36.327 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 112.7977ms
2025-09-18 00:02:36.354 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 00:02:36.361 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.3104ms
2025-09-18 00:02:37.366 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 00:02:37.404 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 37.974ms
2025-09-18 00:02:37.548 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 00:02:37.612 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 63.6577ms
2025-09-18 00:02:43.688 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/ExpenseVouchers - application/json 753
2025-09-18 00:02:43.696 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/ExpenseVouchers - 307 0 null 7.4415ms
2025-09-18 00:02:43.735 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/ExpenseVouchers - null null
2025-09-18 00:02:43.742 +03:00 [INF] CORS policy execution successful.
2025-09-18 00:02:43.744 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/ExpenseVouchers - 204 null null 8.4938ms
2025-09-18 00:02:43.747 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/ExpenseVouchers - application/json 753
2025-09-18 00:02:43.750 +03:00 [INF] CORS policy execution successful.
2025-09-18 00:02:43.760 +03:00 [INF] Request started
2025-09-18 00:02:43.762 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-18 00:02:43.779 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.CreateExpenseVoucherDto) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-18 00:02:43.785 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 00:02:44.435 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 00:02:44.647 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 00:02:45.116 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 00:02:45.216 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='f8cd0c63-50d7-4a69-a344-bc53be110f77'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 00:02:45.261 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 00:02:45.482 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='40542c92-5f17-4e7b-3780-08ddf62d8cd0', @p1='500.00' (Precision = 18) (Scale = 2), @p2=NULL (DbType = Guid), @p3='f8cd0c63-50d7-4a69-a344-bc53be110f77', @p4='EXP-081' (Nullable = false) (Size = 20), @p5='d00cf078-c1ff-4feb-ae37-d66a827ae438', @p6='3fa85f64-5717-4562-b3fc-2c963f66afa6' (Nullable = true), @p7='Vendor' (Size = 450), @p8='2025-09-17T21:02:45.2589011Z', @p9='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p10=NULL (Size = 4000), @p11='EGP' (Nullable = false) (Size = 3), @p12='2025-09-17T13:07:31.9820000Z', @p13='Dummy expense voucher' (Size = 4000), @p14='1.0' (Precision = 18) (Scale = 6), @p15='True', @p16='False', @p17='f8cd0c63-50d7-4a69-a344-bc53be110f77', @p18=NULL (DbType = DateTime2), @p19=NULL (DbType = Guid), @p20='7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe' (Nullable = true), @p21=NULL (DbType = Guid), @p22=NULL (DbType = DateTime2), @p23=NULL (DbType = Guid), @p24='0', @p25='Draft' (Nullable = false) (Size = 450), @p26=NULL (DbType = Guid), @p27='Expense' (Nullable = false) (Size = 450), @p28=NULL (DbType = DateTime2), @p29=NULL (Size = 4000), @p30='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56', @p31='BankAccount' (Nullable = false) (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Vouchers] ([Id], [Amount], [BankAccountId], [CategoryAccountId], [Code], [CompanyId], [CounterpartyId], [CounterpartyType], [CreatedAt], [CreatedBy], [CreatedById], [CurrencyCode], [Date], [Description], [FxRate], [IsActive], [IsDeleted], [JournalAccountId], [PostedAt], [PostedBy], [RecurrenceId], [RecurringScheduleId], [ReversedAt], [ReversedBy], [Revision], [Status], [TreasuryId], [Type], [UpdatedAt], [UpdatedById], [WalletId], [WalletType])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-09-18 00:02:45.583 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='50741c08-9c0a-4c8a-4c12-08ddf62d8cf4', @p1=NULL (Size = 64), @p2='2025-09-17T21:02:45.5236349Z', @p3=NULL (Size = 4000), @p4='invoice.pdf' (Nullable = false) (Size = 500), @p5='0', @p6='invoice.pdf' (Nullable = false) (Size = 255), @p7='True', @p8='False', @p9='' (Nullable = false) (Size = 100), @p10=NULL (DbType = DateTime2), @p11=NULL (Size = 4000), @p12='2025-09-17T21:02:45.5237465Z', @p13='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p14='40542c92-5f17-4e7b-3780-08ddf62d8cd0', @p15='213475c4-c45a-42a5-654e-08ddf62d8cf1', @p16='100.0' (Precision = 18) (Scale = 2), @p17='2025-09-17T21:02:45.5043538Z', @p18=NULL (Size = 4000), @p19='Expense' (Nullable = false) (Size = 4000), @p20='True', @p21='False', @p22='True', @p23='14.0' (Precision = 18) (Scale = 2), @p24='020c0bbf-8202-42d8-9692-2fc202aa5c08', @p25=NULL (DbType = DateTime2), @p26=NULL (Size = 4000), @p27='40542c92-5f17-4e7b-3780-08ddf62d8cd0'], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Attachments] ([Id], [Checksum], [CreatedAt], [CreatedById], [FilePath], [FileSize], [Filename], [IsActive], [IsDeleted], [MimeType], [UpdatedAt], [UpdatedById], [UploadedAt], [UploadedBy], [VoucherId])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
INSERT INTO [VoucherTaxes] ([Id], [BaseAmount], [CreatedAt], [CreatedById], [Direction], [IsActive], [IsDeleted], [IsWithholding], [TaxAmount], [TaxId], [UpdatedAt], [UpdatedById], [VoucherId])
VALUES (@p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27);
2025-09-18 00:02:45.614 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__voucher_Id_0='40542c92-5f17-4e7b-3780-08ddf62d8cd0'], CommandType='"Text"', CommandTimeout='30']
SELECT [v].[Id], [v].[BaseAmount], [v].[CreatedAt], [v].[CreatedById], [v].[Direction], [v].[IsActive], [v].[IsDeleted], [v].[IsWithholding], [v].[TaxAmount], [v].[TaxId], [v].[UpdatedAt], [v].[UpdatedById], [v].[VoucherId]
FROM [VoucherTaxes] AS [v]
WHERE [v].[IsDeleted] = CAST(0 AS bit) AND [v].[VoucherId] = @__voucher_Id_0
2025-09-18 00:02:45.628 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__voucher_Id_0='40542c92-5f17-4e7b-3780-08ddf62d8cd0'], CommandType='"Text"', CommandTimeout='30']
SELECT [a].[Id], [a].[Checksum], [a].[CreatedAt], [a].[CreatedById], [a].[FilePath], [a].[FileSize], [a].[Filename], [a].[IsActive], [a].[IsDeleted], [a].[MimeType], [a].[UpdatedAt], [a].[UpdatedById], [a].[UploadedAt], [a].[UploadedBy], [a].[VoucherId]
FROM [Attachments] AS [a]
WHERE [a].[IsDeleted] = CAST(0 AS bit) AND [a].[VoucherId] = @__voucher_Id_0
2025-09-18 00:02:45.648 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-18 00:02:45.676 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1890.8685ms
2025-09-18 00:02:45.679 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-18 00:02:45.681 +03:00 [INF] Request completed successfully with status code 201
2025-09-18 00:02:45.687 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/ExpenseVouchers - 201 null application/json; charset=utf-8 1940.611ms
2025-09-18 00:17:02.677 +03:00 [INF] Starting web host...
2025-09-18 00:17:03.042 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 00:17:03.045 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 00:17:03.117 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 00:17:03.120 +03:00 [INF] Hosting environment: Development
2025-09-18 00:17:03.121 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 00:32:58.934 +03:00 [INF] Starting web host...
2025-09-18 00:32:59.248 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 00:32:59.251 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 00:32:59.322 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 00:32:59.324 +03:00 [INF] Hosting environment: Development
2025-09-18 00:32:59.325 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 00:33:05.602 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 00:33:05.771 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 169.066ms
2025-09-18 00:33:05.792 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 00:33:05.799 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.2642ms
2025-09-18 00:33:06.933 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 00:33:06.965 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 32.3038ms
2025-09-18 00:33:07.177 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 00:33:07.277 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 99.7617ms
2025-09-18 00:33:30.443 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/api/ExpenseVouchers/0a0d2ff8-e454-44a4-2715-08ddf607cc3a - null null
2025-09-18 00:33:30.458 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/api/ExpenseVouchers/0a0d2ff8-e454-44a4-2715-08ddf607cc3a - 307 0 null 15.5658ms
2025-09-18 00:33:30.524 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/api/ExpenseVouchers/0a0d2ff8-e454-44a4-2715-08ddf607cc3a - null null
2025-09-18 00:33:30.531 +03:00 [INF] CORS policy execution successful.
2025-09-18 00:33:30.541 +03:00 [INF] Request started
2025-09-18 00:33:30.544 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-18 00:33:30.572 +03:00 [INF] Route matched with {action = "GetExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetExpenseVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-18 00:33:30.579 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 00:33:31.302 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 00:33:31.530 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 00:33:32.043 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[@__id_0='0a0d2ff8-e454-44a4-2715-08ddf607cc3a'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [v].[Id], [v].[Amount], [v].[BankAccountId], [v].[CategoryAccountId], [v].[Code], [v].[CompanyId], [v].[CounterpartyId], [v].[CounterpartyType], [v].[CreatedAt], [v].[CreatedBy], [v].[CreatedById], [v].[CurrencyCode], [v].[Date], [v].[Description], [v].[FxRate], [v].[IsActive], [v].[IsDeleted], [v].[JournalAccountId], [v].[PostedAt], [v].[PostedBy], [v].[RecurrenceId], [v].[RecurringScheduleId], [v].[ReversedAt], [v].[ReversedBy], [v].[Revision], [v].[Status], [v].[TreasuryId], [v].[Type], [v].[UpdatedAt], [v].[UpdatedById], [v].[WalletId], [v].[WalletType]
FROM [Vouchers] AS [v]
WHERE [v].[Id] = @__id_0
2025-09-18 00:33:32.187 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__voucher_Id_0='0a0d2ff8-e454-44a4-2715-08ddf607cc3a'], CommandType='"Text"', CommandTimeout='30']
SELECT [v].[Id], [v].[BaseAmount], [v].[CreatedAt], [v].[CreatedById], [v].[Direction], [v].[IsActive], [v].[IsDeleted], [v].[IsWithholding], [v].[TaxAmount], [v].[TaxId], [v].[UpdatedAt], [v].[UpdatedById], [v].[VoucherId]
FROM [VoucherTaxes] AS [v]
WHERE [v].[IsDeleted] = CAST(0 AS bit) AND [v].[VoucherId] = @__voucher_Id_0
2025-09-18 00:33:32.233 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__voucher_Id_0='0a0d2ff8-e454-44a4-2715-08ddf607cc3a'], CommandType='"Text"', CommandTimeout='30']
SELECT [a].[Id], [a].[Checksum], [a].[CreatedAt], [a].[CreatedById], [a].[FilePath], [a].[FileSize], [a].[Filename], [a].[IsActive], [a].[IsDeleted], [a].[MimeType], [a].[UpdatedAt], [a].[UpdatedById], [a].[UploadedAt], [a].[UploadedBy], [a].[VoucherId]
FROM [Attachments] AS [a]
WHERE [a].[IsDeleted] = CAST(0 AS bit) AND [a].[VoucherId] = @__voucher_Id_0
2025-09-18 00:33:32.274 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-18 00:33:32.301 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP) in 1722.6629ms
2025-09-18 00:33:32.303 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-18 00:33:32.305 +03:00 [INF] Request completed successfully with status code 200
2025-09-18 00:33:32.311 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/api/ExpenseVouchers/0a0d2ff8-e454-44a4-2715-08ddf607cc3a - 200 null application/json; charset=utf-8 1787.8117ms
2025-09-18 01:03:26.974 +03:00 [INF] Starting web host...
2025-09-18 01:03:27.253 +03:00 [FTL] Host terminated unexpectedly
System.AggregateException: Some services are not able to be constructed (Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.CreateIncomeVoucherCommand,ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler': Unable to resolve service for type 'ModularERP.Modules.Finance.Features.IncomesVoucher.Service.Interface.IIncomeVoucherService' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.)
 ---> System.InvalidOperationException: Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.CreateIncomeVoucherCommand,ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler': Unable to resolve service for type 'ModularERP.Modules.Finance.Features.IncomesVoucher.Service.Interface.IIncomeVoucherService' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.
 ---> System.InvalidOperationException: Unable to resolve service for type 'ModularERP.Modules.Finance.Features.IncomesVoucher.Service.Interface.IIncomeVoucherService' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceDescriptor serviceDescriptor, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   at Microsoft.Extensions.DependencyInjection.ServiceCollectionContainerBuilderExtensions.BuildServiceProvider(IServiceCollection services, ServiceProviderOptions options)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 128
2025-09-18 01:04:46.148 +03:00 [INF] Starting web host...
2025-09-18 01:04:46.292 +03:00 [FTL] Host terminated unexpectedly
System.AggregateException: Some services are not able to be constructed (Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.CreateIncomeVoucherCommand,ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler': Unable to resolve service for type 'FluentValidation.IValidator`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.)
 ---> System.InvalidOperationException: Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.CreateIncomeVoucherCommand,ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler': Unable to resolve service for type 'FluentValidation.IValidator`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.
 ---> System.InvalidOperationException: Unable to resolve service for type 'FluentValidation.IValidator`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceDescriptor serviceDescriptor, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   at Microsoft.Extensions.DependencyInjection.ServiceCollectionContainerBuilderExtensions.BuildServiceProvider(IServiceCollection services, ServiceProviderOptions options)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 130
2025-09-18 01:06:59.829 +03:00 [INF] Starting web host...
2025-09-18 01:07:00.174 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 01:07:00.177 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 01:07:00.248 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 01:07:00.251 +03:00 [INF] Hosting environment: Development
2025-09-18 01:07:00.252 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 01:07:11.138 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 01:07:11.340 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 203.7249ms
2025-09-18 01:07:11.374 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 01:07:11.388 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.8162ms
2025-09-18 01:07:13.090 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 01:07:13.122 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 31.5593ms
2025-09-18 01:07:13.354 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 01:07:13.388 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate Operation for action - ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP). See inner exception
 ---> Swashbuckle.AspNetCore.SwaggerGen.SwaggerGeneratorException: Failed to generate schema for type - ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto. See inner exception
 ---> System.InvalidOperationException: Can't use schemaId "$CounterpartyDto" for type "$ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CounterpartyDto". The same schemaId is already used for type "$ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.CounterpartyDto"
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaRepository.RegisterType(Type type, String schemaId)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateReferencedSchema(DataContract dataContract, SchemaRepository schemaRepository, Func`1 definitionFactory)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateConcreteSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchemaForMember(Type modelType, SchemaRepository schemaRepository, MemberInfo memberInfo, DataProperty dataProperty)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.CreateObjectSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.<>c__DisplayClass11_0.<GenerateConcreteSchema>b__3()
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateReferencedSchema(DataContract dataContract, SchemaRepository schemaRepository, Func`1 definitionFactory)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateConcreteSchema(DataContract dataContract, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchemaForParameter(Type modelType, SchemaRepository schemaRepository, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   at Swashbuckle.AspNetCore.SwaggerGen.SchemaGenerator.GenerateSchema(Type modelType, SchemaRepository schemaRepository, MemberInfo memberInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateSchema(Type type, SchemaRepository schemaRepository, PropertyInfo propertyInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   --- End of inner exception stack trace ---
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateSchema(Type type, SchemaRepository schemaRepository, PropertyInfo propertyInfo, ParameterInfo parameterInfo, ApiParameterRouteInfo routeInfo)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateRequestBodyFromBodyParameter(ApiDescription apiDescription, SchemaRepository schemaRepository, ApiParameterDescription bodyParameter)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateRequestBody(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperation(ApiDescription apiDescription, SchemaRepository schemaRepository)
   --- End of inner exception stack trace ---
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperation(ApiDescription apiDescription, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GenerateOperations(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GeneratePaths(IEnumerable`1 apiDescriptions, SchemaRepository schemaRepository)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerDocumentWithoutFilters(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.SwaggerGen.SwaggerGenerator.GetSwaggerAsync(String documentName, String host, String basePath)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-09-18 01:07:13.419 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 500 null text/plain; charset=utf-8 65.1405ms
2025-09-18 01:09:13.421 +03:00 [INF] Starting web host...
2025-09-18 01:09:14.005 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 01:09:14.008 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 01:09:14.100 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 01:09:14.102 +03:00 [INF] Hosting environment: Development
2025-09-18 01:09:14.103 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 01:09:16.505 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 01:09:16.622 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 117.3129ms
2025-09-18 01:09:16.645 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 01:09:16.652 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.5109ms
2025-09-18 01:09:17.644 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 01:09:17.673 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.2786ms
2025-09-18 01:09:17.834 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 01:09:17.910 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 75.9575ms
2025-09-18 01:11:59.721 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 681
2025-09-18 01:11:59.728 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 7.4545ms
2025-09-18 01:11:59.768 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:11:59.773 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:11:59.775 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 6.9829ms
2025-09-18 01:11:59.778 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 681
2025-09-18 01:11:59.783 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:11:59.791 +03:00 [INF] Request started
2025-09-18 01:11:59.794 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:11:59.810 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:11:59.818 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:12:00.537 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 01:12:00.789 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:12:01.410 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:12:01.507 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:12:01.523 +03:00 [INF] Executing ForbidResult with authentication schemes (["User does not have permission to deposit to this wallet"]).
2025-09-18 01:12:01.532 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 1713.863ms
2025-09-18 01:12:01.535 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:12:01.538 +03:00 [ERR] Unexpected error occurred
System.InvalidOperationException: No authentication handlers are registered. Did you forget to call AddAuthentication().Add[SomeAuthHandler]("User does not have permission to deposit to this wallet",...)?
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ForbidAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Mvc.ForbidResult.ExecuteResultAsync(ActionContext context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeNextResultFilterAsync>g__Awaited|30_0[TFilter,TFilterAsync](ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.Rethrow(ResultExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.ResultNext[TFilter,TFilterAsync](State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.InvokeResultFilters()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-18 01:12:01.582 +03:00 [INF] Error response sent with status code 500
2025-09-18 01:12:01.591 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 500 null application/json; charset=utf-8 1813.1077ms
2025-09-18 01:15:44.853 +03:00 [INF] Starting web host...
2025-09-18 01:15:45.318 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 01:15:45.322 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 01:15:45.425 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 01:15:45.426 +03:00 [INF] Hosting environment: Development
2025-09-18 01:15:45.427 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 01:15:54.483 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 681
2025-09-18 01:15:54.518 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 35.9409ms
2025-09-18 01:15:54.561 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:15:54.567 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:15:54.571 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 9.8503ms
2025-09-18 01:15:54.574 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 681
2025-09-18 01:15:54.578 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:15:54.596 +03:00 [INF] Request started
2025-09-18 01:15:54.598 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:15:54.623 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:15:54.628 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:15:55.502 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 01:15:55.746 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:15:56.206 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:15:56.331 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__id_0='f8cd0c63-50d7-4a69-a344-bc53be110f77'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:15:56.372 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-09-18 01:15:56.378 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 1750.8814ms
2025-09-18 01:15:56.380 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:15:56.383 +03:00 [INF] Request completed successfully with status code 400
2025-09-18 01:15:56.390 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 400 null text/plain; charset=utf-8 1815.9554ms
2025-09-18 01:16:02.725 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 01:16:02.808 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 83.0824ms
2025-09-18 01:16:02.836 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 01:16:02.842 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.3672ms
2025-09-18 01:16:03.867 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 01:16:03.895 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.4893ms
2025-09-18 01:16:04.063 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 01:16:04.123 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 60.6801ms
2025-09-18 01:16:34.589 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:16:34.593 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 4.6519ms
2025-09-18 01:16:34.596 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:16:34.603 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:16:34.605 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 8.7358ms
2025-09-18 01:16:34.607 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:16:34.613 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:16:34.614 +03:00 [INF] Request started
2025-09-18 01:16:34.615 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:16:34.618 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:16:34.673 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:16:34.683 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='f8cd0c63-50d7-4a69-a344-bc53be110f77'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:16:34.690 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-09-18 01:16:34.692 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 70.5003ms
2025-09-18 01:16:34.696 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:16:34.698 +03:00 [INF] Request completed successfully with status code 400
2025-09-18 01:16:34.699 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 400 null text/plain; charset=utf-8 92.6876ms
2025-09-18 01:19:32.223 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:19:32.227 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 4.6507ms
2025-09-18 01:19:32.256 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:19:32.261 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:19:32.265 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 8.6485ms
2025-09-18 01:19:32.267 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:19:32.274 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:19:32.276 +03:00 [INF] Request started
2025-09-18 01:19:32.277 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:19:32.278 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:19:32.308 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:19:32.316 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:19:32.334 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext'.
System.InvalidOperationException: Cannot convert string value 'Income' from the database to any value in the mapped 'AccountType' enum.
   at Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal.StringEnumConverter`3.ConvertToEnum(String value)
   at lambda_method166(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: Cannot convert string value 'Income' from the database to any value in the mapped 'AccountType' enum.
   at Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal.StringEnumConverter`3.ConvertToEnum(String value)
   at lambda_method166(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-09-18 01:19:32.341 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-09-18 01:19:32.342 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 60.9349ms
2025-09-18 01:19:32.345 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:19:32.346 +03:00 [INF] Request completed successfully with status code 400
2025-09-18 01:19:32.350 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 400 null text/plain; charset=utf-8 82.745ms
2025-09-18 01:21:25.265 +03:00 [INF] Starting web host...
2025-09-18 01:21:25.595 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 01:21:25.597 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 01:21:25.674 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 01:21:25.676 +03:00 [INF] Hosting environment: Development
2025-09-18 01:21:25.677 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 01:21:30.889 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:21:30.926 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 38.1395ms
2025-09-18 01:21:30.964 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:21:30.970 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:21:30.973 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 9.1466ms
2025-09-18 01:21:30.977 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:21:30.981 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:21:30.992 +03:00 [INF] Request started
2025-09-18 01:21:30.994 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:21:31.012 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:21:31.016 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:21:31.685 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 01:21:31.897 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:21:32.345 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:21:32.461 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:21:32.481 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext'.
System.InvalidOperationException: Cannot convert string value 'Income' from the database to any value in the mapped 'AccountType' enum.
   at Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal.StringEnumConverter`3.ConvertToEnum(String value)
   at lambda_method166(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
System.InvalidOperationException: Cannot convert string value 'Income' from the database to any value in the mapped 'AccountType' enum.
   at Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal.StringEnumConverter`3.ConvertToEnum(String value)
   at lambda_method166(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
2025-09-18 01:21:32.493 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-09-18 01:21:32.499 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 1482.0197ms
2025-09-18 01:21:32.502 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:21:32.503 +03:00 [INF] Request completed successfully with status code 400
2025-09-18 01:21:32.511 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 400 null text/plain; charset=utf-8 1534.1194ms
2025-09-18 01:29:01.745 +03:00 [INF] Starting web host...
2025-09-18 01:29:02.066 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 01:29:02.070 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 01:29:02.142 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 01:29:02.144 +03:00 [INF] Hosting environment: Development
2025-09-18 01:29:02.145 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 01:29:08.026 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 01:29:08.139 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 114.1588ms
2025-09-18 01:29:08.166 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 01:29:08.174 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.0797ms
2025-09-18 01:29:09.191 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 01:29:09.219 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.532ms
2025-09-18 01:29:09.387 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 01:29:09.449 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 62.4999ms
2025-09-18 01:29:18.217 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:29:18.228 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 11.1296ms
2025-09-18 01:29:18.266 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:29:18.276 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:29:18.278 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 11.7249ms
2025-09-18 01:29:18.281 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:29:18.286 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:29:18.297 +03:00 [INF] Request started
2025-09-18 01:29:18.299 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:29:18.318 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:29:18.327 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:29:19.005 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 01:29:19.224 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:29:19.679 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:29:19.779 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:29:20.070 +03:00 [ERR] Failed executing DbCommand (40ms) [Parameters=[@p0='9d45553b-2edc-4cae-d55b-08ddf639a502', @p1='500.00' (Precision = 18) (Scale = 2), @p2=NULL (DbType = Guid), @p3='d880c62f-a545-41fe-876d-f76a4a6c1077', @p4='EXP-001' (Nullable = false) (Size = 20), @p5='00000000-0000-0000-0000-000000000000', @p6='3fa85f64-5717-4562-b3fc-2c963f66afa6' (Nullable = true), @p7='Vendor' (Size = 450), @p8='2025-09-17T22:29:19.8233636Z', @p9='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p10=NULL (Size = 4000), @p11='EGP' (Nullable = false) (Size = 3), @p12='2025-09-17T13:07:31.9820000Z', @p13='Dummy expense voucher' (Size = 4000), @p14='1.0' (Precision = 18) (Scale = 6), @p15='True', @p16='False', @p17='00000000-0000-0000-0000-000000000000', @p18=NULL (DbType = DateTime2), @p19=NULL (DbType = Guid), @p20='7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe' (Nullable = true), @p21=NULL (DbType = Guid), @p22=NULL (DbType = DateTime2), @p23=NULL (DbType = Guid), @p24='0', @p25='Draft' (Nullable = false) (Size = 450), @p26=NULL (DbType = Guid), @p27='Income' (Nullable = false) (Size = 450), @p28=NULL (DbType = DateTime2), @p29=NULL (Size = 4000), @p30='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56', @p31='BankAccount' (Nullable = false) (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Vouchers] ([Id], [Amount], [BankAccountId], [CategoryAccountId], [Code], [CompanyId], [CounterpartyId], [CounterpartyType], [CreatedAt], [CreatedBy], [CreatedById], [CurrencyCode], [Date], [Description], [FxRate], [IsActive], [IsDeleted], [JournalAccountId], [PostedAt], [PostedBy], [RecurrenceId], [RecurringScheduleId], [ReversedAt], [ReversedBy], [Revision], [Status], [TreasuryId], [Type], [UpdatedAt], [UpdatedById], [WalletId], [WalletType])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-09-18 01:29:20.099 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_Companies_CompanyId". The conflict occurred in database "ModularERP", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:ab5fc75c-8ef2-4afe-9956-dbd18d27c56a
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_Companies_CompanyId". The conflict occurred in database "ModularERP", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:ab5fc75c-8ef2-4afe-9956-dbd18d27c56a
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-18 01:29:20.141 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 1815.9751ms
2025-09-18 01:29:20.146 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:29:20.148 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_Companies_CompanyId". The conflict occurred in database "ModularERP", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:ab5fc75c-8ef2-4afe-9956-dbd18d27c56a
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 92
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler.Handle(CreateIncomeVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Handlers\CreateIncomeVoucherHandler.cs:line 75
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher(CreateIncomeVoucherDto request) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Controllers\IncomeVouchersController.cs:line 31
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-18 01:29:20.225 +03:00 [INF] Error response sent with status code 500
2025-09-18 01:29:20.234 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 500 null application/json; charset=utf-8 1952.1042ms
2025-09-18 01:32:09.500 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:32:09.505 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 4.4363ms
2025-09-18 01:32:09.538 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:32:09.546 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:32:09.549 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 11.8262ms
2025-09-18 01:32:09.552 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:32:09.557 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:32:09.559 +03:00 [INF] Request started
2025-09-18 01:32:09.560 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:32:09.562 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:32:09.617 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:32:09.626 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:32:09.646 +03:00 [ERR] Failed executing DbCommand (10ms) [Parameters=[@p0='e5ca8b52-5738-4de1-d55c-08ddf639a502', @p1='500.00' (Precision = 18) (Scale = 2), @p2=NULL (DbType = Guid), @p3='d880c62f-a545-41fe-876d-f76a4a6c1077', @p4='EXP-081' (Nullable = false) (Size = 20), @p5='00000000-0000-0000-0000-000000000000', @p6='3fa85f64-5717-4562-b3fc-2c963f66afa6' (Nullable = true), @p7='Vendor' (Size = 450), @p8='2025-09-17T22:32:09.6333938Z', @p9='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p10=NULL (Size = 4000), @p11='EGP' (Nullable = false) (Size = 3), @p12='2025-09-17T13:07:31.9820000Z', @p13='Dummy expense voucher' (Size = 4000), @p14='1.0' (Precision = 18) (Scale = 6), @p15='True', @p16='False', @p17='00000000-0000-0000-0000-000000000000', @p18=NULL (DbType = DateTime2), @p19=NULL (DbType = Guid), @p20='7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe' (Nullable = true), @p21=NULL (DbType = Guid), @p22=NULL (DbType = DateTime2), @p23=NULL (DbType = Guid), @p24='0', @p25='Draft' (Nullable = false) (Size = 450), @p26=NULL (DbType = Guid), @p27='Income' (Nullable = false) (Size = 450), @p28=NULL (DbType = DateTime2), @p29=NULL (Size = 4000), @p30='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56', @p31='BankAccount' (Nullable = false) (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Vouchers] ([Id], [Amount], [BankAccountId], [CategoryAccountId], [Code], [CompanyId], [CounterpartyId], [CounterpartyType], [CreatedAt], [CreatedBy], [CreatedById], [CurrencyCode], [Date], [Description], [FxRate], [IsActive], [IsDeleted], [JournalAccountId], [PostedAt], [PostedBy], [RecurrenceId], [RecurringScheduleId], [ReversedAt], [ReversedBy], [Revision], [Status], [TreasuryId], [Type], [UpdatedAt], [UpdatedById], [WalletId], [WalletType])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-09-18 01:32:09.657 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_Companies_CompanyId". The conflict occurred in database "ModularERP", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:ab5fc75c-8ef2-4afe-9956-dbd18d27c56a
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_Companies_CompanyId". The conflict occurred in database "ModularERP", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:ab5fc75c-8ef2-4afe-9956-dbd18d27c56a
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-18 01:32:09.697 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 129.4517ms
2025-09-18 01:32:09.700 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:32:09.702 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_Companies_CompanyId". The conflict occurred in database "ModularERP", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:ab5fc75c-8ef2-4afe-9956-dbd18d27c56a
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 92
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler.Handle(CreateIncomeVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Handlers\CreateIncomeVoucherHandler.cs:line 75
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher(CreateIncomeVoucherDto request) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Controllers\IncomeVouchersController.cs:line 31
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-18 01:32:09.752 +03:00 [INF] Error response sent with status code 500
2025-09-18 01:32:09.754 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 500 null application/json; charset=utf-8 201.5259ms
2025-09-18 01:37:17.127 +03:00 [INF] Starting web host...
2025-09-18 01:37:17.437 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 01:37:17.441 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 01:37:17.513 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 01:37:17.515 +03:00 [INF] Hosting environment: Development
2025-09-18 01:37:17.517 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 01:37:23.514 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 01:37:23.655 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 140.5977ms
2025-09-18 01:37:23.687 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 01:37:23.696 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.8468ms
2025-09-18 01:37:24.780 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 01:37:24.817 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 36.8235ms
2025-09-18 01:37:25.003 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 01:37:25.151 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 147.9679ms
2025-09-18 01:37:39.617 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:37:39.624 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 7.4142ms
2025-09-18 01:37:39.659 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:37:39.666 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:37:39.669 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 9.6509ms
2025-09-18 01:37:39.673 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:37:39.676 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:37:39.693 +03:00 [INF] Request started
2025-09-18 01:37:39.696 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:37:39.712 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:37:39.717 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:37:40.384 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 01:37:40.608 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:37:41.077 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:37:41.178 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:37:41.441 +03:00 [ERR] Failed executing DbCommand (23ms) [Parameters=[@p0='f7453da6-a2e6-4d94-3181-08ddf63acfdd', @p1='500.00' (Precision = 18) (Scale = 2), @p2=NULL (DbType = Guid), @p3='d880c62f-a545-41fe-876d-f76a4a6c1077', @p4='EXP-081' (Nullable = false) (Size = 20), @p5='d00cf078-c1ff-4feb-ae37-d66a827ae438', @p6='3fa85f64-5717-4562-b3fc-2c963f66afa6' (Nullable = true), @p7='Vendor' (Size = 450), @p8='2025-09-17T22:37:41.2154227Z', @p9='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p10=NULL (Size = 4000), @p11='EGP' (Nullable = false) (Size = 3), @p12='2025-09-17T13:07:31.9820000Z', @p13='Dummy expense voucher' (Size = 4000), @p14='1.0' (Precision = 18) (Scale = 6), @p15='True', @p16='False', @p17='00000000-0000-0000-0000-000000000000', @p18=NULL (DbType = DateTime2), @p19=NULL (DbType = Guid), @p20='7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe' (Nullable = true), @p21=NULL (DbType = Guid), @p22=NULL (DbType = DateTime2), @p23=NULL (DbType = Guid), @p24='0', @p25='Draft' (Nullable = false) (Size = 450), @p26=NULL (DbType = Guid), @p27='Income' (Nullable = false) (Size = 450), @p28=NULL (DbType = DateTime2), @p29=NULL (Size = 4000), @p30='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56', @p31='BankAccount' (Nullable = false) (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Vouchers] ([Id], [Amount], [BankAccountId], [CategoryAccountId], [Code], [CompanyId], [CounterpartyId], [CounterpartyType], [CreatedAt], [CreatedBy], [CreatedById], [CurrencyCode], [Date], [Description], [FxRate], [IsActive], [IsDeleted], [JournalAccountId], [PostedAt], [PostedBy], [RecurrenceId], [RecurringScheduleId], [ReversedAt], [ReversedBy], [Revision], [Status], [TreasuryId], [Type], [UpdatedAt], [UpdatedById], [WalletId], [WalletType])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-09-18 01:37:41.467 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Vouchers' with unique index 'IX_Vouchers_CompanyId_Code'. The duplicate key value is (d00cf078-c1ff-4feb-ae37-d66a827ae438, EXP-081).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:d1a8c26b-1893-4496-851b-1394850b9f3a
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Vouchers' with unique index 'IX_Vouchers_CompanyId_Code'. The duplicate key value is (d00cf078-c1ff-4feb-ae37-d66a827ae438, EXP-081).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:d1a8c26b-1893-4496-851b-1394850b9f3a
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-18 01:37:41.512 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 1794.6718ms
2025-09-18 01:37:41.516 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:37:41.518 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Vouchers' with unique index 'IX_Vouchers_CompanyId_Code'. The duplicate key value is (d00cf078-c1ff-4feb-ae37-d66a827ae438, EXP-081).
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:d1a8c26b-1893-4496-851b-1394850b9f3a
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 92
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler.Handle(CreateIncomeVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Handlers\CreateIncomeVoucherHandler.cs:line 76
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher(CreateIncomeVoucherDto request) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Controllers\IncomeVouchersController.cs:line 31
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-18 01:37:41.588 +03:00 [INF] Error response sent with status code 500
2025-09-18 01:37:41.597 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 500 null application/json; charset=utf-8 1923.2229ms
2025-09-18 01:42:59.583 +03:00 [INF] Starting web host...
2025-09-18 01:43:00.136 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 01:43:00.140 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 01:43:00.260 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 01:43:00.261 +03:00 [INF] Hosting environment: Development
2025-09-18 01:43:00.263 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 01:43:03.820 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 01:43:03.929 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 109.4173ms
2025-09-18 01:43:03.953 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 01:43:03.953 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 01:43:03.959 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.3257ms
2025-09-18 01:43:03.979 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 25.4717ms
2025-09-18 01:43:05.291 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 01:43:05.383 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 92.2796ms
2025-09-18 01:43:11.948 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:43:11.956 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 8.0838ms
2025-09-18 01:43:11.991 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:43:11.999 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:43:12.002 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 10.558ms
2025-09-18 01:43:12.006 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:43:12.009 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:43:12.021 +03:00 [INF] Request started
2025-09-18 01:43:12.024 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:43:12.042 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:43:12.049 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:43:12.754 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 01:43:12.993 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:43:13.468 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:43:13.575 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:43:13.635 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__code_0='EXP-081' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Vouchers] AS [v]
        WHERE [v].[CompanyId] = 'd00cf078-c1ff-4feb-ae37-d66a827ae438' AND [v].[Code] = @__code_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-18 01:43:13.648 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2025-09-18 01:43:13.654 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 1604.5918ms
2025-09-18 01:43:13.657 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:43:13.659 +03:00 [INF] Request completed successfully with status code 400
2025-09-18 01:43:13.665 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 400 null text/plain; charset=utf-8 1659.2778ms
2025-09-18 01:43:22.846 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:43:22.850 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 3.6655ms
2025-09-18 01:43:22.853 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:43:22.860 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:43:22.864 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 11.3009ms
2025-09-18 01:43:22.865 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:43:22.871 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:43:22.872 +03:00 [INF] Request started
2025-09-18 01:43:22.873 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:43:22.880 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:43:22.945 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:43:22.953 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:43:22.962 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__code_0='EXP-159' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Vouchers] AS [v]
        WHERE [v].[CompanyId] = 'd00cf078-c1ff-4feb-ae37-d66a827ae438' AND [v].[Code] = @__code_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-18 01:43:23.198 +03:00 [ERR] Failed executing DbCommand (19ms) [Parameters=[@p0='1f28a1a4-3686-43c5-fea6-08ddf63b9b91', @p1='500.00' (Precision = 18) (Scale = 2), @p2=NULL (DbType = Guid), @p3='d880c62f-a545-41fe-876d-f76a4a6c1077', @p4='EXP-159' (Nullable = false) (Size = 20), @p5='d00cf078-c1ff-4feb-ae37-d66a827ae438', @p6='3fa85f64-5717-4562-b3fc-2c963f66afa6' (Nullable = true), @p7='Vendor' (Size = 450), @p8='2025-09-17T22:43:22.9774369Z', @p9='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p10=NULL (Size = 4000), @p11='EGP' (Nullable = false) (Size = 3), @p12='2025-09-17T13:07:31.9820000Z', @p13='Dummy expense voucher' (Size = 4000), @p14='1.0' (Precision = 18) (Scale = 6), @p15='True', @p16='False', @p17='00000000-0000-0000-0000-000000000000', @p18=NULL (DbType = DateTime2), @p19=NULL (DbType = Guid), @p20='7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe' (Nullable = true), @p21=NULL (DbType = Guid), @p22=NULL (DbType = DateTime2), @p23=NULL (DbType = Guid), @p24='0', @p25='Draft' (Nullable = false) (Size = 450), @p26=NULL (DbType = Guid), @p27='Income' (Nullable = false) (Size = 450), @p28=NULL (DbType = DateTime2), @p29=NULL (Size = 4000), @p30='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56', @p31='BankAccount' (Nullable = false) (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Vouchers] ([Id], [Amount], [BankAccountId], [CategoryAccountId], [Code], [CompanyId], [CounterpartyId], [CounterpartyType], [CreatedAt], [CreatedBy], [CreatedById], [CurrencyCode], [Date], [Description], [FxRate], [IsActive], [IsDeleted], [JournalAccountId], [PostedAt], [PostedBy], [RecurrenceId], [RecurringScheduleId], [ReversedAt], [ReversedBy], [Revision], [Status], [TreasuryId], [Type], [UpdatedAt], [UpdatedById], [WalletId], [WalletType])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-09-18 01:43:23.228 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_GlAccounts_JournalAccountId". The conflict occurred in database "ModularERP", table "dbo.GlAccounts", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:d7530c28-c9f2-4161-9726-9eafe758b18d
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_GlAccounts_JournalAccountId". The conflict occurred in database "ModularERP", table "dbo.GlAccounts", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:d7530c28-c9f2-4161-9726-9eafe758b18d
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-18 01:43:23.266 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 382.6496ms
2025-09-18 01:43:23.268 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:43:23.270 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_GlAccounts_JournalAccountId". The conflict occurred in database "ModularERP", table "dbo.GlAccounts", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:d7530c28-c9f2-4161-9726-9eafe758b18d
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 93
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler.Handle(CreateIncomeVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Handlers\CreateIncomeVoucherHandler.cs:line 89
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher(CreateIncomeVoucherDto request) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Controllers\IncomeVouchersController.cs:line 31
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-18 01:43:23.343 +03:00 [INF] Error response sent with status code 500
2025-09-18 01:43:23.345 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 500 null application/json; charset=utf-8 480.3295ms
2025-09-18 01:43:33.880 +03:00 [INF] Application is shutting down...
2025-09-18 01:45:43.076 +03:00 [INF] Starting web host...
2025-09-18 01:45:43.417 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 01:45:43.421 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 01:45:43.495 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 01:45:43.497 +03:00 [INF] Hosting environment: Development
2025-09-18 01:45:43.499 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 01:45:46.537 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:45:46.567 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 30.4349ms
2025-09-18 01:45:46.600 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:45:46.606 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:45:46.609 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 9.1215ms
2025-09-18 01:45:46.613 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:45:46.619 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:45:46.628 +03:00 [INF] Request started
2025-09-18 01:45:46.631 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:45:46.654 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:45:46.658 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:45:47.338 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 01:45:47.552 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:45:48.018 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:45:48.129 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:45:48.180 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__code_0='INC-159' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Vouchers] AS [v]
        WHERE [v].[CompanyId] = 'd00cf078-c1ff-4feb-ae37-d66a827ae438' AND [v].[Code] = @__code_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-18 01:45:48.417 +03:00 [ERR] Failed executing DbCommand (20ms) [Parameters=[@p0='fc9cbdec-5ed8-4eae-093b-08ddf63bf220', @p1='500.00' (Precision = 18) (Scale = 2), @p2=NULL (DbType = Guid), @p3='d880c62f-a545-41fe-876d-f76a4a6c1077', @p4='INC-159' (Nullable = false) (Size = 20), @p5='d00cf078-c1ff-4feb-ae37-d66a827ae438', @p6='3fa85f64-5717-4562-b3fc-2c963f66afa6' (Nullable = true), @p7='Vendor' (Size = 450), @p8='2025-09-17T22:45:48.1929621Z', @p9='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p10=NULL (Size = 4000), @p11='EGP' (Nullable = false) (Size = 3), @p12='2025-09-17T13:07:31.9820000Z', @p13='Dummy expense voucher' (Size = 4000), @p14='1.0' (Precision = 18) (Scale = 6), @p15='True', @p16='False', @p17='00000000-0000-0000-0000-000000000000', @p18=NULL (DbType = DateTime2), @p19=NULL (DbType = Guid), @p20='7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe' (Nullable = true), @p21=NULL (DbType = Guid), @p22=NULL (DbType = DateTime2), @p23=NULL (DbType = Guid), @p24='0', @p25='Draft' (Nullable = false) (Size = 450), @p26=NULL (DbType = Guid), @p27='Income' (Nullable = false) (Size = 450), @p28=NULL (DbType = DateTime2), @p29=NULL (Size = 4000), @p30='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56', @p31='BankAccount' (Nullable = false) (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Vouchers] ([Id], [Amount], [BankAccountId], [CategoryAccountId], [Code], [CompanyId], [CounterpartyId], [CounterpartyType], [CreatedAt], [CreatedBy], [CreatedById], [CurrencyCode], [Date], [Description], [FxRate], [IsActive], [IsDeleted], [JournalAccountId], [PostedAt], [PostedBy], [RecurrenceId], [RecurringScheduleId], [ReversedAt], [ReversedBy], [Revision], [Status], [TreasuryId], [Type], [UpdatedAt], [UpdatedById], [WalletId], [WalletType])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-09-18 01:45:48.447 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_GlAccounts_JournalAccountId". The conflict occurred in database "ModularERP", table "dbo.GlAccounts", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:71098119-6ac6-41e0-9d80-79a3f27fc834
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_GlAccounts_JournalAccountId". The conflict occurred in database "ModularERP", table "dbo.GlAccounts", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:71098119-6ac6-41e0-9d80-79a3f27fc834
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-09-18 01:45:48.488 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 1829.4838ms
2025-09-18 01:45:48.492 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:45:48.495 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_GlAccounts_JournalAccountId". The conflict occurred in database "ModularERP", table "dbo.GlAccounts", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:71098119-6ac6-41e0-9d80-79a3f27fc834
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 93
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler.Handle(CreateIncomeVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Handlers\CreateIncomeVoucherHandler.cs:line 89
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher(CreateIncomeVoucherDto request) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Controllers\IncomeVouchersController.cs:line 31
   at lambda_method6(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-18 01:45:48.547 +03:00 [INF] Error response sent with status code 500
2025-09-18 01:45:48.556 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 500 null application/json; charset=utf-8 1942.6133ms
2025-09-18 01:49:47.425 +03:00 [INF] Starting web host...
2025-09-18 01:49:47.873 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 01:49:47.878 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 01:49:47.993 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 01:49:47.995 +03:00 [INF] Hosting environment: Development
2025-09-18 01:49:47.996 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 01:49:53.920 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 01:49:54.112 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 190.9286ms
2025-09-18 01:49:54.145 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 01:49:54.151 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.2041ms
2025-09-18 01:49:55.592 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 01:49:55.642 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 50.0647ms
2025-09-18 01:49:55.893 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 01:49:55.971 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 77.9771ms
2025-09-18 01:50:05.225 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:50:05.233 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 7.3942ms
2025-09-18 01:50:05.266 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:50:05.272 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:50:05.275 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 8.9614ms
2025-09-18 01:50:05.279 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:50:05.282 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:50:05.293 +03:00 [INF] Request started
2025-09-18 01:50:05.297 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:50:05.316 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:50:05.323 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:50:06.015 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 01:50:06.270 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 01:50:06.745 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:50:06.844 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:50:06.894 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__code_0='INC-159' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Vouchers] AS [v]
        WHERE [v].[CompanyId] = 'd00cf078-c1ff-4feb-ae37-d66a827ae438' AND [v].[Code] = @__code_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-18 01:50:06.911 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:50:07.172 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='0ab8d8b1-6e73-405f-9c5d-08ddf63c8c56', @p1='500.00' (Precision = 18) (Scale = 2), @p2=NULL (DbType = Guid), @p3='d880c62f-a545-41fe-876d-f76a4a6c1077', @p4='INC-159' (Nullable = false) (Size = 20), @p5='d00cf078-c1ff-4feb-ae37-d66a827ae438', @p6='3fa85f64-5717-4562-b3fc-2c963f66afa6' (Nullable = true), @p7='Vendor' (Size = 450), @p8='2025-09-17T22:50:06.9078104Z', @p9='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p10=NULL (Size = 4000), @p11='EGP' (Nullable = false) (Size = 3), @p12='2025-09-17T13:07:31.9820000Z', @p13='Dummy expense voucher' (Size = 4000), @p14='1.0' (Precision = 18) (Scale = 6), @p15='True', @p16='False', @p17='f8cd0c63-50d7-4a69-a344-bc53be110f77', @p18=NULL (DbType = DateTime2), @p19=NULL (DbType = Guid), @p20='7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe' (Nullable = true), @p21=NULL (DbType = Guid), @p22=NULL (DbType = DateTime2), @p23=NULL (DbType = Guid), @p24='0', @p25='Draft' (Nullable = false) (Size = 450), @p26=NULL (DbType = Guid), @p27='Income' (Nullable = false) (Size = 450), @p28=NULL (DbType = DateTime2), @p29=NULL (Size = 4000), @p30='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56', @p31='BankAccount' (Nullable = false) (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Vouchers] ([Id], [Amount], [BankAccountId], [CategoryAccountId], [Code], [CompanyId], [CounterpartyId], [CounterpartyType], [CreatedAt], [CreatedBy], [CreatedById], [CurrencyCode], [Date], [Description], [FxRate], [IsActive], [IsDeleted], [JournalAccountId], [PostedAt], [PostedBy], [RecurrenceId], [RecurringScheduleId], [ReversedAt], [ReversedBy], [Revision], [Status], [TreasuryId], [Type], [UpdatedAt], [UpdatedById], [WalletId], [WalletType])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-09-18 01:50:07.272 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='edbfcbaa-4e14-42d9-9b9f-08ddf63c8c80', @p1=NULL (Size = 64), @p2='2025-09-17T22:50:07.2162480Z', @p3=NULL (Size = 4000), @p4='invoice.pdf' (Nullable = false) (Size = 500), @p5='0', @p6='invoice.pdf' (Nullable = false) (Size = 255), @p7='True', @p8='False', @p9='' (Nullable = false) (Size = 100), @p10=NULL (DbType = DateTime2), @p11=NULL (Size = 4000), @p12='2025-09-17T22:50:07.2163720Z', @p13='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p14='0ab8d8b1-6e73-405f-9c5d-08ddf63c8c56', @p15='41de91d1-2215-447c-5886-08ddf63c8c7d', @p16='100.0' (Precision = 18) (Scale = 2), @p17='2025-09-17T22:50:07.1947312Z', @p18=NULL (Size = 4000), @p19='Income' (Nullable = false) (Size = 4000), @p20='True', @p21='False', @p22='True', @p23='14.0' (Precision = 18) (Scale = 2), @p24='020c0bbf-8202-42d8-9692-2fc202aa5c08', @p25=NULL (DbType = DateTime2), @p26=NULL (Size = 4000), @p27='0ab8d8b1-6e73-405f-9c5d-08ddf63c8c56'], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Attachments] ([Id], [Checksum], [CreatedAt], [CreatedById], [FilePath], [FileSize], [Filename], [IsActive], [IsDeleted], [MimeType], [UpdatedAt], [UpdatedById], [UploadedAt], [UploadedBy], [VoucherId])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
INSERT INTO [VoucherTaxes] ([Id], [BaseAmount], [CreatedAt], [CreatedById], [Direction], [IsActive], [IsDeleted], [IsWithholding], [TaxAmount], [TaxId], [UpdatedAt], [UpdatedById], [VoucherId])
VALUES (@p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27);
2025-09-18 01:50:07.302 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto'.
2025-09-18 01:50:07.330 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 2007.8856ms
2025-09-18 01:50:07.333 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:50:07.335 +03:00 [INF] Request completed successfully with status code 201
2025-09-18 01:50:07.343 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 201 null application/json; charset=utf-8 2063.9386ms
2025-09-18 01:51:07.954 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 01:51:07.960 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 5.5279ms
2025-09-18 01:51:07.963 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 01:51:07.970 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:51:07.972 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 8.4504ms
2025-09-18 01:51:07.974 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 01:51:07.981 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:51:07.983 +03:00 [INF] Request started
2025-09-18 01:51:07.983 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:51:07.987 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:51:08.038 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:51:08.047 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 01:51:08.058 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__code_0='EXP-179' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Vouchers] AS [v]
        WHERE [v].[CompanyId] = 'd00cf078-c1ff-4feb-ae37-d66a827ae438' AND [v].[Code] = @__code_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-18 01:51:08.065 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 01:51:08.087 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56', @p1='500.00' (Precision = 18) (Scale = 2), @p2=NULL (DbType = Guid), @p3='d880c62f-a545-41fe-876d-f76a4a6c1077', @p4='EXP-179' (Nullable = false) (Size = 20), @p5='d00cf078-c1ff-4feb-ae37-d66a827ae438', @p6='3fa85f64-5717-4562-b3fc-2c963f66afa6' (Nullable = true), @p7='Vendor' (Size = 450), @p8='2025-09-17T22:51:08.0642802Z', @p9='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p10=NULL (Size = 4000), @p11='EGP' (Nullable = false) (Size = 3), @p12='2025-09-17T13:07:31.9820000Z', @p13='Dummy expense voucher' (Size = 4000), @p14='1.0' (Precision = 18) (Scale = 6), @p15='True', @p16='False', @p17='f8cd0c63-50d7-4a69-a344-bc53be110f77', @p18=NULL (DbType = DateTime2), @p19=NULL (DbType = Guid), @p20='7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe' (Nullable = true), @p21=NULL (DbType = Guid), @p22=NULL (DbType = DateTime2), @p23=NULL (DbType = Guid), @p24='0', @p25='Draft' (Nullable = false) (Size = 450), @p26=NULL (DbType = Guid), @p27='Income' (Nullable = false) (Size = 450), @p28=NULL (DbType = DateTime2), @p29=NULL (Size = 4000), @p30='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56', @p31='BankAccount' (Nullable = false) (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Vouchers] ([Id], [Amount], [BankAccountId], [CategoryAccountId], [Code], [CompanyId], [CounterpartyId], [CounterpartyType], [CreatedAt], [CreatedBy], [CreatedById], [CurrencyCode], [Date], [Description], [FxRate], [IsActive], [IsDeleted], [JournalAccountId], [PostedAt], [PostedBy], [RecurrenceId], [RecurringScheduleId], [ReversedAt], [ReversedBy], [Revision], [Status], [TreasuryId], [Type], [UpdatedAt], [UpdatedById], [WalletId], [WalletType])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-09-18 01:51:08.103 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='b2bf6405-72b8-43a0-9ba0-08ddf63c8c80', @p1=NULL (Size = 64), @p2='2025-09-17T22:51:08.0975112Z', @p3=NULL (Size = 4000), @p4='invoice.pdf' (Nullable = false) (Size = 500), @p5='0', @p6='invoice.pdf' (Nullable = false) (Size = 255), @p7='True', @p8='False', @p9='' (Nullable = false) (Size = 100), @p10=NULL (DbType = DateTime2), @p11=NULL (Size = 4000), @p12='2025-09-17T22:51:08.0975152Z', @p13='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p14='f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56', @p15='13932722-a22b-4b89-5887-08ddf63c8c7d', @p16='100.0' (Precision = 18) (Scale = 2), @p17='2025-09-17T22:51:08.0973463Z', @p18=NULL (Size = 4000), @p19='Income' (Nullable = false) (Size = 4000), @p20='True', @p21='False', @p22='True', @p23='14.0' (Precision = 18) (Scale = 2), @p24='020c0bbf-8202-42d8-9692-2fc202aa5c08', @p25=NULL (DbType = DateTime2), @p26=NULL (Size = 4000), @p27='f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56'], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Attachments] ([Id], [Checksum], [CreatedAt], [CreatedById], [FilePath], [FileSize], [Filename], [IsActive], [IsDeleted], [MimeType], [UpdatedAt], [UpdatedById], [UploadedAt], [UploadedBy], [VoucherId])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
INSERT INTO [VoucherTaxes] ([Id], [BaseAmount], [CreatedAt], [CreatedById], [Direction], [IsActive], [IsDeleted], [IsWithholding], [TaxAmount], [TaxId], [UpdatedAt], [UpdatedById], [VoucherId])
VALUES (@p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27);
2025-09-18 01:51:08.115 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto'.
2025-09-18 01:51:08.117 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 126.2434ms
2025-09-18 01:51:08.123 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 01:51:08.125 +03:00 [INF] Request completed successfully with status code 201
2025-09-18 01:51:08.127 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 201 null application/json; charset=utf-8 152.9945ms
2025-09-18 01:51:47.964 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/api/IncomeVouchers/f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56 - null null
2025-09-18 01:51:47.969 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/api/IncomeVouchers/f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56 - 307 0 null 5.1806ms
2025-09-18 01:51:47.974 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/api/IncomeVouchers/f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56 - null null
2025-09-18 01:51:47.980 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:51:47.983 +03:00 [INF] Request started
2025-09-18 01:51:47.984 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-18 01:51:47.993 +03:00 [INF] Route matched with {action = "GetIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] GetIncomeVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:51:48.031 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [v].[Id], [v].[Amount], [v].[BankAccountId], [v].[CategoryAccountId], [v].[Code], [v].[CompanyId], [v].[CounterpartyId], [v].[CounterpartyType], [v].[CreatedAt], [v].[CreatedBy], [v].[CreatedById], [v].[CurrencyCode], [v].[Date], [v].[Description], [v].[FxRate], [v].[IsActive], [v].[IsDeleted], [v].[JournalAccountId], [v].[PostedAt], [v].[PostedBy], [v].[RecurrenceId], [v].[RecurringScheduleId], [v].[ReversedAt], [v].[ReversedBy], [v].[Revision], [v].[Status], [v].[TreasuryId], [v].[Type], [v].[UpdatedAt], [v].[UpdatedById], [v].[WalletId], [v].[WalletType]
FROM [Vouchers] AS [v]
WHERE [v].[Id] = @__id_0
2025-09-18 01:51:48.049 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto'.
2025-09-18 01:51:48.051 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP) in 54.7451ms
2025-09-18 01:51:48.055 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-18 01:51:48.059 +03:00 [INF] Request completed successfully with status code 200
2025-09-18 01:51:48.061 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/api/IncomeVouchers/f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56 - 200 null application/json; charset=utf-8 87.2983ms
2025-09-18 01:51:58.824 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/api/IncomeVouchers/a0ed3318-35e7-45af-7a51-08ddf60e546f - null null
2025-09-18 01:51:58.828 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/api/IncomeVouchers/a0ed3318-35e7-45af-7a51-08ddf60e546f - 307 0 null 4.6384ms
2025-09-18 01:51:58.831 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/api/IncomeVouchers/a0ed3318-35e7-45af-7a51-08ddf60e546f - null null
2025-09-18 01:51:58.839 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:51:58.840 +03:00 [INF] Request started
2025-09-18 01:51:58.841 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-18 01:51:58.843 +03:00 [INF] Route matched with {action = "GetIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] GetIncomeVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:51:58.849 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='a0ed3318-35e7-45af-7a51-08ddf60e546f'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [v].[Id], [v].[Amount], [v].[BankAccountId], [v].[CategoryAccountId], [v].[Code], [v].[CompanyId], [v].[CounterpartyId], [v].[CounterpartyType], [v].[CreatedAt], [v].[CreatedBy], [v].[CreatedById], [v].[CurrencyCode], [v].[Date], [v].[Description], [v].[FxRate], [v].[IsActive], [v].[IsDeleted], [v].[JournalAccountId], [v].[PostedAt], [v].[PostedBy], [v].[RecurrenceId], [v].[RecurringScheduleId], [v].[ReversedAt], [v].[ReversedBy], [v].[Revision], [v].[Status], [v].[TreasuryId], [v].[Type], [v].[UpdatedAt], [v].[UpdatedById], [v].[WalletId], [v].[WalletType]
FROM [Vouchers] AS [v]
WHERE [v].[Id] = @__id_0
2025-09-18 01:51:58.859 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-09-18 01:51:58.874 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP) in 26.3774ms
2025-09-18 01:51:58.877 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-18 01:51:58.878 +03:00 [INF] Request completed successfully with status code 404
2025-09-18 01:51:58.879 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/api/IncomeVouchers/a0ed3318-35e7-45af-7a51-08ddf60e546f - 404 null application/problem+json; charset=utf-8 48.337ms
2025-09-18 01:52:23.490 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/api/IncomeVouchers/f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56 - null null
2025-09-18 01:52:23.495 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/api/IncomeVouchers/f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56 - 307 0 null 4.8876ms
2025-09-18 01:52:23.498 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/api/IncomeVouchers/f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56 - null null
2025-09-18 01:52:23.505 +03:00 [INF] CORS policy execution successful.
2025-09-18 01:52:23.506 +03:00 [INF] Request started
2025-09-18 01:52:23.507 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-18 01:52:23.508 +03:00 [INF] Route matched with {action = "GetIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] GetIncomeVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 01:52:23.519 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__id_0='f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [v].[Id], [v].[Amount], [v].[BankAccountId], [v].[CategoryAccountId], [v].[Code], [v].[CompanyId], [v].[CounterpartyId], [v].[CounterpartyType], [v].[CreatedAt], [v].[CreatedBy], [v].[CreatedById], [v].[CurrencyCode], [v].[Date], [v].[Description], [v].[FxRate], [v].[IsActive], [v].[IsDeleted], [v].[JournalAccountId], [v].[PostedAt], [v].[PostedBy], [v].[RecurrenceId], [v].[RecurringScheduleId], [v].[ReversedAt], [v].[ReversedBy], [v].[Revision], [v].[Status], [v].[TreasuryId], [v].[Type], [v].[UpdatedAt], [v].[UpdatedById], [v].[WalletId], [v].[WalletType]
FROM [Vouchers] AS [v]
WHERE [v].[Id] = @__id_0
2025-09-18 01:52:23.526 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto'.
2025-09-18 01:52:23.531 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP) in 17.2921ms
2025-09-18 01:52:23.534 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-18 01:52:23.536 +03:00 [INF] Request completed successfully with status code 200
2025-09-18 01:52:23.537 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/api/IncomeVouchers/f0b49dd6-6815-4fd4-9c5e-08ddf63c8c56 - 200 null application/json; charset=utf-8 38.8845ms
2025-09-18 02:19:34.891 +03:00 [INF] Starting web host...
2025-09-18 02:19:35.322 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 02:19:35.325 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 02:19:35.405 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 02:19:35.407 +03:00 [INF] Hosting environment: Development
2025-09-18 02:19:35.408 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 02:19:40.460 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 02:19:40.574 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 114.7197ms
2025-09-18 02:19:40.600 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 02:19:40.608 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.0259ms
2025-09-18 02:19:41.608 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 02:19:41.635 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 27.0552ms
2025-09-18 02:19:41.808 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 02:19:41.896 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 88.007ms
2025-09-18 02:19:57.809 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - application/json 753
2025-09-18 02:19:57.817 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5004/api/IncomeVouchers - 307 0 null 7.1919ms
2025-09-18 02:19:57.854 +03:00 [INF] Request starting HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - null null
2025-09-18 02:19:57.861 +03:00 [INF] CORS policy execution successful.
2025-09-18 02:19:57.863 +03:00 [INF] Request finished HTTP/2 OPTIONS https://localhost:7168/api/IncomeVouchers - 204 null null 8.5569ms
2025-09-18 02:19:57.867 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/IncomeVouchers - application/json 753
2025-09-18 02:19:57.869 +03:00 [INF] CORS policy execution successful.
2025-09-18 02:19:57.886 +03:00 [INF] Request started
2025-09-18 02:19:57.889 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 02:19:57.905 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.CreateIncomeVoucherDto) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 02:19:57.911 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 02:19:58.567 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 02:19:58.789 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 02:19:59.253 +03:00 [INF] Executed DbCommand (40ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 02:19:59.351 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__id_0='d880c62f-a545-41fe-876d-f76a4a6c1077'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [g].[Id], [g].[Code], [g].[CompanyId], [g].[CreatedAt], [g].[CreatedById], [g].[IsActive], [g].[IsDeleted], [g].[IsLeaf], [g].[Name], [g].[Type], [g].[UpdatedAt], [g].[UpdatedById]
FROM [GlAccounts] AS [g]
WHERE [g].[Id] = @__id_0
2025-09-18 02:19:59.408 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__code_0='INC-179' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Vouchers] AS [v]
        WHERE [v].[CompanyId] = 'd00cf078-c1ff-4feb-ae37-d66a827ae438' AND [v].[Code] = @__code_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-18 02:19:59.423 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__id_0='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [b].[Id], [b].[AccountNumber], [b].[BankName], [b].[CompanyId], [b].[CreatedAt], [b].[CreatedById], [b].[CurrencyCode], [b].[DepositAcl], [b].[Description], [b].[IsActive], [b].[IsDeleted], [b].[JournalAccountId], [b].[Name], [b].[Status], [b].[UpdatedAt], [b].[UpdatedById], [b].[WithdrawAcl]
FROM [BankAccounts] AS [b]
WHERE [b].[Id] = @__id_0
2025-09-18 02:19:59.646 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='c660e0ad-2288-4ed0-e87b-08ddf640b8c1', @p1='500.00' (Precision = 18) (Scale = 2), @p2=NULL (DbType = Guid), @p3='d880c62f-a545-41fe-876d-f76a4a6c1077', @p4='INC-179' (Nullable = false) (Size = 20), @p5='d00cf078-c1ff-4feb-ae37-d66a827ae438', @p6='3fa85f64-5717-4562-b3fc-2c963f66afa6' (Nullable = true), @p7='Vendor' (Size = 450), @p8='2025-09-17T23:19:59.4205276Z', @p9='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p10=NULL (Size = 4000), @p11='EGP' (Nullable = false) (Size = 3), @p12='2025-09-17T13:07:31.9820000Z', @p13='Dummy expense voucher' (Size = 4000), @p14='1.0' (Precision = 18) (Scale = 6), @p15='True', @p16='False', @p17='f8cd0c63-50d7-4a69-a344-bc53be110f77', @p18=NULL (DbType = DateTime2), @p19=NULL (DbType = Guid), @p20='7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe' (Nullable = true), @p21=NULL (DbType = Guid), @p22=NULL (DbType = DateTime2), @p23=NULL (DbType = Guid), @p24='0', @p25='Draft' (Nullable = false) (Size = 450), @p26=NULL (DbType = Guid), @p27='Income' (Nullable = false) (Size = 450), @p28=NULL (DbType = DateTime2), @p29=NULL (Size = 4000), @p30='4fe6e0a3-b441-45f6-96a4-0a1c499bbe56', @p31='BankAccount' (Nullable = false) (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Vouchers] ([Id], [Amount], [BankAccountId], [CategoryAccountId], [Code], [CompanyId], [CounterpartyId], [CounterpartyType], [CreatedAt], [CreatedBy], [CreatedById], [CurrencyCode], [Date], [Description], [FxRate], [IsActive], [IsDeleted], [JournalAccountId], [PostedAt], [PostedBy], [RecurrenceId], [RecurringScheduleId], [ReversedAt], [ReversedBy], [Revision], [Status], [TreasuryId], [Type], [UpdatedAt], [UpdatedById], [WalletId], [WalletType])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31);
2025-09-18 02:19:59.743 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='de7f5d89-7da4-4f62-61f7-08ddf640b8e6', @p1=NULL (Size = 64), @p2='2025-09-17T23:19:59.6896880Z', @p3=NULL (Size = 4000), @p4='invoice.pdf' (Nullable = false) (Size = 500), @p5='0', @p6='invoice.pdf' (Nullable = false) (Size = 255), @p7='True', @p8='False', @p9='' (Nullable = false) (Size = 100), @p10=NULL (DbType = DateTime2), @p11=NULL (Size = 4000), @p12='2025-09-17T23:19:59.6898212Z', @p13='5dbceb39-9677-46d7-bf8a-2eb914c55437', @p14='c660e0ad-2288-4ed0-e87b-08ddf640b8c1', @p15='7ca00f3e-6db0-41ca-f490-08ddf640b8e2', @p16='100.0' (Precision = 18) (Scale = 2), @p17='2025-09-17T23:19:59.6671074Z', @p18=NULL (Size = 4000), @p19='Income' (Nullable = false) (Size = 4000), @p20='True', @p21='False', @p22='True', @p23='14.0' (Precision = 18) (Scale = 2), @p24='020c0bbf-8202-42d8-9692-2fc202aa5c08', @p25=NULL (DbType = DateTime2), @p26=NULL (Size = 4000), @p27='c660e0ad-2288-4ed0-e87b-08ddf640b8c1'], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Attachments] ([Id], [Checksum], [CreatedAt], [CreatedById], [FilePath], [FileSize], [Filename], [IsActive], [IsDeleted], [MimeType], [UpdatedAt], [UpdatedById], [UploadedAt], [UploadedBy], [VoucherId])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
INSERT INTO [VoucherTaxes] ([Id], [BaseAmount], [CreatedAt], [CreatedById], [Direction], [IsActive], [IsDeleted], [IsWithholding], [TaxAmount], [TaxId], [UpdatedAt], [UpdatedById], [VoucherId])
VALUES (@p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27);
2025-09-18 02:19:59.770 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-18 02:19:59.801 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 1889.4865ms
2025-09-18 02:19:59.804 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-18 02:19:59.806 +03:00 [INF] Request completed successfully with status code 201
2025-09-18 02:19:59.812 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/IncomeVouchers - 201 null application/json; charset=utf-8 1945.077ms
2025-09-18 02:22:12.447 +03:00 [INF] Starting web host...
2025-09-18 02:22:12.796 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 02:22:12.799 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 02:22:12.873 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 02:22:12.875 +03:00 [INF] Hosting environment: Development
2025-09-18 02:22:12.876 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 02:22:12.956 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/index.html - null null
2025-09-18 02:22:13.084 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/index.html - 200 null text/html;charset=utf-8 129.3989ms
2025-09-18 02:22:14.291 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_vs/browserLink - null null
2025-09-18 02:22:14.291 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - null null
2025-09-18 02:22:14.300 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.0482ms
2025-09-18 02:22:14.329 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/_vs/browserLink - 200 null text/javascript; charset=UTF-8 38.6411ms
2025-09-18 02:22:14.540 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - null null
2025-09-18 02:22:14.582 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 42.4168ms
2025-09-18 02:24:18.858 +03:00 [INF] Starting web host...
2025-09-18 02:24:19.272 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-18 02:24:19.275 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-18 02:24:19.357 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-18 02:24:19.359 +03:00 [INF] Hosting environment: Development
2025-09-18 02:24:19.361 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-18 02:24:37.126 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5004/api/IncomeVouchers/c660e0ad-2288-4ed0-e87b-08ddf640b8c1 - null null
2025-09-18 02:24:37.153 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5004/api/IncomeVouchers/c660e0ad-2288-4ed0-e87b-08ddf640b8c1 - 307 0 null 29.1052ms
2025-09-18 02:24:37.189 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/api/IncomeVouchers/c660e0ad-2288-4ed0-e87b-08ddf640b8c1 - null null
2025-09-18 02:24:37.197 +03:00 [INF] CORS policy execution successful.
2025-09-18 02:24:37.208 +03:00 [INF] Request started
2025-09-18 02:24:37.211 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-18 02:24:37.230 +03:00 [INF] Route matched with {action = "GetIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] GetIncomeVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-18 02:24:37.235 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 02:24:37.959 +03:00 [WRN] Sensitive data logging is enabled. Log entries and exception messages may include sensitive application data; this mode should only be enabled during development.
2025-09-18 02:24:38.204 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-18 02:24:38.699 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__id_0='c660e0ad-2288-4ed0-e87b-08ddf640b8c1'], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [v].[Id], [v].[Amount], [v].[BankAccountId], [v].[CategoryAccountId], [v].[Code], [v].[CompanyId], [v].[CounterpartyId], [v].[CounterpartyType], [v].[CreatedAt], [v].[CreatedBy], [v].[CreatedById], [v].[CurrencyCode], [v].[Date], [v].[Description], [v].[FxRate], [v].[IsActive], [v].[IsDeleted], [v].[JournalAccountId], [v].[PostedAt], [v].[PostedBy], [v].[RecurrenceId], [v].[RecurringScheduleId], [v].[ReversedAt], [v].[ReversedBy], [v].[Revision], [v].[Status], [v].[TreasuryId], [v].[Type], [v].[UpdatedAt], [v].[UpdatedById], [v].[WalletId], [v].[WalletType]
FROM [Vouchers] AS [v]
WHERE [v].[Id] = @__id_0
2025-09-18 02:24:38.853 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__voucher_Id_0='c660e0ad-2288-4ed0-e87b-08ddf640b8c1'], CommandType='"Text"', CommandTimeout='30']
SELECT [v].[Id], [v].[BaseAmount], [v].[CreatedAt], [v].[CreatedById], [v].[Direction], [v].[IsActive], [v].[IsDeleted], [v].[IsWithholding], [v].[TaxAmount], [v].[TaxId], [v].[UpdatedAt], [v].[UpdatedById], [v].[VoucherId]
FROM [VoucherTaxes] AS [v]
WHERE [v].[IsDeleted] = CAST(0 AS bit) AND [v].[VoucherId] = @__voucher_Id_0
2025-09-18 02:24:38.900 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__voucher_Id_0='c660e0ad-2288-4ed0-e87b-08ddf640b8c1'], CommandType='"Text"', CommandTimeout='30']
SELECT [a].[Id], [a].[Checksum], [a].[CreatedAt], [a].[CreatedById], [a].[FilePath], [a].[FileSize], [a].[Filename], [a].[IsActive], [a].[IsDeleted], [a].[MimeType], [a].[UpdatedAt], [a].[UpdatedById], [a].[UploadedAt], [a].[UploadedBy], [a].[VoucherId]
FROM [Attachments] AS [a]
WHERE [a].[IsDeleted] = CAST(0 AS bit) AND [a].[VoucherId] = @__voucher_Id_0
2025-09-18 02:24:38.941 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-18 02:24:38.967 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP) in 1731.9073ms
2025-09-18 02:24:38.970 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-18 02:24:38.973 +03:00 [INF] Request completed successfully with status code 200
2025-09-18 02:24:38.981 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/api/IncomeVouchers/c660e0ad-2288-4ed0-e87b-08ddf640b8c1 - 200 null application/json; charset=utf-8 1792.0084ms
