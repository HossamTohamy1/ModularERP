2025-09-25 00:01:33.049 +03:00 [INF] Starting web host...
2025-09-25 00:01:33.896 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:01:33.994 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 00:01:34.071 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:01:34.076 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 00:01:34.097 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 00:01:34.156 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 00:01:34.172 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:01:34.176 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 00:01:34.184 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 00:01:34.196 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 00:01:34.203 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 00:01:34.368 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 00:01:34.377 +03:00 [INF] Master database initialized successfully
2025-09-25 00:01:34.662 +03:00 [FTL] Host terminated unexpectedly
System.TypeInitializationException: The type initializer for 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext' threw an exception.
 ---> System.Reflection.AmbiguousMatchException: Ambiguous match found for 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext Void SetGlobalFilter[T](Microsoft.EntityFrameworkCore.ModelBuilder)'.
   at System.RuntimeType.GetMethodImplCommon(String name, Int32 genericParameterCount, BindingFlags bindingAttr, Binder binder, CallingConventions callConv, Type[] types, ParameterModifier[] modifiers)
   at System.RuntimeType.GetMethodImpl(String name, BindingFlags bindingAttr, Binder binder, CallingConventions callConv, Type[] types, ParameterModifier[] modifiers)
   at System.Type.GetMethod(String name, BindingFlags bindingAttr)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext..cctor() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 328
   --- End of inner exception stack trace ---
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.ApplyGlobalFilters(ModelBuilder builder) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 322
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.OnModelCreating(ModelBuilder builder) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 312
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelCustomizer.Customize(ModelBuilder modelBuilder, DbContext context)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelSource.CreateModel(DbContext context, IConventionSetBuilder conventionSetBuilder, ModelDependencies modelDependencies)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelSource.CreateModel(DbContext context, ModelCreationDependencies modelCreationDependencies, Boolean designTime)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelSource.GetModel(DbContext context, ModelCreationDependencies modelCreationDependencies, Boolean designTime)
   at Microsoft.EntityFrameworkCore.Internal.DbContextServices.CreateModel(Boolean designTime)
   at Microsoft.EntityFrameworkCore.Internal.DbContextServices.get_Model()
   at Microsoft.EntityFrameworkCore.Infrastructure.EntityFrameworkServicesBuilder.<>c.<TryAddCoreServices>b__8_4(IServiceProvider p)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitFactory(FactoryCallSite factoryCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.DynamicServiceProviderEngine.<>c__DisplayClass2_0.<RealizeService>b__0(ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.get_ContextServices()
   at Microsoft.EntityFrameworkCore.DbContext.get_InternalServiceProvider()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Infrastructure.IInfrastructure<System.IServiceProvider>.get_Instance()
   at Microsoft.EntityFrameworkCore.Infrastructure.DatabaseFacade.Microsoft.EntityFrameworkCore.Infrastructure.IInfrastructure<System.IServiceProvider>.get_Instance()
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.GetRelationalService[TService](IInfrastructure`1 databaseFacade)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.Migrate(DatabaseFacade databaseFacade)
   at ModularERP.Program.Main(String[] args) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 178
2025-09-25 00:01:55.492 +03:00 [INF] Starting web host...
2025-09-25 00:01:56.271 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:01:56.306 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 00:01:56.375 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:01:56.380 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 00:01:56.384 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 00:01:56.438 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 00:01:56.454 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:01:56.458 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 00:01:56.464 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 00:01:56.477 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 00:01:56.482 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 00:01:56.637 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 00:01:56.644 +03:00 [INF] Master database initialized successfully
2025-09-25 00:01:56.904 +03:00 [FTL] Host terminated unexpectedly
System.TypeInitializationException: The type initializer for 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext' threw an exception.
 ---> System.Reflection.AmbiguousMatchException: Ambiguous match found for 'ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext Void SetGlobalFilter[T](Microsoft.EntityFrameworkCore.ModelBuilder)'.
   at System.RuntimeType.GetMethodImplCommon(String name, Int32 genericParameterCount, BindingFlags bindingAttr, Binder binder, CallingConventions callConv, Type[] types, ParameterModifier[] modifiers)
   at System.RuntimeType.GetMethodImpl(String name, BindingFlags bindingAttr, Binder binder, CallingConventions callConv, Type[] types, ParameterModifier[] modifiers)
   at System.Type.GetMethod(String name, BindingFlags bindingAttr)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext..cctor() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 328
   --- End of inner exception stack trace ---
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.ApplyGlobalFilters(ModelBuilder builder) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 322
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.OnModelCreating(ModelBuilder builder) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 312
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelCustomizer.Customize(ModelBuilder modelBuilder, DbContext context)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelSource.CreateModel(DbContext context, IConventionSetBuilder conventionSetBuilder, ModelDependencies modelDependencies)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelSource.CreateModel(DbContext context, ModelCreationDependencies modelCreationDependencies, Boolean designTime)
   at Microsoft.EntityFrameworkCore.Infrastructure.ModelSource.GetModel(DbContext context, ModelCreationDependencies modelCreationDependencies, Boolean designTime)
   at Microsoft.EntityFrameworkCore.Internal.DbContextServices.CreateModel(Boolean designTime)
   at Microsoft.EntityFrameworkCore.Internal.DbContextServices.get_Model()
   at Microsoft.EntityFrameworkCore.Infrastructure.EntityFrameworkServicesBuilder.<>c.<TryAddCoreServices>b__8_4(IServiceProvider p)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitFactory(FactoryCallSite factoryCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitConstructor(ConstructorCallSite constructorCallSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitScopeCache(ServiceCallSite callSite, RuntimeResolverContext context)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.DynamicServiceProviderEngine.<>c__DisplayClass2_0.<RealizeService>b__0(ServiceProviderEngineScope scope)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(ServiceIdentifier serviceIdentifier, ServiceProviderEngineScope serviceProviderEngineScope)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)
   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)
   at Microsoft.EntityFrameworkCore.DbContext.get_DbContextDependencies()
   at Microsoft.EntityFrameworkCore.DbContext.get_ContextServices()
   at Microsoft.EntityFrameworkCore.DbContext.get_InternalServiceProvider()
   at Microsoft.EntityFrameworkCore.DbContext.Microsoft.EntityFrameworkCore.Infrastructure.IInfrastructure<System.IServiceProvider>.get_Instance()
   at Microsoft.EntityFrameworkCore.Infrastructure.DatabaseFacade.Microsoft.EntityFrameworkCore.Infrastructure.IInfrastructure<System.IServiceProvider>.get_Instance()
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.GetRelationalService[TService](IInfrastructure`1 databaseFacade)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.Migrate(DatabaseFacade databaseFacade)
   at ModularERP.Program.Main(String[] args) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 178
2025-09-25 00:02:50.050 +03:00 [INF] Starting web host...
2025-09-25 00:02:51.020 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:02:51.155 +03:00 [INF] Executed DbCommand (118ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 00:02:51.235 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:02:51.242 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 00:02:51.263 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 00:02:51.342 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 00:02:51.358 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:02:51.362 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 00:02:51.370 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 00:02:51.381 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 00:02:51.387 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 00:02:51.579 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 00:02:51.587 +03:00 [INF] Master database initialized successfully
2025-09-25 00:02:52.272 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 00:02:52.479 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 00:02:52.480 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 00:02:52.559 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 00:02:52.561 +03:00 [INF] Hosting environment: Development
2025-09-25 00:02:52.562 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 00:02:53.036 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 00:02:53.169 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 134.2974ms
2025-09-25 00:02:53.175 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 00:02:53.178 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 00:02:53.196 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 20.5992ms
2025-09-25 00:02:53.217 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 39.138ms
2025-09-25 00:02:53.274 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 00:02:53.398 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 123.3808ms
2025-09-25 00:03:39.915 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------611320344831397379103336 57877
2025-09-25 00:03:39.932 +03:00 [INF] Request started
2025-09-25 00:03:39.937 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 00:03:39.940 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 00:03:39.959 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 00:03:39.966 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 00:03:40.066 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 00:03:40.277 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 00:03:40.325 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":1}
2025-09-25 00:03:40.368 +03:00 [INF] Validation passed successfully.
2025-09-25 00:03:40.494 +03:00 [INF] Business validations passed successfully.
2025-09-25 00:03:40.519 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-25 00:03:40.739 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_1c35081106fb441d901a76d0a1e8df51", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:de3648d8-1be5-48a5-9e7c-76aca1b2b899
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 345
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-25 00:03:40.793 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 00:03:40.812 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 845.9498ms
2025-09-25 00:03:40.815 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 00:03:40.817 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 00:03:40.823 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 908.4474ms
2025-09-25 00:27:23.929 +03:00 [INF] Starting web host...
2025-09-25 00:27:24.921 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:27:25.001 +03:00 [INF] Executed DbCommand (63ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 00:27:25.103 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:27:25.110 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 00:27:25.122 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 00:27:25.196 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 00:27:25.216 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:27:25.222 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 00:27:25.234 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 00:27:25.248 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 00:27:25.257 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 00:27:25.507 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 00:27:25.517 +03:00 [INF] Master database initialized successfully
2025-09-25 00:27:26.429 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 00:27:26.640 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 00:27:26.641 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 00:27:26.736 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 00:27:26.738 +03:00 [INF] Hosting environment: Development
2025-09-25 00:27:26.740 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 00:27:27.228 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 00:27:27.439 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 211.583ms
2025-09-25 00:27:27.445 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 00:27:27.451 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 00:27:27.465 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 18.8638ms
2025-09-25 00:27:27.538 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 86.9139ms
2025-09-25 00:27:27.582 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 00:27:27.634 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 51.9556ms
2025-09-25 00:27:31.710 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------668316920552371014593029 57877
2025-09-25 00:27:31.730 +03:00 [INF] Request started
2025-09-25 00:27:31.734 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 00:27:31.737 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 00:27:31.757 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 00:27:31.765 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 00:27:31.868 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 00:27:32.151 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 00:27:32.207 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":1}
2025-09-25 00:27:32.263 +03:00 [INF] Validation passed successfully.
2025-09-25 00:27:32.391 +03:00 [INF] Business validations passed successfully.
2025-09-25 00:27:32.421 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-25 00:27:32.685 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_1c35081106fb441d901a76d0a1e8df51", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:912fb976-6429-4149-a175-cc9af2a7e402
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 345
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-25 00:27:32.737 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 00:27:32.758 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 993.9789ms
2025-09-25 00:27:32.762 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 00:27:32.764 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 00:27:32.771 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1060.9145ms
2025-09-25 00:29:36.821 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------343125828085685432370903 57877
2025-09-25 00:29:36.826 +03:00 [INF] Request started
2025-09-25 00:29:36.830 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 00:29:36.831 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 00:29:36.852 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 00:29:36.888 +03:00 [INF] ➡️ Start Handle CreateIncomeVoucher with Request: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","CurrencyCode":"USE","FxRate":1.0,"Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","RecurrenceId":"7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe","SourceJson":"{\"Type\":\"BankAccount\",\"Id\":\"e4d15aae-46c9-4d95-b030-50158457de62\"}","CounterpartyJson":"{\"Type\":\"Vendor\",\"Id\":\"3fa85f64-5717-4562-b3fc-2c963f66afa6\"}","TaxLinesJson":"[{\"TaxId\":\"020c0bbf-8202-42d8-9692-2fc202aa5c08\",\"BaseAmount\":100,\"TaxAmount\":14.0,\"IsWithholding\":true}]","Attachments":[{"ContentDisposition":"form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\"","ContentType":"application/pdf","Headers":[{"Key":"Content-Disposition","Value":["form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\""],"$type":"KeyValuePair`2"},{"Key":"Content-Type","Value":["application/pdf"],"$type":"KeyValuePair`2"}],"Length":56007,"Name":"Attachments","FileName":"Hossam-Reda-Tohamy-Node Js .pdf","$type":"FormFile"}],"SourceId":"e4d15aae-46c9-4d95-b030-50158457de62","SourceType":"BankAccount","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"$type":"CreateIncomeVoucherDto"}
2025-09-25 00:29:36.924 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 00:29:36.993 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 00:29:37.030 +03:00 [INF] ✅ Company verified: "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 00:29:37.033 +03:00 [INF] ✅ DTO validation passed
2025-09-25 00:29:37.049 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 00:29:37.055 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 200.3572ms
2025-09-25 00:29:37.058 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 00:29:37.060 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 00:29:37.061 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 240.973ms
2025-09-25 00:30:27.212 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------548493857502479314849506 57877
2025-09-25 00:30:27.225 +03:00 [INF] Request started
2025-09-25 00:30:27.228 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 00:30:27.234 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 00:30:27.236 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 00:30:27.243 +03:00 [INF] ➡️ Start Handle CreateIncomeVoucher with Request: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","CurrencyCode":"USE","FxRate":1.0,"Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","RecurrenceId":"7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe","SourceJson":"{\"Type\":\"BankAccount\",\"Id\":\"e4d15aae-46c9-4d95-b030-50158457de62\"}","CounterpartyJson":"{\"Type\":\"Vendor\",\"Id\":\"3fa85f64-5717-4562-b3fc-2c963f66afa6\"}","TaxLinesJson":"[{\"TaxId\":\"020c0bbf-8202-42d8-9692-2fc202aa5c08\",\"BaseAmount\":100,\"TaxAmount\":14.0,\"IsWithholding\":true}]","Attachments":[{"ContentDisposition":"form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\"","ContentType":"application/pdf","Headers":[{"Key":"Content-Disposition","Value":["form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\""],"$type":"KeyValuePair`2"},{"Key":"Content-Type","Value":["application/pdf"],"$type":"KeyValuePair`2"}],"Length":56007,"Name":"Attachments","FileName":"Hossam-Reda-Tohamy-Node Js .pdf","$type":"FormFile"}],"SourceId":"e4d15aae-46c9-4d95-b030-50158457de62","SourceType":"BankAccount","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"$type":"CreateIncomeVoucherDto"}
2025-09-25 00:30:27.277 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 00:30:27.282 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 00:30:27.286 +03:00 [INF] ✅ Company verified: "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 00:30:27.288 +03:00 [INF] ✅ DTO validation passed
2025-09-25 00:30:27.298 +03:00 [ERR] ❌ Error in business validations
System.InvalidOperationException: Cannot convert string value 'Income' from the database to any value in the mapped 'AccountType' enum.
   at Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal.StringEnumConverter`3.ConvertToEnum(String value)
   at lambda_method231(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.GetByID(Guid id) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 110
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Service.Interface.IncomeVoucherService.IsCategoryValidAsync(Guid categoryId) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Service\Interface\IncomeVoucherService.cs:line 72
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler.Handle(CreateIncomeVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Handlers\CreateIncomeVoucherHandler.cs:line 156
2025-09-25 00:30:27.307 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 00:30:27.309 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 70.456ms
2025-09-25 00:30:27.311 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 00:30:27.313 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 00:30:27.314 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 101.6188ms
2025-09-25 00:32:02.910 +03:00 [INF] Starting web host...
2025-09-25 00:32:03.715 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:32:03.800 +03:00 [INF] Executed DbCommand (70ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 00:32:03.872 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:32:03.877 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 00:32:03.896 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 00:32:03.952 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 00:32:03.967 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 00:32:03.971 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 00:32:03.977 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 00:32:03.988 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 00:32:03.994 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 00:32:04.155 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 00:32:04.162 +03:00 [INF] Master database initialized successfully
2025-09-25 00:32:04.774 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 00:32:04.875 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 00:32:04.877 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 00:32:04.934 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 00:32:04.936 +03:00 [INF] Hosting environment: Development
2025-09-25 00:32:04.938 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 00:32:04.978 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 00:32:05.092 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 114.4652ms
2025-09-25 00:32:05.095 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 00:32:05.095 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 00:32:05.112 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 16.3734ms
2025-09-25 00:32:05.126 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.8777ms
2025-09-25 00:32:05.174 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 00:32:05.224 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 50.5039ms
2025-09-25 00:32:13.740 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------342437418127689411162580 57877
2025-09-25 00:32:13.759 +03:00 [INF] Request started
2025-09-25 00:32:13.764 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 00:32:13.767 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 00:32:13.785 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 00:32:13.795 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 00:32:13.888 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 00:32:14.092 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 00:32:14.129 +03:00 [INF] ➡️ Start Handle CreateIncomeVoucher with Request: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","CurrencyCode":"USE","FxRate":1.0,"Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","RecurrenceId":"7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe","SourceJson":"{\"Type\":\"BankAccount\",\"Id\":\"e4d15aae-46c9-4d95-b030-50158457de62\"}","CounterpartyJson":"{\"Type\":\"Vendor\",\"Id\":\"3fa85f64-5717-4562-b3fc-2c963f66afa6\"}","TaxLinesJson":"[{\"TaxId\":\"020c0bbf-8202-42d8-9692-2fc202aa5c08\",\"BaseAmount\":100,\"TaxAmount\":14.0,\"IsWithholding\":true}]","Attachments":[{"ContentDisposition":"form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\"","ContentType":"application/pdf","Headers":[{"Key":"Content-Disposition","Value":["form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\""],"$type":"KeyValuePair`2"},{"Key":"Content-Type","Value":["application/pdf"],"$type":"KeyValuePair`2"}],"Length":56007,"Name":"Attachments","FileName":"Hossam-Reda-Tohamy-Node Js .pdf","$type":"FormFile"}],"SourceId":"e4d15aae-46c9-4d95-b030-50158457de62","SourceType":"BankAccount","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"$type":"CreateIncomeVoucherDto"}
2025-09-25 00:32:14.173 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 00:32:14.246 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 00:32:14.277 +03:00 [INF] ✅ Company verified: "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 00:32:14.295 +03:00 [INF] ✅ DTO validation passed
2025-09-25 00:32:14.369 +03:00 [ERR] ❌ Error in business validations
System.InvalidOperationException: Cannot convert string value 'Income' from the database to any value in the mapped 'AccountType' enum.
   at Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal.StringEnumConverter`3.ConvertToEnum(String value)
   at lambda_method470(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.GetByID(Guid id) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 110
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Service.Interface.IncomeVoucherService.IsCategoryValidAsync(Guid categoryId) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Service\Interface\IncomeVoucherService.cs:line 72
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler.Handle(CreateIncomeVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Handlers\CreateIncomeVoucherHandler.cs:line 156
2025-09-25 00:32:14.395 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 00:32:14.417 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 622.9795ms
2025-09-25 00:32:14.420 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 00:32:14.422 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 00:32:14.429 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 688.9457ms
2025-09-25 00:33:35.890 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------315793108411372104028988 57877
2025-09-25 00:33:35.896 +03:00 [INF] Request started
2025-09-25 00:33:35.899 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 00:33:35.900 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 00:33:35.902 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 00:33:35.947 +03:00 [INF] ➡️ Start Handle CreateIncomeVoucher with Request: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","CurrencyCode":"USE","FxRate":1.0,"Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","RecurrenceId":"7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe","SourceJson":"{\"Type\":\"BankAccount\",\"Id\":\"e4d15aae-46c9-4d95-b030-50158457de62\"}","CounterpartyJson":"{\"Type\":\"Vendor\",\"Id\":\"3fa85f64-5717-4562-b3fc-2c963f66afa6\"}","TaxLinesJson":"[{\"TaxId\":\"020c0bbf-8202-42d8-9692-2fc202aa5c08\",\"BaseAmount\":100,\"TaxAmount\":14.0,\"IsWithholding\":true}]","Attachments":[{"ContentDisposition":"form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\"","ContentType":"application/pdf","Headers":[{"Key":"Content-Disposition","Value":["form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\""],"$type":"KeyValuePair`2"},{"Key":"Content-Type","Value":["application/pdf"],"$type":"KeyValuePair`2"}],"Length":56007,"Name":"Attachments","FileName":"Hossam-Reda-Tohamy-Node Js .pdf","$type":"FormFile"}],"SourceId":"e4d15aae-46c9-4d95-b030-50158457de62","SourceType":"BankAccount","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"$type":"CreateIncomeVoucherDto"}
2025-09-25 00:33:35.978 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 00:33:35.985 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 00:33:35.990 +03:00 [INF] ✅ Company verified: "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 00:33:35.992 +03:00 [INF] ✅ DTO validation passed
2025-09-25 00:33:36.013 +03:00 [INF] ✅ Business validations passed
2025-09-25 00:33:36.233 +03:00 [ERR] ❌ Error creating voucher
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_Currencies_CurrencyCode". The conflict occurred in database "ModularERP_Tenant_1c35081106fb441d901a76d0a1e8df51", table "dbo.Currencies", column 'Code'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:50e559bf-da97-49b0-aa59-525d235ba418
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 345
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler.Handle(CreateIncomeVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Handlers\CreateIncomeVoucherHandler.cs:line 190
2025-09-25 00:33:36.253 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 00:33:36.255 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 349.0885ms
2025-09-25 00:33:36.257 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 00:33:36.258 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 00:33:36.259 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 368.8047ms
2025-09-25 00:34:56.479 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------756858682801793711151765 57877
2025-09-25 00:34:56.485 +03:00 [INF] Request started
2025-09-25 00:34:56.486 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 00:34:56.487 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 00:34:56.488 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 00:34:56.499 +03:00 [INF] ➡️ Start Handle CreateIncomeVoucher with Request: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","CurrencyCode":"USD","FxRate":1.0,"Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","RecurrenceId":"7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe","SourceJson":"{\"Type\":\"BankAccount\",\"Id\":\"e4d15aae-46c9-4d95-b030-50158457de62\"}","CounterpartyJson":"{\"Type\":\"Vendor\",\"Id\":\"3fa85f64-5717-4562-b3fc-2c963f66afa6\"}","TaxLinesJson":"[{\"TaxId\":\"020c0bbf-8202-42d8-9692-2fc202aa5c08\",\"BaseAmount\":100,\"TaxAmount\":14.0,\"IsWithholding\":true}]","Attachments":[{"ContentDisposition":"form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\"","ContentType":"application/pdf","Headers":[{"Key":"Content-Disposition","Value":["form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\""],"$type":"KeyValuePair`2"},{"Key":"Content-Type","Value":["application/pdf"],"$type":"KeyValuePair`2"}],"Length":56007,"Name":"Attachments","FileName":"Hossam-Reda-Tohamy-Node Js .pdf","$type":"FormFile"}],"SourceId":"e4d15aae-46c9-4d95-b030-50158457de62","SourceType":"BankAccount","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"$type":"CreateIncomeVoucherDto"}
2025-09-25 00:34:56.530 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 00:34:56.534 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 00:34:56.537 +03:00 [INF] ✅ Company verified: "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 00:34:56.538 +03:00 [INF] ✅ DTO validation passed
2025-09-25 00:34:56.544 +03:00 [INF] ✅ Business validations passed
2025-09-25 00:34:56.562 +03:00 [INF] ✅ Voucher saved with ID: "4930531b-f13c-48ea-0d11-08ddfbb204da"
2025-09-25 00:34:56.603 +03:00 [ERR] ❌ Error processing tax lines
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_VoucherTaxes_Taxes_TaxId". The conflict occurred in database "ModularERP_Tenant_1c35081106fb441d901a76d0a1e8df51", table "dbo.Taxes", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:50e559bf-da97-49b0-aa59-525d235ba418
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 345
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler.Handle(CreateIncomeVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Handlers\CreateIncomeVoucherHandler.cs:line 222
2025-09-25 00:34:56.620 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 00:34:56.621 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 129.5203ms
2025-09-25 00:34:56.623 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 00:34:56.624 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 00:34:56.625 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 145.9797ms
2025-09-25 11:55:18.663 +03:00 [INF] Starting web host...
2025-09-25 11:55:19.484 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 11:55:19.581 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 11:55:19.670 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 11:55:19.676 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 11:55:19.687 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 11:55:19.748 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 11:55:19.771 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 11:55:19.775 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 11:55:19.787 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 11:55:19.801 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 11:55:19.809 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 11:55:20.020 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 11:55:20.028 +03:00 [INF] Master database initialized successfully
2025-09-25 11:55:20.785 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 11:55:20.952 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 11:55:20.954 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 11:55:21.022 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 11:55:21.023 +03:00 [INF] Hosting environment: Development
2025-09-25 11:55:21.024 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 11:55:21.601 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 11:55:22.019 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 11:55:22.026 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 11:55:22.032 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 433.5001ms
2025-09-25 11:55:22.050 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 23.7007ms
2025-09-25 11:55:22.135 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 108.5822ms
2025-09-25 11:55:22.218 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 11:55:22.360 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 142.237ms
2025-09-25 11:55:26.421 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------566123866211113539567692 57877
2025-09-25 11:55:26.439 +03:00 [INF] Request started
2025-09-25 11:55:26.444 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 11:55:26.447 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 11:55:26.466 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 11:55:26.472 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 11:55:26.564 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 11:55:26.780 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 11:55:26.817 +03:00 [INF] ➡️ Start Handle CreateIncomeVoucher with Request: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","CurrencyCode":"USD","FxRate":1.0,"Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","RecurrenceId":"7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe","SourceJson":"{\"Type\":\"BankAccount\",\"Id\":\"e4d15aae-46c9-4d95-b030-50158457de62\"}","CounterpartyJson":"{\"Type\":\"Vendor\",\"Id\":\"3fa85f64-5717-4562-b3fc-2c963f66afa6\"}","TaxLinesJson":"[{\"TaxId\":\"020c0bbf-8202-42d8-9692-2fc202aa5c08\",\"BaseAmount\":100,\"TaxAmount\":14.0,\"IsWithholding\":true}]","Attachments":[{"ContentDisposition":"form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\"","ContentType":"application/pdf","Headers":[{"Key":"Content-Disposition","Value":["form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\""],"$type":"KeyValuePair`2"},{"Key":"Content-Type","Value":["application/pdf"],"$type":"KeyValuePair`2"}],"Length":56007,"Name":"Attachments","FileName":"Hossam-Reda-Tohamy-Node Js .pdf","$type":"FormFile"}],"SourceId":"e4d15aae-46c9-4d95-b030-50158457de62","SourceType":"BankAccount","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"$type":"CreateIncomeVoucherDto"}
2025-09-25 11:55:26.853 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 11:55:26.934 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 11:55:26.969 +03:00 [INF] ✅ Company verified: "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 11:55:26.986 +03:00 [INF] ✅ DTO validation passed
2025-09-25 11:55:27.079 +03:00 [INF] ✅ Business validations passed
2025-09-25 11:55:27.101 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 11:55:27.122 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 650.2641ms
2025-09-25 11:55:27.125 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 11:55:27.129 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 11:55:27.134 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 713.0723ms
2025-09-25 11:55:45.765 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------191547663293491024232354 57877
2025-09-25 11:55:45.771 +03:00 [INF] Request started
2025-09-25 11:55:45.775 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 11:55:45.776 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 11:55:45.778 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 11:55:45.792 +03:00 [INF] ➡️ Start Handle CreateIncomeVoucher with Request: {"Code":"INC-14555","Date":"2025-09-18T19:22:40.3180000Z","CurrencyCode":"USD","FxRate":1.0,"Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","RecurrenceId":"7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe","SourceJson":"{\"Type\":\"BankAccount\",\"Id\":\"e4d15aae-46c9-4d95-b030-50158457de62\"}","CounterpartyJson":"{\"Type\":\"Vendor\",\"Id\":\"3fa85f64-5717-4562-b3fc-2c963f66afa6\"}","TaxLinesJson":"[{\"TaxId\":\"020c0bbf-8202-42d8-9692-2fc202aa5c08\",\"BaseAmount\":100,\"TaxAmount\":14.0,\"IsWithholding\":true}]","Attachments":[{"ContentDisposition":"form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\"","ContentType":"application/pdf","Headers":[{"Key":"Content-Disposition","Value":["form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\""],"$type":"KeyValuePair`2"},{"Key":"Content-Type","Value":["application/pdf"],"$type":"KeyValuePair`2"}],"Length":56007,"Name":"Attachments","FileName":"Hossam-Reda-Tohamy-Node Js .pdf","$type":"FormFile"}],"SourceId":"e4d15aae-46c9-4d95-b030-50158457de62","SourceType":"BankAccount","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"$type":"CreateIncomeVoucherDto"}
2025-09-25 11:55:45.822 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 11:55:45.828 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 11:55:45.832 +03:00 [INF] ✅ Company verified: "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 11:55:45.834 +03:00 [INF] ✅ DTO validation passed
2025-09-25 11:55:45.838 +03:00 [INF] ✅ Business validations passed
2025-09-25 11:55:46.059 +03:00 [INF] ✅ Voucher saved with ID: "5a653ebc-cf20-45a4-dc31-08ddfc1150eb"
2025-09-25 11:55:46.111 +03:00 [ERR] ❌ Error processing tax lines
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_VoucherTaxes_Taxes_TaxId". The conflict occurred in database "ModularERP_Tenant_1c35081106fb441d901a76d0a1e8df51", table "dbo.Taxes", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:db334a9d-65f8-49c7-9a01-291cdf42aaae
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 345
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler.Handle(CreateIncomeVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\IncomesVoucher\Handlers\CreateIncomeVoucherHandler.cs:line 222
2025-09-25 11:55:46.145 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 11:55:46.147 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 366.1528ms
2025-09-25 11:55:46.149 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 11:55:46.151 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 11:55:46.153 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 388.1784ms
2025-09-25 12:54:01.736 +03:00 [INF] Starting web host...
2025-09-25 12:54:02.578 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 12:54:02.661 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 12:54:02.732 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 12:54:02.738 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 12:54:02.754 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 12:54:02.828 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 12:54:02.851 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 12:54:02.857 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 12:54:02.865 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 12:54:02.881 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 12:54:02.888 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 12:54:03.054 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 12:54:03.061 +03:00 [INF] Master database initialized successfully
2025-09-25 12:54:03.729 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 12:54:03.884 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 12:54:03.886 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 12:54:03.945 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 12:54:03.948 +03:00 [INF] Hosting environment: Development
2025-09-25 12:54:03.950 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 12:54:04.068 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 12:54:04.187 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 120.4289ms
2025-09-25 12:54:04.209 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 12:54:04.209 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 12:54:04.221 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.0592ms
2025-09-25 12:54:04.237 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 27.1084ms
2025-09-25 12:54:04.451 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 12:54:04.495 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 43.7972ms
2025-09-25 12:54:08.423 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 12:54:08.433 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 10.0136ms
2025-09-25 12:54:08.442 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 12:54:08.442 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 12:54:08.446 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 3.6305ms
2025-09-25 12:54:08.457 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 14.8432ms
2025-09-25 12:54:08.523 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 12:54:08.594 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 71.1816ms
2025-09-25 13:15:39.786 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/api/Tax - null null
2025-09-25 13:15:39.809 +03:00 [INF] Request started
2025-09-25 13:15:39.821 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 13:15:39.824 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/api/Tax - 400 null application/json 37.8968ms
2025-09-25 13:16:27.144 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/Tax - null null
2025-09-25 13:16:27.150 +03:00 [INF] Request started
2025-09-25 13:16:27.154 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 13:16:27.157 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.Taxs.Controllers.TaxController.GetAll (ModularERP)'
2025-09-25 13:16:27.171 +03:00 [INF] Route matched with {action = "GetAll", controller = "Tax"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.IEnumerable`1[ModularERP.Modules.Finance.Features.Taxs.DTO.TaxListDto]]]] GetAll() on controller ModularERP.Modules.Finance.Features.Taxs.Controllers.TaxController (ModularERP).
2025-09-25 13:16:27.177 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 13:16:27.258 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 13:16:27.424 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 13:16:27.479 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Finance.Features.Taxs.DTO.TaxListDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 13:16:27.499 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.Taxs.Controllers.TaxController.GetAll (ModularERP) in 322.1199ms
2025-09-25 13:16:27.502 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.Taxs.Controllers.TaxController.GetAll (ModularERP)'
2025-09-25 13:16:27.504 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 13:16:27.507 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/Tax - 200 null application/json; charset=utf-8 363.1294ms
2025-09-25 13:17:43.231 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Tax - application/json 112
2025-09-25 13:17:43.242 +03:00 [INF] Request started
2025-09-25 13:17:43.243 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 13:17:43.244 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.Taxs.Controllers.TaxController.Create (ModularERP)'
2025-09-25 13:17:43.251 +03:00 [INF] Route matched with {action = "Create", controller = "Tax"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.Taxs.DTO.TaxResponseDto]]] Create(ModularERP.Modules.Finance.Features.Taxs.DTO.CreateTaxDto) on controller ModularERP.Modules.Finance.Features.Taxs.Controllers.TaxController (ModularERP).
2025-09-25 13:17:43.471 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.Taxs.DTO.TaxResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 13:17:43.514 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.Taxs.Controllers.TaxController.Create (ModularERP) in 260.684ms
2025-09-25 13:17:43.520 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.Taxs.Controllers.TaxController.Create (ModularERP)'
2025-09-25 13:17:43.523 +03:00 [INF] Request completed successfully with status code 201
2025-09-25 13:17:43.525 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Tax - 201 null application/json; charset=utf-8 294.2442ms
2025-09-25 13:18:34.030 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------405238593036782693345919 57877
2025-09-25 13:18:34.033 +03:00 [INF] Request started
2025-09-25 13:18:34.035 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 13:18:34.036 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 13:18:34.042 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 13:18:34.099 +03:00 [INF] ➡️ Start Handle CreateIncomeVoucher with Request: {"Code":"INC-14555","Date":"2025-09-18T19:22:40.3180000Z","CurrencyCode":"USD","FxRate":1.0,"Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","RecurrenceId":"7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe","SourceJson":"{\"Type\":\"BankAccount\",\"Id\":\"e4d15aae-46c9-4d95-b030-50158457de62\"}","CounterpartyJson":"{\"Type\":\"Vendor\",\"Id\":\"3fa85f64-5717-4562-b3fc-2c963f66afa6\"}","TaxLinesJson":"[{\"TaxId\":\"d2d9f0de-50a3-4e48-b386-08ddfc1cc3f9\",\"BaseAmount\":100,\"TaxAmount\":14.0,\"IsWithholding\":true}]","Attachments":[{"ContentDisposition":"form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\"","ContentType":"application/pdf","Headers":[{"Key":"Content-Disposition","Value":["form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\""],"$type":"KeyValuePair`2"},{"Key":"Content-Type","Value":["application/pdf"],"$type":"KeyValuePair`2"}],"Length":56007,"Name":"Attachments","FileName":"Hossam-Reda-Tohamy-Node Js .pdf","$type":"FormFile"}],"SourceId":"e4d15aae-46c9-4d95-b030-50158457de62","SourceType":"BankAccount","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"$type":"CreateIncomeVoucherDto"}
2025-09-25 13:18:34.134 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 13:18:34.190 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 13:18:34.214 +03:00 [INF] ✅ Company verified: "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 13:18:34.230 +03:00 [INF] ✅ DTO validation passed
2025-09-25 13:18:34.293 +03:00 [INF] ✅ Business validations passed
2025-09-25 13:18:34.306 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 13:18:34.311 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 265.8309ms
2025-09-25 13:18:34.314 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 13:18:34.315 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 13:18:34.317 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 286.7852ms
2025-09-25 13:18:39.923 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------253476801775651941028075 57877
2025-09-25 13:18:39.927 +03:00 [INF] Request started
2025-09-25 13:18:39.928 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 13:18:39.929 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 13:18:39.931 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 13:18:39.943 +03:00 [INF] ➡️ Start Handle CreateIncomeVoucher with Request: {"Code":"INC-14554","Date":"2025-09-18T19:22:40.3180000Z","CurrencyCode":"USD","FxRate":1.0,"Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","RecurrenceId":"7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe","SourceJson":"{\"Type\":\"BankAccount\",\"Id\":\"e4d15aae-46c9-4d95-b030-50158457de62\"}","CounterpartyJson":"{\"Type\":\"Vendor\",\"Id\":\"3fa85f64-5717-4562-b3fc-2c963f66afa6\"}","TaxLinesJson":"[{\"TaxId\":\"d2d9f0de-50a3-4e48-b386-08ddfc1cc3f9\",\"BaseAmount\":100,\"TaxAmount\":14.0,\"IsWithholding\":true}]","Attachments":[{"ContentDisposition":"form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\"","ContentType":"application/pdf","Headers":[{"Key":"Content-Disposition","Value":["form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\""],"$type":"KeyValuePair`2"},{"Key":"Content-Type","Value":["application/pdf"],"$type":"KeyValuePair`2"}],"Length":56007,"Name":"Attachments","FileName":"Hossam-Reda-Tohamy-Node Js .pdf","$type":"FormFile"}],"SourceId":"e4d15aae-46c9-4d95-b030-50158457de62","SourceType":"BankAccount","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"$type":"CreateIncomeVoucherDto"}
2025-09-25 13:18:39.973 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 13:18:39.977 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 13:18:39.978 +03:00 [INF] ✅ Company verified: "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 13:18:39.979 +03:00 [INF] ✅ DTO validation passed
2025-09-25 13:18:39.982 +03:00 [INF] ✅ Business validations passed
2025-09-25 13:18:40.125 +03:00 [INF] ✅ Voucher saved with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 13:18:40.204 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 13:18:40.210 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 274.6025ms
2025-09-25 13:18:40.214 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 13:18:40.215 +03:00 [INF] Request completed successfully with status code 201
2025-09-25 13:18:40.217 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 201 null application/json; charset=utf-8 294.2169ms
2025-09-25 15:45:48.492 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 15:45:48.526 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 33.9451ms
2025-09-25 15:45:48.605 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/favicon.ico - null null
2025-09-25 15:45:48.608 +03:00 [INF] Request started
2025-09-25 15:45:48.609 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 15:45:48.610 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/favicon.ico - 400 null application/json 5.3925ms
2025-09-25 16:39:15.132 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Tenants/create - application/json 51
2025-09-25 16:39:15.138 +03:00 [INF] Request started
2025-09-25 16:39:15.140 +03:00 [INF] Executing endpoint 'ModularERP.Common.Controller.TenantsController.CreateTenant (ModularERP)'
2025-09-25 16:39:15.144 +03:00 [INF] Route matched with {action = "CreateTenant", controller = "Tenants"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateTenant(ModularERP.Common.Controller.CreateTenantRequest) on controller ModularERP.Common.Controller.TenantsController (ModularERP).
2025-09-25 16:39:15.227 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (Size = 3), @p3='?' (Size = 4000), @p4='?' (Size = 100), @p5='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [MasterCompanies] ([Id], [CreatedAt], [CurrencyCode], [DatabaseName], [Name], [Status])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-09-25 16:39:15.236 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 16:39:15.838 +03:00 [INF] Applied 2 migrations to database ModularERP_Tenant_f38123754b52450b895b32978878d590
2025-09-25 16:39:15.840 +03:00 [INF] Created tenant database for company "f2e851dc-722a-4e31-8e64-340728601d60": ModularERP_Tenant_f38123754b52450b895b32978878d590
2025-09-25 16:39:15.842 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`5[[System.Guid, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 16:39:15.846 +03:00 [INF] Executed action ModularERP.Common.Controller.TenantsController.CreateTenant (ModularERP) in 698.796ms
2025-09-25 16:39:15.847 +03:00 [INF] Executed endpoint 'ModularERP.Common.Controller.TenantsController.CreateTenant (ModularERP)'
2025-09-25 16:39:15.848 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 16:39:15.849 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Tenants/create - 200 null application/json; charset=utf-8 716.9275ms
2025-09-25 16:39:46.256 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------206409734109685517170794 57878
2025-09-25 16:39:46.260 +03:00 [INF] Request started
2025-09-25 16:39:46.261 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 16:39:46.262 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 16:39:46.264 +03:00 [INF] Route matched with {action = "CreateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] CreateIncomeVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 16:39:46.279 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 16:39:46.288 +03:00 [INF] ➡️ Start Handle CreateIncomeVoucher with Request: {"Code":"INC-145551","Date":"2025-09-18T19:22:40.3180000Z","CurrencyCode":"USD","FxRate":1.0,"Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","RecurrenceId":"7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe","SourceJson":"{\"Type\":\"BankAccount\",\"Id\":\"e4d15aae-46c9-4d95-b030-50158457de62\"}","CounterpartyJson":"{\"Type\":\"Vendor\",\"Id\":\"3fa85f64-5717-4562-b3fc-2c963f66afa6\"}","TaxLinesJson":"[{\"TaxId\":\"d2d9f0de-50a3-4e48-b386-08ddfc1cc3f9\",\"BaseAmount\":100,\"TaxAmount\":14.0,\"IsWithholding\":true}]","Attachments":[{"ContentDisposition":"form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\"","ContentType":"application/pdf","Headers":[{"Key":"Content-Disposition","Value":["form-data; name=\"Attachments\"; filename=\"Hossam-Reda-Tohamy-Node Js .pdf\""],"$type":"KeyValuePair`2"},{"Key":"Content-Type","Value":["application/pdf"],"$type":"KeyValuePair`2"}],"Length":56007,"Name":"Attachments","FileName":"Hossam-Reda-Tohamy-Node Js .pdf","$type":"FormFile"}],"SourceId":"e4d15aae-46c9-4d95-b030-50158457de62","SourceType":"BankAccount","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"$type":"CreateIncomeVoucherDto"}
2025-09-25 16:39:46.320 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 16:39:46.349 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 16:39:46.354 +03:00 [INF] ✅ Company verified: "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 16:39:46.355 +03:00 [INF] ✅ DTO validation passed
2025-09-25 16:39:46.362 +03:00 [INF] ✅ Business validations passed
2025-09-25 16:39:46.388 +03:00 [INF] ✅ Voucher saved with ID: "2643f3e6-bd29-4034-eeef-08ddfc1ce5ba"
2025-09-25 16:39:46.404 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 16:39:46.406 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP) in 139.4286ms
2025-09-25 16:39:46.409 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.CreateIncomeVoucher (ModularERP)'
2025-09-25 16:39:46.411 +03:00 [INF] Request completed successfully with status code 201
2025-09-25 16:39:46.412 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/IncomeVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 201 null application/json; charset=utf-8 155.802ms
2025-09-25 17:16:32.142 +03:00 [INF] Starting web host...
2025-09-25 17:16:32.954 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 17:16:33.049 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 17:16:33.115 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 17:16:33.120 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 17:16:33.138 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 17:16:33.192 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 17:16:33.207 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 17:16:33.213 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 17:16:33.220 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 17:16:33.230 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 17:16:33.236 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 17:16:33.401 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 17:16:33.408 +03:00 [INF] Master database initialized successfully
2025-09-25 17:16:34.079 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 17:16:34.190 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 17:16:34.192 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 17:16:34.250 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 17:16:34.252 +03:00 [INF] Hosting environment: Development
2025-09-25 17:16:34.254 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 17:16:34.954 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 17:16:35.164 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 211.8862ms
2025-09-25 17:16:35.173 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 17:16:35.174 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 17:16:35.185 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.8494ms
2025-09-25 17:16:35.227 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 53.5088ms
2025-09-25 17:16:35.306 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 17:16:35.372 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 66.6471ms
2025-09-25 17:20:21.075 +03:00 [INF] Starting web host...
2025-09-25 17:20:21.308 +03:00 [FTL] Host terminated unexpectedly
System.AggregateException: Some services are not able to be constructed (Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.UpdateIncomeVoucherCommand,ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.UpdateIncomeVoucherHandler': Unable to resolve service for type 'FluentValidation.IValidator`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.UpdateIncomeVoucherDto]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.UpdateIncomeVoucherHandler'.)
 ---> System.InvalidOperationException: Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.UpdateIncomeVoucherCommand,ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.UpdateIncomeVoucherHandler': Unable to resolve service for type 'FluentValidation.IValidator`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.UpdateIncomeVoucherDto]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.UpdateIncomeVoucherHandler'.
 ---> System.InvalidOperationException: Unable to resolve service for type 'FluentValidation.IValidator`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.UpdateIncomeVoucherDto]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.UpdateIncomeVoucherHandler'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceDescriptor serviceDescriptor, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   at Microsoft.Extensions.DependencyInjection.ServiceCollectionContainerBuilderExtensions.BuildServiceProvider(IServiceCollection services, ServiceProviderOptions options)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 173
2025-09-25 17:21:58.217 +03:00 [INF] Starting web host...
2025-09-25 17:21:59.006 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 17:21:59.092 +03:00 [INF] Executed DbCommand (67ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 17:21:59.161 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 17:21:59.167 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 17:21:59.183 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 17:21:59.240 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 17:21:59.256 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 17:21:59.261 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 17:21:59.269 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 17:21:59.281 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 17:21:59.287 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 17:21:59.447 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 17:21:59.454 +03:00 [INF] Master database initialized successfully
2025-09-25 17:22:00.078 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 17:22:00.177 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 17:22:00.179 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 17:22:00.241 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 17:22:00.243 +03:00 [INF] Hosting environment: Development
2025-09-25 17:22:00.245 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 17:22:00.732 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 17:22:00.884 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 153.1282ms
2025-09-25 17:22:00.888 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 17:22:00.888 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 17:22:00.910 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 22.2246ms
2025-09-25 17:22:00.965 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 77.0748ms
2025-09-25 17:22:01.000 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 17:22:01.062 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 62.6909ms
2025-09-25 17:22:09.172 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 17:22:09.184 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 12.4456ms
2025-09-25 17:22:09.202 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 17:22:09.202 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 17:22:09.207 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.0594ms
2025-09-25 17:22:09.214 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 12.4095ms
2025-09-25 17:22:09.249 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 17:22:09.296 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 46.2469ms
2025-09-25 17:24:05.722 +03:00 [INF] Starting web host...
2025-09-25 17:24:06.555 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 17:24:06.630 +03:00 [INF] Executed DbCommand (57ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 17:24:06.708 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 17:24:06.714 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 17:24:06.734 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 17:24:06.791 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 17:24:06.806 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 17:24:06.810 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 17:24:06.820 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 17:24:06.830 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 17:24:06.836 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 17:24:06.997 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 17:24:07.005 +03:00 [INF] Master database initialized successfully
2025-09-25 17:24:07.618 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 17:24:07.717 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 17:24:07.719 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 17:24:07.778 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 17:24:07.780 +03:00 [INF] Hosting environment: Development
2025-09-25 17:24:07.782 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 17:24:08.118 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 17:24:08.228 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 111.3456ms
2025-09-25 17:24:08.256 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 17:24:08.256 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 17:24:08.266 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.9749ms
2025-09-25 17:24:08.279 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 22.5073ms
2025-09-25 17:24:08.302 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 17:24:08.344 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 41.6275ms
2025-09-25 17:24:12.999 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 17:24:13.011 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 11.5334ms
2025-09-25 17:24:13.027 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 17:24:13.027 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 17:24:13.035 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.8327ms
2025-09-25 17:24:13.041 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 13.5456ms
2025-09-25 17:24:13.069 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 17:24:13.111 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 41.8076ms
2025-09-25 17:25:34.549 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/uploads/625e6c04-063a-4afe-8722-38a39c57a67a_Hossam-Reda-Tohamy-Full - null null
2025-09-25 17:25:34.569 +03:00 [INF] Request started
2025-09-25 17:25:34.573 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-25 17:25:34.576 +03:00 [INF] Request completed successfully with status code 404
2025-09-25 17:25:34.582 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/uploads/625e6c04-063a-4afe-8722-38a39c57a67a_Hossam-Reda-Tohamy-Full - 404 0 null 33.0781ms
2025-09-25 17:25:34.588 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7168/uploads/625e6c04-063a-4afe-8722-38a39c57a67a_Hossam-Reda-Tohamy-Full, Response status code: 404
2025-09-25 17:27:00.817 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/IncomeVouchers/{id}/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 17:27:00.822 +03:00 [INF] Request started
2025-09-25 17:27:00.825 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-25 17:27:00.828 +03:00 [INF] Request completed successfully with status code 404
2025-09-25 17:27:00.831 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/IncomeVouchers/{id}/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 404 0 null 14.3329ms
2025-09-25 17:27:00.837 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7168/api/IncomeVouchers/%7Bid%7D/e83bbacf-7934-4340-eeee-08ddfc1ce5ba, Response status code: 404
2025-09-25 17:29:28.227 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/IncomeVouchers/{id}/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 17:29:28.234 +03:00 [INF] Request started
2025-09-25 17:29:28.236 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-25 17:29:28.238 +03:00 [INF] Request completed successfully with status code 404
2025-09-25 17:29:28.239 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/IncomeVouchers/{id}/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 404 0 null 12.2114ms
2025-09-25 17:29:28.243 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7168/api/IncomeVouchers/%7Bid%7D/e83bbacf-7934-4340-eeee-08ddfc1ce5ba, Response status code: 404
2025-09-25 17:29:34.578 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 17:29:34.584 +03:00 [INF] Request started
2025-09-25 17:29:34.586 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-25 17:29:34.588 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-25 17:29:34.604 +03:00 [INF] Route matched with {action = "GetIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] GetIncomeVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 17:29:34.612 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 17:29:34.680 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 17:29:34.697 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 17:29:34.744 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 17:29:34.879 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 17:29:34.883 +03:00 [INF] Fetching income voucher with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 17:29:34.925 +03:00 [WRN] Voucher with ID "e83bbacf-7934-4340-eeee-08ddfc1ce5ba" not found
2025-09-25 17:29:34.933 +03:00 [INF] Executing NotFoundObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 17:29:34.956 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP) in 344.7838ms
2025-09-25 17:29:34.959 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-25 17:29:34.962 +03:00 [INF] Request completed successfully with status code 404
2025-09-25 17:29:34.966 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 404 null application/json; charset=utf-8 387.707ms
2025-09-25 17:36:30.765 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 17:36:30.770 +03:00 [INF] Request started
2025-09-25 17:36:30.771 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 17:36:30.772 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-25 17:36:30.774 +03:00 [INF] Route matched with {action = "GetIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] GetIncomeVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 17:36:30.840 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 17:36:30.881 +03:00 [INF] Fetching income voucher with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 17:36:30.986 +03:00 [INF] Found income voucher: INC-14554
2025-09-25 17:36:31.089 +03:00 [INF] Retrieved 1 tax lines and 1 attachments for voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 17:36:31.108 +03:00 [INF] Successfully retrieved income voucher INC-14554 with all related data
2025-09-25 17:36:31.110 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 17:36:31.122 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP) in 340.6787ms
2025-09-25 17:36:31.124 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.GetIncomeVoucher (ModularERP)'
2025-09-25 17:36:31.126 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 17:36:31.129 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 200 null application/json; charset=utf-8 363.447ms
2025-09-25 17:54:41.436 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - multipart/form-data; boundary=--------------------------622354287859677842084470 99799
2025-09-25 17:54:41.441 +03:00 [INF] Request started
2025-09-25 17:54:41.442 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 17:54:41.443 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 17:54:41.450 +03:00 [INF] Route matched with {action = "UpdateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] UpdateIncomeVoucher(System.Guid, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile], System.String) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 17:54:41.509 +03:00 [INF] ➡️ Start Handle UpdateIncomeVoucher with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 17:54:41.511 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 17:54:41.557 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 17:54:41.586 +03:00 [INF] ✅ Voucher and Company verified: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba" - "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 17:54:41.607 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 17:54:41.611 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP) in 154.3544ms
2025-09-25 17:54:41.613 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 17:54:41.615 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 17:54:41.619 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 400 null application/json; charset=utf-8 183.8581ms
2025-09-25 17:58:52.716 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - multipart/form-data; boundary=--------------------------207290403959875989117433 99799
2025-09-25 17:58:52.720 +03:00 [INF] Request started
2025-09-25 17:58:52.721 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 17:58:52.723 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 17:58:52.724 +03:00 [INF] Route matched with {action = "UpdateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] UpdateIncomeVoucher(System.Guid, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile], System.String) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 17:58:52.731 +03:00 [INF] ➡️ Start Handle UpdateIncomeVoucher with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 17:58:52.732 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 17:58:52.751 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 17:58:52.762 +03:00 [INF] ✅ Voucher and Company verified: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba" - "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 17:58:52.765 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 17:58:52.766 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP) in 40.2776ms
2025-09-25 17:58:52.768 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 17:58:52.769 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 17:58:52.771 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 400 null application/json; charset=utf-8 55.563ms
2025-09-25 18:00:47.077 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - multipart/form-data; boundary=--------------------------010152776201828154026929 99799
2025-09-25 18:00:47.081 +03:00 [INF] Request started
2025-09-25 18:00:47.082 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:00:47.083 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 18:00:47.085 +03:00 [INF] Route matched with {action = "UpdateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] UpdateIncomeVoucher(System.Guid, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile], System.String) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 18:00:47.099 +03:00 [INF] ➡️ Start Handle UpdateIncomeVoucher with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:00:47.102 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 18:00:47.114 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 18:00:47.125 +03:00 [INF] ✅ Voucher and Company verified: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba" - "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 18:00:47.128 +03:00 [INF] ✅ DTO validation passed
2025-09-25 18:00:47.188 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:00:47.191 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP) in 103.0472ms
2025-09-25 18:00:47.192 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 18:00:47.194 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 18:00:47.195 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 400 null application/json; charset=utf-8 118.3467ms
2025-09-25 18:01:05.370 +03:00 [INF] Starting web host...
2025-09-25 18:01:06.195 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:01:06.409 +03:00 [INF] Executed DbCommand (172ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 18:01:06.477 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:01:06.482 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 18:01:06.498 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 18:01:06.556 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 18:01:06.571 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:01:06.575 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 18:01:06.582 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 18:01:06.592 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 18:01:06.598 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 18:01:06.757 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 18:01:06.763 +03:00 [INF] Master database initialized successfully
2025-09-25 18:01:07.418 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 18:01:07.514 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 18:01:07.517 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 18:01:07.573 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 18:01:07.576 +03:00 [INF] Hosting environment: Development
2025-09-25 18:01:07.578 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 18:01:07.922 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 18:01:08.029 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 106.8726ms
2025-09-25 18:01:08.032 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 18:01:08.032 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 18:01:08.043 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.9121ms
2025-09-25 18:01:08.063 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.6342ms
2025-09-25 18:01:08.208 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 18:01:08.244 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 35.2895ms
2025-09-25 18:02:16.377 +03:00 [INF] Starting web host...
2025-09-25 18:02:17.162 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:02:17.242 +03:00 [INF] Executed DbCommand (63ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 18:02:17.309 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:02:17.315 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 18:02:17.325 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 18:02:17.381 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 18:02:17.397 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:02:17.401 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 18:02:17.408 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 18:02:17.419 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 18:02:17.425 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 18:02:17.584 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 18:02:17.591 +03:00 [INF] Master database initialized successfully
2025-09-25 18:02:18.219 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 18:02:18.315 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 18:02:18.318 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 18:02:18.380 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 18:02:18.382 +03:00 [INF] Hosting environment: Development
2025-09-25 18:02:18.383 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 18:02:18.459 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 18:02:18.570 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 136.0392ms
2025-09-25 18:02:18.572 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 18:02:18.572 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 18:02:18.588 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 15.8019ms
2025-09-25 18:02:18.602 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.5502ms
2025-09-25 18:02:18.674 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 18:02:18.735 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 61.694ms
2025-09-25 18:02:20.365 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - multipart/form-data; boundary=--------------------------778335956891349418586566 99799
2025-09-25 18:02:20.381 +03:00 [INF] Request started
2025-09-25 18:02:20.387 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:02:20.390 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 18:02:20.405 +03:00 [INF] Route matched with {action = "UpdateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] UpdateIncomeVoucher(System.Guid, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile], System.String) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 18:02:20.412 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 18:02:20.497 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 18:02:20.702 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 18:02:20.727 +03:00 [INF] ➡️ Start Handle UpdateIncomeVoucher with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:02:20.729 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 18:02:20.806 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 18:02:20.943 +03:00 [INF] ✅ Voucher and Company verified: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba" - "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 18:02:20.960 +03:00 [INF] ✅ DTO validation passed
2025-09-25 18:02:21.033 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:02:21.057 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP) in 644.9829ms
2025-09-25 18:02:21.060 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 18:02:21.061 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 18:02:21.069 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 400 null application/json; charset=utf-8 703.3551ms
2025-09-25 18:03:05.383 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - multipart/form-data; boundary=--------------------------943004403002337767178275 99799
2025-09-25 18:03:05.392 +03:00 [INF] Request started
2025-09-25 18:03:05.396 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:03:05.397 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 18:03:05.399 +03:00 [INF] Route matched with {action = "UpdateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] UpdateIncomeVoucher(System.Guid, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile], System.String) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 18:03:05.414 +03:00 [INF] ➡️ Start Handle UpdateIncomeVoucher with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:03:05.415 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 18:03:05.441 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 18:03:05.458 +03:00 [INF] ✅ Voucher and Company verified: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba" - "1edafb1b-de49-4fc8-b06a-d563864b9227"
2025-09-25 18:03:05.461 +03:00 [INF] ✅ DTO validation passed
2025-09-25 18:03:05.469 +03:00 [INF] ✅ Business validations passed
2025-09-25 18:03:05.602 +03:00 [INF] ✅ Voucher updated with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:03:05.696 +03:00 [INF] ✅ Tax lines updated
2025-09-25 18:03:05.736 +03:00 [INF] ✅ Attachments updated
2025-09-25 18:03:05.757 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:03:05.765 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP) in 361.0567ms
2025-09-25 18:03:05.770 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 18:03:05.773 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 18:03:05.775 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 200 null application/json; charset=utf-8 391.5075ms
2025-09-25 18:16:10.074 +03:00 [INF] Starting web host...
2025-09-25 18:16:10.866 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:16:10.952 +03:00 [INF] Executed DbCommand (71ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 18:16:11.017 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:16:11.023 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 18:16:11.034 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 18:16:11.090 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 18:16:11.106 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:16:11.113 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 18:16:11.120 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 18:16:11.132 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 18:16:11.139 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 18:16:11.302 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 18:16:11.310 +03:00 [INF] Master database initialized successfully
2025-09-25 18:16:11.907 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 18:16:12.005 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 18:16:12.006 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 18:16:12.064 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 18:16:12.066 +03:00 [INF] Hosting environment: Development
2025-09-25 18:16:12.068 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 18:16:12.509 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 18:16:12.616 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 108.2016ms
2025-09-25 18:16:12.659 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 18:16:12.659 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 18:16:12.665 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.0547ms
2025-09-25 18:16:12.686 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 27.5592ms
2025-09-25 18:16:12.717 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 18:16:12.766 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 48.6794ms
2025-09-25 18:17:43.668 +03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7168/api/IncomeVouchers/4930531b-f13c-48ea-0d11-08ddfbb204da - null null
2025-09-25 18:17:43.683 +03:00 [INF] Request started
2025-09-25 18:17:43.688 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:17:43.691 +03:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-09-25 18:17:43.693 +03:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-09-25 18:17:43.694 +03:00 [INF] Request completed successfully with status code 405
2025-09-25 18:17:43.697 +03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7168/api/IncomeVouchers/4930531b-f13c-48ea-0d11-08ddfbb204da - 405 0 null 29.8689ms
2025-09-25 18:19:04.038 +03:00 [INF] Starting web host...
2025-09-25 18:19:04.923 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:19:05.040 +03:00 [INF] Executed DbCommand (101ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 18:19:05.128 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:19:05.136 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 18:19:05.155 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 18:19:05.234 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 18:19:05.249 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:19:05.253 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 18:19:05.260 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 18:19:05.272 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 18:19:05.279 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 18:19:05.453 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 18:19:05.460 +03:00 [INF] Master database initialized successfully
2025-09-25 18:19:06.114 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 18:19:06.227 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 18:19:06.229 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 18:19:06.289 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 18:19:06.291 +03:00 [INF] Hosting environment: Development
2025-09-25 18:19:06.293 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 18:19:06.400 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 18:19:06.505 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 106.1245ms
2025-09-25 18:19:06.544 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 18:19:06.544 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 18:19:06.552 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.3661ms
2025-09-25 18:19:06.565 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 21.2114ms
2025-09-25 18:19:06.597 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 18:19:06.639 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 42.8547ms
2025-09-25 18:19:10.452 +03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7168/api/IncomeVouchers/4930531b-f13c-48ea-0d11-08ddfbb204da - null null
2025-09-25 18:19:10.474 +03:00 [INF] Request started
2025-09-25 18:19:10.479 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:19:10.481 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.DeleteIncomeVoucher (ModularERP)'
2025-09-25 18:19:10.497 +03:00 [INF] Route matched with {action = "DeleteIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Boolean]]] DeleteIncomeVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 18:19:10.503 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 18:19:10.565 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 18:19:10.669 +03:00 [INF] ➡️ Start Handle DeleteIncomeVoucher with ID: "4930531b-f13c-48ea-0d11-08ddfbb204da"
2025-09-25 18:19:10.671 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 18:19:10.699 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 18:19:10.722 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.DeleteIncomeVoucher (ModularERP) in 219.2172ms
2025-09-25 18:19:10.725 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.DeleteIncomeVoucher (ModularERP)'
2025-09-25 18:19:10.727 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 18:19:10.732 +03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7168/api/IncomeVouchers/4930531b-f13c-48ea-0d11-08ddfbb204da - 400 null application/json; charset=utf-8 280.0543ms
2025-09-25 18:20:58.396 +03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 18:20:58.404 +03:00 [INF] Request started
2025-09-25 18:20:58.410 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:20:58.411 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.DeleteIncomeVoucher (ModularERP)'
2025-09-25 18:20:58.414 +03:00 [INF] Route matched with {action = "DeleteIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Boolean]]] DeleteIncomeVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 18:20:58.424 +03:00 [INF] ➡️ Start Handle DeleteIncomeVoucher with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:20:58.427 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 18:20:58.438 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 18:20:58.441 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.DeleteIncomeVoucher (ModularERP) in 23.6947ms
2025-09-25 18:20:58.442 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.DeleteIncomeVoucher (ModularERP)'
2025-09-25 18:20:58.444 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 18:20:58.445 +03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 400 null application/json; charset=utf-8 48.6739ms
2025-09-25 18:24:52.606 +03:00 [INF] Starting web host...
2025-09-25 18:24:53.387 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:24:53.466 +03:00 [INF] Executed DbCommand (61ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 18:24:53.549 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:24:53.554 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 18:24:53.570 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 18:24:53.629 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 18:24:53.645 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:24:53.650 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 18:24:53.656 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 18:24:53.666 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 18:24:53.670 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 18:24:53.825 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 18:24:53.832 +03:00 [INF] Master database initialized successfully
2025-09-25 18:24:54.428 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 18:24:54.526 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 18:24:54.528 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 18:24:54.585 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 18:24:54.587 +03:00 [INF] Hosting environment: Development
2025-09-25 18:24:54.589 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 18:24:55.051 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 18:24:55.162 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 110.8323ms
2025-09-25 18:24:55.170 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 18:24:55.170 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 18:24:55.176 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.9297ms
2025-09-25 18:24:55.197 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 27.0818ms
2025-09-25 18:24:55.265 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 18:24:55.314 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 49.6885ms
2025-09-25 18:25:07.583 +03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 18:25:07.609 +03:00 [INF] Request started
2025-09-25 18:25:07.613 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:25:07.616 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.DeleteIncomeVoucher (ModularERP)'
2025-09-25 18:25:07.632 +03:00 [INF] Route matched with {action = "DeleteIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Boolean]]] DeleteIncomeVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 18:25:07.638 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 18:25:07.698 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 18:25:07.798 +03:00 [INF] ➡️ Start Handle DeleteIncomeVoucher with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:25:07.800 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 18:25:07.862 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 18:25:07.966 +03:00 [INF] ✅ Voucher verified: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba", Code: INC-14554
2025-09-25 18:25:07.969 +03:00 [INF] ✅ Dependencies checked
2025-09-25 18:25:07.999 +03:00 [INF] 🗑️ Deleted file: /uploads/b93daa73-6c2f-427f-ab0b-7a12dab1e6d7_Hossam-Reda-Tohamy-Node Js .pdf
2025-09-25 18:25:08.086 +03:00 [INF] 🗑️ Deleted file: /uploads/64c3a0e2-50a3-44eb-83c3-a4413ddd19db_Hossam-Reda-Tohamy-Full Stack NET Angular.pdf
2025-09-25 18:25:08.094 +03:00 [INF] ✅ Deleted 2 attachments
2025-09-25 18:25:08.147 +03:00 [INF] ✅ Deleted 1 tax lines
2025-09-25 18:25:08.194 +03:00 [INF] ✅ Voucher deleted successfully: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba", Code: INC-14554
2025-09-25 18:25:08.202 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 18:25:08.218 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.DeleteIncomeVoucher (ModularERP) in 580.1152ms
2025-09-25 18:25:08.222 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.DeleteIncomeVoucher (ModularERP)'
2025-09-25 18:25:08.224 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 18:25:08.228 +03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7168/api/IncomeVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 200 null application/json; charset=utf-8 645.6079ms
2025-09-25 18:38:02.521 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 18:38:02.527 +03:00 [INF] Request started
2025-09-25 18:38:02.531 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:38:02.533 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-25 18:38:02.546 +03:00 [INF] Route matched with {action = "GetExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetExpenseVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 18:38:02.714 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 18:38:02.720 +03:00 [INF] Fetching expense voucher with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:38:02.733 +03:00 [INF] Found expense voucher: INC-14554
2025-09-25 18:38:02.750 +03:00 [INF] Retrieved 0 tax lines and 0 attachments for voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:38:02.770 +03:00 [INF] Successfully retrieved expense voucher INC-14554 with all related data
2025-09-25 18:38:02.773 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:38:02.788 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP) in 238.2646ms
2025-09-25 18:38:02.790 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-25 18:38:02.791 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 18:38:02.793 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 200 null application/json; charset=utf-8 271.6119ms
2025-09-25 18:41:23.550 +03:00 [INF] Starting web host...
2025-09-25 18:41:24.422 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:41:24.493 +03:00 [INF] Executed DbCommand (56ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 18:41:24.570 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:41:24.576 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 18:41:24.587 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 18:41:24.645 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 18:41:24.659 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:41:24.662 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 18:41:24.669 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 18:41:24.679 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 18:41:24.686 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 18:41:24.848 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 18:41:24.854 +03:00 [INF] Master database initialized successfully
2025-09-25 18:41:25.518 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 18:41:25.624 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 18:41:25.625 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 18:41:25.688 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 18:41:25.690 +03:00 [INF] Hosting environment: Development
2025-09-25 18:41:25.691 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 18:41:25.984 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 18:41:26.094 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 111.501ms
2025-09-25 18:41:26.226 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 18:41:26.226 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 18:41:26.242 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 15.6264ms
2025-09-25 18:41:26.258 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 32.116ms
2025-09-25 18:41:26.317 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 18:41:26.357 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 40.3648ms
2025-09-25 18:41:29.888 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 18:41:29.904 +03:00 [INF] Request started
2025-09-25 18:41:29.908 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:41:29.911 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-25 18:41:29.926 +03:00 [INF] Route matched with {action = "GetExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetExpenseVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 18:41:29.932 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 18:41:29.992 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 18:41:30.215 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 18:41:30.219 +03:00 [INF] ➡️ Start Handle GetExpenseVoucherById with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:41:30.330 +03:00 [INF] ✅ Voucher retrieved: INC-14554
2025-09-25 18:41:30.350 +03:00 [INF] ✅ Retrieved 0 tax lines for voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:41:30.363 +03:00 [INF] ✅ Retrieved 0 attachments for voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:41:30.372 +03:00 [INF] ✅ Successfully built response for voucher INC-14554
2025-09-25 18:41:30.379 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:41:30.408 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP) in 475.927ms
2025-09-25 18:41:30.410 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-25 18:41:30.413 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 18:41:30.418 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 200 null application/json; charset=utf-8 529.512ms
2025-09-25 18:45:43.823 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 18:45:43.829 +03:00 [INF] Request started
2025-09-25 18:45:43.833 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:45:43.835 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-25 18:45:43.836 +03:00 [INF] Route matched with {action = "GetExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetExpenseVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 18:45:43.842 +03:00 [INF] ➡️ Start Handle GetExpenseVoucherById with ID: "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:45:43.851 +03:00 [INF] ✅ Voucher retrieved: INC-14554
2025-09-25 18:45:43.856 +03:00 [INF] ✅ Retrieved 0 tax lines for voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:45:43.868 +03:00 [INF] ✅ Retrieved 0 attachments for voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 18:45:43.870 +03:00 [INF] ✅ Successfully built response for voucher INC-14554
2025-09-25 18:45:43.872 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:45:43.873 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP) in 35.2429ms
2025-09-25 18:45:43.875 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-25 18:45:43.876 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 18:45:43.877 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 200 null application/json; charset=utf-8 54.3123ms
2025-09-25 18:49:57.037 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers - multipart/form-data; boundary=--------------------------602904403852917238470593 48407
2025-09-25 18:49:57.042 +03:00 [INF] Request started
2025-09-25 18:49:57.043 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:49:57.044 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 18:49:57.052 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 18:49:57.115 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-145551","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":1}
2025-09-25 18:49:57.153 +03:00 [INF] Validation passed successfully.
2025-09-25 18:49:57.225 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:49:57.228 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 171.7914ms
2025-09-25 18:49:57.230 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 18:49:57.232 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 18:49:57.234 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers - 400 null application/json; charset=utf-8 196.6445ms
2025-09-25 18:50:56.059 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers - multipart/form-data; boundary=--------------------------048813416821630332699987 48407
2025-09-25 18:50:56.063 +03:00 [INF] Request started
2025-09-25 18:50:56.064 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:50:56.065 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 18:50:56.067 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 18:50:56.075 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-145551","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":1}
2025-09-25 18:50:56.088 +03:00 [INF] Validation passed successfully.
2025-09-25 18:50:56.101 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
System.InvalidOperationException: Cannot convert string value 'Expence' from the database to any value in the mapped 'AccountType' enum.
   at Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal.StringEnumConverter`3.ConvertToEnum(String value)
   at lambda_method468(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.GetByID(Guid id) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 110
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Service.ExpenseVoucherService.IsCategoryValidAsync(Guid categoryId) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Service\ExpenseVoucherService.cs:line 72
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 86
2025-09-25 18:50:56.131 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:50:56.133 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 63.323ms
2025-09-25 18:50:56.135 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 18:50:56.136 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 18:50:56.137 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers - 400 null application/json; charset=utf-8 78.47ms
2025-09-25 18:52:29.622 +03:00 [INF] Starting web host...
2025-09-25 18:52:30.407 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:52:30.496 +03:00 [INF] Executed DbCommand (65ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 18:52:30.563 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:52:30.569 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 18:52:30.587 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 18:52:30.641 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 18:52:30.656 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 18:52:30.661 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 18:52:30.668 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 18:52:30.678 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 18:52:30.686 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 18:52:30.846 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 18:52:30.853 +03:00 [INF] Master database initialized successfully
2025-09-25 18:52:31.481 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 18:52:31.585 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 18:52:31.586 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 18:52:31.650 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 18:52:31.652 +03:00 [INF] Hosting environment: Development
2025-09-25 18:52:31.654 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 18:52:32.091 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 18:52:32.206 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 115.2137ms
2025-09-25 18:52:32.211 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 18:52:32.211 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 18:52:32.240 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 29.2031ms
2025-09-25 18:52:32.262 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 51.7224ms
2025-09-25 18:52:32.417 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 18:52:32.476 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 59.1674ms
2025-09-25 18:52:34.367 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers - multipart/form-data; boundary=--------------------------090229662020897758981982 48407
2025-09-25 18:52:34.384 +03:00 [INF] Request started
2025-09-25 18:52:34.389 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:52:34.391 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 18:52:34.409 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 18:52:34.416 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 18:52:34.498 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 18:52:34.708 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 18:52:34.752 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-145551","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":1}
2025-09-25 18:52:34.792 +03:00 [INF] Validation passed successfully.
2025-09-25 18:52:34.884 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
System.InvalidOperationException: Cannot convert string value 'Expence' from the database to any value in the mapped 'AccountType' enum.
   at Microsoft.EntityFrameworkCore.Storage.ValueConversion.Internal.StringEnumConverter`3.ConvertToEnum(String value)
   at lambda_method231(Closure, QueryContext, DbDataReader, ResultContext, SingleQueryResultCoordinator)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.GetByID(Guid id) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 110
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Service.ExpenseVoucherService.IsCategoryValidAsync(Guid categoryId) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Service\ExpenseVoucherService.cs:line 72
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 86
2025-09-25 18:52:34.910 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:52:34.928 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 511.9654ms
2025-09-25 18:52:34.931 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 18:52:34.933 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 18:52:34.938 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers - 400 null application/json; charset=utf-8 570.8198ms
2025-09-25 18:54:20.324 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers - multipart/form-data; boundary=--------------------------348756220196972129781341 48407
2025-09-25 18:54:20.331 +03:00 [INF] Request started
2025-09-25 18:54:20.334 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:54:20.335 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 18:54:20.337 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 18:54:20.348 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-145551","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"f7acf111-b0d2-47a5-f814-08ddfb9592b7","Source":{"Type":"BankAccount","Id":"e4d15aae-46c9-4d95-b030-50158457de62","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":1}
2025-09-25 18:54:20.360 +03:00 [INF] Validation passed successfully.
2025-09-25 18:54:20.385 +03:00 [INF] Business validations passed successfully.
2025-09-25 18:54:20.416 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-145551","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-25 18:54:20.624 +03:00 [INF] Voucher saved successfully with ID: "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 18:54:20.626 +03:00 [INF] Processing 1 tax lines
2025-09-25 18:54:20.627 +03:00 [INF] Processing tax line: TaxId="d2d9f0de-50a3-4e48-b386-08ddfc1cc3f9", BaseAmount=100, TaxAmount=14.0
2025-09-25 18:54:20.670 +03:00 [INF] Successfully added 1 tax lines
2025-09-25 18:54:20.672 +03:00 [INF] Processing 1 attachments
2025-09-25 18:54:20.707 +03:00 [INF] Successfully added 1 attachments
2025-09-25 18:54:20.710 +03:00 [INF] Voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e" created successfully with 1 taxes and 1 attachments.
2025-09-25 18:54:20.718 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:54:20.737 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 397.4778ms
2025-09-25 18:54:20.740 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-25 18:54:20.743 +03:00 [INF] Request completed successfully with status code 201
2025-09-25 18:54:20.745 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers - 201 null application/json; charset=utf-8 420.8192ms
2025-09-25 18:56:04.857 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/ExpenseVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - null null
2025-09-25 18:56:04.863 +03:00 [INF] Request started
2025-09-25 18:56:04.864 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 18:56:04.865 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-25 18:56:04.870 +03:00 [INF] Route matched with {action = "GetExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetExpenseVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 18:56:04.878 +03:00 [INF] ➡️ Start Handle GetExpenseVoucherById with ID: "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 18:56:04.903 +03:00 [INF] ✅ Voucher retrieved: EXP-145551
2025-09-25 18:56:04.916 +03:00 [INF] ✅ Retrieved 1 tax lines for voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 18:56:04.926 +03:00 [INF] ✅ Retrieved 1 attachments for voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 18:56:04.928 +03:00 [INF] ✅ Successfully built response for voucher EXP-145551
2025-09-25 18:56:04.931 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 18:56:04.933 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP) in 60.2094ms
2025-09-25 18:56:04.935 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-25 18:56:04.936 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 18:56:04.938 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/ExpenseVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - 200 null application/json; charset=utf-8 80.6656ms
2025-09-25 19:03:00.691 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/uploads/2f629f00-154e-448c-a420-2c684f2cde49_Hossam-Reda-Tohamy-BackEnd - null null
2025-09-25 19:03:00.696 +03:00 [INF] Request started
2025-09-25 19:03:00.702 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 19:03:00.704 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/uploads/2f629f00-154e-448c-a420-2c684f2cde49_Hossam-Reda-Tohamy-BackEnd - 400 null application/json 13.0905ms
2025-09-25 19:03:32.982 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/uploads/2f629f00-154e-448c-a420-2c684f2cde49_Hossam-Reda-Tohamy-BackEnd - null null
2025-09-25 19:03:32.988 +03:00 [INF] Request started
2025-09-25 19:03:32.989 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 19:03:32.990 +03:00 [INF] Request completed successfully with status code 404
2025-09-25 19:03:32.991 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/uploads/2f629f00-154e-448c-a420-2c684f2cde49_Hossam-Reda-Tohamy-BackEnd - 404 0 null 8.9455ms
2025-09-25 19:03:32.999 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7168/uploads/2f629f00-154e-448c-a420-2c684f2cde49_Hossam-Reda-Tohamy-BackEnd, Response status code: 404
2025-09-25 19:04:28.689 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/uploads/2f629f00-154e-448c-a420-2c684f2cde49_Hossam-Reda-Tohamy-BackEnd - null null
2025-09-25 19:04:28.696 +03:00 [INF] Request started
2025-09-25 19:04:28.698 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 19:04:28.700 +03:00 [INF] Request completed successfully with status code 404
2025-09-25 19:04:28.702 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/uploads/2f629f00-154e-448c-a420-2c684f2cde49_Hossam-Reda-Tohamy-BackEnd - 404 0 null 13.1408ms
2025-09-25 19:04:28.706 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7168/uploads/2f629f00-154e-448c-a420-2c684f2cde49_Hossam-Reda-Tohamy-BackEnd, Response status code: 404
2025-09-25 19:05:59.912 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/ExpenseVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - null null
2025-09-25 19:05:59.919 +03:00 [INF] Request started
2025-09-25 19:05:59.920 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 19:05:59.922 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-25 19:05:59.924 +03:00 [INF] Route matched with {action = "GetExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetExpenseVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 19:05:59.929 +03:00 [INF] ➡️ Start Handle GetExpenseVoucherById with ID: "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 19:05:59.950 +03:00 [INF] ✅ Voucher retrieved: EXP-145551
2025-09-25 19:05:59.954 +03:00 [INF] ✅ Retrieved 1 tax lines for voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 19:05:59.958 +03:00 [INF] ✅ Retrieved 1 attachments for voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 19:05:59.959 +03:00 [INF] ✅ Successfully built response for voucher EXP-145551
2025-09-25 19:05:59.965 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 19:05:59.967 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP) in 40.1937ms
2025-09-25 19:05:59.969 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.GetExpenseVoucher (ModularERP)'
2025-09-25 19:05:59.971 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 19:05:59.973 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/ExpenseVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - 200 null application/json; charset=utf-8 61.132ms
2025-09-25 22:01:10.544 +03:00 [INF] Starting web host...
2025-09-25 22:01:11.367 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 22:01:11.459 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 22:01:11.527 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 22:01:11.533 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 22:01:11.551 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 22:01:11.606 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 22:01:11.622 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 22:01:11.628 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 22:01:11.635 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 22:01:11.648 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 22:01:11.655 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 22:01:11.815 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 22:01:11.823 +03:00 [INF] Master database initialized successfully
2025-09-25 22:01:12.438 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 22:01:12.535 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 22:01:12.536 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 22:01:12.595 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 22:01:12.597 +03:00 [INF] Hosting environment: Development
2025-09-25 22:01:12.599 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 22:01:13.090 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 22:01:13.230 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 138.3862ms
2025-09-25 22:01:13.234 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 22:01:13.234 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 22:01:13.257 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 22.736ms
2025-09-25 22:01:13.295 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 60.7664ms
2025-09-25 22:01:13.498 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 22:01:13.566 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 67.7421ms
2025-09-25 22:05:56.805 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - multipart/form-data; boundary=--------------------------563193301550803510633396 85535
2025-09-25 22:05:56.825 +03:00 [INF] Request started
2025-09-25 22:05:56.830 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 22:05:56.834 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 22:05:56.854 +03:00 [INF] Route matched with {action = "UpdateIncomeVoucher", controller = "IncomeVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]]] UpdateIncomeVoucher(System.Guid, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile], System.String) on controller ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController (ModularERP).
2025-09-25 22:05:56.860 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 22:05:56.957 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 22:05:57.183 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 22:05:57.218 +03:00 [INF] ➡️ Start Handle UpdateIncomeVoucher with ID: "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 22:05:57.220 +03:00 [INF] ✅ Tenant verified: "9df6fad9-79f1-4722-bec3-fc20bb0d5c14"
2025-09-25 22:05:57.301 +03:00 [INF] ✅ User verified: "f0602c31-0c12-4b5c-9ccf-fe17811d5c53"
2025-09-25 22:05:57.410 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:05:57.434 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP) in 573.8138ms
2025-09-25 22:05:57.438 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.IncomesVoucher.Controllers.IncomeVouchersController.UpdateIncomeVoucher (ModularERP)'
2025-09-25 22:05:57.441 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 22:05:57.449 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/IncomeVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - 400 null application/json; charset=utf-8 643.8968ms
2025-09-25 22:06:34.892 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/ExpenseVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - multipart/form-data; boundary=--------------------------759594224188019067889602 85535
2025-09-25 22:06:34.900 +03:00 [INF] Request started
2025-09-25 22:06:34.905 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 22:06:34.906 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.UpdateExpenseVoucher (ModularERP)'
2025-09-25 22:06:34.915 +03:00 [INF] Route matched with {action = "UpdateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] UpdateExpenseVoucher(System.Guid, System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile], System.Collections.Generic.List`1[System.Guid]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 22:06:34.976 +03:00 [INF] Start updating expense voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 22:06:35.215 +03:00 [ERR] Error updating expense voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The UPDATE statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_1c35081106fb441d901a76d0a1e8df51", table "dbo.AspNetUsers", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetWithRowsAffectedOnlyAsync(Int32 commandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:39df2e5f-afb6-466a-b849-b25b9f2b543e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 345
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.UpdateExpenseVoucherHandler.Handle(UpdateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\UpdateExpenseVoucherHandler.cs:line 137
2025-09-25 22:06:35.275 +03:00 [INF] Executing ObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:06:35.280 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.UpdateExpenseVoucher (ModularERP) in 359.7508ms
2025-09-25 22:06:35.284 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.UpdateExpenseVoucher (ModularERP)'
2025-09-25 22:06:35.285 +03:00 [INF] Request completed successfully with status code 500
2025-09-25 22:06:35.288 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/ExpenseVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - 500 null application/json; charset=utf-8 395.476ms
2025-09-25 22:06:56.323 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/ExpenseVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - multipart/form-data; boundary=--------------------------749973590524475211680352 85535
2025-09-25 22:06:56.328 +03:00 [INF] Request started
2025-09-25 22:06:56.333 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 22:06:56.335 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.UpdateExpenseVoucher (ModularERP)'
2025-09-25 22:06:56.336 +03:00 [INF] Route matched with {action = "UpdateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] UpdateExpenseVoucher(System.Guid, System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile], System.Collections.Generic.List`1[System.Guid]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 22:06:56.344 +03:00 [INF] Start updating expense voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 22:06:56.380 +03:00 [ERR] Error updating expense voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The UPDATE statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_1c35081106fb441d901a76d0a1e8df51", table "dbo.AspNetUsers", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetWithRowsAffectedOnlyAsync(Int32 commandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:39df2e5f-afb6-466a-b849-b25b9f2b543e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 345
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.UpdateExpenseVoucherHandler.Handle(UpdateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\UpdateExpenseVoucherHandler.cs:line 137
2025-09-25 22:06:56.414 +03:00 [INF] Executing ObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:06:56.416 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.UpdateExpenseVoucher (ModularERP) in 76.6037ms
2025-09-25 22:06:56.418 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.UpdateExpenseVoucher (ModularERP)'
2025-09-25 22:06:56.421 +03:00 [INF] Request completed successfully with status code 500
2025-09-25 22:06:56.423 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/ExpenseVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - 500 null application/json; charset=utf-8 100.6853ms
2025-09-25 22:12:03.879 +03:00 [INF] Starting web host...
2025-09-25 22:12:04.648 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 22:12:04.725 +03:00 [INF] Executed DbCommand (59ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-25 22:12:04.794 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 22:12:04.799 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-25 22:12:04.818 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-25 22:12:04.875 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-25 22:12:04.891 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-25 22:12:04.895 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-25 22:12:04.902 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-25 22:12:04.913 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-25 22:12:04.919 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-25 22:12:05.078 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-25 22:12:05.085 +03:00 [INF] Master database initialized successfully
2025-09-25 22:12:05.708 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-25 22:12:05.807 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-25 22:12:05.809 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-25 22:12:05.866 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-25 22:12:05.868 +03:00 [INF] Hosting environment: Development
2025-09-25 22:12:05.870 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-25 22:12:06.355 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-25 22:12:06.466 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 112.2829ms
2025-09-25 22:12:06.475 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-25 22:12:06.475 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-25 22:12:06.486 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.0754ms
2025-09-25 22:12:06.500 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 24.2691ms
2025-09-25 22:12:06.652 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-25 22:12:06.698 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 45.8673ms
2025-09-25 22:12:40.005 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/ExpenseVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - multipart/form-data; boundary=--------------------------405222955176492082298349 85535
2025-09-25 22:12:40.020 +03:00 [INF] Request started
2025-09-25 22:12:40.025 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 22:12:40.028 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.UpdateExpenseVoucher (ModularERP)'
2025-09-25 22:12:40.047 +03:00 [INF] Route matched with {action = "UpdateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] UpdateExpenseVoucher(System.Guid, System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile], System.Collections.Generic.List`1[System.Guid]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 22:12:40.054 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 22:12:40.155 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-25 22:12:40.367 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-25 22:12:40.400 +03:00 [INF] Start updating expense voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 22:12:40.911 +03:00 [INF] Successfully updated expense voucher "9fc81319-ab66-46b2-f378-08ddfc4bca5e"
2025-09-25 22:12:40.920 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-25 22:12:40.945 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.UpdateExpenseVoucher (ModularERP) in 891.8994ms
2025-09-25 22:12:40.948 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.UpdateExpenseVoucher (ModularERP)'
2025-09-25 22:12:40.950 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 22:12:40.955 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/ExpenseVouchers/9fc81319-ab66-46b2-f378-08ddfc4bca5e - 200 null application/json; charset=utf-8 950.4838ms
2025-09-25 22:13:32.988 +03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 22:13:32.993 +03:00 [INF] Request started
2025-09-25 22:13:32.998 +03:00 [INF] Request completed successfully with status code 400
2025-09-25 22:13:33.001 +03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 400 null application/json 12.8489ms
2025-09-25 22:15:03.539 +03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 22:15:03.545 +03:00 [INF] Request started
2025-09-25 22:15:03.546 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 22:15:03.549 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.DeleteExpenseVoucher (ModularERP)'
2025-09-25 22:15:03.556 +03:00 [INF] Route matched with {action = "DeleteExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.String]]] DeleteExpenseVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 22:15:03.574 +03:00 [INF] Start deleting expense voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 22:15:03.619 +03:00 [INF] Successfully deleted expense voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba" with 0 tax lines and 0 attachments
2025-09-25 22:15:03.622 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:15:03.625 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.DeleteExpenseVoucher (ModularERP) in 65.838ms
2025-09-25 22:15:03.627 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.DeleteExpenseVoucher (ModularERP)'
2025-09-25 22:15:03.628 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 22:15:03.629 +03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 200 null application/json; charset=utf-8 90.5168ms
2025-09-25 22:16:00.843 +03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 22:16:00.847 +03:00 [INF] Request started
2025-09-25 22:16:00.848 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 22:16:00.849 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.DeleteExpenseVoucher (ModularERP)'
2025-09-25 22:16:00.851 +03:00 [INF] Route matched with {action = "DeleteExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.String]]] DeleteExpenseVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 22:16:00.856 +03:00 [INF] Start deleting expense voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 22:16:00.875 +03:00 [INF] Successfully deleted expense voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba" with 0 tax lines and 0 attachments
2025-09-25 22:16:00.877 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:16:00.879 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.DeleteExpenseVoucher (ModularERP) in 24.5156ms
2025-09-25 22:16:00.881 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.DeleteExpenseVoucher (ModularERP)'
2025-09-25 22:16:00.882 +03:00 [INF] Request completed successfully with status code 200
2025-09-25 22:16:00.883 +03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 200 null application/json; charset=utf-8 39.7833ms
2025-09-25 22:16:02.623 +03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - null null
2025-09-25 22:16:02.626 +03:00 [INF] Request started
2025-09-25 22:16:02.627 +03:00 [INF] Processing request for tenant: 9df6fad9-79f1-4722-bec3-fc20bb0d5c14
2025-09-25 22:16:02.628 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.DeleteExpenseVoucher (ModularERP)'
2025-09-25 22:16:02.629 +03:00 [INF] Route matched with {action = "DeleteExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.String]]] DeleteExpenseVoucher(System.Guid) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-25 22:16:02.635 +03:00 [INF] Start deleting expense voucher "e83bbacf-7934-4340-eeee-08ddfc1ce5ba"
2025-09-25 22:16:02.638 +03:00 [INF] Executing NotFoundObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-25 22:16:02.640 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.DeleteExpenseVoucher (ModularERP) in 8.8819ms
2025-09-25 22:16:02.642 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.DeleteExpenseVoucher (ModularERP)'
2025-09-25 22:16:02.643 +03:00 [INF] Request completed successfully with status code 404
2025-09-25 22:16:02.644 +03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7168/api/ExpenseVouchers/e83bbacf-7934-4340-eeee-08ddfc1ce5ba - 404 null application/json; charset=utf-8 20.8364ms
