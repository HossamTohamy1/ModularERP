2025-10-23 12:26:51.583 +03:00 [INF] Starting web host...
2025-10-23 12:26:52.978 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-23 12:26:53.065 +03:00 [INF] Executed DbCommand (70ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-23 12:26:53.153 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-23 12:26:53.160 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-23 12:26:53.169 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-23 12:26:53.231 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-23 12:26:53.245 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-23 12:26:53.248 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-23 12:26:53.257 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-23 12:26:53.266 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-23 12:26:53.272 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-23 12:26:53.446 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-23 12:26:53.453 +03:00 [INF] Master database initialized successfully
2025-10-23 12:26:55.066 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-23 12:26:55.219 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-23 12:26:55.220 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-23 12:26:55.328 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-23 12:26:55.330 +03:00 [INF] Hosting environment: Development
2025-10-23 12:26:55.331 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-23 12:26:55.775 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-23 12:26:56.058 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 286.3536ms
2025-10-23 12:26:56.062 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-23 12:26:56.062 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-23 12:26:56.078 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 15.8551ms
2025-10-23 12:26:56.121 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 59.2714ms
2025-10-23 12:26:56.179 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-23 12:26:56.504 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 324.8642ms
2025-10-23 12:39:10.347 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StocktakingImportExport/{c98ed6e2-98ab-4d74-9f4d-1df282fbea94}/import - multipart/form-data; boundary=--------------------------223925175221909441150734 204
2025-10-23 12:39:10.366 +03:00 [INF] Request started
2025-10-23 12:39:10.368 +03:00 [INF] === Incoming Request ===
2025-10-23 12:39:10.370 +03:00 [INF] Path: /api/StocktakingImportExport/%7Bc98ed6e2-98ab-4d74-9f4d-1df282fbea94%7D/import
2025-10-23 12:39:10.371 +03:00 [INF] Method: POST
2025-10-23 12:39:10.372 +03:00 [INF] === Headers ===
2025-10-23 12:39:10.374 +03:00 [INF] Accept: ["*/*"]
2025-10-23 12:39:10.378 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 12:39:10.380 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 12:39:10.382 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 12:39:10.383 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 12:39:10.384 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------223925175221909441150734"]
2025-10-23 12:39:10.387 +03:00 [INF] Content-Length: ["204"]
2025-10-23 12:39:10.389 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 12:39:10.390 +03:00 [INF] Postman-Token: ["f0dcefe4-cff4-4e70-bd4b-4f572885c62e"]
2025-10-23 12:39:10.394 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 12:39:10.397 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 12:39:10.400 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP)'
2025-10-23 12:39:10.423 +03:00 [INF] Route matched with {action = "ImportStocktaking", controller = "StocktakingImportExport"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Stocktaking.DTO.DTO_StockTaking_ImportExport.ImportStocktakingResultDto]]] ImportStocktaking(System.Guid, ModularERP.Modules.Inventory.Features.Stocktaking.Commends.Commends_StockTaking_ImportExport.ImportStocktakingCommand, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController (ModularERP).
2025-10-23 12:39:10.429 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-23 12:39:10.460 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-10-23 12:39:10.480 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP) in 51.2836ms
2025-10-23 12:39:10.483 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP)'
2025-10-23 12:39:10.485 +03:00 [INF] Request completed successfully with status code 400
2025-10-23 12:39:10.488 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StocktakingImportExport/{c98ed6e2-98ab-4d74-9f4d-1df282fbea94}/import - 400 null application/problem+json; charset=utf-8 140.8703ms
2025-10-23 12:41:28.183 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StocktakingImportExport/{c98ed6e2-98ab-4d74-9f4d-1df282fbea94}/import - multipart/form-data; boundary=--------------------------044066820673493829878611 204
2025-10-23 12:41:28.194 +03:00 [INF] Request started
2025-10-23 12:41:28.196 +03:00 [INF] === Incoming Request ===
2025-10-23 12:41:28.197 +03:00 [INF] Path: /api/StocktakingImportExport/%7Bc98ed6e2-98ab-4d74-9f4d-1df282fbea94%7D/import
2025-10-23 12:41:28.197 +03:00 [INF] Method: POST
2025-10-23 12:41:28.198 +03:00 [INF] === Headers ===
2025-10-23 12:41:28.199 +03:00 [INF] Accept: ["*/*"]
2025-10-23 12:41:28.202 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 12:41:28.203 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 12:41:28.204 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 12:41:28.206 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 12:41:28.207 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------044066820673493829878611"]
2025-10-23 12:41:28.208 +03:00 [INF] Content-Length: ["204"]
2025-10-23 12:41:28.210 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 12:41:28.211 +03:00 [INF] Postman-Token: ["94e0dcac-0973-4be7-b3b3-8f1baca1e9af"]
2025-10-23 12:41:28.214 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 12:41:28.215 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 12:41:28.216 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP)'
2025-10-23 12:41:28.219 +03:00 [INF] Route matched with {action = "ImportStocktaking", controller = "StocktakingImportExport"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Stocktaking.DTO.DTO_StockTaking_ImportExport.ImportStocktakingResultDto]]] ImportStocktaking(System.Guid, ModularERP.Modules.Inventory.Features.Stocktaking.Commends.Commends_StockTaking_ImportExport.ImportStocktakingCommand, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController (ModularERP).
2025-10-23 12:41:28.223 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-10-23 12:41:28.225 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP) in 3.4411ms
2025-10-23 12:41:28.227 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP)'
2025-10-23 12:41:28.228 +03:00 [INF] Request completed successfully with status code 400
2025-10-23 12:41:28.229 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StocktakingImportExport/{c98ed6e2-98ab-4d74-9f4d-1df282fbea94}/import - 400 null application/problem+json; charset=utf-8 46.3203ms
2025-10-23 12:43:36.845 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StocktakingImportExport/{c98ed6e2-98ab-4d74-9f4d-1df282fbea94}/import - multipart/form-data; boundary=--------------------------859565619126890823181639 10796
2025-10-23 12:43:36.851 +03:00 [INF] Request started
2025-10-23 12:43:36.852 +03:00 [INF] === Incoming Request ===
2025-10-23 12:43:36.852 +03:00 [INF] Path: /api/StocktakingImportExport/%7Bc98ed6e2-98ab-4d74-9f4d-1df282fbea94%7D/import
2025-10-23 12:43:36.854 +03:00 [INF] Method: POST
2025-10-23 12:43:36.856 +03:00 [INF] === Headers ===
2025-10-23 12:43:36.858 +03:00 [INF] Accept: ["*/*"]
2025-10-23 12:43:36.860 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 12:43:36.862 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 12:43:36.863 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 12:43:36.866 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 12:43:36.867 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------859565619126890823181639"]
2025-10-23 12:43:36.869 +03:00 [INF] Content-Length: ["10796"]
2025-10-23 12:43:36.870 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 12:43:36.872 +03:00 [INF] Postman-Token: ["d17618c1-a341-48e3-ac97-283cdf708b49"]
2025-10-23 12:43:36.874 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 12:43:36.876 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 12:43:36.879 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP)'
2025-10-23 12:43:36.880 +03:00 [INF] Route matched with {action = "ImportStocktaking", controller = "StocktakingImportExport"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Stocktaking.DTO.DTO_StockTaking_ImportExport.ImportStocktakingResultDto]]] ImportStocktaking(System.Guid, ModularERP.Modules.Inventory.Features.Stocktaking.Commends.Commends_StockTaking_ImportExport.ImportStocktakingCommand, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController (ModularERP).
2025-10-23 12:43:36.892 +03:00 [INF] Importing stocktaking data for StocktakingId: "c98ed6e2-98ab-4d74-9f4d-1df282fbea94"
2025-10-23 12:43:36.997 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-23 12:43:37.544 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-23 12:43:37.555 +03:00 [INF] Starting import for StocktakingId: "c98ed6e2-98ab-4d74-9f4d-1df282fbea94"
2025-10-23 12:43:37.592 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP) in 708.4273ms
2025-10-23 12:43:37.595 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP)'
2025-10-23 12:43:37.597 +03:00 [ERR] Application exception occurred: Stocktaking not found
ModularERP.Common.Exceptions.NotFoundException: Stocktaking not found
   at ModularERP.Modules.Inventory.Features.Stocktaking.Handlers.Handlers_StockTaking_ImportExport.ImportStocktakingHandler.Handle(ImportStocktakingCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Handlers\Handlers_StockTaking_ImportExport\ImportStocktakingHandler.cs:line 56
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking(Guid id, ImportStocktakingCommand command, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Controllers\StocktakingImportExportController.cs:line 35
   at lambda_method99(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 352
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 305
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-23 12:43:37.651 +03:00 [INF] Error response sent with status code 404
2025-10-23 12:43:37.657 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StocktakingImportExport/{c98ed6e2-98ab-4d74-9f4d-1df282fbea94}/import - 404 null application/json; charset=utf-8 811.4949ms
2025-10-23 12:44:17.589 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StocktakingImportExport/{0cf7db88-a08b-47f2-b003-1bb4dc0a425f}/import - multipart/form-data; boundary=--------------------------307713123923614855212962 10796
2025-10-23 12:44:17.594 +03:00 [INF] Request started
2025-10-23 12:44:17.595 +03:00 [INF] === Incoming Request ===
2025-10-23 12:44:17.596 +03:00 [INF] Path: /api/StocktakingImportExport/%7B0cf7db88-a08b-47f2-b003-1bb4dc0a425f%7D/import
2025-10-23 12:44:17.597 +03:00 [INF] Method: POST
2025-10-23 12:44:17.600 +03:00 [INF] === Headers ===
2025-10-23 12:44:17.602 +03:00 [INF] Accept: ["*/*"]
2025-10-23 12:44:17.603 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 12:44:17.604 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 12:44:17.606 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 12:44:17.607 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 12:44:17.610 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------307713123923614855212962"]
2025-10-23 12:44:17.614 +03:00 [INF] Content-Length: ["10796"]
2025-10-23 12:44:17.616 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 12:44:17.617 +03:00 [INF] Postman-Token: ["f85d12a6-1232-46d5-99c7-7b1fda7bbaa0"]
2025-10-23 12:44:17.620 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 12:44:17.621 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 12:44:17.622 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP)'
2025-10-23 12:44:17.623 +03:00 [INF] Route matched with {action = "ImportStocktaking", controller = "StocktakingImportExport"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Stocktaking.DTO.DTO_StockTaking_ImportExport.ImportStocktakingResultDto]]] ImportStocktaking(System.Guid, ModularERP.Modules.Inventory.Features.Stocktaking.Commends.Commends_StockTaking_ImportExport.ImportStocktakingCommand, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController (ModularERP).
2025-10-23 12:44:17.628 +03:00 [INF] Importing stocktaking data for StocktakingId: "0cf7db88-a08b-47f2-b003-1bb4dc0a425f"
2025-10-23 12:44:17.633 +03:00 [INF] Starting import for StocktakingId: "0cf7db88-a08b-47f2-b003-1bb4dc0a425f"
2025-10-23 12:44:18.724 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Stocktaking.DTO.DTO_StockTaking_ImportExport.ImportStocktakingResultDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-23 12:44:18.738 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP) in 1111.4912ms
2025-10-23 12:44:18.740 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ImportStocktaking (ModularERP)'
2025-10-23 12:44:18.745 +03:00 [INF] Request completed successfully with status code 200
2025-10-23 12:44:18.747 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StocktakingImportExport/{0cf7db88-a08b-47f2-b003-1bb4dc0a425f}/import - 200 null application/json; charset=utf-8 1157.635ms
2025-10-23 12:49:08.384 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StocktakingImportExport/{0cf7db88-a08b-47f2-b003-1bb4dc0a425f}/export - null null
2025-10-23 12:49:08.387 +03:00 [INF] Request started
2025-10-23 12:49:08.388 +03:00 [INF] === Incoming Request ===
2025-10-23 12:49:08.389 +03:00 [INF] Path: /api/StocktakingImportExport/%7B0cf7db88-a08b-47f2-b003-1bb4dc0a425f%7D/export
2025-10-23 12:49:08.390 +03:00 [INF] Method: GET
2025-10-23 12:49:08.391 +03:00 [INF] === Headers ===
2025-10-23 12:49:08.392 +03:00 [INF] Accept: ["*/*"]
2025-10-23 12:49:08.395 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 12:49:08.396 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 12:49:08.398 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 12:49:08.400 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 12:49:08.402 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 12:49:08.404 +03:00 [INF] Postman-Token: ["802b5765-682d-420e-8d88-15b2dd82b846"]
2025-10-23 12:49:08.407 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 12:49:08.407 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 12:49:08.409 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ExportStocktaking (ModularERP)'
2025-10-23 12:49:08.414 +03:00 [INF] Route matched with {action = "ExportStocktaking", controller = "StocktakingImportExport"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ExportStocktaking(System.Guid, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController (ModularERP).
2025-10-23 12:49:08.420 +03:00 [INF] Exporting stocktaking data for StocktakingId: "0cf7db88-a08b-47f2-b003-1bb4dc0a425f"
2025-10-23 12:49:08.432 +03:00 [INF] Exporting stocktaking data for StocktakingId: "0cf7db88-a08b-47f2-b003-1bb4dc0a425f"
2025-10-23 12:49:08.961 +03:00 [INF] Successfully exported 0 lines
2025-10-23 12:49:09.019 +03:00 [INF] Executing FileContentResult, sending file with download name 'Stocktaking_1234567891_20251023094908.xlsx' ...
2025-10-23 12:49:09.031 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ExportStocktaking (ModularERP) in 612.156ms
2025-10-23 12:49:09.033 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.ExportStocktaking (ModularERP)'
2025-10-23 12:49:09.036 +03:00 [INF] Request completed successfully with status code 200
2025-10-23 12:49:09.040 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StocktakingImportExport/{0cf7db88-a08b-47f2-b003-1bb4dc0a425f}/export - 200 3228 application/vnd.openxmlformats-officedocument.spreadsheetml.sheet 656.4162ms
2025-10-23 13:37:47.561 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StocktakingImportExport/{45ef0250-4160-4789-884f-8d5c14239b1c}/upload-image/{c98ed6e2-98ab-4d74-9f4d-1df282fbea94} - multipart/form-data; boundary=--------------------------205823096496833326055149 139181
2025-10-23 13:37:47.569 +03:00 [INF] Request started
2025-10-23 13:37:47.572 +03:00 [INF] === Incoming Request ===
2025-10-23 13:37:47.573 +03:00 [INF] Path: /api/StocktakingImportExport/%7B45ef0250-4160-4789-884f-8d5c14239b1c%7D/upload-image/%7Bc98ed6e2-98ab-4d74-9f4d-1df282fbea94%7D
2025-10-23 13:37:47.576 +03:00 [INF] Method: GET
2025-10-23 13:37:47.578 +03:00 [INF] === Headers ===
2025-10-23 13:37:47.580 +03:00 [INF] Accept: ["*/*"]
2025-10-23 13:37:47.584 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 13:37:47.585 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 13:37:47.587 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 13:37:47.589 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 13:37:47.590 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------205823096496833326055149"]
2025-10-23 13:37:47.592 +03:00 [INF] Content-Length: ["139181"]
2025-10-23 13:37:47.594 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 13:37:47.596 +03:00 [INF] Postman-Token: ["64ef61d6-acf0-4a5a-98a3-bc1ba73b1df1"]
2025-10-23 13:37:47.598 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 13:37:47.600 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 13:37:47.602 +03:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-10-23 13:37:47.604 +03:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-10-23 13:37:47.605 +03:00 [INF] Request completed successfully with status code 405
2025-10-23 13:37:47.607 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StocktakingImportExport/{45ef0250-4160-4789-884f-8d5c14239b1c}/upload-image/{c98ed6e2-98ab-4d74-9f4d-1df282fbea94} - 405 0 null 45.6121ms
2025-10-23 13:37:47.614 +03:00 [INF] Connection id "0HNGI2P7CTLV4", Request id "0HNGI2P7CTLV4:00000001": the application completed without reading the entire request body.
2025-10-23 13:38:00.181 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StocktakingImportExport/{45ef0250-4160-4789-884f-8d5c14239b1c}/upload-image/{c98ed6e2-98ab-4d74-9f4d-1df282fbea94} - multipart/form-data; boundary=--------------------------012196035185672635682765 139181
2025-10-23 13:38:00.186 +03:00 [INF] Request started
2025-10-23 13:38:00.187 +03:00 [INF] === Incoming Request ===
2025-10-23 13:38:00.189 +03:00 [INF] Path: /api/StocktakingImportExport/%7B45ef0250-4160-4789-884f-8d5c14239b1c%7D/upload-image/%7Bc98ed6e2-98ab-4d74-9f4d-1df282fbea94%7D
2025-10-23 13:38:00.192 +03:00 [INF] Method: POST
2025-10-23 13:38:00.194 +03:00 [INF] === Headers ===
2025-10-23 13:38:00.195 +03:00 [INF] Accept: ["*/*"]
2025-10-23 13:38:00.197 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 13:38:00.200 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 13:38:00.202 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 13:38:00.204 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 13:38:00.206 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------012196035185672635682765"]
2025-10-23 13:38:00.207 +03:00 [INF] Content-Length: ["139181"]
2025-10-23 13:38:00.212 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 13:38:00.214 +03:00 [INF] Postman-Token: ["7235b978-d266-4d3d-8c95-5066030e96f4"]
2025-10-23 13:38:00.217 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 13:38:00.218 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 13:38:00.220 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.UploadLineImage (ModularERP)'
2025-10-23 13:38:00.228 +03:00 [INF] Route matched with {action = "UploadLineImage", controller = "StocktakingImportExport"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Stocktaking.DTO.DTO_StockTaking_ImportExport.UploadImageResultDto]]] UploadLineImage(System.Guid, System.Guid, ModularERP.Modules.Inventory.Features.Stocktaking.Commends.Commends_StockTaking_ImportExport.UploadStocktakingLineImageCommand, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController (ModularERP).
2025-10-23 13:38:00.245 +03:00 [INF] Uploading image for StocktakingId: "45ef0250-4160-4789-884f-8d5c14239b1c", LineId: "c98ed6e2-98ab-4d74-9f4d-1df282fbea94"
2025-10-23 13:38:00.260 +03:00 [INF] Uploading image for StocktakingId: "45ef0250-4160-4789-884f-8d5c14239b1c", LineId: "c98ed6e2-98ab-4d74-9f4d-1df282fbea94"
2025-10-23 13:38:00.458 +03:00 [INF] Image uploaded successfully for LineId: "c98ed6e2-98ab-4d74-9f4d-1df282fbea94", Path: uploads/stocktaking/45ef0250-4160-4789-884f-8d5c14239b1c_c98ed6e2-98ab-4d74-9f4d-1df282fbea94_43eab4f3-42f6-44b4-a089-e03e23204be3.jpeg
2025-10-23 13:38:00.461 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Stocktaking.DTO.DTO_StockTaking_ImportExport.UploadImageResultDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-23 13:38:00.467 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.UploadLineImage (ModularERP) in 232.7123ms
2025-10-23 13:38:00.470 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingImportExportController.UploadLineImage (ModularERP)'
2025-10-23 13:38:00.472 +03:00 [INF] Request completed successfully with status code 200
2025-10-23 13:38:00.474 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StocktakingImportExport/{45ef0250-4160-4789-884f-8d5c14239b1c}/upload-image/{c98ed6e2-98ab-4d74-9f4d-1df282fbea94} - 200 null application/json; charset=utf-8 292.3867ms
2025-10-23 13:39:20.669 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockSnapshot/{45ef0250-4160-4789-884f-8d5c14239b1c}/snapshot/refresh - null null
2025-10-23 13:39:20.673 +03:00 [INF] Request started
2025-10-23 13:39:20.674 +03:00 [INF] === Incoming Request ===
2025-10-23 13:39:20.675 +03:00 [INF] Path: /api/StockSnapshot/%7B45ef0250-4160-4789-884f-8d5c14239b1c%7D/snapshot/refresh
2025-10-23 13:39:20.676 +03:00 [INF] Method: GET
2025-10-23 13:39:20.677 +03:00 [INF] === Headers ===
2025-10-23 13:39:20.680 +03:00 [INF] Accept: ["*/*"]
2025-10-23 13:39:20.682 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 13:39:20.684 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 13:39:20.685 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 13:39:20.687 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 13:39:20.689 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 13:39:20.691 +03:00 [INF] Postman-Token: ["55e734ab-9e8f-4d3f-b63f-89d28a14ba80"]
2025-10-23 13:39:20.693 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 13:39:20.694 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 13:39:20.695 +03:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-10-23 13:39:20.696 +03:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-10-23 13:39:20.697 +03:00 [INF] Request completed successfully with status code 405
2025-10-23 13:39:20.702 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockSnapshot/{45ef0250-4160-4789-884f-8d5c14239b1c}/snapshot/refresh - 405 0 null 32.7378ms
2025-10-23 13:39:30.676 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockSnapshot/{45ef0250-4160-4789-884f-8d5c14239b1c}/snapshot/refresh - null 0
2025-10-23 13:39:30.681 +03:00 [INF] Request started
2025-10-23 13:39:30.682 +03:00 [INF] === Incoming Request ===
2025-10-23 13:39:30.683 +03:00 [INF] Path: /api/StockSnapshot/%7B45ef0250-4160-4789-884f-8d5c14239b1c%7D/snapshot/refresh
2025-10-23 13:39:30.685 +03:00 [INF] Method: POST
2025-10-23 13:39:30.687 +03:00 [INF] === Headers ===
2025-10-23 13:39:30.688 +03:00 [INF] Accept: ["*/*"]
2025-10-23 13:39:30.689 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 13:39:30.691 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 13:39:30.692 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 13:39:30.693 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 13:39:30.695 +03:00 [INF] Content-Length: ["0"]
2025-10-23 13:39:30.699 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 13:39:30.701 +03:00 [INF] Postman-Token: ["0863dcd9-264e-4698-bb39-ea8720442a8b"]
2025-10-23 13:39:30.703 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 13:39:30.704 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 13:39:30.706 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP)'
2025-10-23 13:39:30.711 +03:00 [INF] Route matched with {action = "RefreshSnapshot", controller = "StockSnapshot"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RefreshSnapshot(System.Guid) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController (ModularERP).
2025-10-23 13:39:30.715 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP) in 1.2081ms
2025-10-23 13:39:30.718 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP)'
2025-10-23 13:39:30.720 +03:00 [ERR] Unexpected error occurred
System.InvalidOperationException: Unable to resolve service for type 'Microsoft.Extensions.Logging.ILogger' while attempting to activate 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method406(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 352
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 305
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-23 13:39:30.735 +03:00 [INF] Error response sent with status code 500
2025-10-23 13:39:30.738 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockSnapshot/{45ef0250-4160-4789-884f-8d5c14239b1c}/snapshot/refresh - 500 null application/json; charset=utf-8 61.3584ms
2025-10-23 13:41:18.029 +03:00 [INF] Starting web host...
2025-10-23 13:41:21.692 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-23 13:41:21.740 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-23 13:41:21.818 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-23 13:41:21.824 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-23 13:41:21.837 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-23 13:41:21.894 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-23 13:41:21.910 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-23 13:41:21.914 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-23 13:41:21.922 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-23 13:41:21.936 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-23 13:41:21.941 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-23 13:41:22.114 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-23 13:41:22.122 +03:00 [INF] Master database initialized successfully
2025-10-23 13:41:24.207 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-23 13:41:24.438 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-23 13:41:24.440 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-23 13:41:24.533 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-23 13:41:24.536 +03:00 [INF] Hosting environment: Development
2025-10-23 13:41:24.537 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-23 13:41:24.865 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-23 13:41:24.995 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 129.8638ms
2025-10-23 13:41:25.000 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-23 13:41:25.000 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-23 13:41:25.012 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.5704ms
2025-10-23 13:41:25.031 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.4035ms
2025-10-23 13:41:25.195 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-23 13:41:25.441 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 245.1404ms
2025-10-23 13:41:31.019 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockSnapshot/{45ef0250-4160-4789-884f-8d5c14239b1c}/snapshot/refresh - null 0
2025-10-23 13:41:31.044 +03:00 [INF] Request started
2025-10-23 13:41:31.047 +03:00 [INF] === Incoming Request ===
2025-10-23 13:41:31.048 +03:00 [INF] Path: /api/StockSnapshot/%7B45ef0250-4160-4789-884f-8d5c14239b1c%7D/snapshot/refresh
2025-10-23 13:41:31.049 +03:00 [INF] Method: POST
2025-10-23 13:41:31.050 +03:00 [INF] === Headers ===
2025-10-23 13:41:31.053 +03:00 [INF] Accept: ["*/*"]
2025-10-23 13:41:31.056 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 13:41:31.058 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 13:41:31.060 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 13:41:31.062 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 13:41:31.064 +03:00 [INF] Content-Length: ["0"]
2025-10-23 13:41:31.066 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 13:41:31.067 +03:00 [INF] Postman-Token: ["deee6490-1344-462c-ac8d-3be75e7dbe76"]
2025-10-23 13:41:31.071 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 13:41:31.075 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 13:41:31.077 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP)'
2025-10-23 13:41:31.096 +03:00 [INF] Route matched with {action = "RefreshSnapshot", controller = "StockSnapshot"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RefreshSnapshot(System.Guid) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController (ModularERP).
2025-10-23 13:41:31.102 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-23 13:41:31.124 +03:00 [INF] POST request to refresh snapshot for stocktaking "45ef0250-4160-4789-884f-8d5c14239b1c"
2025-10-23 13:41:31.193 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-23 13:41:31.801 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-23 13:41:31.811 +03:00 [INF] Refreshing snapshot for stocktaking "45ef0250-4160-4789-884f-8d5c14239b1c"
2025-10-23 13:41:31.842 +03:00 [WRN] Cannot refresh snapshot for stocktaking "45ef0250-4160-4789-884f-8d5c14239b1c" with status "Posted"
2025-10-23 13:41:31.850 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP) in 747.7149ms
2025-10-23 13:41:31.853 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP)'
2025-10-23 13:41:31.857 +03:00 [WRN] Business logic exception occurred: Cannot refresh snapshot. Stocktaking is in Posted status
ModularERP.Common.Exceptions.BusinessLogicException: Cannot refresh snapshot. Stocktaking is in Posted status
   at ModularERP.Modules.Inventory.Features.Stocktaking.Handlers.Handlers_StockSnapshot.RefreshSnapshotCommandHandler.Handle(RefreshSnapshotCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Handlers\Handlers_StockSnapshot\RefreshSnapshotCommandHandler.cs:line 68
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot(Guid id) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Controllers\StockSnapshotController.cs:line 58
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 352
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 305
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-23 13:41:31.933 +03:00 [INF] Error response sent with status code 400
2025-10-23 13:41:31.940 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockSnapshot/{45ef0250-4160-4789-884f-8d5c14239b1c}/snapshot/refresh - 400 null application/json; charset=utf-8 920.6197ms
2025-10-23 13:41:55.533 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Stocktaking - application/json 237
2025-10-23 13:41:55.609 +03:00 [INF] Request started
2025-10-23 13:41:55.610 +03:00 [INF] === Incoming Request ===
2025-10-23 13:41:55.611 +03:00 [INF] Path: /api/Stocktaking
2025-10-23 13:41:55.617 +03:00 [INF] Method: POST
2025-10-23 13:41:55.620 +03:00 [INF] === Headers ===
2025-10-23 13:41:55.624 +03:00 [INF] Accept: ["*/*"]
2025-10-23 13:41:55.627 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 13:41:55.629 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 13:41:55.632 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 13:41:55.633 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 13:41:55.637 +03:00 [INF] Content-Type: ["application/json"]
2025-10-23 13:41:55.639 +03:00 [INF] Content-Length: ["237"]
2025-10-23 13:41:55.640 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 13:41:55.642 +03:00 [INF] Postman-Token: ["dc31560a-6634-4c2b-9311-195235fdb59e"]
2025-10-23 13:41:55.645 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 13:41:55.647 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 13:41:55.650 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingController.Create (ModularERP)'
2025-10-23 13:41:55.655 +03:00 [INF] Route matched with {action = "Create", controller = "Stocktaking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ModularERP.Modules.Inventory.Features.Stocktaking.Commends.Commends_StockTaking_Header.CreateStocktakingCommand) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingController (ModularERP).
2025-10-23 13:41:55.728 +03:00 [INF] Creating stocktaking with number 12345678910 for warehouse "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-10-23 13:41:55.792 +03:00 [WRN] Stocktaking number 12345678910 already exists
2025-10-23 13:41:55.794 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingController.Create (ModularERP) in 135.2753ms
2025-10-23 13:41:55.796 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingController.Create (ModularERP)'
2025-10-23 13:41:55.798 +03:00 [WRN] Business logic exception occurred: Stocktaking number '12345678910' already exists
ModularERP.Common.Exceptions.BusinessLogicException: Stocktaking number '12345678910' already exists
   at ModularERP.Modules.Inventory.Features.Stocktaking.Handlers.Handlers_StockTaking_Header.CreateStocktakingHandler.Handle(CreateStocktakingCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Handlers\Handlers_StockTaking_Header\CreateStocktakingHandler.cs:line 47
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingController.Create(CreateStocktakingCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Controllers\StocktakingController.cs:line 31
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 352
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 305
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-23 13:41:55.822 +03:00 [INF] Error response sent with status code 400
2025-10-23 13:41:55.823 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Stocktaking - 400 null application/json; charset=utf-8 290.2208ms
2025-10-23 13:42:03.484 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Stocktaking - application/json 237
2025-10-23 13:42:03.489 +03:00 [INF] Request started
2025-10-23 13:42:03.490 +03:00 [INF] === Incoming Request ===
2025-10-23 13:42:03.491 +03:00 [INF] Path: /api/Stocktaking
2025-10-23 13:42:03.492 +03:00 [INF] Method: POST
2025-10-23 13:42:03.493 +03:00 [INF] === Headers ===
2025-10-23 13:42:03.496 +03:00 [INF] Accept: ["*/*"]
2025-10-23 13:42:03.497 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 13:42:03.499 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 13:42:03.501 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 13:42:03.502 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 13:42:03.505 +03:00 [INF] Content-Type: ["application/json"]
2025-10-23 13:42:03.506 +03:00 [INF] Content-Length: ["237"]
2025-10-23 13:42:03.508 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 13:42:03.510 +03:00 [INF] Postman-Token: ["1460c82e-c282-4ccd-8d15-c313b1b42e1e"]
2025-10-23 13:42:03.512 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 13:42:03.513 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 13:42:03.516 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingController.Create (ModularERP)'
2025-10-23 13:42:03.518 +03:00 [INF] Route matched with {action = "Create", controller = "Stocktaking"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ModularERP.Modules.Inventory.Features.Stocktaking.Commends.Commends_StockTaking_Header.CreateStocktakingCommand) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingController (ModularERP).
2025-10-23 13:42:03.526 +03:00 [INF] Creating stocktaking with number 12345678911 for warehouse "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-10-23 13:42:03.664 +03:00 [INF] Stocktaking created successfully with ID "66cca75e-892c-489f-913e-a252a68d345b"
2025-10-23 13:42:03.717 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Stocktaking.DTO.DTO_StockTaking_Header.CreateStocktakingDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-23 13:42:03.726 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingController.Create (ModularERP) in 205.9963ms
2025-10-23 13:42:03.732 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StocktakingController.Create (ModularERP)'
2025-10-23 13:42:03.734 +03:00 [INF] Request completed successfully with status code 200
2025-10-23 13:42:03.736 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Stocktaking - 200 null application/json; charset=utf-8 251.5443ms
2025-10-23 13:42:22.966 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockSnapshot/{66cca75e-892c-489f-913e-a252a68d345b}/snapshot/refresh - null 0
2025-10-23 13:42:22.972 +03:00 [INF] Request started
2025-10-23 13:42:22.973 +03:00 [INF] === Incoming Request ===
2025-10-23 13:42:22.974 +03:00 [INF] Path: /api/StockSnapshot/%7B66cca75e-892c-489f-913e-a252a68d345b%7D/snapshot/refresh
2025-10-23 13:42:22.975 +03:00 [INF] Method: POST
2025-10-23 13:42:22.978 +03:00 [INF] === Headers ===
2025-10-23 13:42:22.981 +03:00 [INF] Accept: ["*/*"]
2025-10-23 13:42:22.983 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 13:42:22.984 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 13:42:22.986 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 13:42:22.989 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 13:42:22.990 +03:00 [INF] Content-Length: ["0"]
2025-10-23 13:42:22.993 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 13:42:22.996 +03:00 [INF] Postman-Token: ["b42f50b6-1a82-4291-96a7-200bf6b03471"]
2025-10-23 13:42:22.999 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 13:42:23.000 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 13:42:23.001 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP)'
2025-10-23 13:42:23.003 +03:00 [INF] Route matched with {action = "RefreshSnapshot", controller = "StockSnapshot"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RefreshSnapshot(System.Guid) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController (ModularERP).
2025-10-23 13:42:23.009 +03:00 [INF] POST request to refresh snapshot for stocktaking "66cca75e-892c-489f-913e-a252a68d345b"
2025-10-23 13:42:23.014 +03:00 [INF] Refreshing snapshot for stocktaking "66cca75e-892c-489f-913e-a252a68d345b"
2025-10-23 13:42:23.045 +03:00 [ERR] Error refreshing snapshot for stocktaking "66cca75e-892c-489f-913e-a252a68d345b"
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Id'.
Invalid column name 'CreatedById'.
Invalid column name 'IsActive'.
Invalid column name 'StocktakingHeaderId'.
Invalid column name 'UpdatedAt'.
Invalid column name 'UpdatedById'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at ModularERP.Modules.Inventory.Features.Stocktaking.Handlers.Handlers_StockSnapshot.RefreshSnapshotCommandHandler.Handle(RefreshSnapshotCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Handlers\Handlers_StockSnapshot\RefreshSnapshotCommandHandler.cs:line 75
ClientConnectionId:b6c93c57-d71c-44b1-827e-af404c739be0
Error Number:207,State:1,Class:16
2025-10-23 13:42:23.144 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP) in 135.6856ms
2025-10-23 13:42:23.147 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP)'
2025-10-23 13:42:23.148 +03:00 [WRN] Business logic exception occurred: Failed to refresh snapshot
ModularERP.Common.Exceptions.BusinessLogicException: Failed to refresh snapshot
   at ModularERP.Modules.Inventory.Features.Stocktaking.Handlers.Handlers_StockSnapshot.RefreshSnapshotCommandHandler.Handle(RefreshSnapshotCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Handlers\Handlers_StockSnapshot\RefreshSnapshotCommandHandler.cs:line 147
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot(Guid id) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Controllers\StockSnapshotController.cs:line 58
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 352
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 305
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-23 13:42:23.167 +03:00 [INF] Error response sent with status code 400
2025-10-23 13:42:23.169 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockSnapshot/{66cca75e-892c-489f-913e-a252a68d345b}/snapshot/refresh - 400 null application/json; charset=utf-8 203.0871ms
2025-10-23 13:46:57.669 +03:00 [INF] Starting web host...
2025-10-23 13:46:59.160 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-23 13:46:59.206 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-23 13:46:59.280 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-23 13:46:59.285 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-23 13:46:59.289 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-23 13:46:59.350 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-23 13:46:59.368 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-23 13:46:59.374 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-23 13:46:59.381 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-23 13:46:59.394 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-23 13:46:59.400 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-23 13:46:59.612 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-23 13:46:59.620 +03:00 [INF] Master database initialized successfully
2025-10-23 13:47:01.455 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-23 13:47:01.574 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-23 13:47:01.576 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-23 13:47:01.688 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-23 13:47:01.690 +03:00 [INF] Hosting environment: Development
2025-10-23 13:47:01.692 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-23 13:47:01.923 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-23 13:47:02.091 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 168.6278ms
2025-10-23 13:47:02.103 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-23 13:47:02.111 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.2783ms
2025-10-23 13:47:02.120 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-23 13:47:02.152 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 32.5217ms
2025-10-23 13:47:02.325 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-23 13:47:02.531 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 205.455ms
2025-10-23 13:48:16.704 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockSnapshot/{66cca75e-892c-489f-913e-a252a68d345b}/snapshot/refresh - null 0
2025-10-23 13:48:16.722 +03:00 [INF] Request started
2025-10-23 13:48:16.725 +03:00 [INF] === Incoming Request ===
2025-10-23 13:48:16.728 +03:00 [INF] Path: /api/StockSnapshot/%7B66cca75e-892c-489f-913e-a252a68d345b%7D/snapshot/refresh
2025-10-23 13:48:16.730 +03:00 [INF] Method: POST
2025-10-23 13:48:16.732 +03:00 [INF] === Headers ===
2025-10-23 13:48:16.735 +03:00 [INF] Accept: ["*/*"]
2025-10-23 13:48:16.738 +03:00 [INF] Connection: ["keep-alive"]
2025-10-23 13:48:16.740 +03:00 [INF] Host: ["localhost:7168"]
2025-10-23 13:48:16.742 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-23 13:48:16.744 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-23 13:48:16.745 +03:00 [INF] Content-Length: ["0"]
2025-10-23 13:48:16.747 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-23 13:48:16.748 +03:00 [INF] Postman-Token: ["683d98fa-17b2-4556-980d-d8cc0f2594a9"]
2025-10-23 13:48:16.754 +03:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-23 13:48:16.755 +03:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-23 13:48:16.758 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP)'
2025-10-23 13:48:16.775 +03:00 [INF] Route matched with {action = "RefreshSnapshot", controller = "StockSnapshot"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RefreshSnapshot(System.Guid) on controller ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController (ModularERP).
2025-10-23 13:48:16.781 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-23 13:48:16.788 +03:00 [INF] POST request to refresh snapshot for stocktaking "66cca75e-892c-489f-913e-a252a68d345b"
2025-10-23 13:48:16.860 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-23 13:48:17.351 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-23 13:48:17.356 +03:00 [INF] Refreshing snapshot for stocktaking "66cca75e-892c-489f-913e-a252a68d345b"
2025-10-23 13:48:17.394 +03:00 [ERR] Error refreshing snapshot for stocktaking "66cca75e-892c-489f-913e-a252a68d345b"
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'Id'.
Invalid column name 'CreatedById'.
Invalid column name 'IsActive'.
Invalid column name 'StocktakingHeaderId'.
Invalid column name 'UpdatedAt'.
Invalid column name 'UpdatedById'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at ModularERP.Modules.Inventory.Features.Stocktaking.Handlers.Handlers_StockSnapshot.RefreshSnapshotCommandHandler.Handle(RefreshSnapshotCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Handlers\Handlers_StockSnapshot\RefreshSnapshotCommandHandler.cs:line 75
ClientConnectionId:7ec46b23-283f-4abb-a3fa-f20416c8460a
Error Number:207,State:1,Class:16
2025-10-23 13:48:17.436 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP) in 654.0272ms
2025-10-23 13:48:17.439 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot (ModularERP)'
2025-10-23 13:48:17.442 +03:00 [WRN] Business logic exception occurred: Failed to refresh snapshot
ModularERP.Common.Exceptions.BusinessLogicException: Failed to refresh snapshot
   at ModularERP.Modules.Inventory.Features.Stocktaking.Handlers.Handlers_StockSnapshot.RefreshSnapshotCommandHandler.Handle(RefreshSnapshotCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Handlers\Handlers_StockSnapshot\RefreshSnapshotCommandHandler.cs:line 147
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Stocktaking.Controllers.StockSnapshotController.RefreshSnapshot(Guid id) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Stocktaking\Controllers\StockSnapshotController.cs:line 58
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 352
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 305
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-23 13:48:17.478 +03:00 [INF] Error response sent with status code 400
2025-10-23 13:48:17.484 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockSnapshot/{66cca75e-892c-489f-913e-a252a68d345b}/snapshot/refresh - 400 null application/json; charset=utf-8 779.6222ms
