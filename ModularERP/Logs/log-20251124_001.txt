2025-11-24 19:39:10.956 +02:00 [INF] Starting web host...
2025-11-24 19:39:13.031 +02:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 19:39:13.123 +02:00 [INF] Executed DbCommand (64ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 19:39:13.235 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 19:39:13.246 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 19:39:13.262 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 19:39:13.353 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 19:39:13.371 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 19:39:13.375 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 19:39:13.385 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 19:39:13.402 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 19:39:13.409 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 19:39:13.629 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 19:39:13.638 +02:00 [INF] Master database initialized successfully
2025-11-24 19:39:17.932 +02:00 [FTL] Host terminated unexpectedly
System.InvalidOperationException: An error was generated for warning 'Microsoft.EntityFrameworkCore.Migrations.PendingModelChangesWarning': The model for context 'FinanceDbContext' has pending changes. Add a new migration before updating the database. See https://aka.ms/efcore-docs-pending-changes. This exception can be suppressed or logged by passing event ID 'RelationalEventId.PendingModelChangesWarning' to the 'ConfigureWarnings' method in 'DbContext.OnConfiguring' or 'AddDbContext'.
   at Microsoft.EntityFrameworkCore.Diagnostics.EventDefinition`1.Log[TLoggerCategory](IDiagnosticsLogger`1 logger, TParam arg)
   at Microsoft.EntityFrameworkCore.Diagnostics.RelationalLoggerExtensions.PendingModelChangesWarning(IDiagnosticsLogger`1 diagnostics, Type contextType)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.ValidateMigrations(Boolean useTransaction, String targetMigration)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.Migrate(String targetMigration)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.Migrate(DatabaseFacade databaseFacade)
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 269
2025-11-24 19:39:37.214 +02:00 [INF] Starting web host...
2025-11-24 19:39:38.168 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 258
2025-11-24 19:39:49.011 +02:00 [INF] Starting web host...
2025-11-24 19:39:49.848 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 258
2025-11-24 20:24:49.062 +02:00 [INF] Starting web host...
2025-11-24 20:24:53.000 +02:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:24:53.083 +02:00 [INF] Executed DbCommand (63ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 20:24:53.171 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:24:53.178 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 20:24:53.187 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 20:24:53.253 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 20:24:53.275 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:24:53.280 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 20:24:53.287 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 20:24:53.303 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 20:24:53.312 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 20:24:53.492 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 20:24:53.502 +02:00 [INF] Master database initialized successfully
2025-11-24 20:24:55.993 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 20:24:56.209 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 20:24:56.211 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 20:24:56.335 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 20:24:56.337 +02:00 [INF] Hosting environment: Development
2025-11-24 20:24:56.339 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 20:24:56.717 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 20:24:56.958 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 243.9323ms
2025-11-24 20:24:56.985 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 20:24:56.987 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 20:24:56.996 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.5605ms
2025-11-24 20:24:57.032 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 45.1719ms
2025-11-24 20:24:57.189 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 20:24:57.583 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 394.1628ms
2025-11-24 20:26:58.392 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 20:26:58.406 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 13.8315ms
2025-11-24 20:26:58.420 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 20:26:58.420 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 20:26:58.431 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 10.9663ms
2025-11-24 20:26:58.434 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.3409ms
2025-11-24 20:26:58.507 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 20:26:58.782 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 275.0807ms
2025-11-24 20:30:57.262 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6a72aa83-5920-44c5-bad1-08de2b77ee69}/apply - application/json 242
2025-11-24 20:30:57.281 +02:00 [INF] Request started
2025-11-24 20:30:57.284 +02:00 [INF] === Incoming Request ===
2025-11-24 20:30:57.287 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B6a72aa83-5920-44c5-bad1-08de2b77ee69%7D/apply
2025-11-24 20:30:57.288 +02:00 [INF] Method: POST
2025-11-24 20:30:57.293 +02:00 [INF] === Headers ===
2025-11-24 20:30:57.296 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:30:57.300 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:30:57.302 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:30:57.305 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:30:57.306 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:30:57.308 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:30:57.310 +02:00 [INF] Content-Length: ["242"]
2025-11-24 20:30:57.312 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:30:57.313 +02:00 [INF] Postman-Token: ["06c98824-7bce-42d4-8333-b4aa877dfff4"]
2025-11-24 20:30:57.319 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:30:57.321 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:30:57.324 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:30:57.345 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 20:30:57.351 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 20:30:57.379 +02:00 [INF] ApplyPayment endpoint called for payment "6a72aa83-5920-44c5-bad1-08de2b77ee69"
2025-11-24 20:30:57.481 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 20:30:58.031 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 20:30:58.035 +02:00 [INF] Applying payment "6a72aa83-5920-44c5-bad1-08de2b77ee69" to invoices
2025-11-24 20:30:58.213 +02:00 [INF] Created allocation for payment PAY-00005 to invoice INV-202511-0002, Amount: 144
2025-11-24 20:30:58.308 +02:00 [INF] Successfully applied payment "6a72aa83-5920-44c5-bad1-08de2b77ee69"
2025-11-24 20:30:58.455 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 20:30:58.476 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 1124.4602ms
2025-11-24 20:30:58.478 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:30:58.481 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 20:30:58.485 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6a72aa83-5920-44c5-bad1-08de2b77ee69}/apply - 200 null application/json; charset=utf-8 1223.4584ms
2025-11-24 20:41:13.410 +02:00 [INF] Starting web host...
2025-11-24 20:41:15.337 +02:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:41:15.402 +02:00 [INF] Executed DbCommand (47ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 20:41:15.473 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:41:15.478 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 20:41:15.494 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 20:41:15.580 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 20:41:15.596 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:41:15.601 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 20:41:15.609 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 20:41:15.622 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 20:41:15.628 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 20:41:15.802 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 20:41:15.810 +02:00 [INF] Master database initialized successfully
2025-11-24 20:41:17.779 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 20:41:17.908 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 20:41:17.910 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 20:41:20.840 +02:00 [INF] Starting web host...
2025-11-24 20:41:22.307 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:41:22.338 +02:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 20:41:22.412 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:41:22.417 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 20:41:22.420 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 20:41:22.475 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 20:41:22.491 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:41:22.495 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 20:41:22.502 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 20:41:22.514 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 20:41:22.518 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 20:41:22.672 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 20:41:22.680 +02:00 [INF] Master database initialized successfully
2025-11-24 20:41:24.694 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 20:41:24.799 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 20:41:24.801 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 20:41:24.892 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 20:41:24.894 +02:00 [INF] Hosting environment: Development
2025-11-24 20:41:24.897 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 20:41:24.937 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 20:41:25.064 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 128.1436ms
2025-11-24 20:41:25.121 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 20:41:25.121 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 20:41:25.131 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.1115ms
2025-11-24 20:41:25.146 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 24.3205ms
2025-11-24 20:41:25.200 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 20:41:25.496 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 295.6367ms
2025-11-24 20:41:37.304 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6a72aa83-5920-44c5-bad1-08de2b77ee69}/apply - application/json 242
2025-11-24 20:41:37.321 +02:00 [INF] Request started
2025-11-24 20:41:37.323 +02:00 [INF] === Incoming Request ===
2025-11-24 20:41:37.326 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B6a72aa83-5920-44c5-bad1-08de2b77ee69%7D/apply
2025-11-24 20:41:37.328 +02:00 [INF] Method: POST
2025-11-24 20:41:37.329 +02:00 [INF] === Headers ===
2025-11-24 20:41:37.332 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:41:37.336 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:41:37.337 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:41:37.339 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:41:37.341 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:41:37.345 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:41:37.347 +02:00 [INF] Content-Length: ["242"]
2025-11-24 20:41:37.350 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:41:37.351 +02:00 [INF] Postman-Token: ["52a09e7a-1fd7-46d1-96c2-01782ab4f52d"]
2025-11-24 20:41:37.358 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:41:37.360 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:41:37.363 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:41:37.383 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 20:41:37.389 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 20:41:37.419 +02:00 [INF] ApplyPayment endpoint called for payment "6a72aa83-5920-44c5-bad1-08de2b77ee69"
2025-11-24 20:41:37.535 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 20:41:38.160 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 20:41:38.164 +02:00 [INF] Applying payment "6a72aa83-5920-44c5-bad1-08de2b77ee69" to invoices
2025-11-24 20:41:38.353 +02:00 [INF] Created allocation for payment PAY-00005 to invoice INV-202511-0002, Amount: 144
2025-11-24 20:41:38.452 +02:00 [INF] Successfully applied payment "6a72aa83-5920-44c5-bad1-08de2b77ee69"
2025-11-24 20:41:38.571 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 20:41:38.593 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 1203.4031ms
2025-11-24 20:41:38.597 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:41:38.600 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 20:41:38.605 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6a72aa83-5920-44c5-bad1-08de2b77ee69}/apply - 200 null application/json; charset=utf-8 1301.2779ms
2025-11-24 20:43:32.052 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{d248dbde-0c52-47b5-8c9d-08de2b6c52cd}/apply - application/json 242
2025-11-24 20:43:32.073 +02:00 [INF] Request started
2025-11-24 20:43:32.075 +02:00 [INF] === Incoming Request ===
2025-11-24 20:43:32.076 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7Bd248dbde-0c52-47b5-8c9d-08de2b6c52cd%7D/apply
2025-11-24 20:43:32.077 +02:00 [INF] Method: POST
2025-11-24 20:43:32.078 +02:00 [INF] === Headers ===
2025-11-24 20:43:32.079 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:43:32.081 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:43:32.083 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:43:32.085 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:43:32.086 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:43:32.088 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:43:32.090 +02:00 [INF] Content-Length: ["242"]
2025-11-24 20:43:32.093 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:43:32.095 +02:00 [INF] Postman-Token: ["8370b351-74f9-4336-b263-e2f01856870b"]
2025-11-24 20:43:32.098 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:43:32.100 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:43:32.101 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:43:32.104 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 20:43:32.109 +02:00 [INF] ApplyPayment endpoint called for payment "d248dbde-0c52-47b5-8c9d-08de2b6c52cd"
2025-11-24 20:43:32.115 +02:00 [INF] Applying payment "d248dbde-0c52-47b5-8c9d-08de2b6c52cd" to invoices
2025-11-24 20:43:32.123 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 14.3052ms
2025-11-24 20:43:32.126 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:43:32.129 +02:00 [WRN] Business logic exception occurred: Total allocation amount (144) exceeds unallocated amount (0.0000)
ModularERP.Common.Exceptions.BusinessLogicException: Total allocation amount (144) exceeds unallocated amount (0.0000)
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_PaymentApplication.ApplyPaymentHandler.Handle(ApplyPaymentCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_PaymentApplication\ApplyPaymentHandler.cs:line 66
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment(Guid id, ApplyPaymentDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Controllers\PaymentApplicationController.cs:line 57
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-24 20:43:32.200 +02:00 [INF] Error response sent with status code 400
2025-11-24 20:43:32.203 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{d248dbde-0c52-47b5-8c9d-08de2b6c52cd}/apply - 400 null application/json; charset=utf-8 150.7757ms
2025-11-24 20:44:16.945 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{c5d0a8d4-e54b-4464-8604-08de2b6cf479}/apply - application/json 242
2025-11-24 20:44:16.950 +02:00 [INF] Request started
2025-11-24 20:44:16.950 +02:00 [INF] === Incoming Request ===
2025-11-24 20:44:16.951 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7Bc5d0a8d4-e54b-4464-8604-08de2b6cf479%7D/apply
2025-11-24 20:44:16.953 +02:00 [INF] Method: POST
2025-11-24 20:44:16.955 +02:00 [INF] === Headers ===
2025-11-24 20:44:16.957 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:44:16.958 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:44:16.960 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:44:16.962 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:44:16.963 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:44:16.966 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:44:16.967 +02:00 [INF] Content-Length: ["242"]
2025-11-24 20:44:16.969 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:44:16.970 +02:00 [INF] Postman-Token: ["3576820e-82f5-4496-ab10-253253429822"]
2025-11-24 20:44:16.973 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:44:16.975 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:44:16.976 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:44:16.978 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 20:44:16.981 +02:00 [INF] ApplyPayment endpoint called for payment "c5d0a8d4-e54b-4464-8604-08de2b6cf479"
2025-11-24 20:44:16.987 +02:00 [INF] Applying payment "c5d0a8d4-e54b-4464-8604-08de2b6cf479" to invoices
2025-11-24 20:44:16.993 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 12.5536ms
2025-11-24 20:44:16.997 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:44:17.000 +02:00 [WRN] Business logic exception occurred: Cannot apply allocations to a voided payment
ModularERP.Common.Exceptions.BusinessLogicException: Cannot apply allocations to a voided payment
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_PaymentApplication.ApplyPaymentHandler.Handle(ApplyPaymentCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_PaymentApplication\ApplyPaymentHandler.cs:line 54
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment(Guid id, ApplyPaymentDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Controllers\PaymentApplicationController.cs:line 57
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-24 20:44:17.021 +02:00 [INF] Error response sent with status code 400
2025-11-24 20:44:17.023 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{c5d0a8d4-e54b-4464-8604-08de2b6cf479}/apply - 400 null application/json; charset=utf-8 78.1978ms
2025-11-24 20:44:29.431 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{98774b55-e395-4956-bad0-08de2b77ee69}/apply - application/json 242
2025-11-24 20:44:29.436 +02:00 [INF] Request started
2025-11-24 20:44:29.437 +02:00 [INF] === Incoming Request ===
2025-11-24 20:44:29.438 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B98774b55-e395-4956-bad0-08de2b77ee69%7D/apply
2025-11-24 20:44:29.440 +02:00 [INF] Method: POST
2025-11-24 20:44:29.442 +02:00 [INF] === Headers ===
2025-11-24 20:44:29.443 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:44:29.444 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:44:29.446 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:44:29.447 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:44:29.449 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:44:29.452 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:44:29.455 +02:00 [INF] Content-Length: ["242"]
2025-11-24 20:44:29.457 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:44:29.458 +02:00 [INF] Postman-Token: ["118d428b-dd52-42ab-969b-9d238d88e706"]
2025-11-24 20:44:29.460 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:44:29.462 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:44:29.463 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:44:29.464 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 20:44:29.468 +02:00 [INF] ApplyPayment endpoint called for payment "98774b55-e395-4956-bad0-08de2b77ee69"
2025-11-24 20:44:29.473 +02:00 [INF] Applying payment "98774b55-e395-4956-bad0-08de2b77ee69" to invoices
2025-11-24 20:44:29.475 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 7.3618ms
2025-11-24 20:44:29.477 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:44:29.479 +02:00 [WRN] Business logic exception occurred: Total allocation amount (144) exceeds unallocated amount (0.0000)
ModularERP.Common.Exceptions.BusinessLogicException: Total allocation amount (144) exceeds unallocated amount (0.0000)
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_PaymentApplication.ApplyPaymentHandler.Handle(ApplyPaymentCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_PaymentApplication\ApplyPaymentHandler.cs:line 66
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment(Guid id, ApplyPaymentDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Controllers\PaymentApplicationController.cs:line 57
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-24 20:44:29.499 +02:00 [INF] Error response sent with status code 400
2025-11-24 20:44:29.500 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{98774b55-e395-4956-bad0-08de2b77ee69}/apply - 400 null application/json; charset=utf-8 69.3065ms
2025-11-24 20:44:51.642 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{d248dbde-0c52-47b5-8c9d-08de2b6c52cd}/apply - application/json 242
2025-11-24 20:44:51.647 +02:00 [INF] Request started
2025-11-24 20:44:51.648 +02:00 [INF] === Incoming Request ===
2025-11-24 20:44:51.650 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7Bd248dbde-0c52-47b5-8c9d-08de2b6c52cd%7D/apply
2025-11-24 20:44:51.651 +02:00 [INF] Method: POST
2025-11-24 20:44:51.654 +02:00 [INF] === Headers ===
2025-11-24 20:44:51.656 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:44:51.657 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:44:51.659 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:44:51.661 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:44:51.665 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:44:51.667 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:44:51.668 +02:00 [INF] Content-Length: ["242"]
2025-11-24 20:44:51.670 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:44:51.672 +02:00 [INF] Postman-Token: ["586f8854-4aae-401a-9ded-1d6d4674a6bb"]
2025-11-24 20:44:51.675 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:44:51.676 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:44:51.677 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:44:51.680 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 20:44:51.686 +02:00 [INF] ApplyPayment endpoint called for payment "d248dbde-0c52-47b5-8c9d-08de2b6c52cd"
2025-11-24 20:44:51.688 +02:00 [INF] Applying payment "d248dbde-0c52-47b5-8c9d-08de2b6c52cd" to invoices
2025-11-24 20:44:51.690 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 4.5492ms
2025-11-24 20:44:51.692 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:44:51.696 +02:00 [WRN] Business logic exception occurred: Total allocation amount (144) exceeds unallocated amount (0.0000)
ModularERP.Common.Exceptions.BusinessLogicException: Total allocation amount (144) exceeds unallocated amount (0.0000)
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_PaymentApplication.ApplyPaymentHandler.Handle(ApplyPaymentCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_PaymentApplication\ApplyPaymentHandler.cs:line 66
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment(Guid id, ApplyPaymentDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Controllers\PaymentApplicationController.cs:line 57
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-24 20:44:51.718 +02:00 [INF] Error response sent with status code 400
2025-11-24 20:44:51.719 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{d248dbde-0c52-47b5-8c9d-08de2b6c52cd}/apply - 400 null application/json; charset=utf-8 77.3932ms
2025-11-24 20:44:59.714 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{d248dbde-0c52-47b5-8c9d-08de2b6c52cd}/apply - application/json 242
2025-11-24 20:44:59.718 +02:00 [INF] Request started
2025-11-24 20:44:59.719 +02:00 [INF] === Incoming Request ===
2025-11-24 20:44:59.720 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7Bd248dbde-0c52-47b5-8c9d-08de2b6c52cd%7D/apply
2025-11-24 20:44:59.721 +02:00 [INF] Method: POST
2025-11-24 20:44:59.723 +02:00 [INF] === Headers ===
2025-11-24 20:44:59.727 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:44:59.730 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:44:59.731 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:44:59.733 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:44:59.737 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:44:59.738 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:44:59.740 +02:00 [INF] Content-Length: ["242"]
2025-11-24 20:44:59.744 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:44:59.747 +02:00 [INF] Postman-Token: ["6772cb97-a1df-4ec3-80ee-74bfa38e7b45"]
2025-11-24 20:44:59.749 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:44:59.751 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:44:59.752 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:44:59.754 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 20:44:59.760 +02:00 [INF] ApplyPayment endpoint called for payment "d248dbde-0c52-47b5-8c9d-08de2b6c52cd"
2025-11-24 20:44:59.763 +02:00 [INF] Applying payment "d248dbde-0c52-47b5-8c9d-08de2b6c52cd" to invoices
2025-11-24 20:44:59.768 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 8.8528ms
2025-11-24 20:44:59.770 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:44:59.772 +02:00 [WRN] Business logic exception occurred: Total allocation amount (144) exceeds unallocated amount (0.0000)
ModularERP.Common.Exceptions.BusinessLogicException: Total allocation amount (144) exceeds unallocated amount (0.0000)
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_PaymentApplication.ApplyPaymentHandler.Handle(ApplyPaymentCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_PaymentApplication\ApplyPaymentHandler.cs:line 66
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment(Guid id, ApplyPaymentDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Controllers\PaymentApplicationController.cs:line 57
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-24 20:44:59.796 +02:00 [INF] Error response sent with status code 400
2025-11-24 20:44:59.799 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{d248dbde-0c52-47b5-8c9d-08de2b6c52cd}/apply - 400 null application/json; charset=utf-8 85.067ms
2025-11-24 20:45:41.789 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchases/SupplierPayments - application/json 346
2025-11-24 20:45:41.793 +02:00 [INF] Request started
2025-11-24 20:45:41.795 +02:00 [INF] === Incoming Request ===
2025-11-24 20:45:41.796 +02:00 [INF] Path: /api/purchases/SupplierPayments
2025-11-24 20:45:41.797 +02:00 [INF] Method: POST
2025-11-24 20:45:41.800 +02:00 [INF] === Headers ===
2025-11-24 20:45:41.801 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:45:41.803 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:45:41.804 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:45:41.806 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:45:41.808 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:45:41.811 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:45:41.813 +02:00 [INF] Content-Length: ["346"]
2025-11-24 20:45:41.815 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:45:41.817 +02:00 [INF] Postman-Token: ["b6ae5917-0805-4465-927d-b76fa74cf03f"]
2025-11-24 20:45:41.820 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:45:41.821 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:45:41.822 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController.CreateSupplierPayment (ModularERP)'
2025-11-24 20:45:41.827 +02:00 [INF] Route matched with {action = "CreateSupplierPayment", controller = "SupplierPayments"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateSupplierPayment(ModularERP.Modules.Purchases.Invoicing.DTO.DTO_SupplierPayments.CreateSupplierPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController (ModularERP).
2025-11-24 20:45:41.852 +02:00 [INF] Creating supplier payment for Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 20:45:41.854 +02:00 [WRN] Invalid PaymentType: FullPayment
2025-11-24 20:45:41.855 +02:00 [WRN] Business logic error creating supplier payment
ModularERP.Common.Exceptions.BusinessLogicException: Invalid PaymentType. Allowed values: AgainstInvoice, Deposit, Advance
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_SupplierPayments.CreateSupplierPaymentHandler.Handle(CreateSupplierPaymentCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_SupplierPayments\CreateSupplierPaymentHandler.cs:line 51
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController.CreateSupplierPayment(CreateSupplierPaymentDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Controllers\SupplierPaymentsController.cs:line 139
2025-11-24 20:45:41.866 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_SupplierPayments.SupplierPaymentDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 20:45:41.870 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController.CreateSupplierPayment (ModularERP) in 36.8485ms
2025-11-24 20:45:41.873 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController.CreateSupplierPayment (ModularERP)'
2025-11-24 20:45:41.875 +02:00 [INF] Request completed successfully with status code 400
2025-11-24 20:45:41.877 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchases/SupplierPayments - 400 null application/json; charset=utf-8 87.8125ms
2025-11-24 20:46:10.478 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchases/SupplierPayments - application/json 342
2025-11-24 20:46:10.482 +02:00 [INF] Request started
2025-11-24 20:46:10.483 +02:00 [INF] === Incoming Request ===
2025-11-24 20:46:10.484 +02:00 [INF] Path: /api/purchases/SupplierPayments
2025-11-24 20:46:10.486 +02:00 [INF] Method: POST
2025-11-24 20:46:10.487 +02:00 [INF] === Headers ===
2025-11-24 20:46:10.490 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:46:10.492 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:46:10.493 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:46:10.495 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:46:10.496 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:46:10.499 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:46:10.501 +02:00 [INF] Content-Length: ["342"]
2025-11-24 20:46:10.503 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:46:10.505 +02:00 [INF] Postman-Token: ["35e646c4-e6ed-4b7f-8ae9-a60d51464e2d"]
2025-11-24 20:46:10.507 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:46:10.509 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:46:10.510 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController.CreateSupplierPayment (ModularERP)'
2025-11-24 20:46:10.512 +02:00 [INF] Route matched with {action = "CreateSupplierPayment", controller = "SupplierPayments"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateSupplierPayment(ModularERP.Modules.Purchases.Invoicing.DTO.DTO_SupplierPayments.CreateSupplierPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController (ModularERP).
2025-11-24 20:46:10.519 +02:00 [INF] Creating supplier payment for Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 20:46:10.658 +02:00 [INF] Supplier payment created successfully: "5494a534-08e8-4a21-b2f0-08de2b89bc7f"
2025-11-24 20:46:10.690 +02:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_SupplierPayments.SupplierPaymentDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 20:46:10.709 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController.CreateSupplierPayment (ModularERP) in 193.1492ms
2025-11-24 20:46:10.711 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController.CreateSupplierPayment (ModularERP)'
2025-11-24 20:46:10.713 +02:00 [INF] Request completed successfully with status code 201
2025-11-24 20:46:10.714 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchases/SupplierPayments - 201 null application/json; charset=utf-8 235.889ms
2025-11-24 20:46:22.455 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{5494a534-08e8-4a21-b2f0-08de2b89bc7f}/apply - application/json 242
2025-11-24 20:46:22.458 +02:00 [INF] Request started
2025-11-24 20:46:22.459 +02:00 [INF] === Incoming Request ===
2025-11-24 20:46:22.461 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B5494a534-08e8-4a21-b2f0-08de2b89bc7f%7D/apply
2025-11-24 20:46:22.462 +02:00 [INF] Method: POST
2025-11-24 20:46:22.466 +02:00 [INF] === Headers ===
2025-11-24 20:46:22.468 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:46:22.470 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:46:22.471 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:46:22.473 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:46:22.476 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:46:22.477 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:46:22.479 +02:00 [INF] Content-Length: ["242"]
2025-11-24 20:46:22.481 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:46:22.484 +02:00 [INF] Postman-Token: ["36f0c153-60f2-4064-a477-4f1ffcb6ed73"]
2025-11-24 20:46:22.486 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:46:22.487 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:46:22.489 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:46:22.490 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 20:46:22.494 +02:00 [INF] ApplyPayment endpoint called for payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f"
2025-11-24 20:46:22.498 +02:00 [INF] Applying payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f" to invoices
2025-11-24 20:46:22.512 +02:00 [INF] Created allocation for payment PAY-00006 to invoice INV-202511-0002, Amount: 144
2025-11-24 20:46:22.518 +02:00 [INF] Successfully applied payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f"
2025-11-24 20:46:22.530 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 20:46:22.533 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 38.9727ms
2025-11-24 20:46:22.536 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:46:22.537 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 20:46:22.538 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{5494a534-08e8-4a21-b2f0-08de2b89bc7f}/apply - 200 null application/json; charset=utf-8 83.8853ms
2025-11-24 20:55:28.512 +02:00 [INF] Starting web host...
2025-11-24 20:55:30.417 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:55:30.488 +02:00 [INF] Executed DbCommand (56ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 20:55:30.558 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:55:30.564 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 20:55:30.583 +02:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 20:55:30.640 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 20:55:30.656 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:55:30.661 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 20:55:30.668 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 20:55:30.680 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 20:55:30.688 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 20:55:30.853 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 20:55:30.861 +02:00 [INF] Master database initialized successfully
2025-11-24 20:55:33.046 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 20:55:33.168 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 20:55:33.170 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 20:55:33.255 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 20:55:33.271 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 20:55:33.273 +02:00 [INF] Hosting environment: Development
2025-11-24 20:55:33.275 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 20:55:33.439 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 184.6775ms
2025-11-24 20:55:33.544 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 20:55:33.544 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 20:55:33.550 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.0933ms
2025-11-24 20:55:33.573 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 29.6366ms
2025-11-24 20:55:33.627 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 20:55:33.970 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 342.8908ms
2025-11-24 20:57:15.291 +02:00 [INF] Starting web host...
2025-11-24 20:57:17.015 +02:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:57:17.082 +02:00 [INF] Executed DbCommand (48ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 20:57:17.171 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:57:17.178 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 20:57:17.194 +02:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 20:57:17.252 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 20:57:17.269 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:57:17.273 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 20:57:17.281 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 20:57:17.295 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 20:57:17.303 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 20:57:17.491 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 20:57:17.499 +02:00 [INF] Master database initialized successfully
2025-11-24 20:57:21.653 +02:00 [INF] Starting web host...
2025-11-24 20:57:23.094 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:57:23.126 +02:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 20:57:23.204 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:57:23.209 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 20:57:23.213 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 20:57:23.269 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 20:57:23.286 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:57:23.292 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 20:57:23.307 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 20:57:23.325 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 20:57:23.330 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 20:57:23.499 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 20:57:23.508 +02:00 [INF] Master database initialized successfully
2025-11-24 20:57:28.308 +02:00 [INF] Starting web host...
2025-11-24 20:57:29.755 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:57:29.788 +02:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 20:57:29.870 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:57:29.877 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 20:57:29.881 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 20:57:29.939 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 20:57:29.955 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:57:29.960 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 20:57:29.966 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 20:57:29.980 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 20:57:29.984 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 20:57:30.142 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 20:57:30.150 +02:00 [INF] Master database initialized successfully
2025-11-24 20:57:32.222 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 20:57:32.328 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 20:57:32.330 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 20:57:32.406 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 20:57:32.430 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 20:57:32.432 +02:00 [INF] Hosting environment: Development
2025-11-24 20:57:32.433 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 20:57:32.537 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 131.8734ms
2025-11-24 20:57:32.600 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 20:57:32.600 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 20:57:32.609 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.0497ms
2025-11-24 20:57:32.632 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 31.5224ms
2025-11-24 20:57:32.660 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 20:57:32.961 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 301.497ms
2025-11-24 20:57:35.781 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{5494a534-08e8-4a21-b2f0-08de2b89bc7f}/apply - application/json 242
2025-11-24 20:57:35.858 +02:00 [INF] Request started
2025-11-24 20:57:35.879 +02:00 [INF] === Incoming Request ===
2025-11-24 20:57:35.882 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B5494a534-08e8-4a21-b2f0-08de2b89bc7f%7D/apply
2025-11-24 20:57:35.883 +02:00 [INF] Method: POST
2025-11-24 20:57:35.885 +02:00 [INF] === Headers ===
2025-11-24 20:57:35.889 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:57:35.894 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:57:35.897 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:57:35.899 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:57:35.919 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:57:35.921 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:57:35.925 +02:00 [INF] Content-Length: ["242"]
2025-11-24 20:57:35.928 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:57:35.930 +02:00 [INF] Postman-Token: ["9e7de4b7-a3c6-4499-9a49-8c547fcf8b15"]
2025-11-24 20:57:35.935 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:57:35.937 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:57:35.940 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:57:35.964 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 20:57:35.969 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 20:57:36.018 +02:00 [INF] ApplyPayment endpoint called for payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f"
2025-11-24 20:57:36.138 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 20:57:37.041 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 20:57:37.052 +02:00 [INF] Applying payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f" to invoices
2025-11-24 20:57:37.265 +02:00 [INF] Created allocation for payment PAY-00006 to invoice INV-202511-0002, Amount: 144
2025-11-24 20:57:37.373 +02:00 [INF] Successfully applied payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f"
2025-11-24 20:57:37.488 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 20:57:37.512 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 1542.6711ms
2025-11-24 20:57:37.516 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:57:37.520 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 20:57:37.529 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{5494a534-08e8-4a21-b2f0-08de2b89bc7f}/apply - 200 null application/json; charset=utf-8 1747.8262ms
2025-11-24 20:58:46.910 +02:00 [INF] Starting web host...
2025-11-24 20:58:48.421 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:58:48.479 +02:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 20:58:48.553 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:58:48.559 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 20:58:48.576 +02:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 20:58:48.633 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 20:58:48.651 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 20:58:48.657 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 20:58:48.664 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 20:58:48.675 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 20:58:48.683 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 20:58:48.935 +02:00 [INF] Executed DbCommand (81ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 20:58:48.955 +02:00 [INF] Master database initialized successfully
2025-11-24 20:58:51.099 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 20:58:51.208 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 20:58:51.210 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 20:58:51.310 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 20:58:51.312 +02:00 [INF] Hosting environment: Development
2025-11-24 20:58:51.313 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 20:58:51.325 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 20:58:51.467 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 142.9235ms
2025-11-24 20:58:51.471 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 20:58:51.471 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 20:58:51.532 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 61.0728ms
2025-11-24 20:58:51.546 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 75.4148ms
2025-11-24 20:58:51.572 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 20:58:51.884 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 312.4132ms
2025-11-24 20:58:54.555 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{5494a534-08e8-4a21-b2f0-08de2b89bc7f}/apply - application/json 242
2025-11-24 20:58:54.580 +02:00 [INF] Request started
2025-11-24 20:58:54.584 +02:00 [INF] === Incoming Request ===
2025-11-24 20:58:54.586 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B5494a534-08e8-4a21-b2f0-08de2b89bc7f%7D/apply
2025-11-24 20:58:54.587 +02:00 [INF] Method: POST
2025-11-24 20:58:54.589 +02:00 [INF] === Headers ===
2025-11-24 20:58:54.594 +02:00 [INF] Accept: ["*/*"]
2025-11-24 20:58:54.598 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 20:58:54.602 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 20:58:54.604 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 20:58:54.607 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 20:58:54.610 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 20:58:54.611 +02:00 [INF] Content-Length: ["242"]
2025-11-24 20:58:54.614 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 20:58:54.616 +02:00 [INF] Postman-Token: ["7e1d7fdf-d64d-4e2e-ab20-eea81dc0d0d5"]
2025-11-24 20:58:54.623 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 20:58:54.625 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 20:58:54.626 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:58:54.652 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 20:58:54.658 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 20:58:54.697 +02:00 [INF] ApplyPayment endpoint called for payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f"
2025-11-24 20:58:54.812 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 20:58:55.695 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 20:58:55.710 +02:00 [INF] Applying payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f" to invoices
2025-11-24 20:58:55.911 +02:00 [INF] Created allocation for payment PAY-00006 to invoice INV-202511-0002, Amount: 144
2025-11-24 20:58:56.019 +02:00 [INF] Successfully applied payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f"
2025-11-24 20:58:56.135 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 20:58:56.161 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 1502.3693ms
2025-11-24 20:58:56.163 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 20:58:56.166 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 20:58:56.172 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{5494a534-08e8-4a21-b2f0-08de2b89bc7f}/apply - 200 null application/json; charset=utf-8 1617.1923ms
2025-11-24 21:06:33.567 +02:00 [INF] Starting web host...
2025-11-24 21:06:35.156 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:06:35.219 +02:00 [INF] Executed DbCommand (48ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 21:06:35.290 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:06:35.297 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 21:06:35.314 +02:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 21:06:35.372 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 21:06:35.388 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:06:35.394 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 21:06:35.402 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 21:06:35.415 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 21:06:35.422 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 21:06:35.599 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 21:06:35.607 +02:00 [INF] Master database initialized successfully
2025-11-24 21:06:37.665 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 21:06:37.781 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 21:06:37.784 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 21:06:37.874 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 21:06:37.876 +02:00 [INF] Hosting environment: Development
2025-11-24 21:06:37.877 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 21:06:37.999 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 21:06:38.178 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 180.3277ms
2025-11-24 21:06:38.213 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 21:06:38.213 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 21:06:38.222 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.1708ms
2025-11-24 21:06:38.239 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 25.8501ms
2025-11-24 21:06:38.268 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 21:06:38.597 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 329.0483ms
2025-11-24 21:06:44.831 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{5494a534-08e8-4a21-b2f0-08de2b89bc7f}/apply - application/json 242
2025-11-24 21:06:44.855 +02:00 [INF] Request started
2025-11-24 21:06:44.858 +02:00 [INF] === Incoming Request ===
2025-11-24 21:06:44.862 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B5494a534-08e8-4a21-b2f0-08de2b89bc7f%7D/apply
2025-11-24 21:06:44.863 +02:00 [INF] Method: POST
2025-11-24 21:06:44.866 +02:00 [INF] === Headers ===
2025-11-24 21:06:44.869 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:06:44.874 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:06:44.878 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:06:44.879 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:06:44.881 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:06:44.882 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:06:44.885 +02:00 [INF] Content-Length: ["242"]
2025-11-24 21:06:44.887 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:06:44.888 +02:00 [INF] Postman-Token: ["0ae96653-3e20-43b2-ace2-e05de3ba8923"]
2025-11-24 21:06:44.895 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:06:44.896 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:06:44.898 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:06:44.920 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:06:44.928 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:06:44.959 +02:00 [INF] ApplyPayment endpoint called for payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f"
2025-11-24 21:06:45.056 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 21:06:45.710 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:06:45.715 +02:00 [INF] Applying payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f" to invoices
2025-11-24 21:06:45.908 +02:00 [INF] Created allocation for payment PAY-00006 to invoice INV-202511-0002, Amount: 144
2025-11-24 21:06:46.013 +02:00 [INF] Successfully applied payment "5494a534-08e8-4a21-b2f0-08de2b89bc7f"
2025-11-24 21:06:46.129 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:06:46.152 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 1225.5388ms
2025-11-24 21:06:46.155 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:06:46.158 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:06:46.164 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{5494a534-08e8-4a21-b2f0-08de2b89bc7f}/apply - 200 null application/json; charset=utf-8 1333.1306ms
2025-11-24 21:07:27.071 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchases/SupplierPayments - application/json 398
2025-11-24 21:07:27.090 +02:00 [INF] Request started
2025-11-24 21:07:27.091 +02:00 [INF] === Incoming Request ===
2025-11-24 21:07:27.092 +02:00 [INF] Path: /api/purchases/SupplierPayments
2025-11-24 21:07:27.093 +02:00 [INF] Method: POST
2025-11-24 21:07:27.095 +02:00 [INF] === Headers ===
2025-11-24 21:07:27.096 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:07:27.097 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:07:27.099 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:07:27.100 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:07:27.101 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:07:27.103 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:07:27.104 +02:00 [INF] Content-Length: ["398"]
2025-11-24 21:07:27.105 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:07:27.107 +02:00 [INF] Postman-Token: ["ba32a2b8-38d4-45c3-bc8a-a30c915412e5"]
2025-11-24 21:07:27.111 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:07:27.112 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:07:27.113 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController.CreateSupplierPayment (ModularERP)'
2025-11-24 21:07:27.118 +02:00 [INF] Route matched with {action = "CreateSupplierPayment", controller = "SupplierPayments"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateSupplierPayment(ModularERP.Modules.Purchases.Invoicing.DTO.DTO_SupplierPayments.CreateSupplierPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController (ModularERP).
2025-11-24 21:07:27.142 +02:00 [INF] Creating supplier payment for Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:07:27.275 +02:00 [INF] Supplier payment created successfully: "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:07:27.309 +02:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_SupplierPayments.SupplierPaymentDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:07:27.330 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController.CreateSupplierPayment (ModularERP) in 208.5668ms
2025-11-24 21:07:27.334 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.SupplierPaymentsController.CreateSupplierPayment (ModularERP)'
2025-11-24 21:07:27.335 +02:00 [INF] Request completed successfully with status code 201
2025-11-24 21:07:27.336 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchases/SupplierPayments - 201 null application/json; charset=utf-8 264.6749ms
2025-11-24 21:07:45.813 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/apply - application/json 242
2025-11-24 21:07:45.819 +02:00 [INF] Request started
2025-11-24 21:07:45.820 +02:00 [INF] === Incoming Request ===
2025-11-24 21:07:45.821 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B6bb6259b-ed0b-4f46-e63c-08de2b8cb56c%7D/apply
2025-11-24 21:07:45.822 +02:00 [INF] Method: POST
2025-11-24 21:07:45.824 +02:00 [INF] === Headers ===
2025-11-24 21:07:45.824 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:07:45.826 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:07:45.829 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:07:45.830 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:07:45.832 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:07:45.833 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:07:45.835 +02:00 [INF] Content-Length: ["242"]
2025-11-24 21:07:45.836 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:07:45.838 +02:00 [INF] Postman-Token: ["cc49e9e5-2e51-4f17-b72d-1f3deaba9a7d"]
2025-11-24 21:07:45.841 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:07:45.842 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:07:45.844 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:07:45.845 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:07:45.848 +02:00 [INF] ApplyPayment endpoint called for payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:07:45.851 +02:00 [INF] Applying payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c" to invoices
2025-11-24 21:07:45.860 +02:00 [INF] Created allocation for payment PAY-00007 to invoice INV-202511-0002, Amount: 144
2025-11-24 21:07:45.871 +02:00 [INF] Successfully applied payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:07:45.882 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:07:45.885 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 37.8006ms
2025-11-24 21:07:45.887 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:07:45.888 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:07:45.889 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/apply - 200 null application/json; charset=utf-8 76.3063ms
2025-11-24 21:08:30.753 +02:00 [INF] Starting web host...
2025-11-24 21:08:34.430 +02:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:08:34.494 +02:00 [INF] Executed DbCommand (45ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 21:08:34.589 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:08:34.598 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 21:08:34.609 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 21:08:34.692 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 21:08:34.709 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:08:34.713 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 21:08:34.721 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 21:08:34.735 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 21:08:34.740 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 21:08:34.952 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 21:08:34.961 +02:00 [INF] Master database initialized successfully
2025-11-24 21:08:37.524 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 21:08:37.789 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 21:08:37.790 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 21:08:37.921 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 21:08:37.923 +02:00 [INF] Hosting environment: Development
2025-11-24 21:08:37.924 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 21:08:38.643 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 21:08:39.199 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 567.9077ms
2025-11-24 21:08:39.238 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 21:08:39.238 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 21:08:39.308 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 69.9672ms
2025-11-24 21:08:39.373 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 135.6137ms
2025-11-24 21:08:39.431 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 21:08:40.342 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 910.7823ms
2025-11-24 21:08:46.231 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/apply - application/json 242
2025-11-24 21:08:46.250 +02:00 [INF] Request started
2025-11-24 21:08:46.253 +02:00 [INF] === Incoming Request ===
2025-11-24 21:08:46.256 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B6bb6259b-ed0b-4f46-e63c-08de2b8cb56c%7D/apply
2025-11-24 21:08:46.258 +02:00 [INF] Method: POST
2025-11-24 21:08:46.260 +02:00 [INF] === Headers ===
2025-11-24 21:08:46.265 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:08:46.270 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:08:46.272 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:08:46.274 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:08:46.276 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:08:46.278 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:08:46.279 +02:00 [INF] Content-Length: ["242"]
2025-11-24 21:08:46.281 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:08:46.283 +02:00 [INF] Postman-Token: ["045d188b-13a9-4c20-998a-5b65c824b028"]
2025-11-24 21:08:46.290 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:08:46.292 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:08:46.294 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:08:46.338 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:08:46.346 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:08:46.413 +02:00 [INF] ApplyPayment endpoint called for payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:08:46.595 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 21:08:47.579 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:08:47.585 +02:00 [INF] Applying payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c" to invoices
2025-11-24 21:10:23.393 +02:00 [INF] Created allocation for payment PAY-00007 to invoice INV-202511-0002, Amount: 144
2025-11-24 21:14:28.160 +02:00 [INF] Successfully applied payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:15:24.506 +02:00 [INF] Starting web host...
2025-11-24 21:15:26.127 +02:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:15:26.178 +02:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 21:15:26.269 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:15:26.276 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 21:15:26.297 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 21:15:26.369 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 21:15:26.386 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:15:26.390 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 21:15:26.397 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 21:15:26.408 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 21:15:26.412 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 21:15:26.593 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 21:15:26.603 +02:00 [INF] Master database initialized successfully
2025-11-24 21:15:28.647 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 21:15:28.754 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 21:15:28.757 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 21:15:28.868 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 21:15:28.877 +02:00 [INF] Hosting environment: Development
2025-11-24 21:15:28.879 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 21:15:28.960 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 21:15:29.111 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 152.9101ms
2025-11-24 21:15:29.115 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 21:15:29.122 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 21:15:29.144 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 28.7021ms
2025-11-24 21:15:29.168 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 49.8212ms
2025-11-24 21:15:29.214 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 21:15:29.514 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 299.8555ms
2025-11-24 21:15:35.644 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/apply - application/json 242
2025-11-24 21:15:35.669 +02:00 [INF] Request started
2025-11-24 21:15:35.671 +02:00 [INF] === Incoming Request ===
2025-11-24 21:15:35.673 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B6bb6259b-ed0b-4f46-e63c-08de2b8cb56c%7D/apply
2025-11-24 21:15:35.674 +02:00 [INF] Method: POST
2025-11-24 21:15:35.675 +02:00 [INF] === Headers ===
2025-11-24 21:15:35.677 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:15:35.680 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:15:35.682 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:15:35.684 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:15:35.685 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:15:35.687 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:15:35.690 +02:00 [INF] Content-Length: ["242"]
2025-11-24 21:15:35.692 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:15:35.693 +02:00 [INF] Postman-Token: ["16d64a3a-8b52-4a07-b918-8e548f4725c3"]
2025-11-24 21:15:35.698 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:15:35.700 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:15:35.702 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:15:35.726 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:15:35.731 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:15:35.771 +02:00 [INF] ApplyPayment endpoint called for payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:15:35.889 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 21:15:36.729 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:15:36.742 +02:00 [INF] Applying payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c" to invoices
2025-11-24 21:15:37.041 +02:00 [INF] Created allocation for payment PAY-00007 to invoice INV-202511-0002, Amount: 144
2025-11-24 21:15:37.073 +02:00 [INF] Successfully applied payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:15:37.230 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:15:37.255 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 1523.9021ms
2025-11-24 21:15:37.258 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:15:37.260 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:15:37.267 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/apply - 200 null application/json; charset=utf-8 1622.3262ms
2025-11-24 21:18:49.330 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/allocate - application/json 137
2025-11-24 21:18:49.350 +02:00 [INF] Request started
2025-11-24 21:18:49.351 +02:00 [INF] === Incoming Request ===
2025-11-24 21:18:49.353 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B6bb6259b-ed0b-4f46-e63c-08de2b8cb56c%7D/allocate
2025-11-24 21:18:49.354 +02:00 [INF] Method: POST
2025-11-24 21:18:49.355 +02:00 [INF] === Headers ===
2025-11-24 21:18:49.356 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:18:49.358 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:18:49.359 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:18:49.361 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:18:49.362 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:18:49.364 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:18:49.365 +02:00 [INF] Content-Length: ["137"]
2025-11-24 21:18:49.366 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:18:49.368 +02:00 [INF] Postman-Token: ["61b57bae-ab23-4de3-9095-f19420dcc8ac"]
2025-11-24 21:18:49.372 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:18:49.374 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:18:49.375 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.AllocatePayment (ModularERP)'
2025-11-24 21:18:49.381 +02:00 [INF] Route matched with {action = "AllocatePayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AllocatePayment(System.Guid, System.Collections.Generic.List`1[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.InvoiceAllocationDto]) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:18:49.387 +02:00 [INF] AllocatePayment endpoint called for payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:18:49.393 +02:00 [INF] Applying payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c" to invoices
2025-11-24 21:18:49.438 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.AllocatePayment (ModularERP) in 54.4229ms
2025-11-24 21:18:49.442 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.AllocatePayment (ModularERP)'
2025-11-24 21:18:49.444 +02:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'Purchases.PaymentAllocations' with unique index 'IX_PaymentAllocations_Payment_Invoice'. The duplicate key value is (6bb6259b-ed0b-4f46-e63c-08de2b8cb56c, af1aab03-bfc2-4e9d-b992-0105a7527a37).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:173e1bc8-f10f-4e9d-a6b1-710713a72a62
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2599
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_PaymentApplication.ApplyPaymentHandler.Handle(ApplyPaymentCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_PaymentApplication\ApplyPaymentHandler.cs:line 108
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_PaymentApplication.AllocatePaymentHandler.Handle(AllocatePaymentCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_PaymentApplication\AllocatePaymentHandler.cs:line 28
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.AllocatePayment(Guid id, List`1 allocations) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Controllers\PaymentApplicationController.cs:line 97
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-24 21:18:49.524 +02:00 [INF] Error response sent with status code 500
2025-11-24 21:18:49.526 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/allocate - 500 null application/json; charset=utf-8 196.5154ms
2025-11-24 21:19:32.963 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/allocate - application/json 137
2025-11-24 21:19:32.968 +02:00 [INF] Request started
2025-11-24 21:19:32.969 +02:00 [INF] === Incoming Request ===
2025-11-24 21:19:32.971 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B6bb6259b-ed0b-4f46-e63c-08de2b8cb56c%7D/allocate
2025-11-24 21:19:32.973 +02:00 [INF] Method: POST
2025-11-24 21:19:32.974 +02:00 [INF] === Headers ===
2025-11-24 21:19:32.975 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:19:32.977 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:19:32.978 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:19:32.980 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:19:32.982 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:19:32.984 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:19:32.986 +02:00 [INF] Content-Length: ["137"]
2025-11-24 21:19:32.988 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:19:32.990 +02:00 [INF] Postman-Token: ["514d5c4c-a8a2-496b-b516-d09c8ab9e9c5"]
2025-11-24 21:19:32.993 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:19:32.994 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:19:32.995 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.AllocatePayment (ModularERP)'
2025-11-24 21:19:32.997 +02:00 [INF] Route matched with {action = "AllocatePayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AllocatePayment(System.Guid, System.Collections.Generic.List`1[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.InvoiceAllocationDto]) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:19:33.000 +02:00 [INF] AllocatePayment endpoint called for payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:19:33.007 +02:00 [INF] Applying payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c" to invoices
2025-11-24 21:19:33.024 +02:00 [INF] Created allocation for payment PAY-00007 to invoice INV-202511-0002, Amount: 100
2025-11-24 21:19:33.029 +02:00 [INF] Successfully applied payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:19:33.039 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:19:33.043 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.AllocatePayment (ModularERP) in 43.8266ms
2025-11-24 21:19:33.045 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.AllocatePayment (ModularERP)'
2025-11-24 21:19:33.046 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:19:33.048 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/allocate - 200 null application/json; charset=utf-8 84.6893ms
2025-11-24 21:21:27.671 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{af1aab03-bfc2-4e9d-b992-0105a7527a37}/pay - application/json 206
2025-11-24 21:21:27.675 +02:00 [INF] Request started
2025-11-24 21:21:27.676 +02:00 [INF] === Incoming Request ===
2025-11-24 21:21:27.677 +02:00 [INF] Path: /api/PaymentApplication/purchase-invoices/%7Baf1aab03-bfc2-4e9d-b992-0105a7527a37%7D/pay
2025-11-24 21:21:27.678 +02:00 [INF] Method: POST
2025-11-24 21:21:27.679 +02:00 [INF] === Headers ===
2025-11-24 21:21:27.680 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:21:27.684 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:21:27.686 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:21:27.687 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:21:27.688 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:21:27.690 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:21:27.692 +02:00 [INF] Content-Length: ["206"]
2025-11-24 21:21:27.694 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:21:27.695 +02:00 [INF] Postman-Token: ["5c31bfe4-22d7-4580-9924-581603e2d83c"]
2025-11-24 21:21:27.697 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:21:27.698 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:21:27.699 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:21:27.705 +02:00 [INF] Route matched with {action = "PayInvoice", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PayInvoice(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PayInvoiceDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:21:27.713 +02:00 [INF] PayInvoice endpoint called for invoice "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-24 21:21:27.742 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Object, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:21:27.746 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP) in 38.2056ms
2025-11-24 21:21:27.749 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:21:27.753 +02:00 [INF] Request completed successfully with status code 400
2025-11-24 21:21:27.754 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{af1aab03-bfc2-4e9d-b992-0105a7527a37}/pay - 400 null application/json; charset=utf-8 83.4631ms
2025-11-24 21:22:38.506 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - application/json 206
2025-11-24 21:22:38.511 +02:00 [INF] Request started
2025-11-24 21:22:38.511 +02:00 [INF] === Incoming Request ===
2025-11-24 21:22:38.513 +02:00 [INF] Path: /api/PaymentApplication/purchase-invoices/%7Be2b2b134-64f7-4af9-b25b-18f0afae3203%7D/pay
2025-11-24 21:22:38.514 +02:00 [INF] Method: POST
2025-11-24 21:22:38.516 +02:00 [INF] === Headers ===
2025-11-24 21:22:38.517 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:22:38.519 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:22:38.520 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:22:38.522 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:22:38.523 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:22:38.527 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:22:38.528 +02:00 [INF] Content-Length: ["206"]
2025-11-24 21:22:38.531 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:22:38.532 +02:00 [INF] Postman-Token: ["d6eba646-d621-4940-b74b-1ad6e800371b"]
2025-11-24 21:22:38.534 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:22:38.537 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:22:38.538 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:22:38.540 +02:00 [INF] Route matched with {action = "PayInvoice", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PayInvoice(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PayInvoiceDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:22:38.545 +02:00 [INF] PayInvoice endpoint called for invoice "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-24 21:22:38.549 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Object, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:22:38.551 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP) in 7.002ms
2025-11-24 21:22:38.553 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:22:38.555 +02:00 [INF] Request completed successfully with status code 400
2025-11-24 21:22:38.556 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - 400 null application/json; charset=utf-8 49.9105ms
2025-11-24 21:22:59.210 +02:00 [INF] Starting web host...
2025-11-24 21:23:00.674 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:23:00.717 +02:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 21:23:00.792 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:23:00.799 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 21:23:00.812 +02:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 21:23:00.883 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 21:23:00.900 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:23:00.904 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 21:23:00.911 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 21:23:00.922 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 21:23:00.927 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 21:23:01.090 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 21:23:01.097 +02:00 [INF] Master database initialized successfully
2025-11-24 21:23:03.112 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 21:23:03.221 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 21:23:03.223 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 21:23:03.316 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 21:23:03.319 +02:00 [INF] Hosting environment: Development
2025-11-24 21:23:03.320 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 21:23:03.628 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 21:23:03.754 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 127.0784ms
2025-11-24 21:23:03.889 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 21:23:03.889 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 21:23:03.895 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.5161ms
2025-11-24 21:23:03.915 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 25.723ms
2025-11-24 21:23:03.972 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 21:23:04.252 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 279.8442ms
2025-11-24 21:23:06.670 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - application/json 206
2025-11-24 21:23:06.694 +02:00 [INF] Request started
2025-11-24 21:23:06.697 +02:00 [INF] === Incoming Request ===
2025-11-24 21:23:06.699 +02:00 [INF] Path: /api/PaymentApplication/purchase-invoices/%7Be2b2b134-64f7-4af9-b25b-18f0afae3203%7D/pay
2025-11-24 21:23:06.700 +02:00 [INF] Method: POST
2025-11-24 21:23:06.701 +02:00 [INF] === Headers ===
2025-11-24 21:23:06.705 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:23:06.709 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:23:06.710 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:23:06.711 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:23:06.714 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:23:06.716 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:23:06.718 +02:00 [INF] Content-Length: ["206"]
2025-11-24 21:23:06.720 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:23:06.723 +02:00 [INF] Postman-Token: ["a88346c5-56f3-4f2d-a475-d70f01fe991e"]
2025-11-24 21:23:06.729 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:23:06.730 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:23:06.733 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:23:06.757 +02:00 [INF] Route matched with {action = "PayInvoice", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PayInvoice(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PayInvoiceDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:23:06.764 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:23:06.794 +02:00 [INF] PayInvoice endpoint called for invoice "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-24 21:23:06.845 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Object, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:23:06.860 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP) in 95.958ms
2025-11-24 21:23:06.862 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:23:06.869 +02:00 [INF] Request completed successfully with status code 400
2025-11-24 21:23:06.872 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - 400 null application/json; charset=utf-8 202.1093ms
2025-11-24 21:26:30.196 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - application/json 150
2025-11-24 21:26:30.219 +02:00 [INF] Request started
2025-11-24 21:26:30.221 +02:00 [INF] === Incoming Request ===
2025-11-24 21:26:30.222 +02:00 [INF] Path: /api/PaymentApplication/purchase-invoices/%7Be2b2b134-64f7-4af9-b25b-18f0afae3203%7D/pay
2025-11-24 21:26:30.224 +02:00 [INF] Method: POST
2025-11-24 21:26:30.225 +02:00 [INF] === Headers ===
2025-11-24 21:26:30.226 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:26:30.227 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:26:30.230 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:26:30.232 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:26:30.234 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:26:30.236 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:26:30.237 +02:00 [INF] Content-Length: ["150"]
2025-11-24 21:26:30.240 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:26:30.241 +02:00 [INF] Postman-Token: ["67522f8a-b607-4f6a-aa35-823f1918760e"]
2025-11-24 21:26:30.245 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:26:30.246 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:26:30.251 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:26:30.253 +02:00 [INF] Route matched with {action = "PayInvoice", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PayInvoice(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PayInvoiceDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:26:30.258 +02:00 [INF] PayInvoice endpoint called for invoice "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-24 21:26:30.261 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Object, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:26:30.263 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP) in 5.9293ms
2025-11-24 21:26:30.265 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:26:30.267 +02:00 [INF] Request completed successfully with status code 400
2025-11-24 21:26:30.269 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - 400 null application/json; charset=utf-8 73.47ms
2025-11-24 21:36:14.620 +02:00 [INF] Starting web host...
2025-11-24 21:36:16.370 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:36:16.412 +02:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 21:36:16.481 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:36:16.487 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 21:36:16.500 +02:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 21:36:16.554 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 21:36:16.570 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:36:16.575 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 21:36:16.581 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 21:36:16.594 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 21:36:16.599 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 21:36:16.784 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 21:36:16.792 +02:00 [INF] Master database initialized successfully
2025-11-24 21:36:19.069 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 21:36:19.176 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 21:36:19.179 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 21:36:19.272 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 21:36:19.275 +02:00 [INF] Hosting environment: Development
2025-11-24 21:36:19.276 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 21:36:19.426 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 21:36:19.577 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 152.2578ms
2025-11-24 21:36:19.714 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 21:36:19.714 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 21:36:19.721 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.6865ms
2025-11-24 21:36:19.743 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.9327ms
2025-11-24 21:36:19.786 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 21:36:20.092 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 306.3304ms
2025-11-24 21:36:29.348 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - application/json 150
2025-11-24 21:36:29.371 +02:00 [INF] Request started
2025-11-24 21:36:29.375 +02:00 [INF] === Incoming Request ===
2025-11-24 21:36:29.377 +02:00 [INF] Path: /api/PaymentApplication/purchase-invoices/%7Be2b2b134-64f7-4af9-b25b-18f0afae3203%7D/pay
2025-11-24 21:36:29.378 +02:00 [INF] Method: POST
2025-11-24 21:36:29.379 +02:00 [INF] === Headers ===
2025-11-24 21:36:29.382 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:36:29.386 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:36:29.387 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:36:29.389 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:36:29.390 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:36:29.392 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:36:29.393 +02:00 [INF] Content-Length: ["150"]
2025-11-24 21:36:29.395 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:36:29.397 +02:00 [INF] Postman-Token: ["b2ea5af5-bc03-47c5-ab4b-1e48648e6315"]
2025-11-24 21:36:29.402 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:36:29.405 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:36:29.406 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:36:29.428 +02:00 [INF] Route matched with {action = "PayInvoice", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PayInvoice(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PayInvoiceDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:36:29.435 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:36:29.499 +02:00 [INF] PayInvoice endpoint called for invoice "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-24 21:36:29.620 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Object, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:36:29.643 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP) in 209.2085ms
2025-11-24 21:36:29.645 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:36:29.647 +02:00 [INF] Request completed successfully with status code 400
2025-11-24 21:36:29.651 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - 400 null application/json; charset=utf-8 303.3355ms
2025-11-24 21:36:40.439 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - application/json 206
2025-11-24 21:36:40.459 +02:00 [INF] Request started
2025-11-24 21:36:40.461 +02:00 [INF] === Incoming Request ===
2025-11-24 21:36:40.464 +02:00 [INF] Path: /api/PaymentApplication/purchase-invoices/%7Be2b2b134-64f7-4af9-b25b-18f0afae3203%7D/pay
2025-11-24 21:36:40.465 +02:00 [INF] Method: POST
2025-11-24 21:36:40.466 +02:00 [INF] === Headers ===
2025-11-24 21:36:40.468 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:36:40.470 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:36:40.472 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:36:40.473 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:36:40.475 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:36:40.476 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:36:40.478 +02:00 [INF] Content-Length: ["206"]
2025-11-24 21:36:40.480 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:36:40.482 +02:00 [INF] Postman-Token: ["11d54937-6651-4884-95de-0e5bdc0ba83a"]
2025-11-24 21:36:40.487 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:36:40.488 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:36:40.489 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:36:40.491 +02:00 [INF] Route matched with {action = "PayInvoice", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PayInvoice(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PayInvoiceDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:36:40.496 +02:00 [INF] PayInvoice endpoint called for invoice "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-24 21:36:40.499 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Object, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-24 21:36:40.501 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP) in 8.1529ms
2025-11-24 21:36:40.503 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:36:40.505 +02:00 [INF] Request completed successfully with status code 400
2025-11-24 21:36:40.506 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - 400 null application/json; charset=utf-8 67.2482ms
2025-11-24 21:36:48.565 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - application/json 203
2025-11-24 21:36:48.571 +02:00 [INF] Request started
2025-11-24 21:36:48.572 +02:00 [INF] === Incoming Request ===
2025-11-24 21:36:48.572 +02:00 [INF] Path: /api/PaymentApplication/purchase-invoices/%7Be2b2b134-64f7-4af9-b25b-18f0afae3203%7D/pay
2025-11-24 21:36:48.573 +02:00 [INF] Method: POST
2025-11-24 21:36:48.574 +02:00 [INF] === Headers ===
2025-11-24 21:36:48.575 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:36:48.577 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:36:48.579 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:36:48.580 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:36:48.582 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:36:48.584 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:36:48.585 +02:00 [INF] Content-Length: ["203"]
2025-11-24 21:36:48.586 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:36:48.588 +02:00 [INF] Postman-Token: ["c43bb59f-5563-4e4e-8689-7b8346a017c9"]
2025-11-24 21:36:48.590 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:36:48.590 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:36:48.591 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:36:48.593 +02:00 [INF] Route matched with {action = "PayInvoice", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PayInvoice(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PayInvoiceDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:36:48.596 +02:00 [INF] PayInvoice endpoint called for invoice "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-24 21:36:48.657 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 21:36:49.369 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:36:49.383 +02:00 [INF] Processing payment for invoice "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-24 21:36:49.658 +02:00 [INF] Payment PAY-00008 created for invoice INV-202511-0003, Amount: 100
2025-11-24 21:36:49.663 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:36:49.676 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP) in 1080.7589ms
2025-11-24 21:36:49.679 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.PayInvoice (ModularERP)'
2025-11-24 21:36:49.681 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:36:49.685 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/purchase-invoices/{e2b2b134-64f7-4af9-b25b-18f0afae3203}/pay - 200 null application/json; charset=utf-8 1120.2887ms
2025-11-24 21:39:25.045 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - application/json 394
2025-11-24 21:39:25.049 +02:00 [INF] Request started
2025-11-24 21:39:25.050 +02:00 [INF] === Incoming Request ===
2025-11-24 21:39:25.051 +02:00 [INF] Path: /api/PaymentApplication/suppliers/%7Bb4c57f6f-47c9-43d1-8021-0ff57a3b4e79%7D/pay
2025-11-24 21:39:25.052 +02:00 [INF] Method: POST
2025-11-24 21:39:25.053 +02:00 [INF] === Headers ===
2025-11-24 21:39:25.054 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:39:25.055 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:39:25.057 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:39:25.059 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:39:25.064 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:39:25.066 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:39:25.069 +02:00 [INF] Content-Length: ["394"]
2025-11-24 21:39:25.070 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:39:25.072 +02:00 [INF] Postman-Token: ["0882b9a5-3e06-4af8-992a-2dc09fa78ca6"]
2025-11-24 21:39:25.073 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:39:25.075 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:39:25.077 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:39:25.082 +02:00 [INF] Route matched with {action = "QuickPaySupplier", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] QuickPaySupplier(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.QuickPaySupplierDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:39:25.090 +02:00 [INF] QuickPaySupplier endpoint called for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:39:25.121 +02:00 [INF] Processing quick payment for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:39:25.148 +02:00 [INF] Quick payment PAY-00009 created for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79", Amount: 50
2025-11-24 21:39:25.153 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:39:25.155 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP) in 70.4279ms
2025-11-24 21:39:25.158 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:39:25.160 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:39:25.162 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - 200 null application/json; charset=utf-8 116.3695ms
2025-11-24 21:43:07.747 +02:00 [INF] Starting web host...
2025-11-24 21:43:09.373 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:43:09.414 +02:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 21:43:09.489 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:43:09.495 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 21:43:09.508 +02:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 21:43:09.564 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 21:43:09.580 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:43:09.585 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 21:43:09.591 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 21:43:09.602 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 21:43:09.607 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 21:43:09.785 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 21:43:09.794 +02:00 [INF] Master database initialized successfully
2025-11-24 21:43:12.095 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 21:43:12.236 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 21:43:12.238 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 21:43:12.339 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 21:43:12.341 +02:00 [INF] Hosting environment: Development
2025-11-24 21:43:12.342 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 21:43:12.641 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 21:43:12.781 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 141.3033ms
2025-11-24 21:43:12.921 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 21:43:12.921 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 21:43:12.930 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.106ms
2025-11-24 21:43:12.945 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 23.8994ms
2025-11-24 21:43:12.979 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 21:43:13.264 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 284.3794ms
2025-11-24 21:43:14.578 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - application/json 394
2025-11-24 21:43:14.603 +02:00 [INF] Request started
2025-11-24 21:43:14.606 +02:00 [INF] === Incoming Request ===
2025-11-24 21:43:14.608 +02:00 [INF] Path: /api/PaymentApplication/suppliers/%7Bb4c57f6f-47c9-43d1-8021-0ff57a3b4e79%7D/pay
2025-11-24 21:43:14.609 +02:00 [INF] Method: POST
2025-11-24 21:43:14.610 +02:00 [INF] === Headers ===
2025-11-24 21:43:14.612 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:43:14.619 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:43:14.622 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:43:14.625 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:43:14.627 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:43:14.629 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:43:14.631 +02:00 [INF] Content-Length: ["394"]
2025-11-24 21:43:14.635 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:43:14.637 +02:00 [INF] Postman-Token: ["8f7b9ff4-69fc-49a0-a35d-40f990bdd6ce"]
2025-11-24 21:43:14.642 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:43:14.645 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:43:14.646 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:43:14.670 +02:00 [INF] Route matched with {action = "QuickPaySupplier", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] QuickPaySupplier(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.QuickPaySupplierDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:43:14.676 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:43:14.759 +02:00 [INF] QuickPaySupplier endpoint called for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:43:14.872 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 21:43:15.790 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:43:15.806 +02:00 [INF] Processing quick payment for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:43:16.071 +02:00 [INF] Quick payment PAY-00010 created for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79", Amount: 50
2025-11-24 21:43:16.082 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:43:16.106 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP) in 1428.4226ms
2025-11-24 21:43:16.110 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:43:16.112 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:43:16.120 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - 200 null application/json; charset=utf-8 1542.7986ms
2025-11-24 21:43:23.332 +02:00 [INF] Starting web host...
2025-11-24 21:43:24.884 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:43:24.930 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 21:43:25.015 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:43:25.023 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 21:43:25.029 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 21:43:25.095 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 21:43:25.115 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:43:25.120 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 21:43:25.127 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 21:43:25.139 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 21:43:25.144 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 21:43:25.309 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 21:43:25.317 +02:00 [INF] Master database initialized successfully
2025-11-24 21:43:27.223 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 21:43:27.334 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 21:43:27.337 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 21:43:27.425 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 21:43:27.427 +02:00 [INF] Hosting environment: Development
2025-11-24 21:43:27.428 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 21:43:27.882 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 21:43:28.005 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 124.0139ms
2025-11-24 21:43:28.009 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 21:43:28.009 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 21:43:28.018 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.6183ms
2025-11-24 21:43:28.039 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 29.699ms
2025-11-24 21:43:28.082 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 21:43:28.361 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 279.1808ms
2025-11-24 21:43:36.106 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - application/json 394
2025-11-24 21:43:36.130 +02:00 [INF] Request started
2025-11-24 21:43:36.133 +02:00 [INF] === Incoming Request ===
2025-11-24 21:43:36.135 +02:00 [INF] Path: /api/PaymentApplication/suppliers/%7Bb4c57f6f-47c9-43d1-8021-0ff57a3b4e79%7D/pay
2025-11-24 21:43:36.136 +02:00 [INF] Method: POST
2025-11-24 21:43:36.137 +02:00 [INF] === Headers ===
2025-11-24 21:43:36.141 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:43:36.145 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:43:36.146 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:43:36.148 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:43:36.150 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:43:36.151 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:43:36.153 +02:00 [INF] Content-Length: ["394"]
2025-11-24 21:43:36.154 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:43:36.156 +02:00 [INF] Postman-Token: ["62ba6219-2c26-4003-930b-a7f5c4ac98ef"]
2025-11-24 21:43:36.161 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:43:36.162 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:43:36.164 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:43:36.180 +02:00 [INF] Route matched with {action = "QuickPaySupplier", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] QuickPaySupplier(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.QuickPaySupplierDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:43:36.185 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:43:36.216 +02:00 [INF] QuickPaySupplier endpoint called for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:43:36.333 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 21:43:37.054 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:43:37.085 +02:00 [INF] Processing quick payment for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:43:37.366 +02:00 [INF] Quick payment PAY-00011 created for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79", Amount: 50
2025-11-24 21:43:37.377 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:43:37.396 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP) in 1210.4687ms
2025-11-24 21:43:37.398 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:43:37.401 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:43:37.406 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - 200 null application/json; charset=utf-8 1300.0782ms
2025-11-24 21:44:06.871 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - application/json 394
2025-11-24 21:44:06.890 +02:00 [INF] Request started
2025-11-24 21:44:06.892 +02:00 [INF] === Incoming Request ===
2025-11-24 21:44:06.893 +02:00 [INF] Path: /api/PaymentApplication/suppliers/%7Bb4c57f6f-47c9-43d1-8021-0ff57a3b4e79%7D/pay
2025-11-24 21:44:06.894 +02:00 [INF] Method: POST
2025-11-24 21:44:06.895 +02:00 [INF] === Headers ===
2025-11-24 21:44:06.896 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:44:06.898 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:44:06.900 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:44:06.901 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:44:06.903 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:44:06.904 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:44:06.906 +02:00 [INF] Content-Length: ["394"]
2025-11-24 21:44:06.907 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:44:06.908 +02:00 [INF] Postman-Token: ["8cf880b1-629b-4a36-a944-bd4e55a367f8"]
2025-11-24 21:44:06.912 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:44:06.912 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:44:06.914 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:44:06.917 +02:00 [INF] Route matched with {action = "QuickPaySupplier", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] QuickPaySupplier(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.QuickPaySupplierDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:44:06.921 +02:00 [INF] QuickPaySupplier endpoint called for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:44:06.926 +02:00 [INF] Processing quick payment for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:44:06.972 +02:00 [INF] Quick payment PAY-00012 created for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79", Amount: 50
2025-11-24 21:44:06.975 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:44:06.977 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP) in 56.757ms
2025-11-24 21:44:06.979 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:44:06.981 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:44:06.983 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - 200 null application/json; charset=utf-8 112.817ms
2025-11-24 21:44:25.935 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/apply - application/json 242
2025-11-24 21:44:25.939 +02:00 [INF] Request started
2025-11-24 21:44:25.941 +02:00 [INF] === Incoming Request ===
2025-11-24 21:44:25.942 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B6bb6259b-ed0b-4f46-e63c-08de2b8cb56c%7D/apply
2025-11-24 21:44:25.943 +02:00 [INF] Method: POST
2025-11-24 21:44:25.944 +02:00 [INF] === Headers ===
2025-11-24 21:44:25.945 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:44:25.946 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:44:25.947 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:44:25.949 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:44:25.951 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:44:25.952 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:44:25.953 +02:00 [INF] Content-Length: ["242"]
2025-11-24 21:44:25.955 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:44:25.956 +02:00 [INF] Postman-Token: ["1dc3ad02-02a0-4ae6-bd96-5d042634d345"]
2025-11-24 21:44:25.958 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:44:25.959 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:44:25.960 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:44:25.965 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:44:25.972 +02:00 [INF] ApplyPayment endpoint called for payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:44:25.988 +02:00 [INF] Applying payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c" to invoices
2025-11-24 21:44:26.100 +02:00 [INF] Created allocation for payment PAY-00007 to invoice INV-202511-0002, Amount: 144
2025-11-24 21:44:26.112 +02:00 [INF] Successfully applied payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:44:26.231 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:44:26.235 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 266.8109ms
2025-11-24 21:44:26.237 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:44:26.239 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:44:26.241 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/apply - 200 null application/json; charset=utf-8 306.1987ms
2025-11-24 21:44:28.061 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/apply - application/json 242
2025-11-24 21:44:28.066 +02:00 [INF] Request started
2025-11-24 21:44:28.066 +02:00 [INF] === Incoming Request ===
2025-11-24 21:44:28.067 +02:00 [INF] Path: /api/PaymentApplication/supplier-payments/%7B6bb6259b-ed0b-4f46-e63c-08de2b8cb56c%7D/apply
2025-11-24 21:44:28.068 +02:00 [INF] Method: POST
2025-11-24 21:44:28.069 +02:00 [INF] === Headers ===
2025-11-24 21:44:28.070 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:44:28.071 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:44:28.073 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:44:28.075 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:44:28.076 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:44:28.078 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:44:28.080 +02:00 [INF] Content-Length: ["242"]
2025-11-24 21:44:28.081 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:44:28.083 +02:00 [INF] Postman-Token: ["d32dc5c1-4b83-4254-8c69-633e530b5a24"]
2025-11-24 21:44:28.084 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:44:28.085 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:44:28.086 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:44:28.087 +02:00 [INF] Route matched with {action = "ApplyPayment", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApplyPayment(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.ApplyPaymentDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:44:28.090 +02:00 [INF] ApplyPayment endpoint called for payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c"
2025-11-24 21:44:28.093 +02:00 [INF] Applying payment "6bb6259b-ed0b-4f46-e63c-08de2b8cb56c" to invoices
2025-11-24 21:44:28.125 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP) in 35.7951ms
2025-11-24 21:44:28.128 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment (ModularERP)'
2025-11-24 21:44:28.130 +02:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'Purchases.PaymentAllocations' with unique index 'IX_PaymentAllocations_Payment_Invoice'. The duplicate key value is (6bb6259b-ed0b-4f46-e63c-08de2b8cb56c, af1aab03-bfc2-4e9d-b992-0105a7527a37).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4bf72b77-16dd-42ab-9cfb-7875c818dc28
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2599
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_PaymentApplication.ApplyPaymentHandler.Handle(ApplyPaymentCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_PaymentApplication\ApplyPaymentHandler.cs:line 107
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.ApplyPayment(Guid id, ApplyPaymentDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Controllers\PaymentApplicationController.cs:line 57
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-24 21:44:28.221 +02:00 [INF] Error response sent with status code 500
2025-11-24 21:44:28.223 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/supplier-payments/{6bb6259b-ed0b-4f46-e63c-08de2b8cb56c}/apply - 500 null application/json; charset=utf-8 161.8877ms
2025-11-24 21:44:35.294 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - application/json 394
2025-11-24 21:44:35.367 +02:00 [INF] Request started
2025-11-24 21:44:35.368 +02:00 [INF] === Incoming Request ===
2025-11-24 21:44:35.369 +02:00 [INF] Path: /api/PaymentApplication/suppliers/%7Bb4c57f6f-47c9-43d1-8021-0ff57a3b4e79%7D/pay
2025-11-24 21:44:35.370 +02:00 [INF] Method: POST
2025-11-24 21:44:35.371 +02:00 [INF] === Headers ===
2025-11-24 21:44:35.373 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:44:35.376 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:44:35.378 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:44:35.380 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:44:35.381 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:44:35.383 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:44:35.388 +02:00 [INF] Content-Length: ["394"]
2025-11-24 21:44:35.390 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:44:35.391 +02:00 [INF] Postman-Token: ["c3cb91fe-e584-4bfa-84e3-8c0e19ebd4c8"]
2025-11-24 21:44:35.393 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:44:35.394 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:44:35.395 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:44:35.399 +02:00 [INF] Route matched with {action = "QuickPaySupplier", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] QuickPaySupplier(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.QuickPaySupplierDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:44:35.403 +02:00 [INF] QuickPaySupplier endpoint called for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:44:35.411 +02:00 [INF] Processing quick payment for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:44:35.429 +02:00 [INF] Quick payment PAY-00013 created for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79", Amount: 50
2025-11-24 21:44:35.431 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:44:35.432 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP) in 30.1546ms
2025-11-24 21:44:35.434 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:44:35.435 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:44:35.436 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - 200 null application/json; charset=utf-8 141.9072ms
2025-11-24 21:46:08.079 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - application/json 401
2025-11-24 21:46:08.083 +02:00 [INF] Request started
2025-11-24 21:46:08.084 +02:00 [INF] === Incoming Request ===
2025-11-24 21:46:08.085 +02:00 [INF] Path: /api/PaymentApplication/suppliers/%7Bb4c57f6f-47c9-43d1-8021-0ff57a3b4e79%7D/pay
2025-11-24 21:46:08.086 +02:00 [INF] Method: POST
2025-11-24 21:46:08.087 +02:00 [INF] === Headers ===
2025-11-24 21:46:08.088 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:46:08.089 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:46:08.093 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:46:08.094 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:46:08.096 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:46:08.097 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:46:08.099 +02:00 [INF] Content-Length: ["401"]
2025-11-24 21:46:08.101 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:46:08.102 +02:00 [INF] Postman-Token: ["075a6d51-9506-4cf8-bab5-2a6beafe1cde"]
2025-11-24 21:46:08.104 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:46:08.105 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:46:08.106 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:46:08.108 +02:00 [INF] Route matched with {action = "QuickPaySupplier", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] QuickPaySupplier(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.QuickPaySupplierDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:46:08.111 +02:00 [INF] QuickPaySupplier endpoint called for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:46:08.113 +02:00 [INF] Processing quick payment for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:46:08.144 +02:00 [ERR] Unexpected error processing quick payment
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PaymentAllocations_SupplierPayments_PaymentId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.SupplierPayments", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4bf72b77-16dd-42ab-9cfb-7875c818dc28
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2599
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_PaymentApplication.QuickPaySupplierHandler.Handle(QuickPaySupplierCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_PaymentApplication\QuickPaySupplierHandler.cs:line 106
2025-11-24 21:46:08.165 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:46:08.167 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP) in 56.5194ms
2025-11-24 21:46:08.168 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:46:08.169 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:46:08.171 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - 200 null application/json; charset=utf-8 91.3549ms
2025-11-24 21:46:35.142 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - application/json 401
2025-11-24 21:46:35.150 +02:00 [INF] Request started
2025-11-24 21:46:35.151 +02:00 [INF] === Incoming Request ===
2025-11-24 21:46:35.152 +02:00 [INF] Path: /api/PaymentApplication/suppliers/%7Bb4c57f6f-47c9-43d1-8021-0ff57a3b4e79%7D/pay
2025-11-24 21:46:35.154 +02:00 [INF] Method: POST
2025-11-24 21:46:35.157 +02:00 [INF] === Headers ===
2025-11-24 21:46:35.158 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:46:35.160 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:46:35.162 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:46:35.163 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:46:35.167 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:46:35.169 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:46:35.171 +02:00 [INF] Content-Length: ["401"]
2025-11-24 21:46:35.172 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:46:35.174 +02:00 [INF] Postman-Token: ["58f68094-6660-4be5-8200-723913882fb0"]
2025-11-24 21:46:35.178 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:46:35.179 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:46:35.180 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:46:35.183 +02:00 [INF] Route matched with {action = "QuickPaySupplier", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] QuickPaySupplier(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.QuickPaySupplierDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:46:35.189 +02:00 [INF] QuickPaySupplier endpoint called for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:46:35.191 +02:00 [INF] Processing quick payment for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:46:35.196 +02:00 [ERR] Unexpected error processing quick payment
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PaymentAllocations_SupplierPayments_PaymentId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.SupplierPayments", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4bf72b77-16dd-42ab-9cfb-7875c818dc28
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2599
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Invoicing.Handlers.Handlers_PaymentApplication.QuickPaySupplierHandler.Handle(QuickPaySupplierCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Invoicing\Handlers\Handlers_PaymentApplication\QuickPaySupplierHandler.cs:line 106
2025-11-24 21:46:35.233 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:46:35.235 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP) in 46.6669ms
2025-11-24 21:46:35.238 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:46:35.241 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:46:35.242 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - 200 null application/json; charset=utf-8 99.8897ms
2025-11-24 21:49:10.306 +02:00 [INF] Starting web host...
2025-11-24 21:49:11.852 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:49:11.905 +02:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 21:49:11.988 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:49:11.994 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 21:49:12.003 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 21:49:12.068 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 21:49:12.085 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:49:12.089 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 21:49:12.096 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 21:49:12.108 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 21:49:12.112 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 21:49:12.281 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 21:49:12.289 +02:00 [INF] Master database initialized successfully
2025-11-24 21:49:14.467 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 21:49:14.589 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 21:49:14.591 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 21:49:14.690 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 21:49:14.693 +02:00 [INF] Hosting environment: Development
2025-11-24 21:49:14.695 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 21:49:14.755 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 21:49:14.937 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 183.1334ms
2025-11-24 21:49:15.094 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 21:49:15.094 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 21:49:15.102 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.3151ms
2025-11-24 21:49:15.126 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 32.0634ms
2025-11-24 21:49:15.187 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 21:49:15.525 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 337.5888ms
2025-11-24 21:49:18.393 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - application/json 401
2025-11-24 21:49:18.414 +02:00 [INF] Request started
2025-11-24 21:49:18.417 +02:00 [INF] === Incoming Request ===
2025-11-24 21:49:18.419 +02:00 [INF] Path: /api/PaymentApplication/suppliers/%7Bb4c57f6f-47c9-43d1-8021-0ff57a3b4e79%7D/pay
2025-11-24 21:49:18.421 +02:00 [INF] Method: POST
2025-11-24 21:49:18.422 +02:00 [INF] === Headers ===
2025-11-24 21:49:18.426 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:49:18.431 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:49:18.434 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:49:18.435 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:49:18.437 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:49:18.439 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:49:18.441 +02:00 [INF] Content-Length: ["401"]
2025-11-24 21:49:18.444 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:49:18.449 +02:00 [INF] Postman-Token: ["3f5873e8-948d-491f-aa20-a850ba5f7ac3"]
2025-11-24 21:49:18.458 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:49:18.460 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:49:18.462 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:49:18.482 +02:00 [INF] Route matched with {action = "QuickPaySupplier", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] QuickPaySupplier(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.QuickPaySupplierDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:49:18.490 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:49:18.607 +02:00 [INF] QuickPaySupplier endpoint called for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:49:18.761 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 21:49:19.469 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:49:19.476 +02:00 [INF] Processing quick payment for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:49:19.880 +02:00 [INF] Quick payment PAY-00014 created for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79", Amount: 50
2025-11-24 21:49:19.891 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:49:19.922 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP) in 1432.0941ms
2025-11-24 21:49:19.925 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:49:19.928 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:49:19.935 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - 200 null application/json; charset=utf-8 1541.9341ms
2025-11-24 21:50:47.244 +02:00 [INF] Starting web host...
2025-11-24 21:50:48.691 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:50:48.732 +02:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-24 21:50:48.802 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:50:48.808 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-24 21:50:48.812 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-24 21:50:48.867 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-24 21:50:48.883 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-24 21:50:48.886 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-24 21:50:48.892 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-24 21:50:48.903 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-24 21:50:48.908 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-24 21:50:49.064 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-24 21:50:49.071 +02:00 [INF] Master database initialized successfully
2025-11-24 21:50:51.198 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-24 21:50:51.305 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-24 21:50:51.307 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-24 21:50:51.399 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-24 21:50:51.401 +02:00 [INF] Hosting environment: Development
2025-11-24 21:50:51.403 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-24 21:50:51.721 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-24 21:50:51.859 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 139.0384ms
2025-11-24 21:50:51.869 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-24 21:50:51.869 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-24 21:50:51.878 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.0446ms
2025-11-24 21:50:51.905 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 35.5929ms
2025-11-24 21:50:52.050 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-24 21:50:52.326 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 275.1013ms
2025-11-24 21:51:04.016 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - application/json 401
2025-11-24 21:51:04.040 +02:00 [INF] Request started
2025-11-24 21:51:04.043 +02:00 [INF] === Incoming Request ===
2025-11-24 21:51:04.046 +02:00 [INF] Path: /api/PaymentApplication/suppliers/%7Bb4c57f6f-47c9-43d1-8021-0ff57a3b4e79%7D/pay
2025-11-24 21:51:04.047 +02:00 [INF] Method: POST
2025-11-24 21:51:04.050 +02:00 [INF] === Headers ===
2025-11-24 21:51:04.054 +02:00 [INF] Accept: ["*/*"]
2025-11-24 21:51:04.057 +02:00 [INF] Connection: ["keep-alive"]
2025-11-24 21:51:04.058 +02:00 [INF] Host: ["localhost:7168"]
2025-11-24 21:51:04.064 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-24 21:51:04.066 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-24 21:51:04.069 +02:00 [INF] Content-Type: ["application/json"]
2025-11-24 21:51:04.072 +02:00 [INF] Content-Length: ["401"]
2025-11-24 21:51:04.074 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-24 21:51:04.077 +02:00 [INF] Postman-Token: ["4f1e3ce4-e77c-4f15-9ccf-f3682b356ae2"]
2025-11-24 21:51:04.084 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-24 21:51:04.085 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-24 21:51:04.088 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:51:04.112 +02:00 [INF] Route matched with {action = "QuickPaySupplier", controller = "PaymentApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] QuickPaySupplier(System.Guid, ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.QuickPaySupplierDto) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController (ModularERP).
2025-11-24 21:51:04.119 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:51:04.164 +02:00 [INF] QuickPaySupplier endpoint called for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:51:04.305 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-24 21:51:05.131 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-24 21:51:05.141 +02:00 [INF] Processing quick payment for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-24 21:51:05.679 +02:00 [INF] Quick payment PAY-00015 created for supplier "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79", Amount: 50
2025-11-24 21:51:05.690 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_PaymentApplication.PaymentApplicationSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-24 21:51:05.714 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP) in 1594.7053ms
2025-11-24 21:51:05.716 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PaymentApplicationController.QuickPaySupplier (ModularERP)'
2025-11-24 21:51:05.719 +02:00 [INF] Request completed successfully with status code 200
2025-11-24 21:51:05.724 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentApplication/suppliers/{b4c57f6f-47c9-43d1-8021-0ff57a3b4e79}/pay - 200 null application/json; charset=utf-8 1708.5792ms
