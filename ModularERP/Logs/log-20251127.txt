2025-11-27 00:00:03.748 +02:00 [INF] Starting web host...
2025-11-27 00:00:05.755 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 260
2025-11-27 00:11:02.685 +02:00 [INF] Starting web host...
2025-11-27 00:11:03.860 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 260
2025-11-27 00:14:39.090 +02:00 [INF] Starting web host...
2025-11-27 00:14:40.062 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 260
2025-11-27 00:15:52.856 +02:00 [INF] Starting web host...
2025-11-27 00:15:53.827 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 260
2025-11-27 00:16:56.922 +02:00 [INF] Starting web host...
2025-11-27 00:16:57.816 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 260
2025-11-27 00:18:55.042 +02:00 [INF] Starting web host...
2025-11-27 00:18:55.921 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 260
2025-11-27 00:20:25.532 +02:00 [INF] Starting web host...
2025-11-27 00:20:26.391 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 260
2025-11-27 00:35:28.271 +02:00 [INF] Starting web host...
2025-11-27 00:35:29.877 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 260
2025-11-27 00:36:06.740 +02:00 [INF] Starting web host...
2025-11-27 00:36:08.436 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 00:36:08.509 +02:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 00:36:08.583 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 00:36:08.590 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 00:36:08.603 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 00:36:08.659 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 00:36:08.674 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 00:36:08.678 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 00:36:08.687 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 00:36:08.698 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 00:36:08.703 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 00:36:08.875 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 00:36:08.882 +02:00 [INF] Master database initialized successfully
2025-11-27 00:36:11.242 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 00:36:11.654 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 00:36:11.655 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 00:36:11.816 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 00:36:11.817 +02:00 [INF] Hosting environment: Development
2025-11-27 00:36:11.818 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 00:36:12.203 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 00:36:12.519 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 319.1845ms
2025-11-27 00:36:12.536 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 00:36:12.536 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 00:36:12.550 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.9222ms
2025-11-27 00:36:12.608 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 72.6353ms
2025-11-27 00:36:12.659 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 00:36:13.131 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 472.0937ms
2025-11-27 00:56:17.360 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentTerms - application/json 124
2025-11-27 00:56:17.390 +02:00 [INF] Request started
2025-11-27 00:56:17.393 +02:00 [INF] === Incoming Request ===
2025-11-27 00:56:17.396 +02:00 [INF] Path: /api/PaymentTerms
2025-11-27 00:56:17.397 +02:00 [INF] Method: POST
2025-11-27 00:56:17.398 +02:00 [INF] === Headers ===
2025-11-27 00:56:17.402 +02:00 [INF] Accept: ["*/*"]
2025-11-27 00:56:17.405 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 00:56:17.406 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 00:56:17.408 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 00:56:17.409 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 00:56:17.411 +02:00 [INF] Content-Type: ["application/json"]
2025-11-27 00:56:17.412 +02:00 [INF] Content-Length: ["124"]
2025-11-27 00:56:17.414 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 00:56:17.416 +02:00 [INF] Postman-Token: ["b33d48bd-170d-4837-9f16-66d460d9e95b"]
2025-11-27 00:56:17.421 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 00:56:17.422 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 00:56:17.425 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentTermsController.Create (ModularERP)'
2025-11-27 00:56:17.451 +02:00 [INF] Route matched with {action = "Create", controller = "PaymentTerms"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ModularERP.Modules.Purchases.Payment.DTO.DTO_PaymentTerm.CreatePaymentTermDto) on controller ModularERP.Modules.Purchases.Payment.Controllers.PaymentTermsController (ModularERP).
2025-11-27 00:56:17.457 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 00:56:17.574 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 00:56:18.368 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 00:56:18.371 +02:00 [INF] Creating Payment Term: Net 30
2025-11-27 00:56:18.541 +02:00 [INF] Payment Term created successfully with ID: "da401a16-b5d6-4179-bc3f-7951e8fd1821"
2025-11-27 00:56:18.551 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Payment.DTO.DTO_PaymentTerm.PaymentTermResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-27 00:56:18.575 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Payment.Controllers.PaymentTermsController.Create (ModularERP) in 1118.9566ms
2025-11-27 00:56:18.578 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentTermsController.Create (ModularERP)'
2025-11-27 00:56:18.581 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 00:56:18.586 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentTerms - 200 null application/json; charset=utf-8 1226.4574ms
2025-11-27 00:58:27.624 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------440158971783849349750327 4106
2025-11-27 00:58:27.645 +02:00 [INF] Request started
2025-11-27 00:58:27.647 +02:00 [INF] === Incoming Request ===
2025-11-27 00:58:27.650 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 00:58:27.651 +02:00 [INF] Method: POST
2025-11-27 00:58:27.652 +02:00 [INF] === Headers ===
2025-11-27 00:58:27.652 +02:00 [INF] Accept: ["*/*"]
2025-11-27 00:58:27.654 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 00:58:27.656 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 00:58:27.658 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 00:58:27.659 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 00:58:27.661 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------440158971783849349750327"]
2025-11-27 00:58:27.662 +02:00 [INF] Content-Length: ["4106"]
2025-11-27 00:58:27.665 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 00:58:27.666 +02:00 [INF] Postman-Token: ["06774665-c3c8-43c9-98d1-960c99b26624"]
2025-11-27 00:58:27.669 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 00:58:27.670 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 00:58:27.673 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 00:58:27.690 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 00:58:27.869 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 00:58:28.023 +02:00 [INF] Starting PO amount calculations
2025-11-27 00:58:28.024 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 00:58:28.027 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 00:58:28.028 +02:00 [INF] Adjustments Total: 10
2025-11-27 00:58:28.029 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 00:58:28.030 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 00:58:28.032 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 00:58:28.033 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 00:58:28.034 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 00:58:28.036 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 00:58:28.183 +02:00 [INF] Purchase Order created with ID: "3e147827-ae34-48cd-8157-02a907b1885f", Number: PO-202511-0002
2025-11-27 00:58:28.299 +02:00 [ERR] Error creating purchase order
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PODeposits_PaymentMethods_PaymentMethodId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.PaymentMethods", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:f5a93527-0129-4297-9ac4-0d47775dd3c4
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2656
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 156
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.AddDeposits(Guid purchaseOrderId, List`1 deposits, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 629
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 136
2025-11-27 00:58:28.358 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 664.8141ms
2025-11-27 00:58:28.361 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 00:58:28.363 +02:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PODeposits_PaymentMethods_PaymentMethodId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.PaymentMethods", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:f5a93527-0129-4297-9ac4-0d47775dd3c4
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2656
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 156
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.AddDeposits(Guid purchaseOrderId, List`1 deposits, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 629
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 136
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 00:58:28.404 +02:00 [INF] Error response sent with status code 500
2025-11-27 00:58:28.407 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 782.8528ms
2025-11-27 01:16:05.316 +02:00 [INF] Starting web host...
2025-11-27 01:16:09.712 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:16:09.796 +02:00 [INF] Executed DbCommand (68ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:16:09.898 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:16:09.905 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:16:09.920 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:16:10.004 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:16:10.025 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:16:10.030 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:16:10.038 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:16:10.051 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:16:10.059 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:16:10.299 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:16:10.307 +02:00 [INF] Master database initialized successfully
2025-11-27 01:16:12.968 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:16:13.100 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:16:13.102 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:16:13.201 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:16:13.203 +02:00 [INF] Hosting environment: Development
2025-11-27 01:16:13.204 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:16:14.419 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:16:14.602 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 183.3395ms
2025-11-27 01:16:14.621 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:16:14.625 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:16:14.634 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 12.9263ms
2025-11-27 01:16:14.697 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 72.5326ms
2025-11-27 01:16:14.767 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:16:15.159 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 391.9591ms
2025-11-27 01:16:33.048 +02:00 [INF] Starting web host...
2025-11-27 01:16:34.708 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:16:34.800 +02:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:16:34.873 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:16:34.879 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:16:34.889 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:16:34.950 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:16:34.965 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:16:34.970 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:16:34.977 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:16:34.989 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:16:34.995 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:16:35.163 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:16:35.171 +02:00 [INF] Master database initialized successfully
2025-11-27 01:16:37.643 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:16:37.754 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:16:37.756 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:16:37.854 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:16:37.856 +02:00 [INF] Hosting environment: Development
2025-11-27 01:16:37.858 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:16:38.034 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:16:38.228 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 194.7462ms
2025-11-27 01:16:38.229 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:16:38.229 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:16:38.243 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.677ms
2025-11-27 01:16:38.260 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.984ms
2025-11-27 01:16:38.283 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:16:38.640 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 356.4028ms
2025-11-27 01:17:27.683 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentMethods - application/json 174
2025-11-27 01:17:27.707 +02:00 [INF] Request started
2025-11-27 01:17:27.709 +02:00 [INF] === Incoming Request ===
2025-11-27 01:17:27.711 +02:00 [INF] Path: /api/PaymentMethods
2025-11-27 01:17:27.712 +02:00 [INF] Method: POST
2025-11-27 01:17:27.714 +02:00 [INF] === Headers ===
2025-11-27 01:17:27.716 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:17:27.720 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:17:27.722 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:17:27.723 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:17:27.724 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:17:27.726 +02:00 [INF] Content-Type: ["application/json"]
2025-11-27 01:17:27.728 +02:00 [INF] Content-Length: ["174"]
2025-11-27 01:17:27.730 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:17:27.731 +02:00 [INF] Postman-Token: ["70068bc0-6a8c-41e2-bd0c-38e254e057e5"]
2025-11-27 01:17:27.736 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:17:27.738 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:17:27.740 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP)'
2025-11-27 01:17:27.760 +02:00 [INF] Route matched with {action = "Create", controller = "PaymentMethods"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ModularERP.Modules.Purchases.Payment.Commends.Commends_PaymentMethod.CreatePaymentMethodCommand) on controller ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController (ModularERP).
2025-11-27 01:17:27.767 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:17:27.798 +02:00 [INF] POST /api/payment-methods - Name: Bank Transfer, Code: BANK_TRANSFER
2025-11-27 01:17:27.870 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:17:28.757 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:17:28.765 +02:00 [INF] Creating new payment method: Bank Transfer
2025-11-27 01:17:28.779 +02:00 [ERR] Error occurred while creating payment method: Bank Transfer
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
CreatePaymentMethodCommand -> PaymentMethod
ModularERP.Modules.Purchases.Payment.Commends.Commends_PaymentMethod.CreatePaymentMethodCommand -> ModularERP.Modules.Purchases.Payment.Models.PaymentMethod
   at lambda_method194(Closure, Object, PaymentMethod, ResolutionContext)
   at ModularERP.Modules.Purchases.Payment.Handlers.Handlers_PaymentMethod.CreatePaymentMethodCommandHandler.Handle(CreatePaymentMethodCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Handlers\Handlers_PaymentMethod\CreatePaymentMethodCommandHandler.cs:line 36
2025-11-27 01:17:28.808 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Payment.DTO.DTO_PaymentMethod.PaymentMethodDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-27 01:17:28.830 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP) in 1063.1362ms
2025-11-27 01:17:28.834 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP)'
2025-11-27 01:17:28.836 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 01:17:28.841 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentMethods - 200 null application/json; charset=utf-8 1157.9515ms
2025-11-27 01:19:37.183 +02:00 [INF] Starting web host...
2025-11-27 01:19:38.925 +02:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:19:39.018 +02:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:19:39.090 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:19:39.095 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:19:39.112 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:19:39.169 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:19:39.186 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:19:39.192 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:19:39.199 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:19:39.211 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:19:39.218 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:19:39.394 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:19:39.404 +02:00 [INF] Master database initialized successfully
2025-11-27 01:19:41.499 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:19:41.616 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:19:41.619 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:19:41.718 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:19:41.721 +02:00 [INF] Hosting environment: Development
2025-11-27 01:19:41.722 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:19:42.113 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:19:42.244 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 132.5043ms
2025-11-27 01:19:42.244 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:19:42.244 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:19:42.259 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.5225ms
2025-11-27 01:19:42.279 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 35.0269ms
2025-11-27 01:19:42.326 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:19:42.649 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 323.2162ms
2025-11-27 01:19:45.069 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentMethods - application/json 174
2025-11-27 01:19:45.088 +02:00 [INF] Request started
2025-11-27 01:19:45.091 +02:00 [INF] === Incoming Request ===
2025-11-27 01:19:45.093 +02:00 [INF] Path: /api/PaymentMethods
2025-11-27 01:19:45.094 +02:00 [INF] Method: POST
2025-11-27 01:19:45.095 +02:00 [INF] === Headers ===
2025-11-27 01:19:45.098 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:19:45.102 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:19:45.104 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:19:45.106 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:19:45.109 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:19:45.111 +02:00 [INF] Content-Type: ["application/json"]
2025-11-27 01:19:45.112 +02:00 [INF] Content-Length: ["174"]
2025-11-27 01:19:45.114 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:19:45.115 +02:00 [INF] Postman-Token: ["fc035831-f72f-4777-998e-cb0e9f43a2fa"]
2025-11-27 01:19:45.122 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:19:45.124 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:19:45.126 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP)'
2025-11-27 01:19:45.142 +02:00 [INF] Route matched with {action = "Create", controller = "PaymentMethods"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ModularERP.Modules.Purchases.Payment.Commends.Commends_PaymentMethod.CreatePaymentMethodCommand) on controller ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController (ModularERP).
2025-11-27 01:19:45.147 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:19:45.169 +02:00 [INF] POST /api/payment-methods - Name: Bank Transfer, Code: BANK_TRANSFER
2025-11-27 01:19:45.239 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:19:46.181 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:19:46.185 +02:00 [INF] Creating new payment method: Bank Transfer
2025-11-27 01:19:46.192 +02:00 [ERR] Error occurred while creating payment method: Bank Transfer
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
CreatePaymentMethodCommand -> PaymentMethod
ModularERP.Modules.Purchases.Payment.Commends.Commends_PaymentMethod.CreatePaymentMethodCommand -> ModularERP.Modules.Purchases.Payment.Models.PaymentMethod
   at lambda_method194(Closure, Object, PaymentMethod, ResolutionContext)
   at ModularERP.Modules.Purchases.Payment.Handlers.Handlers_PaymentMethod.CreatePaymentMethodCommandHandler.Handle(CreatePaymentMethodCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Handlers\Handlers_PaymentMethod\CreatePaymentMethodCommandHandler.cs:line 36
2025-11-27 01:19:46.226 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Payment.DTO.DTO_PaymentMethod.PaymentMethodDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-27 01:19:46.248 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP) in 1099.8565ms
2025-11-27 01:19:46.252 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP)'
2025-11-27 01:19:46.255 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 01:19:46.262 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentMethods - 200 null application/json; charset=utf-8 1192.6051ms
2025-11-27 01:20:01.146 +02:00 [INF] Starting web host...
2025-11-27 01:20:03.030 +02:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:20:03.111 +02:00 [INF] Executed DbCommand (65ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:20:03.183 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:20:03.189 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:20:03.205 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:20:03.264 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:20:03.279 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:20:03.284 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:20:03.292 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:20:03.303 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:20:03.310 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:20:03.472 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:20:03.479 +02:00 [INF] Master database initialized successfully
2025-11-27 01:20:05.593 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:20:05.716 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:20:05.719 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:20:05.811 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:20:05.813 +02:00 [INF] Hosting environment: Development
2025-11-27 01:20:05.814 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:20:06.165 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:20:06.329 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 162.7829ms
2025-11-27 01:20:06.330 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:20:06.330 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:20:06.341 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.7551ms
2025-11-27 01:20:06.392 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 61.4409ms
2025-11-27 01:20:06.442 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:20:06.824 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 381.9445ms
2025-11-27 01:20:11.232 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentMethods - application/json 174
2025-11-27 01:20:11.252 +02:00 [INF] Request started
2025-11-27 01:20:11.254 +02:00 [INF] === Incoming Request ===
2025-11-27 01:20:11.256 +02:00 [INF] Path: /api/PaymentMethods
2025-11-27 01:20:11.257 +02:00 [INF] Method: POST
2025-11-27 01:20:11.258 +02:00 [INF] === Headers ===
2025-11-27 01:20:11.263 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:20:11.267 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:20:11.268 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:20:11.270 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:20:11.276 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:20:11.279 +02:00 [INF] Content-Type: ["application/json"]
2025-11-27 01:20:11.281 +02:00 [INF] Content-Length: ["174"]
2025-11-27 01:20:11.285 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:20:11.286 +02:00 [INF] Postman-Token: ["7a959cb0-4694-478b-855d-d1cde570e610"]
2025-11-27 01:20:11.292 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:20:11.294 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:20:11.296 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP)'
2025-11-27 01:20:11.315 +02:00 [INF] Route matched with {action = "Create", controller = "PaymentMethods"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ModularERP.Modules.Purchases.Payment.Commends.Commends_PaymentMethod.CreatePaymentMethodCommand) on controller ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController (ModularERP).
2025-11-27 01:20:11.323 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:20:11.349 +02:00 [INF] POST /api/payment-methods - Name: Bank Transfer, Code: BANK_TRANSFER
2025-11-27 01:20:11.420 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:20:12.302 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:20:12.305 +02:00 [INF] Creating new payment method: Bank Transfer
2025-11-27 01:20:12.312 +02:00 [ERR] Error occurred while creating payment method: Bank Transfer
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
CreatePaymentMethodCommand -> PaymentMethod
ModularERP.Modules.Purchases.Payment.Commends.Commends_PaymentMethod.CreatePaymentMethodCommand -> ModularERP.Modules.Purchases.Payment.Models.PaymentMethod
   at lambda_method194(Closure, Object, PaymentMethod, ResolutionContext)
   at ModularERP.Modules.Purchases.Payment.Handlers.Handlers_PaymentMethod.CreatePaymentMethodCommandHandler.Handle(CreatePaymentMethodCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Handlers\Handlers_PaymentMethod\CreatePaymentMethodCommandHandler.cs:line 36
2025-11-27 01:20:12.337 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Payment.DTO.DTO_PaymentMethod.PaymentMethodDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-27 01:20:12.357 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP) in 1034.2711ms
2025-11-27 01:20:12.361 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP)'
2025-11-27 01:20:12.364 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 01:20:12.371 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentMethods - 200 null application/json; charset=utf-8 1139.4644ms
2025-11-27 01:21:16.647 +02:00 [INF] Starting web host...
2025-11-27 01:21:19.982 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:21:20.065 +02:00 [INF] Executed DbCommand (65ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:21:20.134 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:21:20.141 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:21:20.158 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:21:20.216 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:21:20.232 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:21:20.236 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:21:20.244 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:21:20.256 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:21:20.262 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:21:20.425 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:21:20.432 +02:00 [INF] Master database initialized successfully
2025-11-27 01:21:22.820 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:21:22.969 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:21:22.970 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:21:23.083 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:21:23.085 +02:00 [INF] Hosting environment: Development
2025-11-27 01:21:23.087 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:21:26.351 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:21:26.474 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 124.3532ms
2025-11-27 01:21:26.482 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:21:26.494 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.7584ms
2025-11-27 01:21:26.497 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:21:26.532 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 35.6059ms
2025-11-27 01:21:26.592 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:21:26.916 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 323.6034ms
2025-11-27 01:21:49.516 +02:00 [INF] Starting web host...
2025-11-27 01:21:51.435 +02:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:21:51.476 +02:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:21:51.582 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:21:51.588 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:21:51.593 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:21:51.728 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:21:51.745 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:21:51.750 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:21:51.759 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:21:51.774 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:21:51.782 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:21:51.960 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:21:51.968 +02:00 [INF] Master database initialized successfully
2025-11-27 01:21:54.641 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:21:54.759 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:21:54.761 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:21:54.859 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:21:54.861 +02:00 [INF] Hosting environment: Development
2025-11-27 01:21:54.862 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:21:54.923 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:21:55.088 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 165.6058ms
2025-11-27 01:21:55.091 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:21:55.091 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:21:55.101 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.66ms
2025-11-27 01:21:55.128 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 36.2674ms
2025-11-27 01:21:55.192 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:21:55.503 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 310.4722ms
2025-11-27 01:21:58.786 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentMethods - application/json 174
2025-11-27 01:21:58.814 +02:00 [INF] Request started
2025-11-27 01:21:58.817 +02:00 [INF] === Incoming Request ===
2025-11-27 01:21:58.819 +02:00 [INF] Path: /api/PaymentMethods
2025-11-27 01:21:58.820 +02:00 [INF] Method: POST
2025-11-27 01:21:58.821 +02:00 [INF] === Headers ===
2025-11-27 01:21:58.825 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:21:58.830 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:21:58.832 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:21:58.836 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:21:58.838 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:21:58.841 +02:00 [INF] Content-Type: ["application/json"]
2025-11-27 01:21:58.844 +02:00 [INF] Content-Length: ["174"]
2025-11-27 01:21:58.847 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:21:58.848 +02:00 [INF] Postman-Token: ["62120748-7d68-45af-b5bb-130b07e35069"]
2025-11-27 01:21:58.853 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:21:58.854 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:21:58.856 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP)'
2025-11-27 01:21:58.876 +02:00 [INF] Route matched with {action = "Create", controller = "PaymentMethods"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ModularERP.Modules.Purchases.Payment.Commends.Commends_PaymentMethod.CreatePaymentMethodCommand) on controller ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController (ModularERP).
2025-11-27 01:21:58.886 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:21:58.908 +02:00 [INF] POST /api/payment-methods - Name: Bank Transfer, Code: BANK_TRANSFER
2025-11-27 01:21:58.968 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:21:59.921 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:21:59.925 +02:00 [INF] Creating new payment method: Bank Transfer
2025-11-27 01:21:59.932 +02:00 [ERR] Error occurred while creating payment method: Bank Transfer
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
CreatePaymentMethodCommand -> PaymentMethod
ModularERP.Modules.Purchases.Payment.Commends.Commends_PaymentMethod.CreatePaymentMethodCommand -> ModularERP.Modules.Purchases.Payment.Models.PaymentMethod
   at lambda_method194(Closure, Object, PaymentMethod, ResolutionContext)
   at ModularERP.Modules.Purchases.Payment.Handlers.Handlers_PaymentMethod.CreatePaymentMethodCommandHandler.Handle(CreatePaymentMethodCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Handlers\Handlers_PaymentMethod\CreatePaymentMethodCommandHandler.cs:line 36
2025-11-27 01:21:59.981 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Payment.DTO.DTO_PaymentMethod.PaymentMethodDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-27 01:22:00.002 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP) in 1116.0353ms
2025-11-27 01:22:00.029 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP)'
2025-11-27 01:22:00.035 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 01:22:00.045 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentMethods - 200 null application/json; charset=utf-8 1259.0036ms
2025-11-27 01:24:16.734 +02:00 [INF] Starting web host...
2025-11-27 01:24:18.711 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:24:18.761 +02:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:24:18.862 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:24:18.869 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:24:18.875 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:24:18.937 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:24:18.953 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:24:18.956 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:24:18.963 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:24:18.977 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:24:18.981 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:24:19.173 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:24:19.180 +02:00 [INF] Master database initialized successfully
2025-11-27 01:24:21.403 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:24:21.536 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:24:21.539 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:24:21.640 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:24:21.663 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:24:21.665 +02:00 [INF] Hosting environment: Development
2025-11-27 01:24:21.666 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:24:21.816 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 176.3401ms
2025-11-27 01:24:21.818 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:24:21.818 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:24:21.831 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 12.8175ms
2025-11-27 01:24:21.855 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 37.1365ms
2025-11-27 01:24:21.891 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:24:22.232 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 340.2525ms
2025-11-27 01:24:25.255 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PaymentMethods - application/json 174
2025-11-27 01:24:25.273 +02:00 [INF] Request started
2025-11-27 01:24:25.276 +02:00 [INF] === Incoming Request ===
2025-11-27 01:24:25.278 +02:00 [INF] Path: /api/PaymentMethods
2025-11-27 01:24:25.279 +02:00 [INF] Method: POST
2025-11-27 01:24:25.281 +02:00 [INF] === Headers ===
2025-11-27 01:24:25.284 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:24:25.288 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:24:25.290 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:24:25.292 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:24:25.295 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:24:25.298 +02:00 [INF] Content-Type: ["application/json"]
2025-11-27 01:24:25.299 +02:00 [INF] Content-Length: ["174"]
2025-11-27 01:24:25.301 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:24:25.302 +02:00 [INF] Postman-Token: ["3b6fce31-df97-4c20-9e80-3e8ae0667bc4"]
2025-11-27 01:24:25.310 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:24:25.311 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:24:25.316 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP)'
2025-11-27 01:24:25.337 +02:00 [INF] Route matched with {action = "Create", controller = "PaymentMethods"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ModularERP.Modules.Purchases.Payment.Commends.Commends_PaymentMethod.CreatePaymentMethodCommand) on controller ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController (ModularERP).
2025-11-27 01:24:25.344 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:24:25.370 +02:00 [INF] POST /api/payment-methods - Name: Bank Transfer, Code: BANK_TRANSFER
2025-11-27 01:24:25.437 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:24:26.296 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:24:26.300 +02:00 [INF] Creating new payment method: Bank Transfer
2025-11-27 01:24:26.451 +02:00 [INF] Successfully created payment method with ID: "d0df7b97-1b81-4ed5-201c-08de2d42f0be"
2025-11-27 01:24:26.458 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Payment.DTO.DTO_PaymentMethod.PaymentMethodDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-27 01:24:26.480 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP) in 1136.6054ms
2025-11-27 01:24:26.483 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.Create (ModularERP)'
2025-11-27 01:24:26.486 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 01:24:26.493 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PaymentMethods - 200 null application/json; charset=utf-8 1238.1117ms
2025-11-27 01:25:12.893 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------329372655769860434510557 4140
2025-11-27 01:25:12.916 +02:00 [INF] Request started
2025-11-27 01:25:12.918 +02:00 [INF] === Incoming Request ===
2025-11-27 01:25:12.920 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:25:12.922 +02:00 [INF] Method: POST
2025-11-27 01:25:12.923 +02:00 [INF] === Headers ===
2025-11-27 01:25:12.924 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:25:12.925 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:25:12.930 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:25:12.932 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:25:12.934 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:25:12.935 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------329372655769860434510557"]
2025-11-27 01:25:12.938 +02:00 [INF] Content-Length: ["4140"]
2025-11-27 01:25:12.939 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:25:12.941 +02:00 [INF] Postman-Token: ["6b5fc0c6-9a1e-42b4-8a63-13791902ee10"]
2025-11-27 01:25:12.945 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:25:12.947 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:25:12.949 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:25:12.958 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:25:13.103 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 01:25:13.263 +02:00 [INF] Starting PO amount calculations
2025-11-27 01:25:13.264 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 01:25:13.267 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 01:25:13.269 +02:00 [INF] Adjustments Total: 10
2025-11-27 01:25:13.270 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 01:25:13.271 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 01:25:13.274 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 01:25:13.276 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 01:25:13.278 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 01:25:13.280 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 01:25:13.424 +02:00 [INF] Purchase Order created with ID: "112b09ce-1eae-4270-bf6a-42b29cb4c940", Number: PO-202511-0003
2025-11-27 01:25:13.818 +02:00 [ERR] Error creating purchase order
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 493
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
2025-11-27 01:25:13.840 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 875.34ms
2025-11-27 01:25:13.842 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:25:13.845 +02:00 [ERR] Unexpected error occurred
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 493
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:25:13.876 +02:00 [INF] Error response sent with status code 500
2025-11-27 01:25:13.879 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 986.1699ms
2025-11-27 01:30:15.167 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------286648684037433240677098 4140
2025-11-27 01:30:15.173 +02:00 [INF] Request started
2025-11-27 01:30:15.173 +02:00 [INF] === Incoming Request ===
2025-11-27 01:30:15.174 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:30:15.175 +02:00 [INF] Method: POST
2025-11-27 01:30:15.176 +02:00 [INF] === Headers ===
2025-11-27 01:30:15.178 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:30:15.180 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:30:15.182 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:30:15.183 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:30:15.185 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:30:15.186 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------286648684037433240677098"]
2025-11-27 01:30:15.189 +02:00 [INF] Content-Length: ["4140"]
2025-11-27 01:30:15.190 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:30:15.193 +02:00 [INF] Postman-Token: ["b602172f-5eb0-4365-88d6-732facb171a4"]
2025-11-27 01:30:15.195 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:30:15.196 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:30:15.198 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:30:15.201 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:30:15.215 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 01:30:15.232 +02:00 [INF] Starting PO amount calculations
2025-11-27 01:30:15.234 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 01:30:15.235 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 01:30:15.237 +02:00 [INF] Adjustments Total: 10
2025-11-27 01:30:15.238 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 01:30:15.240 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 01:30:15.242 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 01:30:15.246 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 01:30:15.248 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 01:30:15.249 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 01:30:15.270 +02:00 [INF] Purchase Order created with ID: "12ed6829-c444-4e48-981f-b65064e3563a", Number: PO-202511-0004
2025-11-27 01:30:15.317 +02:00 [ERR] Error creating purchase order
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 493
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
2025-11-27 01:30:15.322 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 118.1851ms
2025-11-27 01:30:15.324 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:30:15.329 +02:00 [ERR] Unexpected error occurred
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 493
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:30:15.353 +02:00 [INF] Error response sent with status code 500
2025-11-27 01:30:15.355 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 187.7306ms
2025-11-27 01:30:26.681 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------006003315871300857584474 4140
2025-11-27 01:30:26.685 +02:00 [INF] Request started
2025-11-27 01:30:26.686 +02:00 [INF] === Incoming Request ===
2025-11-27 01:30:26.687 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:30:26.688 +02:00 [INF] Method: POST
2025-11-27 01:30:26.691 +02:00 [INF] === Headers ===
2025-11-27 01:30:26.692 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:30:26.694 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:30:26.696 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:30:26.697 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:30:26.699 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:30:26.701 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------006003315871300857584474"]
2025-11-27 01:30:26.703 +02:00 [INF] Content-Length: ["4140"]
2025-11-27 01:30:26.705 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:30:26.707 +02:00 [INF] Postman-Token: ["533c2c6f-10f9-4e1b-8753-e8100f8df51a"]
2025-11-27 01:30:26.709 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:30:26.712 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:30:26.713 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:30:26.714 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:30:26.731 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 01:30:26.737 +02:00 [INF] Starting PO amount calculations
2025-11-27 01:30:26.738 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 01:30:26.740 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 01:30:26.742 +02:00 [INF] Adjustments Total: 10
2025-11-27 01:30:26.744 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 01:30:26.745 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 01:30:26.747 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 01:30:26.754 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 01:30:26.758 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 01:30:26.760 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 01:30:26.844 +02:00 [INF] Purchase Order created with ID: "68f3629f-775e-42f1-8d32-881957de19d1", Number: PO-202511-0005
2025-11-27 01:30:26.870 +02:00 [ERR] Error creating purchase order
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 493
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
2025-11-27 01:30:26.874 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 157.4772ms
2025-11-27 01:30:26.876 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:30:26.878 +02:00 [ERR] Unexpected error occurred
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 493
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:30:26.901 +02:00 [INF] Error response sent with status code 500
2025-11-27 01:30:26.904 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 223.5939ms
2025-11-27 01:30:33.870 +02:00 [INF] Starting web host...
2025-11-27 01:30:35.416 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:30:35.473 +02:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:30:35.541 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:30:35.547 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:30:35.563 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:30:35.618 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:30:35.633 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:30:35.637 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:30:35.644 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:30:35.656 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:30:35.663 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:30:35.867 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:30:35.874 +02:00 [INF] Master database initialized successfully
2025-11-27 01:30:38.074 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:30:38.183 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:30:38.185 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:30:38.272 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:30:38.274 +02:00 [INF] Hosting environment: Development
2025-11-27 01:30:38.275 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:30:38.452 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:30:38.600 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 149.1451ms
2025-11-27 01:30:38.603 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:30:38.603 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:30:38.633 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 30.1439ms
2025-11-27 01:30:38.664 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 60.652ms
2025-11-27 01:30:38.702 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:30:39.003 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 301.6253ms
2025-11-27 01:30:44.964 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------321348470734574046452843 4140
2025-11-27 01:30:44.981 +02:00 [INF] Request started
2025-11-27 01:30:44.982 +02:00 [INF] === Incoming Request ===
2025-11-27 01:30:44.986 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:30:44.987 +02:00 [INF] Method: POST
2025-11-27 01:30:44.988 +02:00 [INF] === Headers ===
2025-11-27 01:30:44.991 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:30:44.994 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:30:44.996 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:30:44.997 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:30:44.999 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:30:45.003 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------321348470734574046452843"]
2025-11-27 01:30:45.005 +02:00 [INF] Content-Length: ["4140"]
2025-11-27 01:30:45.007 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:30:45.008 +02:00 [INF] Postman-Token: ["b165abd9-6bab-4734-bbe1-dfc87f4b9d56"]
2025-11-27 01:30:45.013 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:30:45.014 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:30:45.017 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:30:45.040 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:30:45.046 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:30:45.292 +02:00 [INF] Executed DbCommand (17ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:30:46.226 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:30:46.230 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 01:30:46.415 +02:00 [INF] Starting PO amount calculations
2025-11-27 01:30:46.417 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 01:30:46.421 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 01:30:46.423 +02:00 [INF] Adjustments Total: 10
2025-11-27 01:30:46.424 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 01:30:46.426 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 01:30:46.428 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 01:30:46.430 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 01:30:46.431 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 01:30:46.434 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 01:30:46.666 +02:00 [INF] Purchase Order created with ID: "9946e01d-9421-4b2e-9c5e-0b1da2d9b18c", Number: PO-202511-0006
2025-11-27 01:30:47.048 +02:00 [ERR] Error creating purchase order
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 493
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
2025-11-27 01:30:47.065 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 2019.2212ms
2025-11-27 01:30:47.071 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:30:47.073 +02:00 [ERR] Unexpected error occurred
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 493
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:30:47.109 +02:00 [INF] Error response sent with status code 500
2025-11-27 01:30:47.115 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 2150.8345ms
2025-11-27 01:39:27.876 +02:00 [INF] Starting web host...
2025-11-27 01:39:29.692 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:39:29.754 +02:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:39:29.824 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:39:29.830 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:39:29.846 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:39:29.908 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:39:29.927 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:39:29.932 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:39:29.940 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:39:29.952 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:39:29.959 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:39:30.157 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:39:30.166 +02:00 [INF] Master database initialized successfully
2025-11-27 01:39:32.356 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:39:32.467 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:39:32.469 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:39:32.555 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:39:32.557 +02:00 [INF] Hosting environment: Development
2025-11-27 01:39:32.558 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:39:32.748 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:39:32.877 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 130.3175ms
2025-11-27 01:39:33.033 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:39:33.033 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:39:33.040 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.973ms
2025-11-27 01:39:33.063 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.3046ms
2025-11-27 01:39:33.116 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:39:33.409 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 292.9844ms
2025-11-27 01:39:47.057 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------500308873676821894434621 4140
2025-11-27 01:39:47.075 +02:00 [INF] Request started
2025-11-27 01:39:47.077 +02:00 [INF] === Incoming Request ===
2025-11-27 01:39:47.079 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:39:47.080 +02:00 [INF] Method: POST
2025-11-27 01:39:47.082 +02:00 [INF] === Headers ===
2025-11-27 01:39:47.086 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:39:47.092 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:39:47.093 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:39:47.095 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:39:47.098 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:39:47.101 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------500308873676821894434621"]
2025-11-27 01:39:47.103 +02:00 [INF] Content-Length: ["4140"]
2025-11-27 01:39:47.105 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:39:47.108 +02:00 [INF] Postman-Token: ["84ccc1ef-7bba-4a50-91fc-0b65fcf39471"]
2025-11-27 01:39:47.116 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:39:47.118 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:39:47.120 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:39:47.146 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:39:47.153 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:39:47.357 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:39:48.207 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:39:48.234 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 01:39:48.451 +02:00 [INF] Starting PO amount calculations
2025-11-27 01:39:48.452 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 01:39:48.454 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 01:39:48.456 +02:00 [INF] Adjustments Total: 10
2025-11-27 01:39:48.457 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 01:39:48.458 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 01:39:48.461 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 01:39:48.465 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 01:39:48.467 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 01:39:48.469 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 01:39:48.809 +02:00 [INF] Purchase Order created with ID: "2fd0064e-db87-4a98-a005-05d1dd63be61", Number: PO-202511-0007
2025-11-27 01:39:49.110 +02:00 [INF] Building response DTO for PO: PO-202511-0007
2025-11-27 01:39:49.279 +02:00 [INF] Fetched 1 products
2025-11-27 01:39:49.281 +02:00 [INF] Fetched 0 services
2025-11-27 01:39:49.319 +02:00 [INF] Fetched 1 tax profiles
2025-11-27 01:39:49.321 +02:00 [INF] Fetching payment term with ID: "da401a16-b5d6-4179-bc3f-7951e8fd1821"
2025-11-27 01:39:49.323 +02:00 [ERR] Error building response DTO for PO: PO-202511-0007
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 511
2025-11-27 01:39:49.353 +02:00 [ERR] Error creating purchase order
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 511
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
2025-11-27 01:39:49.361 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 2208.1909ms
2025-11-27 01:39:49.364 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:39:49.367 +02:00 [ERR] Unexpected error occurred
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 511
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:39:49.412 +02:00 [INF] Error response sent with status code 500
2025-11-27 01:39:49.420 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 2363.1055ms
2025-11-27 01:39:58.029 +02:00 [INF] Starting web host...
2025-11-27 01:39:59.838 +02:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:39:59.929 +02:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:40:00.012 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:40:00.019 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:40:00.028 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:40:00.084 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:40:00.100 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:40:00.104 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:40:00.113 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:40:00.124 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:40:00.131 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:40:00.308 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:40:00.317 +02:00 [INF] Master database initialized successfully
2025-11-27 01:40:02.329 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:40:02.434 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:40:02.436 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:40:02.524 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:40:02.527 +02:00 [INF] Hosting environment: Development
2025-11-27 01:40:02.528 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:40:02.645 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:40:02.816 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 171.1352ms
2025-11-27 01:40:02.819 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:40:02.819 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:40:02.833 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.6034ms
2025-11-27 01:40:02.854 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 34.8486ms
2025-11-27 01:40:02.930 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:40:03.229 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 298.4963ms
2025-11-27 01:40:04.777 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------778699509460079274683083 4140
2025-11-27 01:40:04.795 +02:00 [INF] Request started
2025-11-27 01:40:04.798 +02:00 [INF] === Incoming Request ===
2025-11-27 01:40:04.799 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:40:04.800 +02:00 [INF] Method: POST
2025-11-27 01:40:04.801 +02:00 [INF] === Headers ===
2025-11-27 01:40:04.803 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:40:04.807 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:40:04.809 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:40:04.811 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:40:04.813 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:40:04.815 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------778699509460079274683083"]
2025-11-27 01:40:04.817 +02:00 [INF] Content-Length: ["4140"]
2025-11-27 01:40:04.819 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:40:04.821 +02:00 [INF] Postman-Token: ["a6c5c820-c492-4efb-b709-a16d958f098a"]
2025-11-27 01:40:04.826 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:40:04.829 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:40:04.831 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:40:04.851 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:40:04.857 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:40:05.023 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:40:05.807 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:40:05.812 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 01:40:06.009 +02:00 [INF] Starting PO amount calculations
2025-11-27 01:40:06.011 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 01:40:06.013 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 01:40:06.014 +02:00 [INF] Adjustments Total: 10
2025-11-27 01:40:06.015 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 01:40:06.016 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 01:40:06.019 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 01:40:06.021 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 01:40:06.022 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 01:40:06.024 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 01:40:06.249 +02:00 [INF] Purchase Order created with ID: "6bc9a721-c099-4cdc-bcd3-fef9defc64a1", Number: PO-202511-0008
2025-11-27 01:40:06.496 +02:00 [INF] Building response DTO for PO: PO-202511-0008
2025-11-27 01:40:06.612 +02:00 [INF] Fetched 1 products
2025-11-27 01:40:06.614 +02:00 [INF] Fetched 0 services
2025-11-27 01:40:06.642 +02:00 [INF] Fetched 1 tax profiles
2025-11-27 01:40:06.644 +02:00 [INF] Fetching payment term with ID: "da401a16-b5d6-4179-bc3f-7951e8fd1821"
2025-11-27 01:40:06.645 +02:00 [ERR] Error building response DTO for PO: PO-202511-0008
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 511
2025-11-27 01:40:06.654 +02:00 [ERR] Error creating purchase order
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 511
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
2025-11-27 01:40:06.663 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 1805.3968ms
2025-11-27 01:40:06.666 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:40:06.668 +02:00 [ERR] Unexpected error occurred
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 511
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 163
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:40:06.706 +02:00 [INF] Error response sent with status code 500
2025-11-27 01:40:06.712 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 1935.2856ms
2025-11-27 01:42:56.750 +02:00 [INF] Starting web host...
2025-11-27 01:42:58.534 +02:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:42:58.628 +02:00 [INF] Executed DbCommand (78ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:42:58.725 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:42:58.730 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:42:58.746 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:42:58.808 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:42:58.825 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:42:58.830 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:42:58.841 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:42:58.858 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:42:58.865 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:42:59.112 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:42:59.123 +02:00 [INF] Master database initialized successfully
2025-11-27 01:43:01.464 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:43:01.586 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:43:01.588 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:43:01.681 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:43:01.735 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:43:01.737 +02:00 [INF] Hosting environment: Development
2025-11-27 01:43:01.739 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:43:01.872 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 191.7295ms
2025-11-27 01:43:01.947 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:43:01.947 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:43:01.954 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.7461ms
2025-11-27 01:43:01.992 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 44.6812ms
2025-11-27 01:43:02.042 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:43:02.416 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 374.2297ms
2025-11-27 01:43:20.232 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------436539205008853366122123 4140
2025-11-27 01:43:20.250 +02:00 [INF] Request started
2025-11-27 01:43:20.253 +02:00 [INF] === Incoming Request ===
2025-11-27 01:43:20.256 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:43:20.257 +02:00 [INF] Method: POST
2025-11-27 01:43:20.259 +02:00 [INF] === Headers ===
2025-11-27 01:43:20.265 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:43:20.268 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:43:20.269 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:43:20.272 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:43:20.274 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:43:20.275 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------436539205008853366122123"]
2025-11-27 01:43:20.277 +02:00 [INF] Content-Length: ["4140"]
2025-11-27 01:43:20.282 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:43:20.284 +02:00 [INF] Postman-Token: ["a316997b-1d29-42ab-a25e-11877aa370cf"]
2025-11-27 01:43:20.289 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:43:20.291 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:43:20.294 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:43:20.319 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:43:20.326 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:43:20.539 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:43:21.470 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:43:21.474 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 01:43:21.684 +02:00 [INF] Starting PO amount calculations
2025-11-27 01:43:21.685 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 01:43:21.688 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 01:43:21.691 +02:00 [INF] Adjustments Total: 10
2025-11-27 01:43:21.692 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 01:43:21.696 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 01:43:21.700 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 01:43:21.703 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 01:43:21.706 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 01:43:21.707 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 01:43:21.983 +02:00 [INF] Purchase Order created with ID: "520a3b04-a810-4f53-8da8-e94866b40b21", Number: PO-202511-0009
2025-11-27 01:43:22.239 +02:00 [INF] Building response DTO for PO: PO-202511-0009
2025-11-27 01:43:22.370 +02:00 [INF] Fetched 1 products
2025-11-27 01:43:22.373 +02:00 [INF] Fetched 0 services
2025-11-27 01:43:22.414 +02:00 [INF] Fetched 1 tax profiles
2025-11-27 01:43:22.416 +02:00 [INF] Fetching payment term with ID: "da401a16-b5d6-4179-bc3f-7951e8fd1821"
2025-11-27 01:43:22.417 +02:00 [ERR] Error fetching payment term with ID: "da401a16-b5d6-4179-bc3f-7951e8fd1821"
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 515
2025-11-27 01:43:22.440 +02:00 [INF] Mapped 1 line items
2025-11-27 01:43:22.442 +02:00 [INF] Mapped 1 shipping charges
2025-11-27 01:43:22.463 +02:00 [INF] Successfully built response DTO for PO: PO-202511-0009
2025-11-27 01:43:22.466 +02:00 [INF] Purchase Order PO-202511-0009 created successfully
2025-11-27 01:43:22.474 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.CreatePurchaseOrderDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-27 01:43:22.518 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 2192.1774ms
2025-11-27 01:43:22.521 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:43:22.523 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 01:43:22.531 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 200 null application/json; charset=utf-8 2298.5745ms
2025-11-27 01:47:45.491 +02:00 [INF] Starting web host...
2025-11-27 01:47:47.370 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:47:47.475 +02:00 [INF] Executed DbCommand (89ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:47:47.560 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:47:47.568 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:47:47.585 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:47:47.667 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:47:47.685 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:47:47.691 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:47:47.700 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:47:47.714 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:47:47.733 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:47:47.958 +02:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:47:47.965 +02:00 [INF] Master database initialized successfully
2025-11-27 01:47:50.117 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:47:50.244 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:47:50.247 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:47:50.336 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:47:50.339 +02:00 [INF] Hosting environment: Development
2025-11-27 01:47:50.340 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:47:50.392 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:47:50.564 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 172.1506ms
2025-11-27 01:47:50.712 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:47:50.712 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:47:50.718 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.3441ms
2025-11-27 01:47:50.741 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 29.588ms
2025-11-27 01:47:50.794 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:47:51.178 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 384.0627ms
2025-11-27 01:48:05.272 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------753815433541976524820928 4140
2025-11-27 01:48:05.293 +02:00 [INF] Request started
2025-11-27 01:48:05.296 +02:00 [INF] === Incoming Request ===
2025-11-27 01:48:05.299 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:48:05.300 +02:00 [INF] Method: POST
2025-11-27 01:48:05.302 +02:00 [INF] === Headers ===
2025-11-27 01:48:05.306 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:48:05.312 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:48:05.314 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:48:05.316 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:48:05.319 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:48:05.320 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------753815433541976524820928"]
2025-11-27 01:48:05.322 +02:00 [INF] Content-Length: ["4140"]
2025-11-27 01:48:05.324 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:48:05.325 +02:00 [INF] Postman-Token: ["9b558b5a-a186-466d-80b0-7415935801af"]
2025-11-27 01:48:05.332 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:48:05.334 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:48:05.338 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:48:05.363 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:48:05.369 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:48:05.582 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:48:06.360 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:48:06.364 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 01:48:06.623 +02:00 [INF] Starting PO amount calculations
2025-11-27 01:48:06.624 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 01:48:06.627 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 01:48:06.629 +02:00 [INF] Adjustments Total: 10
2025-11-27 01:48:06.630 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 01:48:06.631 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 01:48:06.634 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 01:48:06.636 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 01:48:06.637 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 01:48:06.639 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 01:48:06.890 +02:00 [INF] Purchase Order created with ID: "d3957597-d549-4427-96dd-e173b93f0eb2", Number: PO-202511-0010
2025-11-27 01:48:07.148 +02:00 [INF] Building response DTO for PO: PO-202511-0010
2025-11-27 01:48:07.213 +02:00 [ERR] Error building response DTO for PO: PO-202511-0010
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 534
2025-11-27 01:48:07.239 +02:00 [ERR] Error creating purchase order
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 534
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 167
2025-11-27 01:48:07.249 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 1878.9662ms
2025-11-27 01:48:07.252 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:48:07.254 +02:00 [ERR] Unexpected error occurred
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 534
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 167
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:48:07.282 +02:00 [INF] Error response sent with status code 500
2025-11-27 01:48:07.290 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 2018.1131ms
2025-11-27 01:53:34.864 +02:00 [INF] Starting web host...
2025-11-27 01:53:36.431 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:53:36.521 +02:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:53:36.592 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:53:36.598 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:53:36.615 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:53:36.675 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:53:36.690 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:53:36.694 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:53:36.701 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:53:36.713 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:53:36.719 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:53:36.927 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:53:36.934 +02:00 [INF] Master database initialized successfully
2025-11-27 01:53:39.259 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:53:39.376 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:53:39.379 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:53:39.468 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:53:39.470 +02:00 [INF] Hosting environment: Development
2025-11-27 01:53:39.471 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:53:39.767 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:53:39.915 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 149.3995ms
2025-11-27 01:53:39.915 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:53:39.915 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:53:39.929 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.2474ms
2025-11-27 01:53:39.953 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 37.6393ms
2025-11-27 01:53:40.027 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:53:40.316 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 288.3609ms
2025-11-27 01:53:45.331 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------139332475573804922744034 4140
2025-11-27 01:53:45.360 +02:00 [INF] Request started
2025-11-27 01:53:45.363 +02:00 [INF] === Incoming Request ===
2025-11-27 01:53:45.364 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:53:45.365 +02:00 [INF] Method: POST
2025-11-27 01:53:45.366 +02:00 [INF] === Headers ===
2025-11-27 01:53:45.369 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:53:45.375 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:53:45.377 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:53:45.381 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:53:45.382 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:53:45.384 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------139332475573804922744034"]
2025-11-27 01:53:45.386 +02:00 [INF] Content-Length: ["4140"]
2025-11-27 01:53:45.388 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:53:45.392 +02:00 [INF] Postman-Token: ["bd74948d-15d8-4a95-847f-710f604fdca5"]
2025-11-27 01:53:45.398 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:53:45.400 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:53:45.402 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:53:45.443 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:53:45.451 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:53:45.709 +02:00 [INF] Executed DbCommand (16ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:53:46.998 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:53:47.010 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 01:53:47.276 +02:00 [INF] Starting PO amount calculations
2025-11-27 01:53:47.277 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 01:53:47.280 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 01:53:47.290 +02:00 [INF] Adjustments Total: 10
2025-11-27 01:53:47.292 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 01:53:47.293 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 01:53:47.296 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 01:53:47.298 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 01:53:47.299 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 01:53:47.301 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 01:53:47.585 +02:00 [INF] Purchase Order created with ID: "3ce1e5fa-5e3a-43c2-9f6b-59465662b3d0", Number: PO-202511-0011
2025-11-27 01:53:47.880 +02:00 [INF] Building response DTO for PO: PO-202511-0011
2025-11-27 01:53:47.958 +02:00 [ERR] Error building response DTO for PO: PO-202511-0011
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 534
2025-11-27 01:53:48.011 +02:00 [ERR] Error creating purchase order
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 534
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 167
2025-11-27 01:53:48.021 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 2571.5955ms
2025-11-27 01:53:48.025 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:53:48.027 +02:00 [ERR] Unexpected error occurred
System.NullReferenceException: Object reference not set to an instance of an object.
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.BuildResponseDto(PurchaseOrder purchaseOrder, Supplier supplier, List`1 lineItems, List`1 deposits, List`1 shippingCharges, List`1 discounts, List`1 adjustments, List`1 poNotes, Int32 attachmentCount, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 534
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 167
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:53:48.087 +02:00 [INF] Error response sent with status code 500
2025-11-27 01:53:48.093 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 2762.0604ms
2025-11-27 01:55:07.405 +02:00 [INF] Starting web host...
2025-11-27 01:55:09.159 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:55:09.271 +02:00 [INF] Executed DbCommand (96ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 01:55:09.339 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:55:09.345 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 01:55:09.362 +02:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 01:55:09.419 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 01:55:09.436 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 01:55:09.440 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 01:55:09.446 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 01:55:09.461 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 01:55:09.468 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 01:55:09.672 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 01:55:09.679 +02:00 [INF] Master database initialized successfully
2025-11-27 01:55:11.894 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 01:55:12.001 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 01:55:12.002 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 01:55:12.093 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 01:55:12.095 +02:00 [INF] Hosting environment: Development
2025-11-27 01:55:12.097 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 01:55:12.331 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 01:55:12.472 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 142.0864ms
2025-11-27 01:55:12.516 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 01:55:12.516 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 01:55:12.522 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.9827ms
2025-11-27 01:55:12.543 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.9668ms
2025-11-27 01:55:12.575 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 01:55:12.937 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 361.3686ms
2025-11-27 01:55:18.816 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------691978138071073134501303 4140
2025-11-27 01:55:18.841 +02:00 [INF] Request started
2025-11-27 01:55:18.937 +02:00 [INF] === Incoming Request ===
2025-11-27 01:55:18.939 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:55:18.941 +02:00 [INF] Method: POST
2025-11-27 01:55:18.943 +02:00 [INF] === Headers ===
2025-11-27 01:55:18.947 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:55:18.969 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:55:18.973 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:55:18.976 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:55:18.978 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:55:18.979 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------691978138071073134501303"]
2025-11-27 01:55:18.982 +02:00 [INF] Content-Length: ["4140"]
2025-11-27 01:55:18.984 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:55:18.985 +02:00 [INF] Postman-Token: ["af3c1fc0-191b-46c4-88b5-a153d75d5391"]
2025-11-27 01:55:18.990 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:55:18.992 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:55:18.994 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:55:19.025 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:55:19.031 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:55:19.228 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 01:55:19.934 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 01:55:19.939 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-27 01:55:20.156 +02:00 [INF] Starting PO amount calculations
2025-11-27 01:55:20.159 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-27 01:55:20.161 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-27 01:55:20.163 +02:00 [INF] Adjustments Total: 10
2025-11-27 01:55:20.164 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-27 01:55:20.165 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-27 01:55:20.168 +02:00 [WRN] âš ï¸ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-27 01:55:20.170 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-27 01:55:20.171 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-27 01:55:20.173 +02:00 [INF] âœ… Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-27 01:55:20.425 +02:00 [INF] Purchase Order created with ID: "7cae7505-1a01-41ce-9732-625778ba4983", Number: PO-202511-0012
2025-11-27 01:55:20.696 +02:00 [INF] Building response DTO for PO: PO-202511-0012
2025-11-27 01:55:20.704 +02:00 [INF] Found 1 unique payment method IDs: d0df7b97-1b81-4ed5-201c-08de2d42f0be
2025-11-27 01:55:20.763 +02:00 [INF] Fetching payment methods for IDs: d0df7b97-1b81-4ed5-201c-08de2d42f0be
2025-11-27 01:55:20.829 +02:00 [INF] Fetched 1 products, 0 services, 1 tax profiles, 1 payment methods
2025-11-27 01:55:20.832 +02:00 [WRN] Payment term with ID "da401a16-b5d6-4179-bc3f-7951e8fd1821" not found
2025-11-27 01:55:20.834 +02:00 [INF] Successfully mapped 1 deposits
2025-11-27 01:55:20.848 +02:00 [INF] Successfully built response DTO for PO: PO-202511-0012
2025-11-27 01:55:20.850 +02:00 [INF] Purchase Order PO-202511-0012 created successfully
2025-11-27 01:55:20.859 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.CreatePurchaseOrderDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-27 01:55:20.900 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 1869.2752ms
2025-11-27 01:55:20.904 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-27 01:55:20.906 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 01:55:20.913 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 200 null application/json; charset=utf-8 2097.3589ms
2025-11-27 01:55:50.417 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PurchaseOrder - null null
2025-11-27 01:55:50.440 +02:00 [INF] Request started
2025-11-27 01:55:50.441 +02:00 [INF] === Incoming Request ===
2025-11-27 01:55:50.442 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-27 01:55:50.443 +02:00 [INF] Method: GET
2025-11-27 01:55:50.444 +02:00 [INF] === Headers ===
2025-11-27 01:55:50.445 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:55:50.448 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:55:50.451 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:55:50.453 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:55:50.454 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:55:50.456 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:55:50.457 +02:00 [INF] Postman-Token: ["6e050748-f746-4b08-ac03-5ab782d6684d"]
2025-11-27 01:55:50.462 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:55:50.463 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:55:50.465 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.GetPurchaseOrders (ModularERP)'
2025-11-27 01:55:50.470 +02:00 [INF] Route matched with {action = "GetPurchaseOrders", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPurchaseOrders(ModularERP.Modules.Purchases.Purchase_Order_Management.Qeuries.Qeuries_PurchaseOrder.GetPurchaseOrderListQuery) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 01:55:50.481 +02:00 [INF] Retrieving purchase orders list with filters
2025-11-27 01:55:50.569 +02:00 [INF] Retrieved 10 purchase orders (Page 1 of 2)
2025-11-27 01:55:50.572 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.PagedResult`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.PurchaseOrderListDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-27 01:55:50.579 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.GetPurchaseOrders (ModularERP) in 105.1378ms
2025-11-27 01:55:50.583 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.GetPurchaseOrders (ModularERP)'
2025-11-27 01:55:50.585 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 01:55:50.587 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PurchaseOrder - 200 null application/json; charset=utf-8 169.8138ms
2025-11-27 01:57:01.461 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PaymentMethods/{7cae7505-1a01-41ce-9732-625778ba4983} - null null
2025-11-27 01:57:01.466 +02:00 [INF] Request started
2025-11-27 01:57:01.467 +02:00 [INF] === Incoming Request ===
2025-11-27 01:57:01.468 +02:00 [INF] Path: /api/PaymentMethods/%7B7cae7505-1a01-41ce-9732-625778ba4983%7D
2025-11-27 01:57:01.469 +02:00 [INF] Method: GET
2025-11-27 01:57:01.471 +02:00 [INF] === Headers ===
2025-11-27 01:57:01.473 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:57:01.475 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:57:01.477 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:57:01.478 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:57:01.480 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:57:01.482 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:57:01.484 +02:00 [INF] Postman-Token: ["dfa67272-b794-4702-a9cb-8f3e2c0f185f"]
2025-11-27 01:57:01.486 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:57:01.487 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:57:01.488 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP)'
2025-11-27 01:57:01.492 +02:00 [INF] Route matched with {action = "GetById", controller = "PaymentMethods"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(System.Guid) on controller ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController (ModularERP).
2025-11-27 01:57:01.497 +02:00 [INF] GET /api/payment-methods/"7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 01:57:01.501 +02:00 [INF] Fetching payment method with ID: "7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 01:57:01.514 +02:00 [WRN] Payment method with ID "7cae7505-1a01-41ce-9732-625778ba4983" not found
2025-11-27 01:57:01.516 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP) in 20.3422ms
2025-11-27 01:57:01.518 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP)'
2025-11-27 01:57:01.522 +02:00 [ERR] Application exception occurred: Payment method with ID 7cae7505-1a01-41ce-9732-625778ba4983 not found
ModularERP.Common.Exceptions.NotFoundException: Payment method with ID 7cae7505-1a01-41ce-9732-625778ba4983 not found
   at ModularERP.Modules.Purchases.Payment.Handlers.Handlers_PaymentMethod.GetPaymentMethodByIdQueryHandler.Handle(GetPaymentMethodByIdQuery request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Handlers\Handlers_PaymentMethod\GetPaymentMethodByIdQueryHandler.cs:line 47
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById(Guid id) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Controllers\PaymentMethodsController.cs:line 73
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:57:01.563 +02:00 [INF] Error response sent with status code 404
2025-11-27 01:57:01.566 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PaymentMethods/{7cae7505-1a01-41ce-9732-625778ba4983} - 404 null application/json; charset=utf-8 104.7035ms
2025-11-27 01:57:22.553 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PaymentMethods/7cae7505-1a01-41ce-9732-625778ba4983 - null null
2025-11-27 01:57:22.557 +02:00 [INF] Request started
2025-11-27 01:57:22.558 +02:00 [INF] === Incoming Request ===
2025-11-27 01:57:22.559 +02:00 [INF] Path: /api/PaymentMethods/7cae7505-1a01-41ce-9732-625778ba4983
2025-11-27 01:57:22.560 +02:00 [INF] Method: GET
2025-11-27 01:57:22.561 +02:00 [INF] === Headers ===
2025-11-27 01:57:22.562 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:57:22.565 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:57:22.567 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:57:22.568 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:57:22.571 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:57:22.574 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:57:22.576 +02:00 [INF] Postman-Token: ["fdd602f8-37ad-4e25-a4cb-4b29ef6c2382"]
2025-11-27 01:57:22.577 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:57:22.578 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:57:22.579 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP)'
2025-11-27 01:57:22.581 +02:00 [INF] Route matched with {action = "GetById", controller = "PaymentMethods"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(System.Guid) on controller ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController (ModularERP).
2025-11-27 01:57:22.586 +02:00 [INF] GET /api/payment-methods/"7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 01:57:22.588 +02:00 [INF] Fetching payment method with ID: "7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 01:57:22.621 +02:00 [WRN] Payment method with ID "7cae7505-1a01-41ce-9732-625778ba4983" not found
2025-11-27 01:57:22.623 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP) in 37.4066ms
2025-11-27 01:57:22.625 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP)'
2025-11-27 01:57:22.627 +02:00 [ERR] Application exception occurred: Payment method with ID 7cae7505-1a01-41ce-9732-625778ba4983 not found
ModularERP.Common.Exceptions.NotFoundException: Payment method with ID 7cae7505-1a01-41ce-9732-625778ba4983 not found
   at ModularERP.Modules.Purchases.Payment.Handlers.Handlers_PaymentMethod.GetPaymentMethodByIdQueryHandler.Handle(GetPaymentMethodByIdQuery request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Handlers\Handlers_PaymentMethod\GetPaymentMethodByIdQueryHandler.cs:line 47
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById(Guid id) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Controllers\PaymentMethodsController.cs:line 73
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:57:22.647 +02:00 [INF] Error response sent with status code 404
2025-11-27 01:57:22.648 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PaymentMethods/7cae7505-1a01-41ce-9732-625778ba4983 - 404 null application/json; charset=utf-8 95.4641ms
2025-11-27 01:58:04.099 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PaymentMethods/7cae7505-1a01-41ce-9732-625778ba4983112b09ce-1eae-4270-bf6a-42b29cb4c9407cae7505-1a01-41ce-9732-625778ba4983 - null null
2025-11-27 01:58:04.104 +02:00 [INF] Request started
2025-11-27 01:58:04.105 +02:00 [INF] === Incoming Request ===
2025-11-27 01:58:04.107 +02:00 [INF] Path: /api/PaymentMethods/7cae7505-1a01-41ce-9732-625778ba4983112b09ce-1eae-4270-bf6a-42b29cb4c9407cae7505-1a01-41ce-9732-625778ba4983
2025-11-27 01:58:04.108 +02:00 [INF] Method: GET
2025-11-27 01:58:04.110 +02:00 [INF] === Headers ===
2025-11-27 01:58:04.111 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:58:04.113 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:58:04.114 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:58:04.116 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:58:04.117 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:58:04.121 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:58:04.122 +02:00 [INF] Postman-Token: ["df27aa89-537f-4177-bddc-97e652899f54"]
2025-11-27 01:58:04.124 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:58:04.125 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:58:04.126 +02:00 [INF] Request completed successfully with status code 404
2025-11-27 01:58:04.128 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PaymentMethods/7cae7505-1a01-41ce-9732-625778ba4983112b09ce-1eae-4270-bf6a-42b29cb4c9407cae7505-1a01-41ce-9732-625778ba4983 - 404 0 null 28.3006ms
2025-11-27 01:58:04.133 +02:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: GET https://localhost:7168/api/PaymentMethods/7cae7505-1a01-41ce-9732-625778ba4983112b09ce-1eae-4270-bf6a-42b29cb4c9407cae7505-1a01-41ce-9732-625778ba4983, Response status code: 404
2025-11-27 01:58:16.949 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PaymentMethods/112b09ce-1eae-4270-bf6a-42b29cb4c940 - null null
2025-11-27 01:58:16.955 +02:00 [INF] Request started
2025-11-27 01:58:16.955 +02:00 [INF] === Incoming Request ===
2025-11-27 01:58:16.956 +02:00 [INF] Path: /api/PaymentMethods/112b09ce-1eae-4270-bf6a-42b29cb4c940
2025-11-27 01:58:16.960 +02:00 [INF] Method: GET
2025-11-27 01:58:16.961 +02:00 [INF] === Headers ===
2025-11-27 01:58:16.962 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:58:16.963 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:58:16.966 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:58:16.968 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:58:16.971 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:58:16.972 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:58:16.974 +02:00 [INF] Postman-Token: ["aa8975dc-cf97-4e1b-bf3f-0c8b1629d626"]
2025-11-27 01:58:16.976 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:58:16.977 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:58:16.978 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP)'
2025-11-27 01:58:16.981 +02:00 [INF] Route matched with {action = "GetById", controller = "PaymentMethods"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(System.Guid) on controller ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController (ModularERP).
2025-11-27 01:58:16.985 +02:00 [INF] GET /api/payment-methods/"112b09ce-1eae-4270-bf6a-42b29cb4c940"
2025-11-27 01:58:16.987 +02:00 [INF] Fetching payment method with ID: "112b09ce-1eae-4270-bf6a-42b29cb4c940"
2025-11-27 01:58:17.017 +02:00 [WRN] Payment method with ID "112b09ce-1eae-4270-bf6a-42b29cb4c940" not found
2025-11-27 01:58:17.020 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP) in 35.1065ms
2025-11-27 01:58:17.022 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP)'
2025-11-27 01:58:17.023 +02:00 [ERR] Application exception occurred: Payment method with ID 112b09ce-1eae-4270-bf6a-42b29cb4c940 not found
ModularERP.Common.Exceptions.NotFoundException: Payment method with ID 112b09ce-1eae-4270-bf6a-42b29cb4c940 not found
   at ModularERP.Modules.Purchases.Payment.Handlers.Handlers_PaymentMethod.GetPaymentMethodByIdQueryHandler.Handle(GetPaymentMethodByIdQuery request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Handlers\Handlers_PaymentMethod\GetPaymentMethodByIdQueryHandler.cs:line 47
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById(Guid id) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Controllers\PaymentMethodsController.cs:line 73
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:58:17.043 +02:00 [INF] Error response sent with status code 404
2025-11-27 01:58:17.045 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PaymentMethods/112b09ce-1eae-4270-bf6a-42b29cb4c940 - 404 null application/json; charset=utf-8 95.2689ms
2025-11-27 01:59:34.331 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PaymentMethods/46187d2b-b8b5-4d3c-b3a9-f839ea5881b9 - null null
2025-11-27 01:59:34.337 +02:00 [INF] Request started
2025-11-27 01:59:34.339 +02:00 [INF] === Incoming Request ===
2025-11-27 01:59:34.340 +02:00 [INF] Path: /api/PaymentMethods/46187d2b-b8b5-4d3c-b3a9-f839ea5881b9
2025-11-27 01:59:34.343 +02:00 [INF] Method: GET
2025-11-27 01:59:34.344 +02:00 [INF] === Headers ===
2025-11-27 01:59:34.346 +02:00 [INF] Accept: ["*/*"]
2025-11-27 01:59:34.347 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 01:59:34.348 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 01:59:34.350 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 01:59:34.352 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 01:59:34.354 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 01:59:34.356 +02:00 [INF] Postman-Token: ["084aefe0-9ed2-4d15-9557-d46dacebbfe3"]
2025-11-27 01:59:34.358 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 01:59:34.360 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 01:59:34.362 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP)'
2025-11-27 01:59:34.364 +02:00 [INF] Route matched with {action = "GetById", controller = "PaymentMethods"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetById(System.Guid) on controller ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController (ModularERP).
2025-11-27 01:59:34.367 +02:00 [INF] GET /api/payment-methods/"46187d2b-b8b5-4d3c-b3a9-f839ea5881b9"
2025-11-27 01:59:34.368 +02:00 [INF] Fetching payment method with ID: "46187d2b-b8b5-4d3c-b3a9-f839ea5881b9"
2025-11-27 01:59:34.391 +02:00 [WRN] Payment method with ID "46187d2b-b8b5-4d3c-b3a9-f839ea5881b9" not found
2025-11-27 01:59:34.394 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP) in 27.5558ms
2025-11-27 01:59:34.396 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById (ModularERP)'
2025-11-27 01:59:34.397 +02:00 [ERR] Application exception occurred: Payment method with ID 46187d2b-b8b5-4d3c-b3a9-f839ea5881b9 not found
ModularERP.Common.Exceptions.NotFoundException: Payment method with ID 46187d2b-b8b5-4d3c-b3a9-f839ea5881b9 not found
   at ModularERP.Modules.Purchases.Payment.Handlers.Handlers_PaymentMethod.GetPaymentMethodByIdQueryHandler.Handle(GetPaymentMethodByIdQuery request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Handlers\Handlers_PaymentMethod\GetPaymentMethodByIdQueryHandler.cs:line 47
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Payment.Controllers.PaymentMethodsController.GetById(Guid id) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Payment\Controllers\PaymentMethodsController.cs:line 73
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 310
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-27 01:59:34.417 +02:00 [INF] Error response sent with status code 404
2025-11-27 01:59:34.418 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PaymentMethods/46187d2b-b8b5-4d3c-b3a9-f839ea5881b9 - 404 null application/json; charset=utf-8 86.7708ms
2025-11-27 02:00:08.589 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PurchaseOrder/{7cae7505-1a01-41ce-9732-625778ba4983} - null null
2025-11-27 02:00:08.593 +02:00 [INF] Request started
2025-11-27 02:00:08.594 +02:00 [INF] === Incoming Request ===
2025-11-27 02:00:08.596 +02:00 [INF] Path: /api/PurchaseOrder/%7B7cae7505-1a01-41ce-9732-625778ba4983%7D
2025-11-27 02:00:08.599 +02:00 [INF] Method: GET
2025-11-27 02:00:08.600 +02:00 [INF] === Headers ===
2025-11-27 02:00:08.602 +02:00 [INF] Accept: ["*/*"]
2025-11-27 02:00:08.603 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 02:00:08.604 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 02:00:08.606 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 02:00:08.607 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 02:00:08.611 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 02:00:08.616 +02:00 [INF] Postman-Token: ["de4757a3-30e4-4bed-893c-980520933cfe"]
2025-11-27 02:00:08.618 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 02:00:08.620 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 02:00:08.622 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.GetPurchaseOrder (ModularERP)'
2025-11-27 02:00:08.626 +02:00 [INF] Route matched with {action = "GetPurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPurchaseOrder(System.Guid) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 02:00:08.636 +02:00 [INF] Retrieving purchase order with ID: "7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 02:00:08.890 +02:00 [INF] Purchase order retrieved successfully: PO-202511-0012
2025-11-27 02:00:08.892 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.PurchaseOrderDetailDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-27 02:00:08.901 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.GetPurchaseOrder (ModularERP) in 270.5312ms
2025-11-27 02:00:08.904 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.GetPurchaseOrder (ModularERP)'
2025-11-27 02:00:08.906 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 02:00:08.907 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PurchaseOrder/{7cae7505-1a01-41ce-9732-625778ba4983} - 200 null application/json; charset=utf-8 318.32ms
2025-11-27 02:03:42.948 +02:00 [INF] Starting web host...
2025-11-27 02:03:44.627 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 02:03:44.723 +02:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-27 02:03:44.814 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 02:03:44.821 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-27 02:03:44.837 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-27 02:03:44.902 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-27 02:03:44.920 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-27 02:03:44.925 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-27 02:03:44.932 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-27 02:03:44.943 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-27 02:03:44.950 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-27 02:03:45.311 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-27 02:03:45.318 +02:00 [INF] Master database initialized successfully
2025-11-27 02:03:47.700 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-27 02:03:47.814 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-27 02:03:47.816 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-27 02:03:47.910 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-27 02:03:47.912 +02:00 [INF] Hosting environment: Development
2025-11-27 02:03:47.913 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-27 02:03:48.427 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-27 02:03:48.586 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 160.5662ms
2025-11-27 02:03:48.646 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-27 02:03:48.646 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-27 02:03:48.652 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.3854ms
2025-11-27 02:03:48.677 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 31.5917ms
2025-11-27 02:03:48.716 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-27 02:03:49.042 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 325.7633ms
2025-11-27 02:06:39.034 +02:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/PurchaseOrder/{id} - multipart/form-data; boundary=--------------------------009983846167388770369012 15676
2025-11-27 02:06:39.051 +02:00 [INF] Request started
2025-11-27 02:06:39.053 +02:00 [INF] === Incoming Request ===
2025-11-27 02:06:39.055 +02:00 [INF] Path: /api/PurchaseOrder/%7Bid%7D
2025-11-27 02:06:39.057 +02:00 [INF] Method: PUT
2025-11-27 02:06:39.058 +02:00 [INF] === Headers ===
2025-11-27 02:06:39.060 +02:00 [INF] Accept: ["*/*"]
2025-11-27 02:06:39.063 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 02:06:39.064 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 02:06:39.066 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 02:06:39.067 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 02:06:39.070 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------009983846167388770369012"]
2025-11-27 02:06:39.071 +02:00 [INF] Content-Length: ["15676"]
2025-11-27 02:06:39.074 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 02:06:39.075 +02:00 [INF] Postman-Token: ["18b84456-2de7-4ccc-b544-f021f53223ad"]
2025-11-27 02:06:39.080 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 02:06:39.083 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 02:06:39.085 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.UpdatePurchaseOrder (ModularERP)'
2025-11-27 02:06:39.108 +02:00 [INF] Route matched with {action = "UpdatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdatePurchaseOrder(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.UpdatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 02:06:39.113 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 02:06:39.160 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-11-27 02:06:39.181 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.UpdatePurchaseOrder (ModularERP) in 68.2344ms
2025-11-27 02:06:39.185 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.UpdatePurchaseOrder (ModularERP)'
2025-11-27 02:06:39.188 +02:00 [INF] Request completed successfully with status code 400
2025-11-27 02:06:39.191 +02:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/PurchaseOrder/{id} - 400 null application/problem+json; charset=utf-8 156.9484ms
2025-11-27 02:10:16.975 +02:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/PurchaseOrder/{7cae7505-1a01-41ce-9732-625778ba4983} - multipart/form-data; boundary=--------------------------206561459819488706856388 15856
2025-11-27 02:10:16.999 +02:00 [INF] Request started
2025-11-27 02:10:17.001 +02:00 [INF] === Incoming Request ===
2025-11-27 02:10:17.002 +02:00 [INF] Path: /api/PurchaseOrder/%7B7cae7505-1a01-41ce-9732-625778ba4983%7D
2025-11-27 02:10:17.003 +02:00 [INF] Method: PUT
2025-11-27 02:10:17.004 +02:00 [INF] === Headers ===
2025-11-27 02:10:17.005 +02:00 [INF] Accept: ["*/*"]
2025-11-27 02:10:17.006 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 02:10:17.009 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 02:10:17.010 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 02:10:17.013 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 02:10:17.014 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------206561459819488706856388"]
2025-11-27 02:10:17.017 +02:00 [INF] Content-Length: ["15856"]
2025-11-27 02:10:17.018 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 02:10:17.020 +02:00 [INF] Postman-Token: ["d15727e1-dc83-4af2-b16d-36f218431783"]
2025-11-27 02:10:17.024 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 02:10:17.025 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 02:10:17.027 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.UpdatePurchaseOrder (ModularERP)'
2025-11-27 02:10:17.028 +02:00 [INF] Route matched with {action = "UpdatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdatePurchaseOrder(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.UpdatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 02:10:17.187 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-27 02:10:17.821 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-27 02:10:17.826 +02:00 [INF] Updating purchase order with ID: "7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 02:10:17.959 +02:00 [INF] Found PO: PO-202511-0012, Status: "Draft"
2025-11-27 02:10:17.995 +02:00 [INF] Validated payment term: Net 30
2025-11-27 02:10:18.053 +02:00 [INF] Validated 1 payment methods
2025-11-27 02:10:18.056 +02:00 [INF] Updated main PO fields
2025-11-27 02:10:18.058 +02:00 [INF] Updating line items for PO: "7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 02:10:18.205 +02:00 [INF] Line items updated successfully
2025-11-27 02:10:18.208 +02:00 [INF] Updating deposits for PO: "7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 02:10:18.263 +02:00 [INF] Deposits updated successfully
2025-11-27 02:10:18.267 +02:00 [INF] Updating shipping charges for PO: "7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 02:10:18.414 +02:00 [INF] Recalculating amounts for PO: "7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 02:10:18.421 +02:00 [INF] Line Items Summary - Gross: 50, Net: 42.50, Tax: 6.3750
2025-11-27 02:10:18.424 +02:00 [INF] After PO Discount - Discount: 2.9750, Net: 39.5250
2025-11-27 02:10:18.427 +02:00 [INF] Grand Total Calculation: Net=39.5250 + Adj=15 + Ship=60 + Tax=15.3750 = 129.9000
2025-11-27 02:10:18.430 +02:00 [INF] âœ… Recalculation Complete - Subtotal: 50, Discount: 2.9750, Adjustment: 15, Shipping: 60, Tax: 15.3750, Total: 129.9000, Deposit: 64.95000, Due: 64.95000
2025-11-27 02:10:18.434 +02:00 [INF] Recalculated amounts - Total: 129.9000, Deposit: 64.95000, Due: 64.95000
2025-11-27 02:10:18.563 +02:00 [INF] Purchase order PO-202511-0012 updated successfully
2025-11-27 02:10:18.566 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-27 02:10:18.575 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.UpdatePurchaseOrder (ModularERP) in 1542.7197ms
2025-11-27 02:10:18.579 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.UpdatePurchaseOrder (ModularERP)'
2025-11-27 02:10:18.580 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 02:10:18.584 +02:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/PurchaseOrder/{7cae7505-1a01-41ce-9732-625778ba4983} - 200 null application/json; charset=utf-8 1608.43ms
2025-11-27 02:11:17.585 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder/{7cae7505-1a01-41ce-9732-625778ba4983}/submit - application/json 61
2025-11-27 02:11:17.589 +02:00 [INF] Request started
2025-11-27 02:11:17.590 +02:00 [INF] === Incoming Request ===
2025-11-27 02:11:17.591 +02:00 [INF] Path: /api/PurchaseOrder/%7B7cae7505-1a01-41ce-9732-625778ba4983%7D/submit
2025-11-27 02:11:17.593 +02:00 [INF] Method: POST
2025-11-27 02:11:17.594 +02:00 [INF] === Headers ===
2025-11-27 02:11:17.595 +02:00 [INF] Accept: ["*/*"]
2025-11-27 02:11:17.597 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 02:11:17.598 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 02:11:17.599 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 02:11:17.601 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 02:11:17.602 +02:00 [INF] Content-Type: ["application/json"]
2025-11-27 02:11:17.603 +02:00 [INF] Content-Length: ["61"]
2025-11-27 02:11:17.605 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 02:11:17.606 +02:00 [INF] Postman-Token: ["77990828-33ad-4cfb-ba91-e02f376e508a"]
2025-11-27 02:11:17.608 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 02:11:17.610 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 02:11:17.611 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.SubmitPurchaseOrder (ModularERP)'
2025-11-27 02:11:17.616 +02:00 [INF] Route matched with {action = "SubmitPurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SubmitPurchaseOrder(System.Guid, SubmitPurchaseOrderRequest) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 02:11:17.631 +02:00 [INF] Submitting purchase order with ID: "7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 02:11:17.665 +02:00 [INF] Purchase order PO-202511-0012 submitted successfully
2025-11-27 02:11:17.666 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-27 02:11:17.668 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.SubmitPurchaseOrder (ModularERP) in 49.4758ms
2025-11-27 02:11:17.670 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.SubmitPurchaseOrder (ModularERP)'
2025-11-27 02:11:17.672 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 02:11:17.676 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder/{7cae7505-1a01-41ce-9732-625778ba4983}/submit - 200 null application/json; charset=utf-8 90.7636ms
2025-11-27 02:11:38.981 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder/{7cae7505-1a01-41ce-9732-625778ba4983}/approve - application/json 90
2025-11-27 02:11:38.986 +02:00 [INF] Request started
2025-11-27 02:11:38.986 +02:00 [INF] === Incoming Request ===
2025-11-27 02:11:38.987 +02:00 [INF] Path: /api/PurchaseOrder/%7B7cae7505-1a01-41ce-9732-625778ba4983%7D/approve
2025-11-27 02:11:38.989 +02:00 [INF] Method: POST
2025-11-27 02:11:38.991 +02:00 [INF] === Headers ===
2025-11-27 02:11:38.991 +02:00 [INF] Accept: ["*/*"]
2025-11-27 02:11:38.993 +02:00 [INF] Connection: ["keep-alive"]
2025-11-27 02:11:38.994 +02:00 [INF] Host: ["localhost:7168"]
2025-11-27 02:11:38.996 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-27 02:11:38.997 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-27 02:11:38.998 +02:00 [INF] Content-Type: ["application/json"]
2025-11-27 02:11:39.000 +02:00 [INF] Content-Length: ["90"]
2025-11-27 02:11:39.002 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-27 02:11:39.003 +02:00 [INF] Postman-Token: ["a71c9eab-e0e0-4d02-a8ca-c99639977ceb"]
2025-11-27 02:11:39.005 +02:00 [INF] ðŸ” TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-27 02:11:39.006 +02:00 [INF] âœ… Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-27 02:11:39.007 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.ApprovePurchaseOrder (ModularERP)'
2025-11-27 02:11:39.011 +02:00 [INF] Route matched with {action = "ApprovePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ApprovePurchaseOrder(System.Guid, ApprovePurchaseOrderRequest) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-27 02:11:39.021 +02:00 [INF] Approving purchase order with ID: "7cae7505-1a01-41ce-9732-625778ba4983"
2025-11-27 02:11:39.035 +02:00 [INF] Purchase order PO-202511-0012 approved successfully
2025-11-27 02:11:39.038 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-27 02:11:39.039 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.ApprovePurchaseOrder (ModularERP) in 25.5479ms
2025-11-27 02:11:39.041 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.ApprovePurchaseOrder (ModularERP)'
2025-11-27 02:11:39.043 +02:00 [INF] Request completed successfully with status code 200
2025-11-27 02:11:39.045 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder/{7cae7505-1a01-41ce-9732-625778ba4983}/approve - 200 null application/json; charset=utf-8 63.6688ms
