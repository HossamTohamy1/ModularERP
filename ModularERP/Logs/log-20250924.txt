2025-09-24 13:17:47.657 +03:00 [INF] Starting web host...
2025-09-24 13:17:48.519 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:17:48.562 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 13:17:48.635 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:17:48.640 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 13:17:48.644 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 13:17:48.705 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 13:17:48.722 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:17:48.726 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 13:17:48.733 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 13:17:48.744 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 13:17:48.748 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 13:17:48.946 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 13:17:48.952 +03:00 [INF] Master database initialized successfully
2025-09-24 13:17:49.262 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 13:17:49.263 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 13:17:49.337 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 13:17:49.339 +03:00 [INF] Hosting environment: Development
2025-09-24 13:17:49.341 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 13:17:49.804 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 13:17:50.334 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 533.5713ms
2025-09-24 13:17:50.350 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 13:17:50.380 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 13:17:50.571 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 221.4934ms
2025-09-24 13:17:50.646 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 265.4975ms
2025-09-24 13:17:50.763 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 13:17:50.838 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 74.3599ms
2025-09-24 13:22:11.018 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/GlAccount - null null
2025-09-24 13:22:11.037 +03:00 [INF] Request started
2025-09-24 13:22:11.041 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:22:11.045 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.GetAllGlAccounts (ModularERP)'
2025-09-24 13:22:11.071 +03:00 [INF] Route matched with {action = "GetAllGlAccounts", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]]] GetAllGlAccounts(System.Nullable`1[System.Guid], System.String, Int32, Int32) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:22:11.077 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:22:11.092 +03:00 [INF] Received request to get GLAccounts - CompanyId: null, SearchTerm: null, Page: 1, Size: 10
2025-09-24 13:22:11.210 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:22:11.833 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:22:11.837 +03:00 [INF] Retrieving GLAccounts with CompanyId: null, SearchTerm: null, Page: 1, PageSize: 10
2025-09-24 13:22:11.929 +03:00 [INF] Retrieved 0 GLAccounts successfully
2025-09-24 13:22:11.937 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-09-24 13:22:11.961 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.GetAllGlAccounts (ModularERP) in 885.1201ms
2025-09-24 13:22:11.964 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.GetAllGlAccounts (ModularERP)'
2025-09-24 13:22:11.967 +03:00 [INF] Request completed successfully with status code 200
2025-09-24 13:22:11.972 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/GlAccount - 200 null application/json; charset=utf-8 953.7138ms
2025-09-24 13:23:59.620 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GlAccount - application/json 138
2025-09-24 13:23:59.625 +03:00 [INF] Request started
2025-09-24 13:23:59.631 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 13:23:59.633 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.CreateGlAccount (ModularERP)'
2025-09-24 13:23:59.645 +03:00 [INF] Route matched with {action = "CreateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] CreateGlAccount(ModularERP.Modules.Finance.Features.GlAccounts.DTO.CreateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:23:59.667 +03:00 [INF] Received request to create GLAccount with Code: GlAccount_120
2025-09-24 13:23:59.715 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:23:59.800 +03:00 [INF] Starting GLAccount creation process for Code: GlAccount_120, Company: "dc1360f6-c029-4e44-9ec2-1a6d59479f99"
2025-09-24 13:23:59.945 +03:00 [INF] GLAccount created successfully with ID: "e767c31a-c4e4-4f6d-8418-08ddfb5479f3", Code: GlAccount_120
2025-09-24 13:23:59.964 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 13:23:59.984 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.CreateGlAccount (ModularERP) in 334.3296ms
2025-09-24 13:23:59.986 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.CreateGlAccount (ModularERP)'
2025-09-24 13:23:59.988 +03:00 [INF] Request completed successfully with status code 201
2025-09-24 13:23:59.989 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GlAccount - 201 null application/json; charset=utf-8 368.7829ms
2025-09-24 13:24:53.080 +03:00 [INF] Request starting HTTP/2 PUT https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - application/json 176
2025-09-24 13:24:53.085 +03:00 [INF] CORS policy execution successful.
2025-09-24 13:24:53.088 +03:00 [INF] Request started
2025-09-24 13:24:53.093 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 13:24:53.094 +03:00 [INF] Request finished HTTP/2 PUT https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - 400 null application/json 13.9265ms
2025-09-24 13:25:30.885 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - application/json 187
2025-09-24 13:25:30.889 +03:00 [INF] Request started
2025-09-24 13:25:30.890 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 13:25:30.891 +03:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-09-24 13:25:30.893 +03:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-09-24 13:25:30.895 +03:00 [INF] Request completed successfully with status code 405
2025-09-24 13:25:30.896 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - 405 0 null 11.1118ms
2025-09-24 13:26:49.623 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - application/json 187
2025-09-24 13:26:49.626 +03:00 [INF] Request started
2025-09-24 13:26:49.627 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:26:49.628 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:26:49.635 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:26:49.644 +03:00 [INF] Received request to update GLAccount with ID: "e767c31a-c4e4-4f6d-8418-08ddfb5479f3"
2025-09-24 13:26:49.659 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:26:49.673 +03:00 [INF] Starting GLAccount update process for ID: "e767c31a-c4e4-4f6d-8418-08ddfb5479f3", Code: GlAccount_140
2025-09-24 13:26:49.699 +03:00 [WRN] GLAccount update failed - Account with ID "e767c31a-c4e4-4f6d-8418-08ddfb5479f3" not found
2025-09-24 13:26:49.705 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 66.0273ms
2025-09-24 13:26:49.708 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:26:49.712 +03:00 [ERR] Application exception occurred: GLAccount with ID 'e767c31a-c4e4-4f6d-8418-08ddfb5479f3' not found
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID 'e767c31a-c4e4-4f6d-8418-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 40
   at ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount(Guid id, UpdateGlAccountDto updateDto) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Controllers\GlAccountController.cs:line 48
   at lambda_method290(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 229
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-24 13:26:49.761 +03:00 [INF] Error response sent with status code 404
2025-09-24 13:26:49.764 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - 404 null application/json; charset=utf-8 141.7788ms
2025-09-24 13:27:13.345 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - application/json 187
2025-09-24 13:27:13.349 +03:00 [INF] Request started
2025-09-24 13:27:13.350 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:27:13.351 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:27:13.352 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:27:13.355 +03:00 [INF] Received request to update GLAccount with ID: "e767c31a-c4e4-4f6d-8418-08ddfb5479f3"
2025-09-24 13:27:13.357 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:27:13.360 +03:00 [INF] Starting GLAccount update process for ID: "e767c31a-c4e4-4f6d-8418-08ddfb5479f3", Code: GlAccount_140
2025-09-24 13:27:13.363 +03:00 [WRN] GLAccount update failed - Account with ID "e767c31a-c4e4-4f6d-8418-08ddfb5479f3" not found
2025-09-24 13:27:13.364 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 9.5179ms
2025-09-24 13:27:13.366 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:27:13.368 +03:00 [ERR] Application exception occurred: GLAccount with ID 'e767c31a-c4e4-4f6d-8418-08ddfb5479f3' not found
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID 'e767c31a-c4e4-4f6d-8418-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 40
   at ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount(Guid id, UpdateGlAccountDto updateDto) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Controllers\GlAccountController.cs:line 48
   at lambda_method290(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 229
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-24 13:27:13.377 +03:00 [INF] Error response sent with status code 404
2025-09-24 13:27:13.378 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - 404 null application/json; charset=utf-8 33.0327ms
2025-09-24 13:28:26.002 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - application/json 181
2025-09-24 13:28:26.005 +03:00 [INF] Request started
2025-09-24 13:28:26.006 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:28:26.007 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:28:26.009 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:28:26.012 +03:00 [INF] Received request to update GLAccount with ID: "e767c31a-c4e4-4f6d-8418-08ddfb5479f3"
2025-09-24 13:28:26.036 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:28:26.040 +03:00 [INF] Starting GLAccount update process for ID: "e767c31a-c4e4-4f6d-8418-08ddfb5479f3", Code: anyyy
2025-09-24 13:28:26.062 +03:00 [WRN] GLAccount update failed - Account with ID "e767c31a-c4e4-4f6d-8418-08ddfb5479f3" not found
2025-09-24 13:28:26.064 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 52.4819ms
2025-09-24 13:28:26.066 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:28:26.067 +03:00 [ERR] Application exception occurred: GLAccount with ID 'e767c31a-c4e4-4f6d-8418-08ddfb5479f3' not found
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID 'e767c31a-c4e4-4f6d-8418-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 40
   at ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount(Guid id, UpdateGlAccountDto updateDto) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Controllers\GlAccountController.cs:line 48
   at lambda_method290(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 229
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-24 13:28:26.076 +03:00 [INF] Error response sent with status code 404
2025-09-24 13:28:26.077 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - 404 null application/json; charset=utf-8 75.8195ms
2025-09-24 13:28:49.942 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - application/json 181
2025-09-24 13:28:49.945 +03:00 [INF] Request started
2025-09-24 13:28:49.946 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:28:49.948 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:28:49.949 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:28:49.953 +03:00 [INF] Received request to update GLAccount with ID: "e767c31a-c4e4-4f6d-8418-08ddfb5479f3"
2025-09-24 13:28:49.967 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:28:49.972 +03:00 [INF] Starting GLAccount update process for ID: "e767c31a-c4e4-4f6d-8418-08ddfb5479f3", Code: anyyy
2025-09-24 13:28:49.983 +03:00 [WRN] GLAccount update failed - Account with ID "e767c31a-c4e4-4f6d-8418-08ddfb5479f3" not found
2025-09-24 13:28:49.986 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 33.0466ms
2025-09-24 13:28:49.987 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:28:49.989 +03:00 [ERR] Application exception occurred: GLAccount with ID 'e767c31a-c4e4-4f6d-8418-08ddfb5479f3' not found
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID 'e767c31a-c4e4-4f6d-8418-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 40
   at ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount(Guid id, UpdateGlAccountDto updateDto) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Controllers\GlAccountController.cs:line 48
   at lambda_method290(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 229
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-24 13:28:49.998 +03:00 [INF] Error response sent with status code 404
2025-09-24 13:28:49.999 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/e767c31a-c4e4-4f6d-8418-08ddfb5479f3 - 404 null application/json; charset=utf-8 57.3721ms
2025-09-24 13:31:02.586 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GlAccount - application/json 141
2025-09-24 13:31:02.591 +03:00 [INF] Request started
2025-09-24 13:31:02.592 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 13:31:02.593 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.CreateGlAccount (ModularERP)'
2025-09-24 13:31:02.594 +03:00 [INF] Route matched with {action = "CreateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] CreateGlAccount(ModularERP.Modules.Finance.Features.GlAccounts.DTO.CreateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:31:02.597 +03:00 [INF] Received request to create GLAccount with Code: GlAccount_1540
2025-09-24 13:31:02.599 +03:00 [INF] Starting GLAccount creation process for Code: GlAccount_1540, Company: "dc1360f6-c029-4e44-9ec2-1a6d59479f99"
2025-09-24 13:31:02.630 +03:00 [INF] GLAccount created successfully with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3", Code: GlAccount_1540
2025-09-24 13:31:02.635 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 13:31:02.638 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.CreateGlAccount (ModularERP) in 40.8254ms
2025-09-24 13:31:02.640 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.CreateGlAccount (ModularERP)'
2025-09-24 13:31:02.641 +03:00 [INF] Request completed successfully with status code 201
2025-09-24 13:31:02.642 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GlAccount - 201 null application/json; charset=utf-8 56.5701ms
2025-09-24 13:31:18.942 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3c8cd441-a748-44a9-8419-08ddfb5479f3 - application/json 181
2025-09-24 13:31:18.946 +03:00 [INF] Request started
2025-09-24 13:31:18.947 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:31:18.948 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:31:18.949 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:31:18.953 +03:00 [INF] Received request to update GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
2025-09-24 13:31:18.957 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:31:18.961 +03:00 [INF] Starting GLAccount update process for ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3", Code: anyyy
2025-09-24 13:31:18.965 +03:00 [WRN] GLAccount update failed - Account with ID "3c8cd441-a748-44a9-8419-08ddfb5479f3" not found
2025-09-24 13:31:18.966 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 13.7409ms
2025-09-24 13:31:18.968 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:31:18.969 +03:00 [ERR] Application exception occurred: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 40
   at ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount(Guid id, UpdateGlAccountDto updateDto) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Controllers\GlAccountController.cs:line 48
   at lambda_method290(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 229
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-24 13:31:18.978 +03:00 [INF] Error response sent with status code 404
2025-09-24 13:31:18.980 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3c8cd441-a748-44a9-8419-08ddfb5479f3 - 404 null application/json; charset=utf-8 37.2392ms
2025-09-24 13:34:52.641 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - application/json 181
2025-09-24 13:34:52.645 +03:00 [INF] Request started
2025-09-24 13:34:52.646 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:34:52.647 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:34:52.649 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:34:52.652 +03:00 [INF] Received request to update GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
2025-09-24 13:34:52.677 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:34:52.684 +03:00 [INF] Starting GLAccount update process for ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3", Code: anyyy
2025-09-24 13:34:52.703 +03:00 [WRN] GLAccount update failed - Account with ID "3c8cd441-a748-44a9-8419-08ddfb5479f3" not found
2025-09-24 13:34:52.709 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 57.2911ms
2025-09-24 13:34:52.711 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:34:52.712 +03:00 [ERR] Application exception occurred: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 40
   at ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount(Guid id, UpdateGlAccountDto updateDto) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Controllers\GlAccountController.cs:line 48
   at lambda_method290(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 229
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-24 13:34:52.721 +03:00 [INF] Error response sent with status code 404
2025-09-24 13:34:52.723 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - 404 null application/json; charset=utf-8 82.1399ms
2025-09-24 13:39:07.232 +03:00 [INF] Starting web host...
2025-09-24 13:39:08.041 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:39:08.130 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 13:39:08.205 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:39:08.211 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 13:39:08.228 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 13:39:08.284 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 13:39:08.300 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:39:08.304 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 13:39:08.311 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 13:39:08.324 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 13:39:08.330 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 13:39:08.510 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 13:39:08.523 +03:00 [INF] Master database initialized successfully
2025-09-24 13:39:08.706 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 13:39:08.708 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 13:39:08.769 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 13:39:08.772 +03:00 [INF] Hosting environment: Development
2025-09-24 13:39:08.773 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 13:39:09.160 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 13:39:09.281 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 121.3161ms
2025-09-24 13:39:09.335 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 13:39:09.335 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 13:39:09.351 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.5077ms
2025-09-24 13:39:09.367 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 32.5846ms
2025-09-24 13:39:09.422 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 13:39:09.495 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 73.1187ms
2025-09-24 13:39:12.342 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - application/json 181
2025-09-24 13:39:12.359 +03:00 [INF] Request started
2025-09-24 13:39:12.364 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:39:12.367 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:39:12.385 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:39:12.390 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:39:12.414 +03:00 [INF] Received request to update GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
2025-09-24 13:39:12.504 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:39:13.025 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:39:13.030 +03:00 [INF] ==> Starting GLAccount update process
2025-09-24 13:39:13.088 +03:00 [WRN] GLAccount update failed - Account with ID "3c8cd441-a748-44a9-8419-08ddfb5479f3" not found
2025-09-24 13:39:13.091 +03:00 [WRN] NotFoundException occurred while updating GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 42
2025-09-24 13:39:13.114 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 722.9436ms
2025-09-24 13:39:13.117 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:39:13.120 +03:00 [ERR] Application exception occurred: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 42
   at ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount(Guid id, UpdateGlAccountDto updateDto) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Controllers\GlAccountController.cs:line 48
   at lambda_method11(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 229
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-24 13:39:13.152 +03:00 [INF] Error response sent with status code 404
2025-09-24 13:39:13.159 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - 404 null application/json; charset=utf-8 816.9392ms
2025-09-24 13:42:45.534 +03:00 [INF] Starting web host...
2025-09-24 13:42:46.404 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:42:46.497 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 13:42:46.584 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:42:46.590 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 13:42:46.599 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 13:42:46.653 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 13:42:46.668 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:42:46.673 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 13:42:46.680 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 13:42:46.692 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 13:42:46.698 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 13:42:46.855 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 13:42:46.864 +03:00 [INF] Master database initialized successfully
2025-09-24 13:42:47.007 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 13:42:47.009 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 13:42:47.068 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 13:42:47.069 +03:00 [INF] Hosting environment: Development
2025-09-24 13:42:47.071 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 13:42:47.464 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 13:42:47.570 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 107.01ms
2025-09-24 13:42:47.710 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 13:42:47.710 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 13:42:47.719 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.5089ms
2025-09-24 13:42:47.737 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.9428ms
2025-09-24 13:42:47.796 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 13:42:47.842 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 45.3236ms
2025-09-24 13:42:56.053 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - application/json 181
2025-09-24 13:42:56.070 +03:00 [INF] Request started
2025-09-24 13:42:56.075 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:42:56.079 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:42:56.094 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:42:56.100 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:42:56.125 +03:00 [INF] Received request to update GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
2025-09-24 13:42:56.222 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:42:56.786 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:42:56.846 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 13:42:56.864 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 764.4566ms
2025-09-24 13:42:56.868 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:42:56.870 +03:00 [INF] Request completed successfully with status code 200
2025-09-24 13:42:56.876 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - 200 null application/json; charset=utf-8 822.8815ms
2025-09-24 13:43:51.119 +03:00 [INF] Starting web host...
2025-09-24 13:43:51.936 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:43:51.990 +03:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 13:43:52.071 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:43:52.076 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 13:43:52.086 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 13:43:52.142 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 13:43:52.157 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:43:52.162 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 13:43:52.170 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 13:43:52.182 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 13:43:52.187 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 13:43:52.371 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 13:43:52.380 +03:00 [INF] Master database initialized successfully
2025-09-24 13:43:52.536 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 13:43:52.538 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 13:43:52.594 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 13:43:52.597 +03:00 [INF] Hosting environment: Development
2025-09-24 13:43:52.599 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 13:43:53.082 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 13:43:53.188 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 107.548ms
2025-09-24 13:43:53.256 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 13:43:53.256 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 13:43:53.266 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.8053ms
2025-09-24 13:43:53.284 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.7311ms
2025-09-24 13:43:53.312 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 13:43:53.356 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 44.2008ms
2025-09-24 13:43:57.206 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - application/json 181
2025-09-24 13:43:57.224 +03:00 [INF] Request started
2025-09-24 13:43:57.229 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:43:57.232 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:43:57.251 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:43:57.258 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:43:57.283 +03:00 [INF] Received request to update GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
2025-09-24 13:43:57.375 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:43:58.082 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:43:58.088 +03:00 [INF] ==> Starting GLAccount update process
2025-09-24 13:43:58.146 +03:00 [WRN] GLAccount update failed - Account with ID "3c8cd441-a748-44a9-8419-08ddfb5479f3" not found
2025-09-24 13:43:58.148 +03:00 [WRN] NotFoundException occurred while updating GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 42
2025-09-24 13:43:58.174 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 914.6936ms
2025-09-24 13:43:58.176 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:43:58.179 +03:00 [ERR] Application exception occurred: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 42
   at ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount(Guid id, UpdateGlAccountDto updateDto) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Controllers\GlAccountController.cs:line 48
   at lambda_method11(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 229
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-24 13:43:58.220 +03:00 [INF] Error response sent with status code 404
2025-09-24 13:43:58.226 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - 404 null application/json; charset=utf-8 1019.9022ms
2025-09-24 13:44:08.046 +03:00 [INF] Starting web host...
2025-09-24 13:44:08.867 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:44:08.936 +03:00 [INF] Executed DbCommand (50ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 13:44:09.020 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:44:09.026 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 13:44:09.040 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 13:44:09.099 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 13:44:09.115 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:44:09.120 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 13:44:09.127 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 13:44:09.140 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 13:44:09.144 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 13:44:09.314 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 13:44:09.321 +03:00 [INF] Master database initialized successfully
2025-09-24 13:44:09.451 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 13:44:09.454 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 13:44:09.513 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 13:44:09.515 +03:00 [INF] Hosting environment: Development
2025-09-24 13:44:09.534 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 13:44:09.995 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 13:44:10.103 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 109.777ms
2025-09-24 13:44:10.135 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 13:44:10.135 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 13:44:10.149 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.4602ms
2025-09-24 13:44:10.164 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.7049ms
2025-09-24 13:44:10.191 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 13:44:10.237 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 46.3028ms
2025-09-24 13:44:12.605 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - application/json 181
2025-09-24 13:44:12.620 +03:00 [INF] Request started
2025-09-24 13:44:12.623 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:44:12.626 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:44:12.643 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:44:12.650 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:44:12.676 +03:00 [INF] Received request to update GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
2025-09-24 13:44:12.780 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:44:13.338 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:44:13.418 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 13:44:13.437 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 786.9745ms
2025-09-24 13:44:13.441 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:44:13.442 +03:00 [INF] Request completed successfully with status code 200
2025-09-24 13:44:13.449 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - 200 null application/json; charset=utf-8 844.1387ms
2025-09-24 13:49:34.212 +03:00 [INF] Starting web host...
2025-09-24 13:49:35.060 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:49:35.129 +03:00 [INF] Executed DbCommand (52ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 13:49:35.215 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:49:35.223 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 13:49:35.239 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 13:49:35.295 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 13:49:35.311 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 13:49:35.316 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 13:49:35.323 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 13:49:35.334 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 13:49:35.341 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 13:49:35.522 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 13:49:35.529 +03:00 [INF] Master database initialized successfully
2025-09-24 13:49:35.677 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 13:49:35.679 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 13:49:35.744 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 13:49:35.746 +03:00 [INF] Hosting environment: Development
2025-09-24 13:49:35.748 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 13:49:36.186 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 13:49:36.307 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 121.657ms
2025-09-24 13:49:36.466 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 13:49:36.466 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 13:49:36.477 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.0331ms
2025-09-24 13:49:36.495 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.9585ms
2025-09-24 13:49:36.556 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 13:49:36.605 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 49.1833ms
2025-09-24 13:49:37.798 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - application/json 181
2025-09-24 13:49:37.813 +03:00 [INF] Request started
2025-09-24 13:49:37.817 +03:00 [INF] Processing request for tenant: 0794b76b-6560-41a1-a146-7e059ed3c64f
2025-09-24 13:49:37.820 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:49:37.836 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:49:37.842 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:49:37.867 +03:00 [INF] Received request to update GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
2025-09-24 13:49:37.999 +03:00 [INF] Executed DbCommand (38ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:49:38.578 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 13:49:38.582 +03:00 [INF] ==> Starting GLAccount update process
2025-09-24 13:49:38.636 +03:00 [WRN] GLAccount update failed - Account with ID "3c8cd441-a748-44a9-8419-08ddfb5479f3" not found
2025-09-24 13:49:38.639 +03:00 [WRN] NotFoundException occurred while updating GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 42
2025-09-24 13:49:38.661 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 818.8184ms
2025-09-24 13:49:38.663 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:49:38.667 +03:00 [ERR] Application exception occurred: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
ModularERP.Common.Exceptions.NotFoundException: GLAccount with ID '3c8cd441-a748-44a9-8419-08ddfb5479f3' not found
   at ModularERP.Modules.Finance.Features.GlAccounts.Handlers.UpdateGlAccountHandler.Handle(UpdateGlAccountCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Handlers\UpdateGlAccountHandler.cs:line 42
   at ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount(Guid id, UpdateGlAccountDto updateDto) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\GlAccounts\Controllers\GlAccountController.cs:line 48
   at lambda_method11(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 229
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-09-24 13:49:38.701 +03:00 [INF] Error response sent with status code 404
2025-09-24 13:49:38.709 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - 404 null application/json; charset=utf-8 910.3395ms
2025-09-24 13:55:19.258 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - application/json 181
2025-09-24 13:55:19.267 +03:00 [INF] Request started
2025-09-24 13:55:19.271 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 13:55:19.273 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:55:19.275 +03:00 [INF] Route matched with {action = "UpdateGlAccount", controller = "GlAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto]]] UpdateGlAccount(System.Guid, ModularERP.Modules.Finance.Features.GlAccounts.DTO.UpdateGlAccountDto) on controller ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController (ModularERP).
2025-09-24 13:55:19.280 +03:00 [INF] Received request to update GLAccount with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
2025-09-24 13:55:19.342 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 13:55:19.420 +03:00 [INF] ==> Starting GLAccount update process
2025-09-24 13:55:19.550 +03:00 [INF] Changes saved successfully for GLAccount ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3"
2025-09-24 13:55:19.589 +03:00 [INF] GLAccount updated successfully with ID: "3c8cd441-a748-44a9-8419-08ddfb5479f3", Code: anyyy
2025-09-24 13:55:19.596 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.GlAccounts.DTO.GlAccountResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 13:55:19.608 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP) in 328.9089ms
2025-09-24 13:55:19.612 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.GlAccounts.Controllers.GlAccountController.UpdateGlAccount (ModularERP)'
2025-09-24 13:55:19.613 +03:00 [INF] Request completed successfully with status code 200
2025-09-24 13:55:19.614 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/GlAccount/3C8CD441-A748-44A9-8419-08DDFB5479F3 - 200 null application/json; charset=utf-8 355.9583ms
2025-09-24 15:36:50.280 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------250223278079711657965186 1685
2025-09-24 15:36:50.288 +03:00 [INF] Request started
2025-09-24 15:36:50.291 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 15:36:50.292 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 15:36:50.310 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 15:36:50.368 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 15:36:50.434 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14555","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"95cf80e4-c946-42fa-8d66-343f371b0987","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 15:36:50.474 +03:00 [INF] Validation passed successfully.
2025-09-24 15:36:50.556 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 15:36:50.566 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 250.7499ms
2025-09-24 15:36:50.570 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 15:36:50.572 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 15:36:50.574 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 293.3679ms
2025-09-24 15:37:17.232 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 15:37:17.269 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 36.4451ms
2025-09-24 15:37:17.282 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 15:37:17.305 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 15:37:17.313 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 31.0656ms
2025-09-24 15:37:17.333 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.0974ms
2025-09-24 15:37:17.536 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 15:37:17.582 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 45.7288ms
2025-09-24 15:37:21.800 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------624991178743208532062092 1685
2025-09-24 15:37:21.806 +03:00 [INF] Request started
2025-09-24 15:37:21.807 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 15:37:21.808 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 15:37:21.811 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 15:37:21.821 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14555","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"95cf80e4-c946-42fa-8d66-343f371b0987","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 15:37:21.835 +03:00 [INF] Validation passed successfully.
2025-09-24 15:37:21.861 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 15:37:21.864 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 49.3305ms
2025-09-24 15:37:21.866 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 15:37:21.869 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 15:37:21.873 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 72.4332ms
2025-09-24 15:55:31.293 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------871396178874023382115323 1685
2025-09-24 15:55:31.298 +03:00 [INF] Request started
2025-09-24 15:55:31.300 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 15:55:31.300 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 15:55:31.302 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 15:55:31.340 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14555","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"95cf80e4-c946-42fa-8d66-343f371b0987","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 15:55:31.353 +03:00 [INF] Validation passed successfully.
2025-09-24 15:55:31.364 +03:00 [INF] Business validations passed successfully.
2025-09-24 15:55:31.382 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
System.InvalidOperationException: Bank account does not have a GL account assigned
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Service.ExpenseVoucherService.GetWalletControlAccountIdAsync(Guid walletId, String walletType) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Service\ExpenseVoucherService.cs:line 109
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 124
2025-09-24 15:55:31.387 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 15:55:31.389 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 81.0926ms
2025-09-24 15:55:31.391 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 15:55:31.395 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 15:55:31.397 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 103.2111ms
2025-09-24 15:55:55.529 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------820652942365231517235459 1685
2025-09-24 15:55:55.533 +03:00 [INF] Request started
2025-09-24 15:55:55.535 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 15:55:55.536 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 15:55:55.538 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 15:55:55.545 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14555","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"95cf80e4-c946-42fa-8d66-343f371b0987","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 15:55:55.560 +03:00 [INF] Validation passed successfully.
2025-09-24 15:55:55.565 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 15:55:55.567 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 24.0289ms
2025-09-24 15:55:55.572 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 15:55:55.574 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 15:55:55.575 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 45.9777ms
2025-09-24 15:56:10.543 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 15:56:10.550 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 6.8531ms
2025-09-24 15:56:10.562 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 15:56:10.562 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 15:56:10.569 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 6.9899ms
2025-09-24 15:56:10.570 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.2263ms
2025-09-24 15:56:10.742 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 15:56:10.771 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 28.566ms
2025-09-24 15:56:18.856 +03:00 [INF] Starting web host...
2025-09-24 15:56:19.750 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 15:56:19.842 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 15:56:19.912 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 15:56:19.919 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 15:56:19.935 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 15:56:19.998 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 15:56:20.015 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 15:56:20.019 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 15:56:20.025 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 15:56:20.036 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 15:56:20.040 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 15:56:20.212 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 15:56:20.219 +03:00 [INF] Master database initialized successfully
2025-09-24 15:56:20.373 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 15:56:20.374 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 15:56:20.433 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 15:56:20.435 +03:00 [INF] Hosting environment: Development
2025-09-24 15:56:20.436 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 15:56:20.905 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 15:56:21.013 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 108.5559ms
2025-09-24 15:56:21.064 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 15:56:21.064 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 15:56:21.086 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.9139ms
2025-09-24 15:56:21.092 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 28.1529ms
2025-09-24 15:56:21.114 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 15:56:21.165 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 51.0572ms
2025-09-24 15:56:40.455 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------035090309133329792987967 1685
2025-09-24 15:56:40.469 +03:00 [INF] Request started
2025-09-24 15:56:40.474 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 15:56:40.477 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 15:56:40.493 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 15:56:40.499 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 15:56:40.691 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 15:56:41.354 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 15:56:41.398 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14555","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"95cf80e4-c946-42fa-8d66-343f371b0987","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 15:56:41.441 +03:00 [INF] Validation passed successfully.
2025-09-24 15:56:41.555 +03:00 [INF] Business validations passed successfully.
2025-09-24 15:56:41.577 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
System.InvalidOperationException: Bank account does not have a GL account assigned
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Service.ExpenseVoucherService.GetWalletControlAccountIdAsync(Guid walletId, String walletType) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Service\ExpenseVoucherService.cs:line 109
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 124
2025-09-24 15:56:41.593 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 15:56:41.612 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1113.0414ms
2025-09-24 15:56:41.615 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 15:56:41.616 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 15:56:41.622 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1167.2118ms
2025-09-24 16:58:49.100 +03:00 [INF] Starting web host...
2025-09-24 16:58:49.874 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 16:58:49.955 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 16:58:50.029 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 16:58:50.035 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 16:58:50.054 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 16:58:50.109 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 16:58:50.125 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 16:58:50.130 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 16:58:50.137 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 16:58:50.149 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 16:58:50.156 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 16:58:50.356 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 16:58:50.364 +03:00 [INF] Master database initialized successfully
2025-09-24 16:58:50.507 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 16:58:50.509 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 16:58:50.568 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 16:58:50.570 +03:00 [INF] Hosting environment: Development
2025-09-24 16:58:50.573 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 16:58:51.025 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 16:58:51.130 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 105.8301ms
2025-09-24 16:58:51.134 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 16:58:51.134 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 16:58:51.154 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.7813ms
2025-09-24 16:58:51.170 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 36.1785ms
2025-09-24 16:58:51.210 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 16:58:51.283 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 73.568ms
2025-09-24 16:58:55.767 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 16:58:55.774 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 7.4131ms
2025-09-24 16:58:55.782 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 16:58:55.782 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 16:58:55.793 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.2491ms
2025-09-24 16:58:55.796 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 13.6324ms
2025-09-24 16:58:55.834 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 16:58:55.878 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 43.9693ms
2025-09-24 16:59:27.693 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/BankAccount - application/json 333
2025-09-24 16:59:27.706 +03:00 [INF] Request started
2025-09-24 16:59:27.712 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 16:59:27.715 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.BankAccounts.Controllers.BankAccountController.CreateBankAccount (ModularERP)'
2025-09-24 16:59:27.729 +03:00 [INF] Route matched with {action = "CreateBankAccount", controller = "BankAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.BankAccounts.DTO.BankAccountCreatedDto]]] CreateBankAccount(ModularERP.Modules.Finance.Features.BankAccounts.DTO.CreateBankAccountDto) on controller ModularERP.Modules.Finance.Features.BankAccounts.Controllers.BankAccountController (ModularERP).
2025-09-24 16:59:27.735 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 16:59:27.881 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 16:59:28.381 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 16:59:28.387 +03:00 [INF] Received CreateBankAccountCommand for TenantId: 7579736e-aa3f-49f9-9c55-d416d15bbd8c, CompanyId: "dc1360f6-c029-4e44-9ec2-1a6d59479f99"
2025-09-24 16:59:28.470 +03:00 [INF] Checking if bank account already exists for CompanyId: "dc1360f6-c029-4e44-9ec2-1a6d59479f99"
2025-09-24 16:59:28.533 +03:00 [WRN] Bank account already exists for CompanyId: "dc1360f6-c029-4e44-9ec2-1a6d59479f99", BankName: Egypt, AccountNumber: 123456789
2025-09-24 16:59:28.541 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.BankAccounts.DTO.BankAccountCreatedDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 16:59:28.558 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.BankAccounts.Controllers.BankAccountController.CreateBankAccount (ModularERP) in 823.0901ms
2025-09-24 16:59:28.563 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.BankAccounts.Controllers.BankAccountController.CreateBankAccount (ModularERP)'
2025-09-24 16:59:28.565 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 16:59:28.569 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/BankAccount - 400 null application/json; charset=utf-8 876.5609ms
2025-09-24 17:00:15.269 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/BankAccount - application/json 327
2025-09-24 17:00:15.274 +03:00 [INF] Request started
2025-09-24 17:00:15.278 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:00:15.281 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.BankAccounts.Controllers.BankAccountController.CreateBankAccount (ModularERP)'
2025-09-24 17:00:15.283 +03:00 [INF] Route matched with {action = "CreateBankAccount", controller = "BankAccount"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.BankAccounts.DTO.BankAccountCreatedDto]]] CreateBankAccount(ModularERP.Modules.Finance.Features.BankAccounts.DTO.CreateBankAccountDto) on controller ModularERP.Modules.Finance.Features.BankAccounts.Controllers.BankAccountController (ModularERP).
2025-09-24 17:00:15.297 +03:00 [INF] Received CreateBankAccountCommand for TenantId: 7579736e-aa3f-49f9-9c55-d416d15bbd8c, CompanyId: "dc1360f6-c029-4e44-9ec2-1a6d59479f99"
2025-09-24 17:00:15.312 +03:00 [INF] Checking if bank account already exists for CompanyId: "dc1360f6-c029-4e44-9ec2-1a6d59479f99"
2025-09-24 17:00:15.320 +03:00 [INF] Adding new bank account: Egypt / 123 for Company: "dc1360f6-c029-4e44-9ec2-1a6d59479f99"
2025-09-24 17:00:15.431 +03:00 [INF] Bank account "fa029ad2-5554-4621-b965-e8fadd6fc568" created successfully
2025-09-24 17:00:15.440 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.BankAccounts.DTO.BankAccountCreatedDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:00:15.455 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.BankAccounts.Controllers.BankAccountController.CreateBankAccount (ModularERP) in 169.6768ms
2025-09-24 17:00:15.459 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.BankAccounts.Controllers.BankAccountController.CreateBankAccount (ModularERP)'
2025-09-24 17:00:15.461 +03:00 [INF] Request completed successfully with status code 201
2025-09-24 17:00:15.463 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/BankAccount - 201 null application/json; charset=utf-8 193.9532ms
2025-09-24 17:01:00.342 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------727827455806435799033373 1685
2025-09-24 17:01:00.349 +03:00 [INF] Request started
2025-09-24 17:01:00.351 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:01:00.353 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:01:00.361 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:01:00.429 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14555","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"95cf80e4-c946-42fa-8d66-343f371b0987","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:01:00.469 +03:00 [INF] Validation passed successfully.
2025-09-24 17:01:00.509 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:01:00.535 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
System.InvalidOperationException: Bank account does not have a GL account assigned
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Service.ExpenseVoucherService.GetWalletControlAccountIdAsync(Guid walletId, String walletType) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Service\ExpenseVoucherService.cs:line 109
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 124
2025-09-24 17:01:00.557 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:01:00.564 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 196.6145ms
2025-09-24 17:01:00.566 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:01:00.569 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:01:00.570 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 228.2105ms
2025-09-24 17:01:26.559 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------978255877211385218798037 1685
2025-09-24 17:01:26.564 +03:00 [INF] Request started
2025-09-24 17:01:26.566 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:01:26.568 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:01:26.572 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:01:26.583 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14555","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:01:26.597 +03:00 [INF] Validation passed successfully.
2025-09-24 17:01:26.606 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:01:26.616 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14555","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:01:26.777 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:367e027e-ee8d-410d-b507-9b8cee1c863d
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:01:26.814 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:01:26.815 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 238.7194ms
2025-09-24 17:01:26.819 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:01:26.822 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:01:26.824 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 264.4999ms
2025-09-24 17:02:13.998 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------074933462896628648490323 1685
2025-09-24 17:02:14.002 +03:00 [INF] Request started
2025-09-24 17:02:14.003 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:02:14.004 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:02:14.006 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:02:14.020 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:02:14.032 +03:00 [INF] Validation passed successfully.
2025-09-24 17:02:14.039 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:02:14.045 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:02:14.063 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:367e027e-ee8d-410d-b507-9b8cee1c863d
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:02:14.099 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:02:14.102 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 89.4451ms
2025-09-24 17:02:14.106 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:02:14.108 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:02:14.110 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 112.0527ms
2025-09-24 17:02:21.113 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:02:21.119 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 6.1848ms
2025-09-24 17:02:21.131 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:02:21.131 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:02:21.139 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 7.1958ms
2025-09-24 17:02:21.139 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.3438ms
2025-09-24 17:02:21.204 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:02:21.219 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 15.3397ms
2025-09-24 17:02:29.222 +03:00 [INF] Starting web host...
2025-09-24 17:02:29.993 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:02:30.064 +03:00 [INF] Executed DbCommand (54ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 17:02:30.142 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:02:30.148 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 17:02:30.163 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 17:02:30.220 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 17:02:30.235 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:02:30.240 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 17:02:30.246 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 17:02:30.257 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 17:02:30.264 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 17:02:30.451 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 17:02:30.457 +03:00 [INF] Master database initialized successfully
2025-09-24 17:02:30.617 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 17:02:30.619 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 17:02:30.684 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 17:02:30.686 +03:00 [INF] Hosting environment: Development
2025-09-24 17:02:30.688 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 17:02:30.786 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:02:30.891 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 105.4572ms
2025-09-24 17:02:30.899 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:02:30.899 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:02:30.919 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.9439ms
2025-09-24 17:02:30.935 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 36.0018ms
2025-09-24 17:02:30.975 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:02:31.018 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 43.6762ms
2025-09-24 17:02:40.611 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------131763314956793128174708 1685
2025-09-24 17:02:40.630 +03:00 [INF] Request started
2025-09-24 17:02:40.635 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:02:40.637 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:02:40.655 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:02:40.662 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:02:40.814 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 17:02:41.602 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:02:41.654 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:02:41.705 +03:00 [INF] Validation passed successfully.
2025-09-24 17:02:41.855 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:02:41.886 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:02:42.124 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:61d92b29-03ff-482c-bc6a-09f1c5f565d6
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:02:42.161 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:02:42.180 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1519.1233ms
2025-09-24 17:02:42.184 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:02:42.186 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:02:42.193 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1581.7494ms
2025-09-24 17:09:23.656 +03:00 [INF] Starting web host...
2025-09-24 17:09:24.438 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:09:24.524 +03:00 [INF] Executed DbCommand (71ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 17:09:24.598 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:09:24.604 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 17:09:24.624 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 17:09:24.680 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 17:09:24.695 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:09:24.700 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 17:09:24.706 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 17:09:24.717 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 17:09:24.723 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 17:09:24.886 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 17:09:24.893 +03:00 [INF] Master database initialized successfully
2025-09-24 17:09:25.034 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 17:09:25.035 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 17:09:25.097 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 17:09:25.099 +03:00 [INF] Hosting environment: Development
2025-09-24 17:09:25.101 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 17:09:25.560 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:09:25.669 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 110.6383ms
2025-09-24 17:09:25.828 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:09:25.828 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:09:25.843 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.1181ms
2025-09-24 17:09:25.860 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 31.2385ms
2025-09-24 17:09:25.928 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:09:25.975 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 46.5039ms
2025-09-24 17:09:30.695 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------820925353263848032433764 1685
2025-09-24 17:09:30.712 +03:00 [INF] Request started
2025-09-24 17:09:30.717 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:09:30.720 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:09:30.737 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:09:30.746 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:09:30.877 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 17:09:31.601 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:09:31.652 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:09:31.703 +03:00 [INF] Validation passed successfully.
2025-09-24 17:09:31.880 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:09:31.921 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:09:32.181 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:13152b74-9ce4-4609-92f7-620f006a2026
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:09:32.251 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:09:32.276 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1527.8885ms
2025-09-24 17:09:32.280 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:09:32.283 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:09:32.294 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1599.2242ms
2025-09-24 17:17:40.508 +03:00 [INF] Starting web host...
2025-09-24 17:17:41.363 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:17:41.459 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 17:17:41.544 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:17:41.550 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 17:17:41.559 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 17:17:41.617 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 17:17:41.633 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:17:41.638 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 17:17:41.645 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 17:17:41.656 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 17:17:41.663 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 17:17:41.830 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 17:17:41.837 +03:00 [INF] Master database initialized successfully
2025-09-24 17:17:41.993 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 17:17:41.995 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 17:17:42.103 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 17:17:42.104 +03:00 [INF] Hosting environment: Development
2025-09-24 17:17:42.106 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 17:17:42.105 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:17:42.239 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 134.5721ms
2025-09-24 17:17:42.305 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:17:42.305 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:17:42.319 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.8614ms
2025-09-24 17:17:42.335 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 29.5658ms
2025-09-24 17:17:42.366 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:17:42.405 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 39.1794ms
2025-09-24 17:17:44.801 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------266668209919334495984118 1685
2025-09-24 17:17:44.817 +03:00 [INF] Request started
2025-09-24 17:17:44.822 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:17:44.824 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:17:44.841 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:17:44.849 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:17:44.979 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 17:17:45.623 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:17:45.670 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:17:45.714 +03:00 [INF] Validation passed successfully.
2025-09-24 17:17:45.887 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:17:45.922 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:17:46.148 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:044f027a-21c8-42a8-bf32-fb70a57d1f50
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:17:46.192 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:17:46.211 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1362.123ms
2025-09-24 17:17:46.215 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:17:46.217 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:17:46.222 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1421.747ms
2025-09-24 17:24:07.988 +03:00 [INF] Starting web host...
2025-09-24 17:24:08.743 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:24:08.833 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 17:24:08.908 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:24:08.914 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 17:24:08.931 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 17:24:08.986 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 17:24:09.002 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:24:09.008 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 17:24:09.015 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 17:24:09.027 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 17:24:09.034 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 17:24:09.199 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 17:24:09.206 +03:00 [INF] Master database initialized successfully
2025-09-24 17:24:09.360 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 17:24:09.361 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 17:24:09.433 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:24:09.446 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 17:24:09.448 +03:00 [INF] Hosting environment: Development
2025-09-24 17:24:09.450 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 17:24:09.560 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 127.4813ms
2025-09-24 17:24:09.612 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:24:09.612 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:24:09.630 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.0815ms
2025-09-24 17:24:09.644 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 32.3993ms
2025-09-24 17:24:09.678 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:24:09.717 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 39.6676ms
2025-09-24 17:24:12.220 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------615783283143756599082144 1685
2025-09-24 17:24:12.236 +03:00 [INF] Request started
2025-09-24 17:24:12.241 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:24:12.244 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:24:12.262 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:24:12.269 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:24:12.392 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 17:24:13.022 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:24:13.067 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:24:13.111 +03:00 [INF] Validation passed successfully.
2025-09-24 17:24:13.273 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:24:13.297 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:24:13.546 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:8462e851-571e-450c-87e8-2b81abb4aac5
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:24:13.604 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:24:13.623 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1353.3066ms
2025-09-24 17:24:13.626 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:24:13.629 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:24:13.635 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1415.3368ms
2025-09-24 17:32:37.070 +03:00 [INF] Starting web host...
2025-09-24 17:32:37.813 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:32:37.867 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 17:32:37.941 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:32:37.946 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 17:32:37.957 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 17:32:38.011 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 17:32:38.026 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:32:38.030 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 17:32:38.038 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 17:32:38.051 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 17:32:38.058 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 17:32:38.216 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 17:32:38.223 +03:00 [INF] Master database initialized successfully
2025-09-24 17:32:38.358 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 17:32:38.360 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 17:32:38.417 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 17:32:38.419 +03:00 [INF] Hosting environment: Development
2025-09-24 17:32:38.421 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 17:32:38.509 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:32:38.610 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 101.6896ms
2025-09-24 17:32:38.649 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:32:38.649 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:32:38.658 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 4.9244ms
2025-09-24 17:32:38.673 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 24.2835ms
2025-09-24 17:32:38.700 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:32:38.734 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 34.5782ms
2025-09-24 17:32:51.164 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------784088967030273453049700 1685
2025-09-24 17:32:51.181 +03:00 [INF] Request started
2025-09-24 17:32:51.186 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:32:51.188 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:32:51.204 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:32:51.211 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:32:51.333 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 17:32:51.943 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:32:51.987 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:32:52.030 +03:00 [INF] Validation passed successfully.
2025-09-24 17:32:52.167 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:32:52.190 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:32:52.402 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:32d1892c-9084-438e-94af-ae7db2d8d723
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:32:52.460 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:32:52.478 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1266.2569ms
2025-09-24 17:32:52.481 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:32:52.483 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:32:52.488 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1324.1073ms
2025-09-24 17:33:40.030 +03:00 [INF] Starting web host...
2025-09-24 17:33:40.931 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:33:40.978 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 17:33:41.049 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:33:41.055 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 17:33:41.073 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 17:33:41.135 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 17:33:41.153 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:33:41.158 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 17:33:41.167 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 17:33:41.181 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 17:33:41.188 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 17:33:41.353 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 17:33:41.361 +03:00 [INF] Master database initialized successfully
2025-09-24 17:33:41.493 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 17:33:41.496 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 17:33:41.561 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 17:33:41.563 +03:00 [INF] Hosting environment: Development
2025-09-24 17:33:41.566 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 17:33:41.989 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:33:42.100 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 111.1309ms
2025-09-24 17:33:42.100 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:33:42.100 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:33:42.124 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 16.7622ms
2025-09-24 17:33:42.141 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 40.5055ms
2025-09-24 17:33:42.173 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:33:42.220 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 46.7832ms
2025-09-24 17:33:50.713 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------221435806669448370748067 1685
2025-09-24 17:33:50.742 +03:00 [INF] Request started
2025-09-24 17:33:50.749 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:33:50.752 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:33:50.774 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:33:50.781 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:33:50.932 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 17:33:51.816 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:33:51.878 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:33:51.932 +03:00 [INF] Validation passed successfully.
2025-09-24 17:33:52.105 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:33:52.135 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:33:52.393 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:a0090bb8-09ea-4bd8-a1a6-3ed8ef529a0e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:33:52.463 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:33:52.486 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1704.4439ms
2025-09-24 17:33:52.488 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:33:52.491 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:33:52.498 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1785.3257ms
2025-09-24 17:39:28.016 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------796515412825704550276777 1685
2025-09-24 17:39:28.024 +03:00 [INF] Request started
2025-09-24 17:39:28.028 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:39:28.030 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:39:28.032 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:39:28.046 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:39:28.060 +03:00 [INF] Validation passed successfully.
2025-09-24 17:39:28.081 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:39:28.089 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:39:28.105 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:a0090bb8-09ea-4bd8-a1a6-3ed8ef529a0e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:39:28.138 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:39:28.141 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 104.2104ms
2025-09-24 17:39:28.144 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:39:28.146 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:39:28.147 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 130.9169ms
2025-09-24 17:40:24.431 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:40:24.439 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 8.6971ms
2025-09-24 17:40:24.449 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:40:24.449 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:40:24.453 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 4.1319ms
2025-09-24 17:40:24.465 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 16.0032ms
2025-09-24 17:40:24.513 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:40:24.540 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 26.8335ms
2025-09-24 17:40:33.565 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------448536603167159500413819 1685
2025-09-24 17:40:33.572 +03:00 [INF] Request started
2025-09-24 17:40:33.600 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:40:33.601 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:40:33.602 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:40:33.614 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:40:33.625 +03:00 [INF] Validation passed successfully.
2025-09-24 17:40:33.632 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:40:33.637 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:40:33.652 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:a0090bb8-09ea-4bd8-a1a6-3ed8ef529a0e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:40:33.685 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:40:33.687 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 81.2198ms
2025-09-24 17:40:33.692 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:40:33.694 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:40:33.696 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 131.2862ms
2025-09-24 17:47:41.481 +03:00 [INF] Starting web host...
2025-09-24 17:47:41.673 +03:00 [FTL] Host terminated unexpectedly
System.AggregateException: Some services are not able to be constructed (Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.CreateIncomeVoucherCommand,ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler': Unable to resolve service for type 'Microsoft.EntityFrameworkCore.DbContext' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.)
 ---> System.InvalidOperationException: Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.CreateIncomeVoucherCommand,ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler': Unable to resolve service for type 'Microsoft.EntityFrameworkCore.DbContext' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.
 ---> System.InvalidOperationException: Unable to resolve service for type 'Microsoft.EntityFrameworkCore.DbContext' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceDescriptor serviceDescriptor, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   at Microsoft.Extensions.DependencyInjection.ServiceCollectionContainerBuilderExtensions.BuildServiceProvider(IServiceCollection services, ServiceProviderOptions options)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 162
2025-09-24 17:51:32.135 +03:00 [INF] Starting web host...
2025-09-24 17:51:32.903 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:51:32.969 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 17:51:33.049 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:51:33.055 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 17:51:33.072 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 17:51:33.127 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 17:51:33.145 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:51:33.150 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 17:51:33.156 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 17:51:33.169 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 17:51:33.177 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 17:51:33.338 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 17:51:33.345 +03:00 [INF] Master database initialized successfully
2025-09-24 17:51:33.482 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 17:51:33.484 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 17:51:33.561 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 17:51:33.563 +03:00 [INF] Hosting environment: Development
2025-09-24 17:51:33.565 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 17:51:33.569 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:51:33.679 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 110.2663ms
2025-09-24 17:51:33.680 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:51:33.680 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:51:33.707 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 26.6397ms
2025-09-24 17:51:33.714 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 33.9614ms
2025-09-24 17:51:33.751 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:51:33.784 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 32.6014ms
2025-09-24 17:51:38.109 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------616889201324049785927313 1685
2025-09-24 17:51:38.133 +03:00 [INF] Request started
2025-09-24 17:51:38.137 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:51:38.140 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:51:38.160 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:51:38.167 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:51:38.295 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 17:51:39.014 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:51:39.074 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:51:39.124 +03:00 [INF] Validation passed successfully.
2025-09-24 17:51:39.254 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:51:39.282 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:51:39.484 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:af607bbb-9382-431b-88d7-fdea426888b5
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:51:39.539 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:51:39.563 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1395.9717ms
2025-09-24 17:51:39.566 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:51:39.568 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:51:39.575 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1466.4362ms
2025-09-24 17:54:49.303 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:54:49.311 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 8.2491ms
2025-09-24 17:54:49.320 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:54:49.320 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:54:49.329 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.4348ms
2025-09-24 17:54:49.334 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 13.7604ms
2025-09-24 17:54:49.391 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:54:49.436 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 44.5075ms
2025-09-24 17:54:55.700 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:54:55.705 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 5.3555ms
2025-09-24 17:54:55.713 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:54:55.713 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:54:55.716 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 3.2532ms
2025-09-24 17:54:55.727 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 13.4842ms
2025-09-24 17:54:55.778 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:54:55.820 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 41.8838ms
2025-09-24 17:54:58.536 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------500879819957749607698105 1685
2025-09-24 17:54:58.542 +03:00 [INF] Request started
2025-09-24 17:54:58.546 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:54:58.547 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:54:58.549 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:54:58.562 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:54:58.577 +03:00 [INF] Validation passed successfully.
2025-09-24 17:54:58.584 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:54:58.590 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:54:58.603 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:af607bbb-9382-431b-88d7-fdea426888b5
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:54:58.636 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:54:58.639 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 86.2237ms
2025-09-24 17:54:58.643 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:54:58.645 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:54:58.647 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 110.868ms
2025-09-24 17:56:01.179 +03:00 [INF] Starting web host...
2025-09-24 17:56:02.012 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:56:02.085 +03:00 [INF] Executed DbCommand (57ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 17:56:02.205 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:56:02.211 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 17:56:02.225 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 17:56:02.313 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 17:56:02.331 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:56:02.335 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 17:56:02.343 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 17:56:02.356 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 17:56:02.364 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 17:56:02.524 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 17:56:02.530 +03:00 [INF] Master database initialized successfully
2025-09-24 17:56:02.694 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 17:56:02.696 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 17:56:02.773 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 17:56:02.775 +03:00 [INF] Hosting environment: Development
2025-09-24 17:56:02.777 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 17:56:03.110 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:56:03.273 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 163.6699ms
2025-09-24 17:56:03.324 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:56:03.324 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:56:03.344 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.0651ms
2025-09-24 17:56:03.358 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 33.97ms
2025-09-24 17:56:03.422 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:56:03.479 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 56.669ms
2025-09-24 17:56:05.670 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------782966680368539623827168 1685
2025-09-24 17:56:05.688 +03:00 [INF] Request started
2025-09-24 17:56:05.693 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:56:05.695 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:56:05.715 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:56:05.723 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:56:05.903 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 17:56:06.587 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:56:06.637 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:56:06.680 +03:00 [INF] Validation passed successfully.
2025-09-24 17:56:06.801 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:56:06.826 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:56:07.044 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:16b643a6-4f01-487f-8d96-087775d400a2
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:56:07.103 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:56:07.121 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1399.0723ms
2025-09-24 17:56:07.125 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:56:07.127 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:56:07.133 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1463.9623ms
2025-09-24 17:57:51.761 +03:00 [INF] Starting web host...
2025-09-24 17:57:52.521 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:57:52.590 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 17:57:52.667 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:57:52.674 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 17:57:52.689 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 17:57:52.749 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 17:57:52.766 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 17:57:52.772 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 17:57:52.779 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 17:57:52.793 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 17:57:52.800 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 17:57:53.017 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 17:57:53.025 +03:00 [INF] Master database initialized successfully
2025-09-24 17:57:53.186 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 17:57:53.187 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 17:57:53.261 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 17:57:53.264 +03:00 [INF] Hosting environment: Development
2025-09-24 17:57:53.265 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 17:57:53.699 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 17:57:53.801 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 102.8553ms
2025-09-24 17:57:53.838 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 17:57:53.838 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 17:57:53.848 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.5445ms
2025-09-24 17:57:53.864 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.0541ms
2025-09-24 17:57:53.895 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 17:57:53.939 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 43.6554ms
2025-09-24 17:57:55.365 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------450903076919584674533769 1685
2025-09-24 17:57:55.381 +03:00 [INF] Request started
2025-09-24 17:57:55.386 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 17:57:55.388 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:57:55.405 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 17:57:55.411 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:57:55.527 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 17:57:56.178 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 17:57:56.224 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 17:57:56.330 +03:00 [INF] Validation passed successfully.
2025-09-24 17:57:56.457 +03:00 [INF] Business validations passed successfully.
2025-09-24 17:57:56.481 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 17:57:56.686 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:d55b9c1f-edc2-45f2-8dd3-bd453339cc01
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 17:57:56.745 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 17:57:56.765 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1353.2435ms
2025-09-24 17:57:56.768 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 17:57:56.771 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 17:57:56.776 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1411.619ms
2025-09-24 18:09:24.506 +03:00 [INF] Starting web host...
2025-09-24 18:09:24.713 +03:00 [FTL] Host terminated unexpectedly
System.AggregateException: Some services are not able to be constructed (Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.CreateIncomeVoucherCommand,ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler': Unable to resolve service for type 'Microsoft.AspNetCore.Identity.UserManager`1[Microsoft.AspNetCore.Identity.IdentityUser]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.)
 ---> System.InvalidOperationException: Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.CreateIncomeVoucherCommand,ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler': Unable to resolve service for type 'Microsoft.AspNetCore.Identity.UserManager`1[Microsoft.AspNetCore.Identity.IdentityUser]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.
 ---> System.InvalidOperationException: Unable to resolve service for type 'Microsoft.AspNetCore.Identity.UserManager`1[Microsoft.AspNetCore.Identity.IdentityUser]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceDescriptor serviceDescriptor, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   at Microsoft.Extensions.DependencyInjection.ServiceCollectionContainerBuilderExtensions.BuildServiceProvider(IServiceCollection services, ServiceProviderOptions options)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 162
2025-09-24 18:11:06.721 +03:00 [INF] Starting web host...
2025-09-24 18:11:06.900 +03:00 [FTL] Host terminated unexpectedly
System.ArgumentException: GenericArguments[0], 'Microsoft.AspNetCore.Identity.IdentityUser', on 'Microsoft.AspNetCore.Identity.EntityFrameworkCore.UserStore`9[TUser,TRole,TContext,TKey,TUserClaim,TUserRole,TUserLogin,TUserToken,TRoleClaim]' violates the constraint of type 'TUser'.
 ---> System.TypeLoadException: GenericArguments[0], 'Microsoft.AspNetCore.Identity.IdentityUser', on 'Microsoft.AspNetCore.Identity.UserStoreBase`5[TUser,TKey,TUserClaim,TUserLogin,TUserToken]' violates the constraint of type parameter 'TUser'.
   at System.RuntimeTypeHandle.Instantiate(Type[] inst)
   at System.RuntimeType.MakeGenericType(Type[] instantiation)
   --- End of inner exception stack trace ---
   at System.RuntimeType.ValidateGenericArguments(MemberInfo definition, RuntimeType[] genericArguments, Exception e)
   at System.RuntimeType.MakeGenericType(Type[] instantiation)
   at Microsoft.Extensions.DependencyInjection.IdentityEntityFrameworkBuilderExtensions.AddStores(IServiceCollection services, Type userType, Type roleType, Type contextType)
   at Microsoft.Extensions.DependencyInjection.IdentityEntityFrameworkBuilderExtensions.AddEntityFrameworkStores[TContext](IdentityBuilder builder)
   at ModularERP.Program.Main(String[] args) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 61
2025-09-24 18:14:04.468 +03:00 [INF] Starting web host...
2025-09-24 18:14:04.673 +03:00 [FTL] Host terminated unexpectedly
System.AggregateException: Some services are not able to be constructed (Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.CreateIncomeVoucherCommand,ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler': Unable to resolve service for type 'Microsoft.AspNetCore.Identity.UserManager`1[Microsoft.AspNetCore.Identity.IdentityUser]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.)
 ---> System.InvalidOperationException: Error while validating the service descriptor 'ServiceType: MediatR.IRequestHandler`2[ModularERP.Modules.Finance.Features.IncomesVoucher.Commands.CreateIncomeVoucherCommand,ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.IncomesVoucher.DTO.IncomeVoucherResponseDto]] Lifetime: Transient ImplementationType: ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler': Unable to resolve service for type 'Microsoft.AspNetCore.Identity.UserManager`1[Microsoft.AspNetCore.Identity.IdentityUser]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.
 ---> System.InvalidOperationException: Unable to resolve service for type 'Microsoft.AspNetCore.Identity.UserManager`1[Microsoft.AspNetCore.Identity.IdentityUser]' while attempting to activate 'ModularERP.Modules.Finance.Features.IncomesVoucher.Handlers.CreateIncomeVoucherHandler'.
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateArgumentCallSites(ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain, ParameterInfo[] parameters, Boolean throwIfCallSiteNotFound)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.CreateConstructorCallSite(ResultCache lifetime, ServiceIdentifier serviceIdentifier, Type implementationType, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.TryCreateExact(ServiceDescriptor descriptor, ServiceIdentifier serviceIdentifier, CallSiteChain callSiteChain, Int32 slot)
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteFactory.GetCallSite(ServiceDescriptor serviceDescriptor, CallSiteChain callSiteChain)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider.ValidateService(ServiceDescriptor descriptor)
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   --- End of inner exception stack trace ---
   at Microsoft.Extensions.DependencyInjection.ServiceProvider..ctor(ICollection`1 serviceDescriptors, ServiceProviderOptions options)
   at Microsoft.Extensions.DependencyInjection.ServiceCollectionContainerBuilderExtensions.BuildServiceProvider(IServiceCollection services, ServiceProviderOptions options)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 168
2025-09-24 18:17:27.863 +03:00 [INF] Starting web host...
2025-09-24 18:17:28.644 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 18:17:28.704 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 18:17:28.797 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 18:17:28.802 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 18:17:28.812 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 18:17:28.866 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 18:17:28.882 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 18:17:28.887 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 18:17:28.894 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 18:17:28.907 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 18:17:28.914 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 18:17:29.090 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 18:17:29.102 +03:00 [INF] Master database initialized successfully
2025-09-24 18:17:29.212 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-24 18:17:29.389 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 18:17:29.391 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 18:17:29.464 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 18:17:29.466 +03:00 [INF] Hosting environment: Development
2025-09-24 18:17:29.468 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 18:17:29.788 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 18:17:29.903 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 116.0939ms
2025-09-24 18:17:29.943 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 18:17:29.943 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 18:17:29.952 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.7308ms
2025-09-24 18:17:29.965 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 22.0817ms
2025-09-24 18:17:30.002 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 18:17:30.049 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 46.6036ms
2025-09-24 18:17:36.227 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------309345669731899536620427 1685
2025-09-24 18:17:36.249 +03:00 [INF] Request started
2025-09-24 18:17:36.254 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 18:17:36.258 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 18:17:36.278 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 18:17:36.284 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 18:17:36.423 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 18:17:37.231 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 18:17:37.293 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 18:17:37.340 +03:00 [INF] Validation passed successfully.
2025-09-24 18:17:37.492 +03:00 [INF] Business validations passed successfully.
2025-09-24 18:17:37.518 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 18:17:37.745 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:50073dfe-a5c2-4b04-8a03-073491eeb32e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 18:17:37.786 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 18:17:37.804 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1520.493ms
2025-09-24 18:17:37.807 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 18:17:37.810 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 18:17:37.815 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1588.6982ms
2025-09-24 20:44:09.217 +03:00 [INF] Starting web host...
2025-09-24 20:44:10.024 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 20:44:10.109 +03:00 [INF] Executed DbCommand (70ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-09-24 20:44:10.194 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 20:44:10.200 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-09-24 20:44:10.223 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-09-24 20:44:10.280 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-09-24 20:44:10.297 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-09-24 20:44:10.302 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-09-24 20:44:10.309 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-09-24 20:44:10.320 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-09-24 20:44:10.328 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-09-24 20:44:10.495 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-09-24 20:44:10.502 +03:00 [INF] Master database initialized successfully
2025-09-24 20:44:10.570 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-09-24 20:44:10.667 +03:00 [INF] Now listening on: https://localhost:7168
2025-09-24 20:44:10.669 +03:00 [INF] Now listening on: http://localhost:5004
2025-09-24 20:44:10.738 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-09-24 20:44:10.740 +03:00 [INF] Hosting environment: Development
2025-09-24 20:44:10.742 +03:00 [INF] Content root path: C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP
2025-09-24 20:44:11.427 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-09-24 20:44:11.592 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 166.4102ms
2025-09-24 20:44:11.602 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-09-24 20:44:11.602 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-09-24 20:44:11.631 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 29.2862ms
2025-09-24 20:44:11.650 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 48.7518ms
2025-09-24 20:44:11.704 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-09-24 20:44:11.764 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 60.7029ms
2025-09-24 20:44:16.836 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - multipart/form-data; boundary=--------------------------155817305345491141856706 1685
2025-09-24 20:44:16.854 +03:00 [INF] Request started
2025-09-24 20:44:16.858 +03:00 [INF] Processing request for tenant: 7579736e-aa3f-49f9-9c55-d416d15bbd8c
2025-09-24 20:44:16.861 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 20:44:16.877 +03:00 [INF] Route matched with {action = "CreateExpenseVoucher", controller = "ExpenseVouchers"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto]]] CreateExpenseVoucher(System.String, System.DateTime, System.String, System.Decimal, System.Decimal, System.String, System.Guid, System.Nullable`1[System.Guid], System.String, System.Guid, System.String, System.String, System.Collections.Generic.List`1[Microsoft.AspNetCore.Http.IFormFile]) on controller ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController (ModularERP).
2025-09-24 20:44:16.883 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 20:44:17.060 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-09-24 20:44:17.845 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-09-24 20:44:17.904 +03:00 [INF] Start creating expense voucher with data: {"Code":"EXP-14554","Date":"2025-09-18T19:22:40.3180000Z","Amount":500,"Description":"ant","CategoryId":"e767c31a-c4e4-4f6d-8418-08ddfb5479f3","Source":{"Type":"BankAccount","Id":"fa029ad2-5554-4621-b965-e8fadd6fc568","$type":"WalletDto"},"Counterparty":{"Type":"Vendor","Id":"3fa85f64-5717-4562-b3fc-2c963f66afa6","$type":"CounterpartyDto"},"TaxLinesCount":1,"AttachmentsCount":0}
2025-09-24 20:44:17.963 +03:00 [INF] Validation passed successfully.
2025-09-24 20:44:18.123 +03:00 [INF] Business validations passed successfully.
2025-09-24 20:44:18.152 +03:00 [INF] Adding voucher to repository: {"Code":"EXP-14554","Amount":500,"Date":"2025-09-18T19:22:40.3180000Z"}
2025-09-24 20:44:18.420 +03:00 [ERR] Unhandled error occurred while creating expense voucher.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Vouchers_AspNetUsers_CreatedBy". The conflict occurred in database "ModularERP_Tenant_6d102e1c787c401e9d3ef53f6a3d446a", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:d479f106-b674-4814-b5f3-9e4450a78fc8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 188
   at ModularERP.Modules.Finance.Features.ExpensesVoucher.Handlers.CreateExpenseVoucherHandler.Handle(CreateExpenseVoucherCommand request, CancellationToken cancellationToken) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Modules\Finance\Features\ExpensesVoucher\Handlers\CreateExpenseVoucherHandler.cs:line 129
2025-09-24 20:44:18.478 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.ExpensesVoucher.DTO.ExpenseVoucherResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-09-24 20:44:18.499 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP) in 1614.6586ms
2025-09-24 20:44:18.504 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.ExpensesVoucher.Controllers.ExpenseVouchersController.CreateExpenseVoucher (ModularERP)'
2025-09-24 20:44:18.507 +03:00 [INF] Request completed successfully with status code 400
2025-09-24 20:44:18.513 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ExpenseVouchers?Code=INC-125468&Date=2025-09-18T19:22:40.318Z&CurrencyCode=EGP&FxRate=1.0&Amount=600&Description=anu&CategoryId=f8cd0c63-50d7-4a69-a344-bc53be110f77&RecurrenceId=7b6fd5d0-11ec-43b6-b9d6-eba78273f3fe - 400 null application/json; charset=utf-8 1676.9896ms
2025-09-24 21:01:53.025 +03:00 [INF] Starting web host...
2025-09-24 21:01:53.241 +03:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in C:\Users\hossny D. monkey\source\repos\ModularERP\ModularERP\Program.cs:line 168
