2025-10-16 09:48:11.427 +03:00 [INF] Starting web host...
2025-10-16 09:48:22.455 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 09:48:22.601 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 09:48:22.889 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 09:48:22.903 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 09:48:22.915 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 09:48:23.101 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 09:48:23.143 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 09:48:23.153 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 09:48:23.179 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 09:48:23.208 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 09:48:23.218 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 09:48:23.766 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 09:48:23.790 +03:00 [INF] Master database initialized successfully
2025-10-16 09:48:28.420 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 09:48:29.115 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 09:48:29.119 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 09:48:29.431 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 09:48:29.435 +03:00 [INF] Hosting environment: Development
2025-10-16 09:48:29.439 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 09:48:30.398 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 09:48:30.777 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 383.8958ms
2025-10-16 09:48:30.782 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 09:48:30.787 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 09:48:30.820 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 37.8532ms
2025-10-16 09:48:30.889 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 102.2405ms
2025-10-16 09:48:30.954 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 09:48:31.505 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 551.7464ms
2025-10-16 09:54:03.641 +03:00 [INF] Starting web host...
2025-10-16 09:54:05.207 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 09:54:05.302 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 09:54:05.434 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 09:54:05.442 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 09:54:05.449 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 09:54:05.534 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 09:54:05.557 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 09:54:05.564 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 09:54:05.575 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 09:54:05.592 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 09:54:05.598 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 09:54:05.820 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 09:54:05.832 +03:00 [INF] Master database initialized successfully
2025-10-16 09:54:07.987 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 09:54:08.212 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 09:54:08.215 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 09:54:08.372 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 09:54:08.376 +03:00 [INF] Hosting environment: Development
2025-10-16 09:54:08.380 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 09:54:08.769 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 09:54:08.954 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 185.9621ms
2025-10-16 09:54:09.090 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 09:54:09.090 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 09:54:09.108 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 17.6901ms
2025-10-16 09:54:09.127 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 37.0013ms
2025-10-16 09:54:09.214 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 09:54:09.603 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 389.3757ms
2025-10-16 09:54:48.403 +03:00 [INF] Starting web host...
2025-10-16 09:54:50.252 +03:00 [INF] Executed DbCommand (54ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 09:54:50.367 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 09:54:50.523 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 09:54:50.535 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 09:54:50.542 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 09:54:50.619 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 09:54:50.642 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 09:54:50.649 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 09:54:50.657 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 09:54:50.675 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 09:54:50.682 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 09:54:50.971 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 09:54:50.982 +03:00 [INF] Master database initialized successfully
2025-10-16 09:54:53.265 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 09:54:53.507 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 09:54:53.509 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 09:54:53.691 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 09:54:53.696 +03:00 [INF] Hosting environment: Development
2025-10-16 09:54:53.701 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 09:54:53.773 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 09:54:54.091 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 323.9305ms
2025-10-16 09:54:54.185 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 09:54:54.185 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 09:54:54.193 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.0453ms
2025-10-16 09:54:54.230 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 44.6621ms
2025-10-16 09:54:54.283 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 09:54:54.746 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 462.4994ms
2025-10-16 09:56:37.066 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/api/RequisitionWorkflowHistory/3fa85f64-5717-4562-b3fc-2c963f66afa6/approval-log - null null
2025-10-16 09:56:37.162 +03:00 [INF] Request started
2025-10-16 09:56:37.171 +03:00 [INF] === Incoming Request ===
2025-10-16 09:56:37.181 +03:00 [INF] Path: /api/RequisitionWorkflowHistory/3fa85f64-5717-4562-b3fc-2c963f66afa6/approval-log
2025-10-16 09:56:37.187 +03:00 [INF] Method: GET
2025-10-16 09:56:37.191 +03:00 [INF] === Headers ===
2025-10-16 09:56:37.199 +03:00 [INF] Accept: ["text/plain"]
2025-10-16 09:56:37.207 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 09:56:37.211 +03:00 [INF] User-Agent: ["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0"]
2025-10-16 09:56:37.216 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br, zstd"]
2025-10-16 09:56:37.219 +03:00 [INF] Accept-Language: ["en-US,en;q=0.9"]
2025-10-16 09:56:37.222 +03:00 [INF] Referer: ["https://localhost:7168/swagger/index.html"]
2025-10-16 09:56:37.226 +03:00 [INF] sec-ch-ua-platform: ["\"Windows\""]
2025-10-16 09:56:37.230 +03:00 [INF] sec-ch-ua: ["\"Microsoft Edge\";v=\"141\", \"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"141\""]
2025-10-16 09:56:37.235 +03:00 [INF] sec-ch-ua-mobile: ["?0"]
2025-10-16 09:56:37.239 +03:00 [INF] sec-fetch-site: ["same-origin"]
2025-10-16 09:56:37.242 +03:00 [INF] sec-fetch-mode: ["cors"]
2025-10-16 09:56:37.245 +03:00 [INF] sec-fetch-dest: ["empty"]
2025-10-16 09:56:37.249 +03:00 [INF] priority: ["u=1, i"]
2025-10-16 09:56:37.259 +03:00 [INF] 🔍 TenantService returned: 'NULL'
2025-10-16 09:56:37.280 +03:00 [INF] Request completed successfully with status code 400
2025-10-16 09:56:37.289 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/api/RequisitionWorkflowHistory/3fa85f64-5717-4562-b3fc-2c963f66afa6/approval-log - 400 null application/json 222.6507ms
2025-10-16 09:57:44.315 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/RequisitionWorkflowHistory/5f3a01e1-635d-40db-2d90-08de0b170b68/approval-log - null null
2025-10-16 09:57:44.329 +03:00 [INF] Request started
2025-10-16 09:57:44.331 +03:00 [INF] === Incoming Request ===
2025-10-16 09:57:44.333 +03:00 [INF] Path: /api/RequisitionWorkflowHistory/5f3a01e1-635d-40db-2d90-08de0b170b68/approval-log
2025-10-16 09:57:44.336 +03:00 [INF] Method: GET
2025-10-16 09:57:44.338 +03:00 [INF] === Headers ===
2025-10-16 09:57:44.340 +03:00 [INF] Accept: ["*/*"]
2025-10-16 09:57:44.343 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 09:57:44.345 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 09:57:44.349 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 09:57:44.352 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 09:57:44.355 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 09:57:44.361 +03:00 [INF] Postman-Token: ["39288caf-28b6-46e9-8783-5e6560ede53b"]
2025-10-16 09:57:44.372 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 09:57:44.375 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 09:57:44.380 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Requisitions.Controllers.RequisitionWorkflowHistoryController.GetApprovalLog (ModularERP)'
2025-10-16 09:57:44.426 +03:00 [INF] Route matched with {action = "GetApprovalLog", controller = "RequisitionWorkflowHistory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.Requisitions.DTO.DTO_Requisition_Workflow.ApprovalLogDto]]]] GetApprovalLog(System.Guid, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Requisitions.Controllers.RequisitionWorkflowHistoryController (ModularERP).
2025-10-16 09:57:44.442 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 09:57:44.637 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 09:57:45.153 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.Requisitions.DTO.DTO_Requisition_Workflow.ApprovalLogDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 09:57:45.206 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Requisitions.Controllers.RequisitionWorkflowHistoryController.GetApprovalLog (ModularERP) in 765.4281ms
2025-10-16 09:57:45.214 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Requisitions.Controllers.RequisitionWorkflowHistoryController.GetApprovalLog (ModularERP)'
2025-10-16 09:57:45.219 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 09:57:45.249 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/RequisitionWorkflowHistory/5f3a01e1-635d-40db-2d90-08de0b170b68/approval-log - 200 null application/json; charset=utf-8 934.5496ms
2025-10-16 09:58:18.637 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/api/RequisitionWorkflowHistory/3fa85f64-5717-4562-b3fc-2c963f66afa6/approval-history - null null
2025-10-16 09:58:18.649 +03:00 [INF] Request started
2025-10-16 09:58:18.651 +03:00 [INF] === Incoming Request ===
2025-10-16 09:58:18.653 +03:00 [INF] Path: /api/RequisitionWorkflowHistory/3fa85f64-5717-4562-b3fc-2c963f66afa6/approval-history
2025-10-16 09:58:18.655 +03:00 [INF] Method: GET
2025-10-16 09:58:18.657 +03:00 [INF] === Headers ===
2025-10-16 09:58:18.660 +03:00 [INF] Accept: ["text/plain"]
2025-10-16 09:58:18.663 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 09:58:18.668 +03:00 [INF] User-Agent: ["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0"]
2025-10-16 09:58:18.672 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br, zstd"]
2025-10-16 09:58:18.676 +03:00 [INF] Accept-Language: ["en-US,en;q=0.9"]
2025-10-16 09:58:18.680 +03:00 [INF] Referer: ["https://localhost:7168/swagger/index.html"]
2025-10-16 09:58:18.683 +03:00 [INF] sec-ch-ua-platform: ["\"Windows\""]
2025-10-16 09:58:18.687 +03:00 [INF] sec-ch-ua: ["\"Microsoft Edge\";v=\"141\", \"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"141\""]
2025-10-16 09:58:18.692 +03:00 [INF] sec-ch-ua-mobile: ["?0"]
2025-10-16 09:58:18.694 +03:00 [INF] sec-fetch-site: ["same-origin"]
2025-10-16 09:58:18.698 +03:00 [INF] sec-fetch-mode: ["cors"]
2025-10-16 09:58:18.700 +03:00 [INF] sec-fetch-dest: ["empty"]
2025-10-16 09:58:18.704 +03:00 [INF] priority: ["u=1, i"]
2025-10-16 09:58:18.707 +03:00 [INF] 🔍 TenantService returned: 'NULL'
2025-10-16 09:58:18.710 +03:00 [INF] Request completed successfully with status code 400
2025-10-16 09:58:18.713 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/api/RequisitionWorkflowHistory/3fa85f64-5717-4562-b3fc-2c963f66afa6/approval-history - 400 null application/json 75.463ms
2025-10-16 09:58:44.854 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/RequisitionWorkflowHistory/5f3a01e1-635d-40db-2d90-08de0b170b68/approval-history - null null
2025-10-16 09:58:44.863 +03:00 [INF] Request started
2025-10-16 09:58:44.866 +03:00 [INF] === Incoming Request ===
2025-10-16 09:58:44.869 +03:00 [INF] Path: /api/RequisitionWorkflowHistory/5f3a01e1-635d-40db-2d90-08de0b170b68/approval-history
2025-10-16 09:58:44.873 +03:00 [INF] Method: GET
2025-10-16 09:58:44.876 +03:00 [INF] === Headers ===
2025-10-16 09:58:44.879 +03:00 [INF] Accept: ["*/*"]
2025-10-16 09:58:44.883 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 09:58:44.889 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 09:58:44.894 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 09:58:44.898 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 09:58:44.903 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 09:58:44.908 +03:00 [INF] Postman-Token: ["820b73db-c8d9-4320-b657-2e7f2d074cb1"]
2025-10-16 09:58:44.914 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 09:58:44.918 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 09:58:44.921 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Requisitions.Controllers.RequisitionWorkflowHistoryController.GetApprovalHistory (ModularERP)'
2025-10-16 09:58:44.929 +03:00 [INF] Route matched with {action = "GetApprovalHistory", controller = "RequisitionWorkflowHistory"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Requisitions.DTO.DTO_ApprovalHistory.ApprovalHistoryDto]]] GetApprovalHistory(System.Guid, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Requisitions.Controllers.RequisitionWorkflowHistoryController (ModularERP).
2025-10-16 09:58:45.031 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Requisitions.DTO.DTO_ApprovalHistory.ApprovalHistoryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 09:58:45.067 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Requisitions.Controllers.RequisitionWorkflowHistoryController.GetApprovalHistory (ModularERP) in 132.9609ms
2025-10-16 09:58:45.073 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Requisitions.Controllers.RequisitionWorkflowHistoryController.GetApprovalHistory (ModularERP)'
2025-10-16 09:58:45.077 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 09:58:45.081 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/RequisitionWorkflowHistory/5f3a01e1-635d-40db-2d90-08de0b170b68/approval-history - 200 null application/json; charset=utf-8 227.172ms
2025-10-16 10:05:00.896 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 322
2025-10-16 10:05:00.904 +03:00 [INF] Request started
2025-10-16 10:05:00.908 +03:00 [INF] === Incoming Request ===
2025-10-16 10:05:00.911 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:05:00.916 +03:00 [INF] Method: POST
2025-10-16 10:05:00.919 +03:00 [INF] === Headers ===
2025-10-16 10:05:00.922 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:05:00.927 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:05:00.932 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:05:00.937 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:05:00.941 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:05:00.946 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:05:00.950 +03:00 [INF] Content-Length: ["322"]
2025-10-16 10:05:00.955 +03:00 [INF] X-Tenant-ID: ["8bed874f-cf2a-4ffa-a188-4cfef779774a","7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:05:00.960 +03:00 [INF] Postman-Token: ["bb2a1f65-dee5-4264-aec0-7686542e6668"]
2025-10-16 10:05:00.966 +03:00 [INF] 🔍 TenantService returned: '8bed874f-cf2a-4ffa-a188-4cfef779774a'
2025-10-16 10:05:00.969 +03:00 [INF] ✅ Processing request for tenant: 8bed874f-cf2a-4ffa-a188-4cfef779774a
2025-10-16 10:05:00.973 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:05:00.989 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:05:01.219 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 10:05:01.233 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 10:05:01.245 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 10:05:02.240 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 10:05:02.290 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 1292.9734ms
2025-10-16 10:05:02.296 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:05:02.304 +03:00 [ERR] Application exception occurred: Product not found
ModularERP.Common.Exceptions.NotFoundException: Product not found
   at ModularERP.Modules.Inventory.Features.StockTransactions.Handlers.CreateStockTransactionCommandHandler.Handle(CreateStockTransactionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Handlers\CreateStockTransactionCommandHandler.cs:line 42
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create(CreateStockTransactionDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Controllers\StockTransactionsController.cs:line 129
   at lambda_method173(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 319
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_5>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 272
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 10:05:02.427 +03:00 [INF] Error response sent with status code 404
2025-10-16 10:05:02.430 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 404 null application/json; charset=utf-8 1534.2962ms
2025-10-16 10:06:03.089 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 322
2025-10-16 10:06:03.096 +03:00 [INF] Request started
2025-10-16 10:06:03.098 +03:00 [INF] === Incoming Request ===
2025-10-16 10:06:03.100 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:06:03.102 +03:00 [INF] Method: POST
2025-10-16 10:06:03.105 +03:00 [INF] === Headers ===
2025-10-16 10:06:03.107 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:06:03.109 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:06:03.113 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:06:03.115 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:06:03.118 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:06:03.122 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:06:03.126 +03:00 [INF] Content-Length: ["322"]
2025-10-16 10:06:03.129 +03:00 [INF] X-Tenant-ID: ["8bed874f-cf2a-4ffa-a188-4cfef779774a","7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:06:03.134 +03:00 [INF] Postman-Token: ["3d7ae9d7-494e-4ff0-8db9-b3a67eda6230"]
2025-10-16 10:06:03.138 +03:00 [INF] 🔍 TenantService returned: '8bed874f-cf2a-4ffa-a188-4cfef779774a'
2025-10-16 10:06:03.140 +03:00 [INF] ✅ Processing request for tenant: 8bed874f-cf2a-4ffa-a188-4cfef779774a
2025-10-16 10:06:03.142 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:06:03.144 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:06:03.153 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 10:06:03.167 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 10:06:03.179 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 10:06:03.193 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 44.4973ms
2025-10-16 10:06:03.198 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:06:03.204 +03:00 [ERR] Application exception occurred: Product not found
ModularERP.Common.Exceptions.NotFoundException: Product not found
   at ModularERP.Modules.Inventory.Features.StockTransactions.Handlers.CreateStockTransactionCommandHandler.Handle(CreateStockTransactionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Handlers\CreateStockTransactionCommandHandler.cs:line 42
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create(CreateStockTransactionDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Controllers\StockTransactionsController.cs:line 129
   at lambda_method173(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 319
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_5>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 272
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 10:06:03.240 +03:00 [INF] Error response sent with status code 404
2025-10-16 10:06:03.244 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 404 null application/json; charset=utf-8 154.4858ms
2025-10-16 10:06:18.501 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 322
2025-10-16 10:06:18.511 +03:00 [INF] Request started
2025-10-16 10:06:18.514 +03:00 [INF] === Incoming Request ===
2025-10-16 10:06:18.517 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:06:18.520 +03:00 [INF] Method: POST
2025-10-16 10:06:18.524 +03:00 [INF] === Headers ===
2025-10-16 10:06:18.527 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:06:18.532 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:06:18.537 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:06:18.542 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:06:18.547 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:06:18.552 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:06:18.557 +03:00 [INF] Content-Length: ["322"]
2025-10-16 10:06:18.562 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:06:18.568 +03:00 [INF] Postman-Token: ["fcbaf987-9243-426d-8df1-a41ce0ec354b"]
2025-10-16 10:06:18.575 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:06:18.579 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:06:18.582 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:06:18.589 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:06:18.698 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 99.3328ms
2025-10-16 10:06:18.704 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:06:18.710 +03:00 [ERR] Unexpected error occurred
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
CreateStockTransactionDto -> StockTransaction
ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto -> ModularERP.Modules.Inventory.Features.StockTransactions.Models.StockTransaction
   at lambda_method190(Closure, Object, StockTransaction, ResolutionContext)
   at ModularERP.Modules.Inventory.Features.StockTransactions.Handlers.CreateStockTransactionCommandHandler.Handle(CreateStockTransactionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Handlers\CreateStockTransactionCommandHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create(CreateStockTransactionDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Controllers\StockTransactionsController.cs:line 129
   at lambda_method173(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 319
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_5>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 272
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 10:06:18.756 +03:00 [INF] Error response sent with status code 500
2025-10-16 10:06:18.760 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 500 null application/json; charset=utf-8 258.6108ms
2025-10-16 10:13:00.707 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 323
2025-10-16 10:13:00.713 +03:00 [INF] Request started
2025-10-16 10:13:00.715 +03:00 [INF] === Incoming Request ===
2025-10-16 10:13:00.718 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:13:00.722 +03:00 [INF] Method: POST
2025-10-16 10:13:00.724 +03:00 [INF] === Headers ===
2025-10-16 10:13:00.727 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:13:00.731 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:13:00.735 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:13:00.739 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:13:00.743 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:13:00.748 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:13:00.753 +03:00 [INF] Content-Length: ["323"]
2025-10-16 10:13:00.758 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:13:00.762 +03:00 [INF] Postman-Token: ["f24d43ef-8141-4c11-9495-056fc3ba095a"]
2025-10-16 10:13:00.766 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:13:00.771 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:13:00.774 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:13:00.778 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:13:00.835 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 50.717ms
2025-10-16 10:13:00.841 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:13:00.845 +03:00 [ERR] Unexpected error occurred
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
CreateStockTransactionDto -> StockTransaction
ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto -> ModularERP.Modules.Inventory.Features.StockTransactions.Models.StockTransaction
   at lambda_method190(Closure, Object, StockTransaction, ResolutionContext)
   at ModularERP.Modules.Inventory.Features.StockTransactions.Handlers.CreateStockTransactionCommandHandler.Handle(CreateStockTransactionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Handlers\CreateStockTransactionCommandHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create(CreateStockTransactionDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Controllers\StockTransactionsController.cs:line 129
   at lambda_method173(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 319
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_5>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 272
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 10:13:00.896 +03:00 [INF] Error response sent with status code 500
2025-10-16 10:13:00.900 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 500 null application/json; charset=utf-8 192.3984ms
2025-10-16 10:15:34.977 +03:00 [INF] Starting web host...
2025-10-16 10:15:36.891 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:15:37.020 +03:00 [INF] Executed DbCommand (102ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 10:15:37.146 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:15:37.155 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 10:15:37.176 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 10:15:37.290 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 10:15:37.317 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:15:37.324 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 10:15:37.336 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 10:15:37.353 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 10:15:37.363 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 10:15:37.602 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 10:15:37.628 +03:00 [INF] Master database initialized successfully
2025-10-16 10:15:40.755 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 10:15:40.999 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 10:15:41.002 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 10:15:41.137 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 10:15:41.140 +03:00 [INF] Hosting environment: Development
2025-10-16 10:15:41.143 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 10:15:41.367 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 10:15:41.527 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 162.5955ms
2025-10-16 10:15:41.539 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 10:15:41.539 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 10:15:41.549 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.6952ms
2025-10-16 10:15:41.579 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 39.6849ms
2025-10-16 10:15:41.978 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 10:15:42.362 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 384.4317ms
2025-10-16 10:15:44.608 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 323
2025-10-16 10:15:44.631 +03:00 [INF] Request started
2025-10-16 10:15:44.633 +03:00 [INF] === Incoming Request ===
2025-10-16 10:15:44.636 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:15:44.638 +03:00 [INF] Method: POST
2025-10-16 10:15:44.640 +03:00 [INF] === Headers ===
2025-10-16 10:15:44.646 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:15:44.652 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:15:44.655 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:15:44.657 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:15:44.659 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:15:44.663 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:15:44.666 +03:00 [INF] Content-Length: ["323"]
2025-10-16 10:15:44.670 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:15:44.673 +03:00 [INF] Postman-Token: ["702f5cf3-8e38-4778-9b92-3434f3b8e214"]
2025-10-16 10:15:44.681 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:15:44.683 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:15:44.686 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:15:44.711 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:15:44.722 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 10:15:44.875 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 10:15:45.580 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 10:15:45.736 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 1012.7237ms
2025-10-16 10:15:45.740 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:15:45.744 +03:00 [ERR] Unexpected error occurred
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
CreateStockTransactionDto -> StockTransaction
ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto -> ModularERP.Modules.Inventory.Features.StockTransactions.Models.StockTransaction
   at lambda_method162(Closure, Object, StockTransaction, ResolutionContext)
   at ModularERP.Modules.Inventory.Features.StockTransactions.Handlers.CreateStockTransactionCommandHandler.Handle(CreateStockTransactionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Handlers\CreateStockTransactionCommandHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create(CreateStockTransactionDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Controllers\StockTransactionsController.cs:line 129
   at lambda_method97(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 319
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_5>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 272
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 10:15:45.826 +03:00 [INF] Error response sent with status code 500
2025-10-16 10:15:45.836 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 500 null application/json; charset=utf-8 1228.376ms
2025-10-16 10:21:38.361 +03:00 [INF] Starting web host...
2025-10-16 10:21:40.790 +03:00 [INF] Executed DbCommand (56ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:21:40.955 +03:00 [INF] Executed DbCommand (111ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 10:21:41.156 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:21:41.165 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 10:21:41.185 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 10:21:41.281 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 10:21:41.317 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:21:41.326 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 10:21:41.344 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 10:21:41.367 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 10:21:41.379 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 10:21:41.636 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 10:21:41.658 +03:00 [INF] Master database initialized successfully
2025-10-16 10:21:44.106 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 10:21:44.302 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 10:21:44.306 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 10:21:44.423 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 10:21:44.426 +03:00 [INF] Hosting environment: Development
2025-10-16 10:21:44.428 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 10:21:44.677 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 10:21:44.856 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 181.591ms
2025-10-16 10:21:45.033 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 10:21:45.033 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 10:21:45.050 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 16.6256ms
2025-10-16 10:21:45.085 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 52.0624ms
2025-10-16 10:21:45.136 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 10:21:45.514 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 377.7333ms
2025-10-16 10:21:58.242 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 323
2025-10-16 10:21:58.266 +03:00 [INF] Request started
2025-10-16 10:21:58.269 +03:00 [INF] === Incoming Request ===
2025-10-16 10:21:58.272 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:21:58.274 +03:00 [INF] Method: POST
2025-10-16 10:21:58.277 +03:00 [INF] === Headers ===
2025-10-16 10:21:58.282 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:21:58.287 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:21:58.290 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:21:58.294 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:21:58.299 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:21:58.302 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:21:58.304 +03:00 [INF] Content-Length: ["323"]
2025-10-16 10:21:58.310 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:21:58.313 +03:00 [INF] Postman-Token: ["679b531e-c2cd-4aa1-8577-09c0328388ef"]
2025-10-16 10:21:58.319 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:21:58.322 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:21:58.326 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:21:58.347 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:21:58.358 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 10:21:58.476 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 10:21:59.131 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 10:21:59.223 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 864.5166ms
2025-10-16 10:21:59.228 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:21:59.232 +03:00 [ERR] Unexpected error occurred
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
CreateStockTransactionDto -> StockTransaction
ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto -> ModularERP.Modules.Inventory.Features.StockTransactions.Models.StockTransaction
   at lambda_method162(Closure, Object, StockTransaction, ResolutionContext)
   at ModularERP.Modules.Inventory.Features.StockTransactions.Handlers.CreateStockTransactionCommandHandler.Handle(CreateStockTransactionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Handlers\CreateStockTransactionCommandHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create(CreateStockTransactionDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Controllers\StockTransactionsController.cs:line 129
   at lambda_method97(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 319
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_5>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 272
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 10:21:59.315 +03:00 [INF] Error response sent with status code 500
2025-10-16 10:21:59.325 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 500 null application/json; charset=utf-8 1082.4322ms
2025-10-16 10:25:29.198 +03:00 [INF] Starting web host...
2025-10-16 10:25:30.919 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:25:30.980 +03:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 10:25:31.088 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:25:31.097 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 10:25:31.105 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 10:25:31.181 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 10:25:31.203 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:25:31.208 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 10:25:31.218 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 10:25:31.236 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 10:25:31.243 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 10:25:31.465 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 10:25:31.475 +03:00 [INF] Master database initialized successfully
2025-10-16 10:25:34.608 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 10:25:34.836 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 10:25:34.841 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 10:25:34.981 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 10:25:34.984 +03:00 [INF] Hosting environment: Development
2025-10-16 10:25:34.989 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 10:25:35.342 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 10:25:35.526 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 184.8221ms
2025-10-16 10:25:35.611 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 10:25:35.611 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 10:25:35.627 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 16.6837ms
2025-10-16 10:25:35.643 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 32.6144ms
2025-10-16 10:25:35.701 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 10:25:35.994 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 293.1774ms
2025-10-16 10:26:00.298 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 323
2025-10-16 10:26:00.344 +03:00 [INF] Request started
2025-10-16 10:26:00.349 +03:00 [INF] === Incoming Request ===
2025-10-16 10:26:00.355 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:26:00.359 +03:00 [INF] Method: POST
2025-10-16 10:26:00.366 +03:00 [INF] === Headers ===
2025-10-16 10:26:00.376 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:26:00.386 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:26:00.392 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:26:00.400 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:26:00.407 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:26:00.412 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:26:00.420 +03:00 [INF] Content-Length: ["323"]
2025-10-16 10:26:00.426 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:26:00.433 +03:00 [INF] Postman-Token: ["490a82ad-2657-4592-ab56-fa93fba84b4b"]
2025-10-16 10:26:00.449 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:26:00.452 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:26:00.463 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:26:00.510 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:26:00.528 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 10:26:00.755 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 10:26:01.896 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 10:26:02.031 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 1502.8592ms
2025-10-16 10:26:02.039 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:26:02.048 +03:00 [ERR] Unexpected error occurred
AutoMapper.AutoMapperMappingException: Missing type map configuration or unsupported mapping.

Mapping types:
CreateStockTransactionDto -> StockTransaction
ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto -> ModularERP.Modules.Inventory.Features.StockTransactions.Models.StockTransaction
   at lambda_method162(Closure, Object, StockTransaction, ResolutionContext)
   at ModularERP.Modules.Inventory.Features.StockTransactions.Handlers.CreateStockTransactionCommandHandler.Handle(CreateStockTransactionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Handlers\CreateStockTransactionCommandHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create(CreateStockTransactionDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Controllers\StockTransactionsController.cs:line 129
   at lambda_method97(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 319
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_5>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 272
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 10:26:02.301 +03:00 [INF] Error response sent with status code 500
2025-10-16 10:26:02.322 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 500 null application/json; charset=utf-8 2022.8964ms
2025-10-16 10:26:09.302 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions - application/json 323
2025-10-16 10:26:09.314 +03:00 [INF] Request started
2025-10-16 10:26:09.315 +03:00 [INF] === Incoming Request ===
2025-10-16 10:26:09.318 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:26:09.321 +03:00 [INF] Method: GET
2025-10-16 10:26:09.325 +03:00 [INF] === Headers ===
2025-10-16 10:26:09.327 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:26:09.332 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:26:09.337 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:26:09.344 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:26:09.351 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:26:09.357 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:26:09.364 +03:00 [INF] Content-Length: ["323"]
2025-10-16 10:26:09.369 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:26:09.377 +03:00 [INF] Postman-Token: ["e960e409-165c-4258-b910-dbc75fd33e10"]
2025-10-16 10:26:09.388 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:26:09.394 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:26:09.397 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP)'
2025-10-16 10:26:09.415 +03:00 [INF] Route matched with {action = "GetAll", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]]] GetAll(System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:26:09.468 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP) in 38.849ms
2025-10-16 10:26:09.476 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP)'
2025-10-16 10:26:09.483 +03:00 [ERR] Unexpected error occurred
System.InvalidOperationException: Missing map from ModularERP.Modules.Inventory.Features.StockTransactions.Models.StockTransaction to ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto. Create using CreateMap<StockTransaction, StockTransactionDto>.
   at AutoMapper.QueryableExtensions.Impl.ProjectionBuilder.PolymorphicMaps(ProjectionRequest& request)
   at AutoMapper.QueryableExtensions.Impl.ProjectionBuilder.CreateProjection(ProjectionRequest request)
   at AutoMapper.Internal.LockingConcurrentDictionary`2.<>c__DisplayClass0_1.<.ctor>b__1()
   at System.Lazy`1.ViaFactory(LazyThreadSafetyMode mode)
   at System.Lazy`1.ExecutionAndPublication(LazyHelper executionAndPublication, Boolean useDefaultConstructor)
   at System.Lazy`1.CreateValue()
   at System.Lazy`1.get_Value()
   at AutoMapper.Internal.LockingConcurrentDictionary`2.GetOrAdd(TKey& key)
   at AutoMapper.QueryableExtensions.Impl.ProjectionBuilder.GetProjection(Type sourceType, Type destinationType, Object parameters, MemberPath[] membersToExpand)
   at AutoMapper.QueryableExtensions.Extensions.ToCore(IQueryable source, Type destinationType, IConfigurationProvider configuration, Object parameters, IEnumerable`1 memberPathsToExpand)
   at AutoMapper.QueryableExtensions.Extensions.ToCore[TResult](IQueryable source, IConfigurationProvider configuration, Object parameters, IEnumerable`1 memberPathsToExpand)
   at AutoMapper.QueryableExtensions.Extensions.ProjectTo[TDestination](IQueryable source, IConfigurationProvider configuration, Object parameters, Expression`1[] membersToExpand)
   at AutoMapper.QueryableExtensions.Extensions.ProjectTo[TDestination](IQueryable source, IConfigurationProvider configuration, Expression`1[] membersToExpand)
   at ModularERP.Modules.Inventory.Features.StockTransactions.Handlers.GetAllStockTransactionsQueryHandler.Handle(GetAllStockTransactionsQuery request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Handlers\GetAllStockTransactionsQueryHandler.cs:line 41
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll(Nullable`1 companyId, Nullable`1 warehouseId, Nullable`1 fromDate, Nullable`1 toDate) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Controllers\StockTransactionsController.cs:line 41
   at lambda_method166(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 319
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_5>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 272
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 10:26:09.582 +03:00 [INF] Error response sent with status code 500
2025-10-16 10:26:09.586 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions - 500 null application/json; charset=utf-8 284.2574ms
2025-10-16 10:26:26.076 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions - null null
2025-10-16 10:26:26.085 +03:00 [INF] Request started
2025-10-16 10:26:26.087 +03:00 [INF] === Incoming Request ===
2025-10-16 10:26:26.089 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:26:26.092 +03:00 [INF] Method: GET
2025-10-16 10:26:26.094 +03:00 [INF] === Headers ===
2025-10-16 10:26:26.099 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:26:26.102 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:26:26.106 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:26:26.109 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:26:26.112 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:26:26.115 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:26:26.119 +03:00 [INF] Postman-Token: ["538dadab-a2bc-42da-bc92-6f924b8edc38"]
2025-10-16 10:26:26.123 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:26:26.125 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:26:26.129 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP)'
2025-10-16 10:26:26.133 +03:00 [INF] Route matched with {action = "GetAll", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]]] GetAll(System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:26:26.146 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP) in 4.9525ms
2025-10-16 10:26:26.152 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP)'
2025-10-16 10:26:26.155 +03:00 [ERR] Unexpected error occurred
System.InvalidOperationException: Missing map from ModularERP.Modules.Inventory.Features.StockTransactions.Models.StockTransaction to ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto. Create using CreateMap<StockTransaction, StockTransactionDto>.
   at AutoMapper.QueryableExtensions.Impl.ProjectionBuilder.PolymorphicMaps(ProjectionRequest& request)
   at AutoMapper.QueryableExtensions.Impl.ProjectionBuilder.CreateProjection(ProjectionRequest request)
   at AutoMapper.Internal.LockingConcurrentDictionary`2.<>c__DisplayClass0_1.<.ctor>b__1()
   at System.Lazy`1.ViaFactory(LazyThreadSafetyMode mode)
--- End of stack trace from previous location ---
   at System.LazyHelper.ThrowException()
   at System.Lazy`1.CreateValue()
   at System.Lazy`1.get_Value()
   at AutoMapper.Internal.LockingConcurrentDictionary`2.GetOrAdd(TKey& key)
   at AutoMapper.QueryableExtensions.Impl.ProjectionBuilder.GetProjection(Type sourceType, Type destinationType, Object parameters, MemberPath[] membersToExpand)
   at AutoMapper.QueryableExtensions.Extensions.ToCore(IQueryable source, Type destinationType, IConfigurationProvider configuration, Object parameters, IEnumerable`1 memberPathsToExpand)
   at AutoMapper.QueryableExtensions.Extensions.ToCore[TResult](IQueryable source, IConfigurationProvider configuration, Object parameters, IEnumerable`1 memberPathsToExpand)
   at AutoMapper.QueryableExtensions.Extensions.ProjectTo[TDestination](IQueryable source, IConfigurationProvider configuration, Object parameters, Expression`1[] membersToExpand)
   at AutoMapper.QueryableExtensions.Extensions.ProjectTo[TDestination](IQueryable source, IConfigurationProvider configuration, Expression`1[] membersToExpand)
   at ModularERP.Modules.Inventory.Features.StockTransactions.Handlers.GetAllStockTransactionsQueryHandler.Handle(GetAllStockTransactionsQuery request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Handlers\GetAllStockTransactionsQueryHandler.cs:line 41
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll(Nullable`1 companyId, Nullable`1 warehouseId, Nullable`1 fromDate, Nullable`1 toDate) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Controllers\StockTransactionsController.cs:line 41
   at lambda_method166(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 319
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_5>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 272
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 10:26:26.211 +03:00 [INF] Error response sent with status code 500
2025-10-16 10:26:26.214 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions - 500 null application/json; charset=utf-8 137.9161ms
2025-10-16 10:34:33.187 +03:00 [INF] Starting web host...
2025-10-16 10:34:35.022 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:34:35.109 +03:00 [INF] Executed DbCommand (64ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 10:34:35.232 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:34:35.240 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 10:34:35.249 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 10:34:35.355 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 10:34:35.379 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 10:34:35.386 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 10:34:35.398 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 10:34:35.417 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 10:34:35.424 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 10:34:35.717 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 10:34:35.742 +03:00 [INF] Master database initialized successfully
2025-10-16 10:34:38.114 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 10:34:38.361 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 10:34:38.364 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 10:34:38.469 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 10:34:38.472 +03:00 [INF] Hosting environment: Development
2025-10-16 10:34:38.475 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 10:34:46.895 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions - null null
2025-10-16 10:34:47.084 +03:00 [INF] Request started
2025-10-16 10:34:47.091 +03:00 [INF] === Incoming Request ===
2025-10-16 10:34:47.097 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:34:47.101 +03:00 [INF] Method: GET
2025-10-16 10:34:47.108 +03:00 [INF] === Headers ===
2025-10-16 10:34:47.117 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:34:47.129 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:34:47.134 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:34:47.144 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:34:47.152 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:34:47.163 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:34:47.167 +03:00 [INF] Postman-Token: ["c258b1be-9e90-43c7-b8e6-616b12ae2843"]
2025-10-16 10:34:47.185 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:34:47.189 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:34:47.196 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP)'
2025-10-16 10:34:47.249 +03:00 [INF] Route matched with {action = "GetAll", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]]] GetAll(System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:34:47.274 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 10:34:47.509 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 10:34:49.353 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 10:34:49.771 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 10:34:49.901 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP) in 2627.1934ms
2025-10-16 10:34:49.908 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP)'
2025-10-16 10:34:49.915 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 10:34:49.941 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions - 200 null application/json; charset=utf-8 3048.6213ms
2025-10-16 10:34:57.700 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 323
2025-10-16 10:34:57.717 +03:00 [INF] Request started
2025-10-16 10:34:57.719 +03:00 [INF] === Incoming Request ===
2025-10-16 10:34:57.722 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:34:57.725 +03:00 [INF] Method: POST
2025-10-16 10:34:57.728 +03:00 [INF] === Headers ===
2025-10-16 10:34:57.732 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:34:57.736 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:34:57.742 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:34:57.746 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:34:57.752 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:34:57.757 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:34:57.764 +03:00 [INF] Content-Length: ["323"]
2025-10-16 10:34:57.769 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:34:57.777 +03:00 [INF] Postman-Token: ["110e0eed-5dd1-4267-ba89-06429cd42008"]
2025-10-16 10:34:57.792 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:34:57.799 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:34:57.806 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:34:57.820 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:34:58.554 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 10:34:58.616 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 784.1664ms
2025-10-16 10:34:58.622 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:34:58.629 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 10:34:58.635 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 201 null application/json; charset=utf-8 934.8724ms
2025-10-16 10:39:30.017 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 325
2025-10-16 10:39:30.030 +03:00 [INF] Request started
2025-10-16 10:39:30.031 +03:00 [INF] === Incoming Request ===
2025-10-16 10:39:30.034 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:39:30.039 +03:00 [INF] Method: POST
2025-10-16 10:39:30.042 +03:00 [INF] === Headers ===
2025-10-16 10:39:30.045 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:39:30.050 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:39:30.055 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:39:30.062 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:39:30.068 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:39:30.074 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:39:30.081 +03:00 [INF] Content-Length: ["325"]
2025-10-16 10:39:30.086 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:39:30.094 +03:00 [INF] Postman-Token: ["0bfeabd7-dd28-4a35-8c42-e66e2fd258c8"]
2025-10-16 10:39:30.102 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:39:30.106 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:39:30.112 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:39:30.118 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:39:30.165 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 31.727ms
2025-10-16 10:39:30.173 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 10:39:30.184 +03:00 [ERR] Application exception occurred: Warehouse not found
ModularERP.Common.Exceptions.NotFoundException: Warehouse not found
   at ModularERP.Modules.Inventory.Features.StockTransactions.Handlers.CreateStockTransactionCommandHandler.Handle(CreateStockTransactionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Handlers\CreateStockTransactionCommandHandler.cs:line 49
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create(CreateStockTransactionDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\StockTransactions\Controllers\StockTransactionsController.cs:line 129
   at lambda_method157(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 10:39:30.303 +03:00 [INF] Error response sent with status code 404
2025-10-16 10:39:30.308 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 404 null application/json; charset=utf-8 289.9965ms
2025-10-16 10:42:17.793 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 10:42:18.017 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 223.1548ms
2025-10-16 10:42:18.499 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 10:42:18.499 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 10:42:18.543 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 44.4516ms
2025-10-16 10:42:18.596 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 96.9376ms
2025-10-16 10:42:18.694 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 10:42:19.479 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 784.6707ms
2025-10-16 10:45:09.847 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions - null null
2025-10-16 10:45:09.853 +03:00 [INF] Request started
2025-10-16 10:45:09.855 +03:00 [INF] === Incoming Request ===
2025-10-16 10:45:09.858 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 10:45:09.862 +03:00 [INF] Method: GET
2025-10-16 10:45:09.865 +03:00 [INF] === Headers ===
2025-10-16 10:45:09.868 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:45:09.872 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:45:09.875 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:45:09.885 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:45:09.889 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:45:09.892 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:45:09.897 +03:00 [INF] Postman-Token: ["1a7e8a2c-5783-40fa-baef-3c739f56f621"]
2025-10-16 10:45:09.901 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:45:09.902 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:45:09.906 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP)'
2025-10-16 10:45:09.910 +03:00 [INF] Route matched with {action = "GetAll", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]]] GetAll(System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:45:09.970 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 10:45:09.975 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP) in 56.1856ms
2025-10-16 10:45:09.979 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetAll (ModularERP)'
2025-10-16 10:45:09.984 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 10:45:09.987 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions - 200 null application/json; charset=utf-8 140.4743ms
2025-10-16 10:47:58.370 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/StockTransactions/{98e80f15-4788-4b97-9a3d-1502f9aed607} - application/json 207
2025-10-16 10:47:58.383 +03:00 [INF] Request started
2025-10-16 10:47:58.386 +03:00 [INF] === Incoming Request ===
2025-10-16 10:47:58.389 +03:00 [INF] Path: /api/StockTransactions/%7B98e80f15-4788-4b97-9a3d-1502f9aed607%7D
2025-10-16 10:47:58.395 +03:00 [INF] Method: PUT
2025-10-16 10:47:58.398 +03:00 [INF] === Headers ===
2025-10-16 10:47:58.404 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:47:58.411 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:47:58.418 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:47:58.425 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:47:58.431 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:47:58.438 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 10:47:58.447 +03:00 [INF] Content-Length: ["207"]
2025-10-16 10:47:58.455 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:47:58.462 +03:00 [INF] Postman-Token: ["2116836c-d28b-451a-aa04-870ec3305d54"]
2025-10-16 10:47:58.471 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:47:58.479 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:47:58.484 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Update (ModularERP)'
2025-10-16 10:47:58.500 +03:00 [INF] Route matched with {action = "Update", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Update(System.Guid, ModularERP.Modules.Inventory.Features.StockTransactions.DTO.UpdateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:47:58.697 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 10:47:58.709 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Update (ModularERP) in 195.364ms
2025-10-16 10:47:58.723 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Update (ModularERP)'
2025-10-16 10:47:58.735 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 10:47:58.749 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/StockTransactions/{98e80f15-4788-4b97-9a3d-1502f9aed607} - 200 null application/json; charset=utf-8 379.2875ms
2025-10-16 10:49:51.322 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions/by-product/{b3835495-fed3-4cb4-ba6c-1dd684fab29d"} - null null
2025-10-16 10:49:51.342 +03:00 [INF] Request started
2025-10-16 10:49:51.346 +03:00 [INF] === Incoming Request ===
2025-10-16 10:49:51.350 +03:00 [INF] Path: /api/StockTransactions/by-product/%7Bb3835495-fed3-4cb4-ba6c-1dd684fab29d%22%7D
2025-10-16 10:49:51.360 +03:00 [INF] Method: GET
2025-10-16 10:49:51.365 +03:00 [INF] === Headers ===
2025-10-16 10:49:51.374 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:49:51.382 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:49:51.390 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:49:51.396 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:49:51.404 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:49:51.415 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:49:51.424 +03:00 [INF] Postman-Token: ["d62bb172-d0f5-4e5c-8a50-6dc2afae6e2d"]
2025-10-16 10:49:51.433 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:49:51.437 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:49:51.444 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByProduct (ModularERP)'
2025-10-16 10:49:51.461 +03:00 [INF] Route matched with {action = "GetByProduct", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]]] GetByProduct(System.Guid, System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:49:51.487 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-10-16 10:49:51.531 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByProduct (ModularERP) in 55.5717ms
2025-10-16 10:49:51.537 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByProduct (ModularERP)'
2025-10-16 10:49:51.544 +03:00 [INF] Request completed successfully with status code 400
2025-10-16 10:49:51.548 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions/by-product/{b3835495-fed3-4cb4-ba6c-1dd684fab29d"} - 400 null application/problem+json; charset=utf-8 225.9862ms
2025-10-16 10:50:00.157 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions/by-product/{b3835495-fed3-4cb4-ba6c-1dd684fab29d} - null null
2025-10-16 10:50:00.163 +03:00 [INF] Request started
2025-10-16 10:50:00.167 +03:00 [INF] === Incoming Request ===
2025-10-16 10:50:00.170 +03:00 [INF] Path: /api/StockTransactions/by-product/%7Bb3835495-fed3-4cb4-ba6c-1dd684fab29d%7D
2025-10-16 10:50:00.172 +03:00 [INF] Method: GET
2025-10-16 10:50:00.176 +03:00 [INF] === Headers ===
2025-10-16 10:50:00.179 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:50:00.183 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:50:00.190 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:50:00.194 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:50:00.198 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:50:00.203 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:50:00.208 +03:00 [INF] Postman-Token: ["67c80737-29dc-4bcc-b987-c9ce8627b894"]
2025-10-16 10:50:00.211 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:50:00.213 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:50:00.218 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByProduct (ModularERP)'
2025-10-16 10:50:00.227 +03:00 [INF] Route matched with {action = "GetByProduct", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]]] GetByProduct(System.Guid, System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:50:00.264 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 10:50:00.270 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByProduct (ModularERP) in 35.5661ms
2025-10-16 10:50:00.276 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByProduct (ModularERP)'
2025-10-16 10:50:00.280 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 10:50:00.282 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions/by-product/{b3835495-fed3-4cb4-ba6c-1dd684fab29d} - 200 null application/json; charset=utf-8 124.944ms
2025-10-16 10:50:51.756 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions/by-warehouse/{ac97ee32-5d33-41e8-9a22-30e3162eaed3} - null null
2025-10-16 10:50:51.763 +03:00 [INF] Request started
2025-10-16 10:50:51.767 +03:00 [INF] === Incoming Request ===
2025-10-16 10:50:51.769 +03:00 [INF] Path: /api/StockTransactions/by-warehouse/%7Bac97ee32-5d33-41e8-9a22-30e3162eaed3%7D
2025-10-16 10:50:51.773 +03:00 [INF] Method: GET
2025-10-16 10:50:51.776 +03:00 [INF] === Headers ===
2025-10-16 10:50:51.778 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:50:51.782 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:50:51.787 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:50:51.791 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:50:51.796 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:50:51.800 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:50:51.804 +03:00 [INF] Postman-Token: ["09a92a59-5e2d-4d82-828e-ae5f13406372"]
2025-10-16 10:50:51.809 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:50:51.816 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:50:51.821 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByWarehouse (ModularERP)'
2025-10-16 10:50:51.837 +03:00 [INF] Route matched with {action = "GetByWarehouse", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]]] GetByWarehouse(System.Guid, System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:50:51.927 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 10:50:51.935 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByWarehouse (ModularERP) in 83.6945ms
2025-10-16 10:50:51.943 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByWarehouse (ModularERP)'
2025-10-16 10:50:51.949 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 10:50:51.954 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions/by-warehouse/{ac97ee32-5d33-41e8-9a22-30e3162eaed3} - 200 null application/json; charset=utf-8 198.5848ms
2025-10-16 10:51:27.038 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions/summary - null null
2025-10-16 10:51:27.048 +03:00 [INF] Request started
2025-10-16 10:51:27.053 +03:00 [INF] === Incoming Request ===
2025-10-16 10:51:27.056 +03:00 [INF] Path: /api/StockTransactions/summary
2025-10-16 10:51:27.061 +03:00 [INF] Method: GET
2025-10-16 10:51:27.064 +03:00 [INF] === Headers ===
2025-10-16 10:51:27.066 +03:00 [INF] Accept: ["*/*"]
2025-10-16 10:51:27.071 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 10:51:27.074 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 10:51:27.078 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 10:51:27.083 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 10:51:27.088 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 10:51:27.094 +03:00 [INF] Postman-Token: ["7e1f160c-37b0-4618-b5f9-79da172f5011"]
2025-10-16 10:51:27.103 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 10:51:27.107 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 10:51:27.113 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP)'
2025-10-16 10:51:27.127 +03:00 [INF] Route matched with {action = "GetSummary", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionSummaryDto]]]] GetSummary(System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 10:51:27.321 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 10:51:27.336 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP) in 197.2418ms
2025-10-16 10:51:27.343 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP)'
2025-10-16 10:51:27.348 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 10:51:27.355 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions/summary - 200 null application/json; charset=utf-8 316.9363ms
2025-10-16 11:46:12.040 +03:00 [INF] Starting web host...
2025-10-16 11:46:15.380 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 11:46:15.467 +03:00 [INF] Executed DbCommand (71ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 11:46:15.538 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 11:46:15.544 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 11:46:15.560 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 11:46:15.614 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 11:46:15.630 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 11:46:15.634 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 11:46:15.642 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 11:46:15.657 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 11:46:15.666 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 11:46:15.839 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 11:46:15.847 +03:00 [INF] Master database initialized successfully
2025-10-16 11:46:17.436 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 11:46:17.613 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 11:46:17.616 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 11:46:17.703 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 11:46:17.705 +03:00 [INF] Hosting environment: Development
2025-10-16 11:46:17.708 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 11:46:18.175 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 11:46:18.347 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 173.4666ms
2025-10-16 11:46:18.385 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 11:46:18.386 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 11:46:18.400 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 14.639ms
2025-10-16 11:46:18.420 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 33.9114ms
2025-10-16 11:46:18.599 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 11:46:18.899 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 299.5913ms
2025-10-16 11:46:24.438 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 323
2025-10-16 11:46:24.454 +03:00 [INF] Request started
2025-10-16 11:46:24.457 +03:00 [INF] === Incoming Request ===
2025-10-16 11:46:24.459 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 11:46:24.461 +03:00 [INF] Method: POST
2025-10-16 11:46:24.462 +03:00 [INF] === Headers ===
2025-10-16 11:46:24.465 +03:00 [INF] Accept: ["*/*"]
2025-10-16 11:46:24.467 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 11:46:24.469 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 11:46:24.471 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 11:46:24.472 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 11:46:24.474 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 11:46:24.476 +03:00 [INF] Content-Length: ["323"]
2025-10-16 11:46:24.478 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 11:46:24.479 +03:00 [INF] Postman-Token: ["d161950e-1fba-407c-8be4-4c053f7d77f0"]
2025-10-16 11:46:24.484 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 11:46:24.487 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 11:46:24.489 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 11:46:24.503 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 11:46:24.510 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 11:46:24.607 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 11:46:25.026 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 11:46:25.309 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 11:46:25.341 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 831.7963ms
2025-10-16 11:46:25.344 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 11:46:25.346 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 11:46:25.351 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 201 null application/json; charset=utf-8 912.2065ms
2025-10-16 11:47:21.030 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions/summary - null null
2025-10-16 11:47:21.039 +03:00 [INF] Request started
2025-10-16 11:47:21.041 +03:00 [INF] === Incoming Request ===
2025-10-16 11:47:21.042 +03:00 [INF] Path: /api/StockTransactions/summary
2025-10-16 11:47:21.043 +03:00 [INF] Method: GET
2025-10-16 11:47:21.044 +03:00 [INF] === Headers ===
2025-10-16 11:47:21.045 +03:00 [INF] Accept: ["*/*"]
2025-10-16 11:47:21.046 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 11:47:21.048 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 11:47:21.049 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 11:47:21.050 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 11:47:21.052 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 11:47:21.054 +03:00 [INF] Postman-Token: ["002ccab6-b9f3-428f-8255-78b67efb4326"]
2025-10-16 11:47:21.058 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 11:47:21.060 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 11:47:21.061 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP)'
2025-10-16 11:47:21.066 +03:00 [INF] Route matched with {action = "GetSummary", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionSummaryDto]]]] GetSummary(System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 11:47:21.158 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 11:47:21.165 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP) in 94.213ms
2025-10-16 11:47:21.168 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP)'
2025-10-16 11:47:21.171 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 11:47:21.172 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions/summary - 200 null application/json; charset=utf-8 141.9439ms
2025-10-16 11:54:59.848 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 324
2025-10-16 11:54:59.854 +03:00 [INF] Request started
2025-10-16 11:54:59.856 +03:00 [INF] === Incoming Request ===
2025-10-16 11:54:59.858 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 11:54:59.859 +03:00 [INF] Method: POST
2025-10-16 11:54:59.860 +03:00 [INF] === Headers ===
2025-10-16 11:54:59.861 +03:00 [INF] Accept: ["*/*"]
2025-10-16 11:54:59.862 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 11:54:59.863 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 11:54:59.865 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 11:54:59.866 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 11:54:59.868 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 11:54:59.869 +03:00 [INF] Content-Length: ["324"]
2025-10-16 11:54:59.870 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 11:54:59.872 +03:00 [INF] Postman-Token: ["369df370-a102-4d6c-b8c6-521f601aabe9"]
2025-10-16 11:54:59.874 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 11:54:59.874 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 11:54:59.876 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 11:54:59.877 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 11:54:59.929 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 11:54:59.932 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 52.9663ms
2025-10-16 11:54:59.935 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 11:54:59.937 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 11:54:59.939 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 201 null application/json; charset=utf-8 90.7695ms
2025-10-16 11:55:01.788 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 324
2025-10-16 11:55:01.791 +03:00 [INF] Request started
2025-10-16 11:55:01.792 +03:00 [INF] === Incoming Request ===
2025-10-16 11:55:01.793 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 11:55:01.794 +03:00 [INF] Method: POST
2025-10-16 11:55:01.795 +03:00 [INF] === Headers ===
2025-10-16 11:55:01.796 +03:00 [INF] Accept: ["*/*"]
2025-10-16 11:55:01.797 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 11:55:01.799 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 11:55:01.801 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 11:55:01.803 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 11:55:01.805 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 11:55:01.806 +03:00 [INF] Content-Length: ["324"]
2025-10-16 11:55:01.808 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 11:55:01.809 +03:00 [INF] Postman-Token: ["7ccbf8ac-8cca-4b8f-b10f-17a1dc47e826"]
2025-10-16 11:55:01.811 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 11:55:01.812 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 11:55:01.813 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 11:55:01.814 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 11:55:01.834 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 11:55:01.837 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 20.327ms
2025-10-16 11:55:01.839 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 11:55:01.841 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 11:55:01.842 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 201 null application/json; charset=utf-8 53.5788ms
2025-10-16 11:55:11.042 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions/summary - null null
2025-10-16 11:55:11.047 +03:00 [INF] Request started
2025-10-16 11:55:11.050 +03:00 [INF] === Incoming Request ===
2025-10-16 11:55:11.051 +03:00 [INF] Path: /api/StockTransactions/summary
2025-10-16 11:55:11.052 +03:00 [INF] Method: GET
2025-10-16 11:55:11.054 +03:00 [INF] === Headers ===
2025-10-16 11:55:11.055 +03:00 [INF] Accept: ["*/*"]
2025-10-16 11:55:11.056 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 11:55:11.057 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 11:55:11.059 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 11:55:11.060 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 11:55:11.062 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 11:55:11.064 +03:00 [INF] Postman-Token: ["371fe1b7-570e-46d7-8c9f-fc6f2ea29a38"]
2025-10-16 11:55:11.065 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 11:55:11.067 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 11:55:11.068 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP)'
2025-10-16 11:55:11.069 +03:00 [INF] Route matched with {action = "GetSummary", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionSummaryDto]]]] GetSummary(System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 11:55:11.083 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 11:55:11.087 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP) in 14.5048ms
2025-10-16 11:55:11.089 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP)'
2025-10-16 11:55:11.090 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 11:55:11.092 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions/summary - 200 null application/json; charset=utf-8 49.4852ms
2025-10-16 11:55:36.173 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 324
2025-10-16 11:55:36.177 +03:00 [INF] Request started
2025-10-16 11:55:36.178 +03:00 [INF] === Incoming Request ===
2025-10-16 11:55:36.180 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 11:55:36.182 +03:00 [INF] Method: POST
2025-10-16 11:55:36.183 +03:00 [INF] === Headers ===
2025-10-16 11:55:36.184 +03:00 [INF] Accept: ["*/*"]
2025-10-16 11:55:36.185 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 11:55:36.187 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 11:55:36.189 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 11:55:36.191 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 11:55:36.193 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 11:55:36.195 +03:00 [INF] Content-Length: ["324"]
2025-10-16 11:55:36.196 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 11:55:36.198 +03:00 [INF] Postman-Token: ["d65ff030-4d39-4065-b691-8ed933061ca8"]
2025-10-16 11:55:36.200 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 11:55:36.201 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 11:55:36.202 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 11:55:36.203 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 11:55:36.243 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 11:55:36.247 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 39.9598ms
2025-10-16 11:55:36.249 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 11:55:36.250 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 11:55:36.252 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 201 null application/json; charset=utf-8 79.1705ms
2025-10-16 11:56:08.493 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions/summary - null null
2025-10-16 11:56:08.498 +03:00 [INF] Request started
2025-10-16 11:56:08.499 +03:00 [INF] === Incoming Request ===
2025-10-16 11:56:08.501 +03:00 [INF] Path: /api/StockTransactions/summary
2025-10-16 11:56:08.502 +03:00 [INF] Method: GET
2025-10-16 11:56:08.503 +03:00 [INF] === Headers ===
2025-10-16 11:56:08.504 +03:00 [INF] Accept: ["*/*"]
2025-10-16 11:56:08.505 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 11:56:08.507 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 11:56:08.509 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 11:56:08.510 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 11:56:08.512 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 11:56:08.514 +03:00 [INF] Postman-Token: ["cdf18da4-7014-4a12-ad5e-a997fa4fe010"]
2025-10-16 11:56:08.516 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 11:56:08.517 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 11:56:08.518 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP)'
2025-10-16 11:56:08.519 +03:00 [INF] Route matched with {action = "GetSummary", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionSummaryDto]]]] GetSummary(System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 11:56:08.535 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 11:56:08.537 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP) in 15.1935ms
2025-10-16 11:56:08.540 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP)'
2025-10-16 11:56:08.541 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 11:56:08.542 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions/summary - 200 null application/json; charset=utf-8 48.7929ms
2025-10-16 11:57:46.378 +03:00 [INF] Starting web host...
2025-10-16 11:57:47.649 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 11:57:47.735 +03:00 [INF] Executed DbCommand (68ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 11:57:47.845 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 11:57:47.852 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 11:57:47.862 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 11:57:47.922 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 11:57:47.942 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 11:57:47.946 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 11:57:47.954 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 11:57:47.967 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 11:57:47.974 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 11:57:48.156 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 11:57:48.163 +03:00 [INF] Master database initialized successfully
2025-10-16 11:57:49.912 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 11:57:50.033 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 11:57:50.035 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 11:57:50.112 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 11:57:50.115 +03:00 [INF] Hosting environment: Development
2025-10-16 11:57:50.116 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 11:57:52.324 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 11:57:52.450 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 126.8688ms
2025-10-16 11:57:52.455 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 11:57:52.455 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 11:57:52.464 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.8411ms
2025-10-16 11:57:52.480 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 25.0348ms
2025-10-16 11:57:52.641 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 11:57:52.841 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 200.1967ms
2025-10-16 11:57:58.933 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions/summary - null null
2025-10-16 11:57:58.957 +03:00 [INF] Request started
2025-10-16 11:57:58.960 +03:00 [INF] === Incoming Request ===
2025-10-16 11:57:58.962 +03:00 [INF] Path: /api/StockTransactions/summary
2025-10-16 11:57:58.964 +03:00 [INF] Method: GET
2025-10-16 11:57:58.965 +03:00 [INF] === Headers ===
2025-10-16 11:57:58.967 +03:00 [INF] Accept: ["*/*"]
2025-10-16 11:57:58.971 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 11:57:58.972 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 11:57:58.974 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 11:57:58.976 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 11:57:58.977 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 11:57:58.979 +03:00 [INF] Postman-Token: ["c6a76f2f-f44d-4f9c-807e-84f2fad9f6f5"]
2025-10-16 11:57:58.983 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 11:57:58.985 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 11:57:58.986 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP)'
2025-10-16 11:57:59.005 +03:00 [INF] Route matched with {action = "GetSummary", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionSummaryDto]]]] GetSummary(System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 11:57:59.011 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 11:57:59.092 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 11:57:59.278 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionSummaryDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 11:57:59.302 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP) in 290.7016ms
2025-10-16 11:57:59.304 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetSummary (ModularERP)'
2025-10-16 11:57:59.306 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 11:57:59.311 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions/summary - 200 null application/json; charset=utf-8 378.2411ms
2025-10-16 11:58:10.317 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions/by-warehouse/{ac97ee32-5d33-41e8-9a22-30e3162eaed3} - null null
2025-10-16 11:58:10.326 +03:00 [INF] Request started
2025-10-16 11:58:10.327 +03:00 [INF] === Incoming Request ===
2025-10-16 11:58:10.329 +03:00 [INF] Path: /api/StockTransactions/by-warehouse/%7Bac97ee32-5d33-41e8-9a22-30e3162eaed3%7D
2025-10-16 11:58:10.330 +03:00 [INF] Method: GET
2025-10-16 11:58:10.331 +03:00 [INF] === Headers ===
2025-10-16 11:58:10.332 +03:00 [INF] Accept: ["*/*"]
2025-10-16 11:58:10.333 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 11:58:10.334 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 11:58:10.336 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 11:58:10.338 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 11:58:10.340 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 11:58:10.342 +03:00 [INF] Postman-Token: ["d51fb5fe-6597-4b75-be17-78b2345110dd"]
2025-10-16 11:58:10.345 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 11:58:10.346 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 11:58:10.348 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByWarehouse (ModularERP)'
2025-10-16 11:58:10.352 +03:00 [INF] Route matched with {action = "GetByWarehouse", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]]] GetByWarehouse(System.Guid, System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 11:58:10.885 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 11:58:10.933 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 11:58:10.946 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByWarehouse (ModularERP) in 589.508ms
2025-10-16 11:58:10.950 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByWarehouse (ModularERP)'
2025-10-16 11:58:10.951 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 11:58:10.954 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions/by-warehouse/{ac97ee32-5d33-41e8-9a22-30e3162eaed3} - 200 null application/json; charset=utf-8 637.0957ms
2025-10-16 11:58:35.209 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/StockTransactions/by-product/{b3835495-fed3-4cb4-ba6c-1dd684fab29d} - null null
2025-10-16 11:58:35.215 +03:00 [INF] Request started
2025-10-16 11:58:35.217 +03:00 [INF] === Incoming Request ===
2025-10-16 11:58:35.219 +03:00 [INF] Path: /api/StockTransactions/by-product/%7Bb3835495-fed3-4cb4-ba6c-1dd684fab29d%7D
2025-10-16 11:58:35.221 +03:00 [INF] Method: GET
2025-10-16 11:58:35.222 +03:00 [INF] === Headers ===
2025-10-16 11:58:35.223 +03:00 [INF] Accept: ["*/*"]
2025-10-16 11:58:35.225 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 11:58:35.226 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 11:58:35.229 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 11:58:35.230 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 11:58:35.232 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 11:58:35.234 +03:00 [INF] Postman-Token: ["4a51e9ab-b93a-47ea-be2a-fc09bffcecd6"]
2025-10-16 11:58:35.236 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 11:58:35.237 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 11:58:35.238 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByProduct (ModularERP)'
2025-10-16 11:58:35.242 +03:00 [INF] Route matched with {action = "GetByProduct", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]]] GetByProduct(System.Guid, System.Nullable`1[System.Guid], System.Nullable`1[System.DateTime], System.Nullable`1[System.DateTime]) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 11:58:35.270 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 11:58:35.273 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByProduct (ModularERP) in 26.8127ms
2025-10-16 11:58:35.275 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.GetByProduct (ModularERP)'
2025-10-16 11:58:35.277 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 11:58:35.278 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/StockTransactions/by-product/{b3835495-fed3-4cb4-ba6c-1dd684fab29d} - 200 null application/json; charset=utf-8 68.8992ms
2025-10-16 12:42:29.169 +03:00 [INF] Starting web host...
2025-10-16 12:42:30.265 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 12:42:30.329 +03:00 [INF] Executed DbCommand (48ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 12:42:30.403 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 12:42:30.409 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 12:42:30.428 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 12:42:30.483 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 12:42:30.498 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 12:42:30.502 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 12:42:30.509 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 12:42:30.520 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 12:42:30.526 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 12:42:30.687 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 12:42:30.698 +03:00 [INF] Master database initialized successfully
2025-10-16 12:42:32.212 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 12:42:32.314 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 12:42:32.317 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 12:42:32.405 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 12:42:32.408 +03:00 [INF] Hosting environment: Development
2025-10-16 12:42:32.410 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 12:51:42.486 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 12:51:42.660 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 175.2284ms
2025-10-16 12:51:42.663 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 12:51:42.663 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 12:51:42.676 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 12.7138ms
2025-10-16 12:51:42.700 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 37.612ms
2025-10-16 12:51:42.899 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 12:51:43.151 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 251.5569ms
2025-10-16 12:53:12.639 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/ProductStats - null null
2025-10-16 12:53:12.662 +03:00 [INF] Request started
2025-10-16 12:53:12.665 +03:00 [INF] === Incoming Request ===
2025-10-16 12:53:12.667 +03:00 [INF] Path: /api/ProductStats
2025-10-16 12:53:12.668 +03:00 [INF] Method: GET
2025-10-16 12:53:12.669 +03:00 [INF] === Headers ===
2025-10-16 12:53:12.671 +03:00 [INF] Accept: ["*/*"]
2025-10-16 12:53:12.674 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 12:53:12.675 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 12:53:12.676 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 12:53:12.678 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 12:53:12.680 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 12:53:12.682 +03:00 [INF] Postman-Token: ["7954cd2f-9832-47c9-b43c-941025943c47"]
2025-10-16 12:53:12.686 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 12:53:12.688 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 12:53:12.689 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats (ModularERP)'
2025-10-16 12:53:12.715 +03:00 [INF] Route matched with {action = "GetProductStats", controller = "ProductStats"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.ProductStatsDto]]] GetProductStats(System.Guid, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController (ModularERP).
2025-10-16 12:53:12.721 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 12:53:12.738 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats (ModularERP) in 16.8356ms
2025-10-16 12:53:12.741 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats (ModularERP)'
2025-10-16 12:53:12.749 +03:00 [WRN] Unauthorized access attempt: Company ID not found in token
System.UnauthorizedAccessException: Company ID not found in token
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetCompanyId() in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductStatsController.cs:line 29
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats(Guid productId, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductStatsController.cs:line 43
   at lambda_method97(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 12:53:12.821 +03:00 [INF] Error response sent with status code 403
2025-10-16 12:53:12.825 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/ProductStats - 403 null application/json; charset=utf-8 185.7772ms
2025-10-16 12:55:35.523 +03:00 [INF] Starting web host...
2025-10-16 12:55:36.589 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 12:55:36.654 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 12:55:36.737 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 12:55:36.745 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 12:55:36.756 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 12:55:36.825 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 12:55:36.848 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 12:55:36.853 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 12:55:36.862 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 12:55:36.879 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 12:55:36.887 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 12:55:37.126 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 12:55:37.134 +03:00 [INF] Master database initialized successfully
2025-10-16 12:55:38.918 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 12:55:39.076 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 12:55:39.077 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 12:55:39.168 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 12:55:39.171 +03:00 [INF] Hosting environment: Development
2025-10-16 12:55:39.172 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 12:55:39.443 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 12:55:39.583 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 141.413ms
2025-10-16 12:55:39.730 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 12:55:39.730 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 12:55:39.736 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.9497ms
2025-10-16 12:55:39.756 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.6336ms
2025-10-16 12:55:39.804 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 12:55:40.013 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 208.331ms
2025-10-16 12:55:45.821 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/ProductStats - null null
2025-10-16 12:55:45.836 +03:00 [INF] Request started
2025-10-16 12:55:45.838 +03:00 [INF] === Incoming Request ===
2025-10-16 12:55:45.840 +03:00 [INF] Path: /api/ProductStats
2025-10-16 12:55:45.840 +03:00 [INF] Method: GET
2025-10-16 12:55:45.842 +03:00 [INF] === Headers ===
2025-10-16 12:55:45.845 +03:00 [INF] Accept: ["*/*"]
2025-10-16 12:55:45.849 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 12:55:45.851 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 12:55:45.852 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 12:55:45.853 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 12:55:45.855 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 12:55:45.857 +03:00 [INF] Postman-Token: ["2a7e8dee-9f33-4448-b665-3b9e115b00d3"]
2025-10-16 12:55:45.863 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 12:55:45.864 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 12:55:45.866 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats (ModularERP)'
2025-10-16 12:55:45.881 +03:00 [INF] Route matched with {action = "GetProductStats", controller = "ProductStats"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.ProductStatsDto]]] GetProductStats(System.Guid, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController (ModularERP).
2025-10-16 12:55:45.886 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 12:55:45.937 +03:00 [WRN] Validation failed for GetProductStatsQuery. Errors: [{"PropertyName":"ProductId","ErrorMessage":"Product ID is required"}]
2025-10-16 12:55:45.950 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats (ModularERP) in 63.7781ms
2025-10-16 12:55:45.953 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats (ModularERP)'
2025-10-16 12:55:45.957 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"ProductId":["Product ID is required"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 44
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats(Guid productId, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductStatsController.cs:line 49
   at lambda_method97(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 12:55:46.010 +03:00 [INF] Error response sent with status code 400
2025-10-16 12:55:46.012 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/ProductStats - 400 null application/json; charset=utf-8 190.9464ms
2025-10-16 12:56:33.760 +03:00 [INF] Starting web host...
2025-10-16 12:56:34.768 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 12:56:34.848 +03:00 [INF] Executed DbCommand (65ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 12:56:34.916 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 12:56:34.922 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 12:56:34.927 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 12:56:34.990 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 12:56:35.009 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 12:56:35.014 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 12:56:35.023 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 12:56:35.034 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 12:56:35.039 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 12:56:35.201 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 12:56:35.210 +03:00 [INF] Master database initialized successfully
2025-10-16 12:56:36.695 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 12:56:36.794 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 12:56:36.797 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 12:56:36.872 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 12:56:36.873 +03:00 [INF] Hosting environment: Development
2025-10-16 12:56:36.874 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 12:56:37.200 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 12:56:37.319 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 119.6686ms
2025-10-16 12:56:37.355 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 12:56:37.355 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 12:56:37.361 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.0224ms
2025-10-16 12:56:37.381 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.1852ms
2025-10-16 12:56:37.406 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 12:56:37.578 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 171.3393ms
2025-10-16 12:57:12.122 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/products/{b3835495-fed3-4cb4-ba6c-1dd684fab29d}/stats - null null
2025-10-16 12:57:12.145 +03:00 [INF] Request started
2025-10-16 12:57:12.149 +03:00 [INF] === Incoming Request ===
2025-10-16 12:57:12.152 +03:00 [INF] Path: /api/products/%7Bb3835495-fed3-4cb4-ba6c-1dd684fab29d%7D/stats
2025-10-16 12:57:12.153 +03:00 [INF] Method: GET
2025-10-16 12:57:12.154 +03:00 [INF] === Headers ===
2025-10-16 12:57:12.156 +03:00 [INF] Accept: ["*/*"]
2025-10-16 12:57:12.159 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 12:57:12.160 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 12:57:12.161 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 12:57:12.163 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 12:57:12.165 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 12:57:12.167 +03:00 [INF] Postman-Token: ["15ac255d-66d1-43d6-be92-62f6b21d2037"]
2025-10-16 12:57:12.172 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 12:57:12.174 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 12:57:12.175 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats (ModularERP)'
2025-10-16 12:57:12.195 +03:00 [INF] Route matched with {action = "GetProductStats", controller = "ProductStats"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.ProductStatsDto]]] GetProductStats(System.Guid, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController (ModularERP).
2025-10-16 12:57:12.201 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 12:57:12.305 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 12:57:12.816 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 12:57:12.913 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.ProductStatsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 12:57:12.935 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats (ModularERP) in 733.7065ms
2025-10-16 12:57:12.938 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.GetProductStats (ModularERP)'
2025-10-16 12:57:12.940 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 12:57:12.945 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/products/{b3835495-fed3-4cb4-ba6c-1dd684fab29d}/stats - 200 null application/json; charset=utf-8 823.6977ms
2025-10-16 12:58:25.912 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/products/{b3835495-fed3-4cb4-ba6c-1dd684fab29d}/stats/refresh - null null
2025-10-16 12:58:25.921 +03:00 [INF] Request started
2025-10-16 12:58:25.923 +03:00 [INF] === Incoming Request ===
2025-10-16 12:58:25.924 +03:00 [INF] Path: /api/products/%7Bb3835495-fed3-4cb4-ba6c-1dd684fab29d%7D/stats/refresh
2025-10-16 12:58:25.926 +03:00 [INF] Method: GET
2025-10-16 12:58:25.927 +03:00 [INF] === Headers ===
2025-10-16 12:58:25.929 +03:00 [INF] Accept: ["*/*"]
2025-10-16 12:58:25.930 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 12:58:25.931 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 12:58:25.933 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 12:58:25.934 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 12:58:25.935 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 12:58:25.937 +03:00 [INF] Postman-Token: ["9fb4d313-a623-4fc9-93c6-bf9865cf92ba"]
2025-10-16 12:58:25.942 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 12:58:25.944 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 12:58:25.945 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP)'
2025-10-16 12:58:25.950 +03:00 [INF] Route matched with {action = "RefreshProductStats", controller = "ProductStats"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.RefreshStatsResultDto]]] RefreshProductStats(System.Guid, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController (ModularERP).
2025-10-16 12:58:26.202 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.RefreshStatsResultDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 12:58:26.207 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP) in 253.6482ms
2025-10-16 12:58:26.211 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP)'
2025-10-16 12:58:26.212 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 12:58:26.213 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/products/{b3835495-fed3-4cb4-ba6c-1dd684fab29d}/stats/refresh - 200 null application/json; charset=utf-8 301.9482ms
2025-10-16 13:00:12.681 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/products/{73fcc544-cb2f-465d-9250-37a5f8a45139}/stats/refresh - null null
2025-10-16 13:00:12.688 +03:00 [INF] Request started
2025-10-16 13:00:12.690 +03:00 [INF] === Incoming Request ===
2025-10-16 13:00:12.691 +03:00 [INF] Path: /api/products/%7B73fcc544-cb2f-465d-9250-37a5f8a45139%7D/stats/refresh
2025-10-16 13:00:12.692 +03:00 [INF] Method: GET
2025-10-16 13:00:12.693 +03:00 [INF] === Headers ===
2025-10-16 13:00:12.694 +03:00 [INF] Accept: ["*/*"]
2025-10-16 13:00:12.696 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 13:00:12.698 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 13:00:12.699 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 13:00:12.700 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 13:00:12.702 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 13:00:12.704 +03:00 [INF] Postman-Token: ["4f17dad7-49a8-42e2-9fe7-224a31bda12c"]
2025-10-16 13:00:12.707 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 13:00:12.708 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 13:00:12.709 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP)'
2025-10-16 13:00:12.710 +03:00 [INF] Route matched with {action = "RefreshProductStats", controller = "ProductStats"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.RefreshStatsResultDto]]] RefreshProductStats(System.Guid, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController (ModularERP).
2025-10-16 13:00:12.747 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.RefreshStatsResultDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 13:00:12.750 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP) in 36.4674ms
2025-10-16 13:00:12.752 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP)'
2025-10-16 13:00:12.754 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 13:00:12.755 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/products/{73fcc544-cb2f-465d-9250-37a5f8a45139}/stats/refresh - 200 null application/json; charset=utf-8 73.6017ms
2025-10-16 13:01:43.829 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/products/{1fae8b7e-132b-41ff-bffa-e48a1c822176}/stats/refresh - null null
2025-10-16 13:01:43.834 +03:00 [INF] Request started
2025-10-16 13:01:43.835 +03:00 [INF] === Incoming Request ===
2025-10-16 13:01:43.836 +03:00 [INF] Path: /api/products/%7B1fae8b7e-132b-41ff-bffa-e48a1c822176%7D/stats/refresh
2025-10-16 13:01:43.837 +03:00 [INF] Method: GET
2025-10-16 13:01:43.838 +03:00 [INF] === Headers ===
2025-10-16 13:01:43.840 +03:00 [INF] Accept: ["*/*"]
2025-10-16 13:01:43.841 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 13:01:43.843 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 13:01:43.844 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 13:01:43.846 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 13:01:43.847 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 13:01:43.849 +03:00 [INF] Postman-Token: ["1c82e69c-01cb-47da-bc13-42ad1c399ee0"]
2025-10-16 13:01:43.851 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 13:01:43.856 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 13:01:43.857 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP)'
2025-10-16 13:01:43.859 +03:00 [INF] Route matched with {action = "RefreshProductStats", controller = "ProductStats"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.RefreshStatsResultDto]]] RefreshProductStats(System.Guid, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController (ModularERP).
2025-10-16 13:01:43.886 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.RefreshStatsResultDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 13:01:43.889 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP) in 27.4247ms
2025-10-16 13:01:43.892 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP)'
2025-10-16 13:01:43.894 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 13:01:43.896 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/products/{1fae8b7e-132b-41ff-bffa-e48a1c822176}/stats/refresh - 200 null application/json; charset=utf-8 66.8738ms
2025-10-16 13:03:53.904 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/products/{b3835495-fed3-4cb4-ba6c-1dd684fab29d}/stats/refresh - null null
2025-10-16 13:03:53.908 +03:00 [INF] Request started
2025-10-16 13:03:53.909 +03:00 [INF] === Incoming Request ===
2025-10-16 13:03:53.909 +03:00 [INF] Path: /api/products/%7Bb3835495-fed3-4cb4-ba6c-1dd684fab29d%7D/stats/refresh
2025-10-16 13:03:53.910 +03:00 [INF] Method: GET
2025-10-16 13:03:53.912 +03:00 [INF] === Headers ===
2025-10-16 13:03:53.914 +03:00 [INF] Accept: ["*/*"]
2025-10-16 13:03:53.916 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 13:03:53.917 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 13:03:53.920 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 13:03:53.921 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 13:03:53.922 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 13:03:53.924 +03:00 [INF] Postman-Token: ["08d49a96-82ce-45ec-b11e-5cc1e89ea1f0"]
2025-10-16 13:03:53.925 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 13:03:53.926 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 13:03:53.927 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP)'
2025-10-16 13:03:53.929 +03:00 [INF] Route matched with {action = "RefreshProductStats", controller = "ProductStats"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.RefreshStatsResultDto]]] RefreshProductStats(System.Guid, System.Threading.CancellationToken) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController (ModularERP).
2025-10-16 13:03:53.957 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ProductStats.RefreshStatsResultDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 13:03:53.959 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP) in 27.0876ms
2025-10-16 13:03:53.961 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductStatsController.RefreshProductStats (ModularERP)'
2025-10-16 13:03:53.962 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 13:03:53.964 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/products/{b3835495-fed3-4cb4-ba6c-1dd684fab29d}/stats/refresh - 200 null application/json; charset=utf-8 60.1869ms
2025-10-16 15:26:50.582 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 15:26:50.607 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 24.7681ms
2025-10-16 15:26:50.618 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 15:26:50.649 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 15:26:50.655 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 36.7641ms
2025-10-16 15:26:50.680 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.6431ms
2025-10-16 15:26:50.742 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 15:26:50.968 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 225.9803ms
2025-10-16 15:27:11.763 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 326
2025-10-16 15:27:11.767 +03:00 [INF] Request started
2025-10-16 15:27:11.768 +03:00 [INF] === Incoming Request ===
2025-10-16 15:27:11.769 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 15:27:11.770 +03:00 [INF] Method: POST
2025-10-16 15:27:11.772 +03:00 [INF] === Headers ===
2025-10-16 15:27:11.773 +03:00 [INF] Accept: ["*/*"]
2025-10-16 15:27:11.774 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 15:27:11.776 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 15:27:11.777 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 15:27:11.779 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 15:27:11.780 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 15:27:11.782 +03:00 [INF] Content-Length: ["326"]
2025-10-16 15:27:11.783 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 15:27:11.785 +03:00 [INF] Postman-Token: ["03801da6-ea93-4225-846c-367e723b827e"]
2025-10-16 15:27:11.786 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 15:27:11.787 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 15:27:11.788 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 15:27:11.792 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 15:27:11.887 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 15:27:12.080 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 15:27:12.102 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 308.2451ms
2025-10-16 15:27:12.106 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 15:27:12.107 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 15:27:12.108 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 201 null application/json; charset=utf-8 344.5726ms
2025-10-16 15:34:44.819 +03:00 [INF] Starting web host...
2025-10-16 15:34:46.043 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 15:34:46.134 +03:00 [INF] Executed DbCommand (70ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 15:34:46.237 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 15:34:46.243 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 15:34:46.261 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 15:34:46.326 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 15:34:46.343 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 15:34:46.347 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 15:34:46.355 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 15:34:46.368 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 15:34:46.375 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 15:34:46.550 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 15:34:46.557 +03:00 [INF] Master database initialized successfully
2025-10-16 15:34:48.138 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 15:34:48.370 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 15:34:48.371 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 15:34:48.447 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 15:34:48.449 +03:00 [INF] Hosting environment: Development
2025-10-16 15:34:48.450 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 15:34:48.624 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 15:34:48.804 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 180.4553ms
2025-10-16 15:34:48.934 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 15:34:48.934 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 15:34:48.940 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.9614ms
2025-10-16 15:34:48.960 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.1157ms
2025-10-16 15:34:49.008 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 15:34:49.225 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 216.6369ms
2025-10-16 15:35:25.311 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 326
2025-10-16 15:35:25.331 +03:00 [INF] Request started
2025-10-16 15:35:25.333 +03:00 [INF] === Incoming Request ===
2025-10-16 15:35:25.335 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 15:35:25.336 +03:00 [INF] Method: POST
2025-10-16 15:35:25.338 +03:00 [INF] === Headers ===
2025-10-16 15:35:25.342 +03:00 [INF] Accept: ["*/*"]
2025-10-16 15:35:25.344 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 15:35:25.346 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 15:35:25.347 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 15:35:25.349 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 15:35:25.351 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 15:35:25.353 +03:00 [INF] Content-Length: ["326"]
2025-10-16 15:35:25.355 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 15:35:25.357 +03:00 [INF] Postman-Token: ["fa2f73ac-8536-40d3-acf5-fbb8c34075d0"]
2025-10-16 15:35:25.362 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 15:35:25.363 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 15:35:25.365 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 15:35:25.385 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 15:35:25.392 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 15:35:25.504 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 15:35:26.053 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 15:35:26.467 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 15:35:26.500 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 1107.8808ms
2025-10-16 15:35:26.503 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 15:35:26.506 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 15:35:26.512 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 201 null application/json; charset=utf-8 1200.5837ms
2025-10-16 15:41:43.963 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 326
2025-10-16 15:41:43.973 +03:00 [INF] Request started
2025-10-16 15:41:43.974 +03:00 [INF] === Incoming Request ===
2025-10-16 15:41:43.976 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 15:41:43.977 +03:00 [INF] Method: POST
2025-10-16 15:41:43.978 +03:00 [INF] === Headers ===
2025-10-16 15:41:43.980 +03:00 [INF] Accept: ["*/*"]
2025-10-16 15:41:43.984 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 15:41:43.986 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 15:41:43.987 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 15:41:43.989 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 15:41:43.990 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 15:41:43.992 +03:00 [INF] Content-Length: ["326"]
2025-10-16 15:41:43.995 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 15:41:43.999 +03:00 [INF] Postman-Token: ["472b7147-21ee-422c-b62b-47e34e9b8b26"]
2025-10-16 15:41:44.003 +03:00 [INF] 🔍 TenantService returned: '7e4a49eb-2e0e-4be8-8d60-c13d7db0f018'
2025-10-16 15:41:44.004 +03:00 [INF] ✅ Processing request for tenant: 7e4a49eb-2e0e-4be8-8d60-c13d7db0f018
2025-10-16 15:41:44.006 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 15:41:44.008 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 15:41:44.070 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 15:41:44.073 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 58.4514ms
2025-10-16 15:41:44.075 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 15:41:44.077 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 15:41:44.081 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 201 null application/json; charset=utf-8 118.305ms
2025-10-16 16:10:10.763 +03:00 [INF] Starting web host...
2025-10-16 16:10:14.603 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 16:10:14.686 +03:00 [INF] Executed DbCommand (64ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 16:10:14.801 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 16:10:14.807 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 16:10:14.816 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 16:10:14.887 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 16:10:14.909 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 16:10:14.914 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 16:10:14.922 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 16:10:14.935 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 16:10:14.942 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 16:10:15.212 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 16:10:15.225 +03:00 [INF] Master database initialized successfully
2025-10-16 16:10:17.596 +03:00 [FTL] Host terminated unexpectedly
System.InvalidOperationException: An error was generated for warning 'Microsoft.EntityFrameworkCore.Migrations.PendingModelChangesWarning': The model for context 'FinanceDbContext' has pending changes. Add a new migration before updating the database. See https://aka.ms/efcore-docs-pending-changes. This exception can be suppressed or logged by passing event ID 'RelationalEventId.PendingModelChangesWarning' to the 'ConfigureWarnings' method in 'DbContext.OnConfiguring' or 'AddDbContext'.
   at Microsoft.EntityFrameworkCore.Diagnostics.EventDefinition`1.Log[TLoggerCategory](IDiagnosticsLogger`1 logger, TParam arg)
   at Microsoft.EntityFrameworkCore.Diagnostics.RelationalLoggerExtensions.PendingModelChangesWarning(IDiagnosticsLogger`1 diagnostics, Type contextType)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.ValidateMigrations(Boolean useTransaction, String targetMigration)
   at Microsoft.EntityFrameworkCore.Migrations.Internal.Migrator.Migrate(String targetMigration)
   at Microsoft.EntityFrameworkCore.RelationalDatabaseFacadeExtensions.Migrate(DatabaseFacade databaseFacade)
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 262
2025-10-16 16:12:37.636 +03:00 [INF] Starting web host...
2025-10-16 16:12:38.051 +03:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 251
2025-10-16 16:13:13.034 +03:00 [INF] Starting web host...
2025-10-16 16:13:13.455 +03:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 251
2025-10-16 16:14:01.788 +03:00 [INF] Starting web host...
2025-10-16 16:14:02.163 +03:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 251
2025-10-16 16:29:01.380 +03:00 [INF] Starting web host...
2025-10-16 16:29:04.257 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 16:29:04.355 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 16:29:04.425 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 16:29:04.430 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 16:29:04.447 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 16:29:04.504 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 16:29:04.520 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 16:29:04.525 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 16:29:04.532 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 16:29:04.547 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 16:29:04.554 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 16:29:04.715 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 16:29:04.723 +03:00 [INF] Master database initialized successfully
2025-10-16 16:29:06.349 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 16:29:06.472 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 16:29:06.475 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 16:29:06.548 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 16:29:06.551 +03:00 [INF] Hosting environment: Development
2025-10-16 16:29:06.552 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 16:29:06.960 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 16:29:07.133 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 174.3704ms
2025-10-16 16:29:07.142 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 16:29:07.142 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 16:29:07.161 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 18.3885ms
2025-10-16 16:29:07.190 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 48.0069ms
2025-10-16 16:29:07.359 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 16:29:07.578 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 219.488ms
2025-10-16 16:31:59.181 +03:00 [INF] Starting web host...
2025-10-16 16:32:00.193 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 16:32:00.276 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 16:32:00.347 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 16:32:00.353 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 16:32:00.369 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 16:32:00.435 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 16:32:00.453 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 16:32:00.457 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 16:32:00.464 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 16:32:00.476 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 16:32:00.485 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 16:32:00.656 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 16:32:00.664 +03:00 [INF] Master database initialized successfully
2025-10-16 16:32:02.256 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 16:32:02.362 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 16:32:02.365 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 16:32:02.441 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 16:32:02.444 +03:00 [INF] Hosting environment: Development
2025-10-16 16:32:02.445 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 16:32:02.598 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 16:32:02.750 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 152.761ms
2025-10-16 16:32:02.750 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 16:32:02.750 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 16:32:02.761 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.0355ms
2025-10-16 16:32:02.788 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 37.8519ms
2025-10-16 16:32:02.850 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 16:32:03.025 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 175.1238ms
2025-10-16 18:17:58.712 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Tenants/create - application/json 57
2025-10-16 18:17:58.774 +03:00 [INF] Request started
2025-10-16 18:17:58.777 +03:00 [INF] === Incoming Request ===
2025-10-16 18:17:58.778 +03:00 [INF] Path: /api/Tenants/create
2025-10-16 18:17:58.780 +03:00 [INF] Method: POST
2025-10-16 18:17:58.781 +03:00 [INF] === Headers ===
2025-10-16 18:17:58.783 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:17:58.789 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:17:58.791 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:17:58.795 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:17:58.797 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:17:58.800 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:17:58.806 +03:00 [INF] Content-Length: ["57"]
2025-10-16 18:17:58.809 +03:00 [INF] X-Tenant-ID: ["7e4a49eb-2e0e-4be8-8d60-c13d7db0f018"]
2025-10-16 18:17:58.814 +03:00 [INF] Postman-Token: ["62fdb3de-567f-4f65-8fcd-34ea5ceeb869"]
2025-10-16 18:17:58.824 +03:00 [INF] Executing endpoint 'ModularERP.Common.Controller.TenantsController.CreateTenant (ModularERP)'
2025-10-16 18:17:58.852 +03:00 [INF] Route matched with {action = "CreateTenant", controller = "Tenants"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateTenant(ModularERP.Common.Controller.CreateTenantRequest) on controller ModularERP.Common.Controller.TenantsController (ModularERP).
2025-10-16 18:17:59.104 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (Size = 3), @p3='?' (Size = 4000), @p4='?' (Size = 100), @p5='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [MasterCompanies] ([Id], [CreatedAt], [CurrencyCode], [DatabaseName], [Name], [Status])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-10-16 18:17:59.164 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 18:18:02.011 +03:00 [INF] Applied 7 migrations to database ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4
2025-10-16 18:18:02.012 +03:00 [INF] Created tenant database for company "6f81c000-285c-4e6a-8125-bc36d14ac4ad": ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4
2025-10-16 18:18:02.021 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`5[[System.Guid, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 18:18:02.040 +03:00 [INF] Executed action ModularERP.Common.Controller.TenantsController.CreateTenant (ModularERP) in 3181.0376ms
2025-10-16 18:18:02.042 +03:00 [INF] Executed endpoint 'ModularERP.Common.Controller.TenantsController.CreateTenant (ModularERP)'
2025-10-16 18:18:02.045 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 18:18:02.049 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Tenants/create - 200 null application/json; charset=utf-8 3336.9931ms
2025-10-16 18:19:39.030 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/TaxComponent - application/json 133
2025-10-16 18:19:39.041 +03:00 [INF] Request started
2025-10-16 18:19:39.044 +03:00 [INF] === Incoming Request ===
2025-10-16 18:19:39.045 +03:00 [INF] Path: /api/TaxComponent
2025-10-16 18:19:39.046 +03:00 [INF] Method: POST
2025-10-16 18:19:39.047 +03:00 [INF] === Headers ===
2025-10-16 18:19:39.048 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:19:39.049 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:19:39.051 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:19:39.052 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:19:39.054 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:19:39.057 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:19:39.059 +03:00 [INF] Content-Length: ["133"]
2025-10-16 18:19:39.061 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:19:39.062 +03:00 [INF] Postman-Token: ["64a6ea6a-693d-4ec3-965d-af6917a6f997"]
2025-10-16 18:19:39.065 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:19:39.066 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:19:39.068 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxComponentController.Create (ModularERP)'
2025-10-16 18:19:39.091 +03:00 [INF] Route matched with {action = "Create", controller = "TaxComponent"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.TaxManagement.DTO.TaxComponentDto]]] Create(ModularERP.Modules.Inventory.Features.TaxManagement.Commends.CreateTaxComponentCommand) on controller ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxComponentController (ModularERP).
2025-10-16 18:19:39.096 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 18:19:39.290 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 18:19:41.108 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 18:19:41.334 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.TaxManagement.DTO.TaxComponentDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 18:19:41.347 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxComponentController.Create (ModularERP) in 2252.5101ms
2025-10-16 18:19:41.350 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxComponentController.Create (ModularERP)'
2025-10-16 18:19:41.351 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 18:19:41.353 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/TaxComponent - 200 null application/json; charset=utf-8 2322.261ms
2025-10-16 18:19:52.489 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/TaxProfile - application/json 254
2025-10-16 18:19:52.494 +03:00 [INF] Request started
2025-10-16 18:19:52.495 +03:00 [INF] === Incoming Request ===
2025-10-16 18:19:52.496 +03:00 [INF] Path: /api/TaxProfile
2025-10-16 18:19:52.497 +03:00 [INF] Method: POST
2025-10-16 18:19:52.498 +03:00 [INF] === Headers ===
2025-10-16 18:19:52.499 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:19:52.501 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:19:52.503 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:19:52.505 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:19:52.506 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:19:52.508 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:19:52.510 +03:00 [INF] Content-Length: ["254"]
2025-10-16 18:19:52.511 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:19:52.513 +03:00 [INF] Postman-Token: ["3ef7ce26-8765-428f-8928-696c54ac3311"]
2025-10-16 18:19:52.515 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:19:52.516 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:19:52.517 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxProfileController.Create (ModularERP)'
2025-10-16 18:19:52.522 +03:00 [INF] Route matched with {action = "Create", controller = "TaxProfile"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.TaxManagement.DTO.TaxProfileDto]]] Create(ModularERP.Modules.Inventory.Features.TaxManagement.Commends.CreateTaxProfileCommand) on controller ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxProfileController (ModularERP).
2025-10-16 18:19:52.639 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxProfileController.Create (ModularERP) in 113.7115ms
2025-10-16 18:19:52.642 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxProfileController.Create (ModularERP)'
2025-10-16 18:19:52.645 +03:00 [WRN] Business logic exception occurred: One or more tax components not found
ModularERP.Common.Exceptions.BusinessLogicException: One or more tax components not found
   at ModularERP.Modules.Inventory.Features.TaxManagement.Handlers.CreateTaxProfileHandler.Handle(CreateTaxProfileCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\TaxManagement\Handlers\CreateTaxProfileHandler.cs:line 51
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxProfileController.Create(CreateTaxProfileCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\TaxManagement\Controllers\TaxProfileController.cs:line 39
   at lambda_method353(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:19:52.799 +03:00 [INF] Error response sent with status code 400
2025-10-16 18:19:52.801 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/TaxProfile - 400 null application/json; charset=utf-8 312.6127ms
2025-10-16 18:20:07.674 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/TaxProfile - application/json 254
2025-10-16 18:20:07.678 +03:00 [INF] Request started
2025-10-16 18:20:07.679 +03:00 [INF] === Incoming Request ===
2025-10-16 18:20:07.680 +03:00 [INF] Path: /api/TaxProfile
2025-10-16 18:20:07.681 +03:00 [INF] Method: POST
2025-10-16 18:20:07.683 +03:00 [INF] === Headers ===
2025-10-16 18:20:07.684 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:20:07.686 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:20:07.687 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:20:07.689 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:20:07.691 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:20:07.692 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:20:07.694 +03:00 [INF] Content-Length: ["254"]
2025-10-16 18:20:07.696 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:20:07.697 +03:00 [INF] Postman-Token: ["bb87efa4-ec43-4084-ad09-ca76ee4372f4"]
2025-10-16 18:20:07.700 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:20:07.701 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:20:07.702 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxProfileController.Create (ModularERP)'
2025-10-16 18:20:07.704 +03:00 [INF] Route matched with {action = "Create", controller = "TaxProfile"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.TaxManagement.DTO.TaxProfileDto]]] Create(ModularERP.Modules.Inventory.Features.TaxManagement.Commends.CreateTaxProfileCommand) on controller ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxProfileController (ModularERP).
2025-10-16 18:20:07.772 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.TaxManagement.DTO.TaxProfileDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 18:20:07.778 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxProfileController.Create (ModularERP) in 71.7765ms
2025-10-16 18:20:07.781 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.TaxManagement.Controllers.TaxProfileController.Create (ModularERP)'
2025-10-16 18:20:07.782 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 18:20:07.784 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/TaxProfile - 200 null application/json; charset=utf-8 109.831ms
2025-10-16 18:21:14.261 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates - application/json 232
2025-10-16 18:21:14.266 +03:00 [INF] Request started
2025-10-16 18:21:14.269 +03:00 [INF] === Incoming Request ===
2025-10-16 18:21:14.270 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:21:14.273 +03:00 [INF] Method: POST
2025-10-16 18:21:14.274 +03:00 [INF] === Headers ===
2025-10-16 18:21:14.276 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:21:14.278 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:21:14.281 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:21:14.283 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:21:14.285 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:21:14.290 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:21:14.293 +03:00 [INF] Content-Length: ["232"]
2025-10-16 18:21:14.296 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:21:14.298 +03:00 [INF] Postman-Token: ["16efedaf-e424-4d43-b89c-f9055e3173a9"]
2025-10-16 18:21:14.301 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:21:14.303 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:21:14.305 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:21:14.348 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:21:14.552 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 201.0555ms
2025-10-16 18:21:14.556 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:21:14.558 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitTemplates_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9e4abd0f-4283-4e3f-ac78-88195df100d6
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler.Handle(CreateUnitTemplateCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\CreateUnitTemplateHandler.cs:line 41
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create(CreateUnitTemplateDto dto, CreateUnitTemplateHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 71
   at lambda_method549(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:21:14.634 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:21:14.635 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates - 500 null application/json; charset=utf-8 374.1458ms
2025-10-16 18:22:01.978 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Companies - application/json 58
2025-10-16 18:22:01.982 +03:00 [INF] Request started
2025-10-16 18:22:01.983 +03:00 [INF] === Incoming Request ===
2025-10-16 18:22:01.984 +03:00 [INF] Path: /api/Companies
2025-10-16 18:22:01.985 +03:00 [INF] Method: POST
2025-10-16 18:22:01.986 +03:00 [INF] === Headers ===
2025-10-16 18:22:01.986 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:22:01.988 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:22:01.990 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:22:01.992 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:22:01.993 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:22:01.994 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:22:01.996 +03:00 [INF] Content-Length: ["58"]
2025-10-16 18:22:01.997 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:22:01.999 +03:00 [INF] Postman-Token: ["b3889d77-e225-4f93-ac0a-c71dcd1f9c7f"]
2025-10-16 18:22:02.002 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:22:02.004 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:22:02.006 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Finance.Features.Companys.Controllers.CompaniesController.CreateCompany (ModularERP)'
2025-10-16 18:22:02.010 +03:00 [INF] Route matched with {action = "CreateCompany", controller = "Companies"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Finance.Features.Companys.DTO.CompanyResponseDto]]] CreateCompany(ModularERP.Modules.Finance.Features.Companys.DTO.CreateCompanyDto) on controller ModularERP.Modules.Finance.Features.Companys.Controllers.CompaniesController (ModularERP).
2025-10-16 18:22:02.051 +03:00 [INF] Creating new company with name: ITechProMaxFax
2025-10-16 18:22:02.121 +03:00 [INF] Successfully created company with ID: "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 18:22:02.125 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Finance.Features.Companys.DTO.CompanyResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 18:22:02.140 +03:00 [INF] Executed action ModularERP.Modules.Finance.Features.Companys.Controllers.CompaniesController.CreateCompany (ModularERP) in 126.5882ms
2025-10-16 18:22:02.143 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Finance.Features.Companys.Controllers.CompaniesController.CreateCompany (ModularERP)'
2025-10-16 18:22:02.144 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 18:22:02.145 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Companies - 201 null application/json; charset=utf-8 167.0809ms
2025-10-16 18:25:12.375 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - application/json 232
2025-10-16 18:25:12.379 +03:00 [INF] Request started
2025-10-16 18:25:12.380 +03:00 [INF] === Incoming Request ===
2025-10-16 18:25:12.381 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:25:12.382 +03:00 [INF] Method: POST
2025-10-16 18:25:12.384 +03:00 [INF] === Headers ===
2025-10-16 18:25:12.385 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:25:12.386 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:25:12.388 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:25:12.389 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:25:12.390 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:25:12.392 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:25:12.393 +03:00 [INF] Content-Length: ["232"]
2025-10-16 18:25:12.395 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:25:12.397 +03:00 [INF] Postman-Token: ["6f6f92bd-dc86-4e32-87d1-b614dd043db1"]
2025-10-16 18:25:12.399 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:25:12.400 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:25:12.401 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:25:12.402 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:25:12.439 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 34.4974ms
2025-10-16 18:25:12.442 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:25:12.443 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitTemplates_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9e4abd0f-4283-4e3f-ac78-88195df100d6
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler.Handle(CreateUnitTemplateCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\CreateUnitTemplateHandler.cs:line 41
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create(CreateUnitTemplateDto dto, CreateUnitTemplateHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 71
   at lambda_method549(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:25:12.469 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:25:12.470 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - 500 null application/json; charset=utf-8 95.6003ms
2025-10-16 18:26:14.725 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - application/json 232
2025-10-16 18:26:14.730 +03:00 [INF] Request started
2025-10-16 18:26:14.731 +03:00 [INF] === Incoming Request ===
2025-10-16 18:26:14.732 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:26:14.733 +03:00 [INF] Method: POST
2025-10-16 18:26:14.733 +03:00 [INF] === Headers ===
2025-10-16 18:26:14.734 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:26:14.736 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:26:14.738 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:26:14.740 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:26:14.742 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:26:14.744 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:26:14.747 +03:00 [INF] Content-Length: ["232"]
2025-10-16 18:26:14.748 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:26:14.750 +03:00 [INF] Postman-Token: ["3b894fa1-4da3-4089-a1b9-04b2e82f12ca"]
2025-10-16 18:26:14.752 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:26:14.753 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:26:14.754 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:26:14.758 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:26:14.779 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 16.4607ms
2025-10-16 18:26:14.782 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:26:14.783 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitTemplates_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9e4abd0f-4283-4e3f-ac78-88195df100d6
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler.Handle(CreateUnitTemplateCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\CreateUnitTemplateHandler.cs:line 41
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create(CreateUnitTemplateDto dto, CreateUnitTemplateHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 71
   at lambda_method549(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:26:14.834 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:26:14.836 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - 500 null application/json; charset=utf-8 110.0544ms
2025-10-16 18:26:51.584 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - application/json 232
2025-10-16 18:26:51.588 +03:00 [INF] Request started
2025-10-16 18:26:51.589 +03:00 [INF] === Incoming Request ===
2025-10-16 18:26:51.590 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:26:51.591 +03:00 [INF] Method: POST
2025-10-16 18:26:51.594 +03:00 [INF] === Headers ===
2025-10-16 18:26:51.595 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:26:51.597 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:26:51.600 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:26:51.601 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:26:51.604 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:26:51.606 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:26:51.608 +03:00 [INF] Content-Length: ["232"]
2025-10-16 18:26:51.610 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:26:51.611 +03:00 [INF] Postman-Token: ["fa7b0b48-6edc-4089-9be3-a7252f937f08"]
2025-10-16 18:26:51.615 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:26:51.616 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:26:51.617 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:26:51.619 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:26:51.629 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 4.6919ms
2025-10-16 18:26:51.632 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:26:51.634 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitTemplates_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:9e4abd0f-4283-4e3f-ac78-88195df100d6
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler.Handle(CreateUnitTemplateCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\CreateUnitTemplateHandler.cs:line 41
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create(CreateUnitTemplateDto dto, CreateUnitTemplateHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 71
   at lambda_method549(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:26:51.690 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:26:51.691 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - 500 null application/json; charset=utf-8 107.1043ms
2025-10-16 18:31:05.077 +03:00 [INF] Starting web host...
2025-10-16 18:31:06.294 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:31:06.380 +03:00 [INF] Executed DbCommand (69ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 18:31:06.474 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:31:06.481 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 18:31:06.499 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 18:31:06.576 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 18:31:06.593 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:31:06.598 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 18:31:06.606 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 18:31:06.619 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 18:31:06.627 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 18:31:06.817 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 18:31:06.824 +03:00 [INF] Master database initialized successfully
2025-10-16 18:31:08.445 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 18:31:08.557 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 18:31:08.560 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 18:31:08.637 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 18:31:08.639 +03:00 [INF] Hosting environment: Development
2025-10-16 18:31:08.640 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 18:31:08.994 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 18:31:09.131 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 138.0918ms
2025-10-16 18:31:09.139 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 18:31:09.140 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 18:31:09.168 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 28.5443ms
2025-10-16 18:31:09.183 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 43.6019ms
2025-10-16 18:31:09.241 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 18:31:09.466 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 224.966ms
2025-10-16 18:31:12.755 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - application/json 232
2025-10-16 18:31:12.781 +03:00 [INF] Request started
2025-10-16 18:31:12.783 +03:00 [INF] === Incoming Request ===
2025-10-16 18:31:12.786 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:31:12.787 +03:00 [INF] Method: POST
2025-10-16 18:31:12.788 +03:00 [INF] === Headers ===
2025-10-16 18:31:12.792 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:31:12.795 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:31:12.797 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:31:12.799 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:31:12.802 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:31:12.803 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:31:12.806 +03:00 [INF] Content-Length: ["232"]
2025-10-16 18:31:12.808 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:31:12.810 +03:00 [INF] Postman-Token: ["4e5cec78-050e-4eec-b7a8-a396cf0eae39"]
2025-10-16 18:31:12.816 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:31:12.817 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:31:12.819 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:31:12.845 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:31:12.981 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 18:31:13.571 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 18:31:13.841 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 18:31:13.881 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 1028.7629ms
2025-10-16 18:31:13.884 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:31:13.887 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 18:31:13.893 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - 201 null application/json; charset=utf-8 1138.7088ms
2025-10-16 18:32:11.292 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units - application/json 90
2025-10-16 18:32:11.301 +03:00 [INF] Request started
2025-10-16 18:32:11.302 +03:00 [INF] === Incoming Request ===
2025-10-16 18:32:11.303 +03:00 [INF] Path: /api/UnitTemplates/%7Bd32310b3-a863-448d-b280-6d1978d8476e%7D/units
2025-10-16 18:32:11.305 +03:00 [INF] Method: POST
2025-10-16 18:32:11.306 +03:00 [INF] === Headers ===
2025-10-16 18:32:11.308 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:32:11.309 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:32:11.311 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:32:11.312 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:32:11.313 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:32:11.315 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:32:11.316 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:32:11.318 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:32:11.319 +03:00 [INF] Postman-Token: ["d6f624ac-af04-4de9-8c2a-c1f2dcc75314"]
2025-10-16 18:32:11.323 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:32:11.325 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:32:11.326 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:32:11.331 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:32:11.461 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 127.0439ms
2025-10-16 18:32:11.464 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:32:11.466 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitConversions_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:04d2fd39-0edd-4fcd-85dd-31aa1f72c3cf
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler.Handle(AddUnitConversionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\AddUnitConversionHandler.cs:line 57
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion(Guid id, CreateUnitConversionDto dto, AddUnitConversionHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 135
   at lambda_method332(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:32:11.532 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:32:11.535 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units - 500 null application/json; charset=utf-8 242.6383ms
2025-10-16 18:32:53.266 +03:00 [INF] Starting web host...
2025-10-16 18:32:54.270 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:32:54.351 +03:00 [INF] Executed DbCommand (61ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 18:32:54.423 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:32:54.429 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 18:32:54.447 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 18:32:54.512 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 18:32:54.527 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:32:54.533 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 18:32:54.540 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 18:32:54.552 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 18:32:54.558 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 18:32:54.723 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 18:32:54.730 +03:00 [INF] Master database initialized successfully
2025-10-16 18:32:56.233 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 18:32:56.335 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 18:32:56.337 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 18:32:56.412 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 18:32:56.414 +03:00 [INF] Hosting environment: Development
2025-10-16 18:32:56.415 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 18:32:56.687 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 18:32:56.803 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 117.1334ms
2025-10-16 18:32:56.840 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 18:32:56.840 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 18:32:56.846 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.5254ms
2025-10-16 18:32:56.866 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 25.6707ms
2025-10-16 18:32:56.902 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 18:32:57.089 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 186.9268ms
2025-10-16 18:33:03.802 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units - application/json 90
2025-10-16 18:33:03.826 +03:00 [INF] Request started
2025-10-16 18:33:03.827 +03:00 [INF] === Incoming Request ===
2025-10-16 18:33:03.830 +03:00 [INF] Path: /api/UnitTemplates/%7Bd32310b3-a863-448d-b280-6d1978d8476e%7D/units
2025-10-16 18:33:03.831 +03:00 [INF] Method: POST
2025-10-16 18:33:03.832 +03:00 [INF] === Headers ===
2025-10-16 18:33:03.836 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:33:03.840 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:33:03.842 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:33:03.845 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:33:03.847 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:33:03.849 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:33:03.850 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:33:03.852 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:33:03.853 +03:00 [INF] Postman-Token: ["d50acc7f-3592-41dc-8e72-1417e2280987"]
2025-10-16 18:33:03.859 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:33:03.860 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:33:03.862 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:33:03.891 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:33:04.022 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 18:33:04.738 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 18:33:04.978 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 1079.8103ms
2025-10-16 18:33:04.981 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:33:04.984 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitConversions_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:586a45dc-e45e-4357-b3ad-f547820a95f2
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler.Handle(AddUnitConversionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\AddUnitConversionHandler.cs:line 59
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion(Guid id, CreateUnitConversionDto dto, AddUnitConversionHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 135
   at lambda_method99(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:33:05.064 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:33:05.069 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units - 500 null application/json; charset=utf-8 1267.2091ms
2025-10-16 18:33:22.674 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/{d32310b3-a863-448d-b280-6d1978d8476e}/units - application/json 90
2025-10-16 18:33:22.682 +03:00 [INF] Request started
2025-10-16 18:33:22.684 +03:00 [INF] === Incoming Request ===
2025-10-16 18:33:22.685 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:33:22.686 +03:00 [INF] Method: POST
2025-10-16 18:33:22.687 +03:00 [INF] === Headers ===
2025-10-16 18:33:22.688 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:33:22.689 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:33:22.691 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:33:22.692 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:33:22.693 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:33:22.695 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:33:22.696 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:33:22.697 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:33:22.699 +03:00 [INF] Postman-Token: ["c0a9b2ae-9023-4bad-b25e-7a7ee76b4ad9"]
2025-10-16 18:33:22.702 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:33:22.703 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:33:22.704 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:33:22.709 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:33:22.765 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 51.5917ms
2025-10-16 18:33:22.768 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:33:22.770 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"Name":["Name is required"],"BaseUnitName":["Base unit name is required"],"BaseUnitShortName":["Base unit short name is required"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create(CreateUnitTemplateDto dto, CreateUnitTemplateHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 64
   at lambda_method403(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:33:22.789 +03:00 [INF] Error response sent with status code 400
2025-10-16 18:33:22.792 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/{d32310b3-a863-448d-b280-6d1978d8476e}/units - 400 null application/json; charset=utf-8 118.0511ms
2025-10-16 18:33:31.675 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - application/json 90
2025-10-16 18:33:31.680 +03:00 [INF] Request started
2025-10-16 18:33:31.681 +03:00 [INF] === Incoming Request ===
2025-10-16 18:33:31.683 +03:00 [INF] Path: /api/UnitTemplates/%7Bd32310b3-a863-448d-b280-6d1978d8476e%7D/units
2025-10-16 18:33:31.684 +03:00 [INF] Method: POST
2025-10-16 18:33:31.685 +03:00 [INF] === Headers ===
2025-10-16 18:33:31.686 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:33:31.687 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:33:31.688 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:33:31.689 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:33:31.691 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:33:31.692 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:33:31.694 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:33:31.696 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:33:31.698 +03:00 [INF] Postman-Token: ["14b8dc60-e5c1-4ab7-ad3e-a6d125c94f48"]
2025-10-16 18:33:31.700 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:33:31.701 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:33:31.702 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:33:31.703 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:33:31.719 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 12.6009ms
2025-10-16 18:33:31.721 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:33:31.722 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitConversions_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:586a45dc-e45e-4357-b3ad-f547820a95f2
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler.Handle(AddUnitConversionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\AddUnitConversionHandler.cs:line 59
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion(Guid id, CreateUnitConversionDto dto, AddUnitConversionHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 135
   at lambda_method99(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:33:31.744 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:33:31.746 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - 500 null application/json; charset=utf-8 70.8153ms
2025-10-16 18:33:51.643 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{37dd4f44-f5d3-4975-a8d3-ff8bdac7b089}/units - application/json 90
2025-10-16 18:33:51.646 +03:00 [INF] Request started
2025-10-16 18:33:51.647 +03:00 [INF] === Incoming Request ===
2025-10-16 18:33:51.648 +03:00 [INF] Path: /api/UnitTemplates/%7B37dd4f44-f5d3-4975-a8d3-ff8bdac7b089%7D/units
2025-10-16 18:33:51.649 +03:00 [INF] Method: POST
2025-10-16 18:33:51.650 +03:00 [INF] === Headers ===
2025-10-16 18:33:51.651 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:33:51.652 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:33:51.654 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:33:51.657 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:33:51.659 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:33:51.660 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:33:51.662 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:33:51.663 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:33:51.664 +03:00 [INF] Postman-Token: ["29288f97-91b4-498e-bb93-7f6600e958b6"]
2025-10-16 18:33:51.666 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:33:51.668 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:33:51.669 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:33:51.671 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:33:51.680 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 5.3317ms
2025-10-16 18:33:51.682 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:33:51.684 +03:00 [ERR] Application exception occurred: Unit template with ID 37dd4f44-f5d3-4975-a8d3-ff8bdac7b089 not found
ModularERP.Common.Exceptions.NotFoundException: Unit template with ID 37dd4f44-f5d3-4975-a8d3-ff8bdac7b089 not found
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler.Handle(AddUnitConversionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\AddUnitConversionHandler.cs:line 35
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion(Guid id, CreateUnitConversionDto dto, AddUnitConversionHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 135
   at lambda_method99(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:33:51.695 +03:00 [INF] Error response sent with status code 404
2025-10-16 18:33:51.696 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{37dd4f44-f5d3-4975-a8d3-ff8bdac7b089}/units - 404 null application/json; charset=utf-8 52.8941ms
2025-10-16 18:33:57.053 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/{37dd4f44-f5d3-4975-a8d3-ff8bdac7b089}/units - application/json 90
2025-10-16 18:33:57.057 +03:00 [INF] Request started
2025-10-16 18:33:57.058 +03:00 [INF] === Incoming Request ===
2025-10-16 18:33:57.060 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:33:57.062 +03:00 [INF] Method: POST
2025-10-16 18:33:57.063 +03:00 [INF] === Headers ===
2025-10-16 18:33:57.064 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:33:57.065 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:33:57.067 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:33:57.068 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:33:57.070 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:33:57.072 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:33:57.074 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:33:57.075 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:33:57.077 +03:00 [INF] Postman-Token: ["b20639f9-42ed-4f92-b437-2ce5955f0509"]
2025-10-16 18:33:57.079 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:33:57.081 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:33:57.082 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:33:57.083 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:33:57.088 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 2.9155ms
2025-10-16 18:33:57.092 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:33:57.093 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"Name":["Name is required"],"BaseUnitName":["Base unit name is required"],"BaseUnitShortName":["Base unit short name is required"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create(CreateUnitTemplateDto dto, CreateUnitTemplateHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 64
   at lambda_method403(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:33:57.105 +03:00 [INF] Error response sent with status code 400
2025-10-16 18:33:57.107 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/{37dd4f44-f5d3-4975-a8d3-ff8bdac7b089}/units - 400 null application/json; charset=utf-8 53.4119ms
2025-10-16 18:35:34.002 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/{d32310b3-a863-448d-b280-6d1978d8476e}/units - application/json 90
2025-10-16 18:35:34.006 +03:00 [INF] Request started
2025-10-16 18:35:34.008 +03:00 [INF] === Incoming Request ===
2025-10-16 18:35:34.009 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:35:34.009 +03:00 [INF] Method: POST
2025-10-16 18:35:34.010 +03:00 [INF] === Headers ===
2025-10-16 18:35:34.011 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:35:34.013 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:35:34.014 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:35:34.015 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:35:34.016 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:35:34.018 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:35:34.019 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:35:34.021 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:35:34.022 +03:00 [INF] Postman-Token: ["f16e7b95-6b39-43bf-b0ac-5e8038e6c8d8"]
2025-10-16 18:35:34.025 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:35:34.026 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:35:34.027 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:35:34.028 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:35:34.032 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 1.7275ms
2025-10-16 18:35:34.034 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:35:34.035 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"Name":["Name is required"],"BaseUnitName":["Base unit name is required"],"BaseUnitShortName":["Base unit short name is required"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create(CreateUnitTemplateDto dto, CreateUnitTemplateHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 64
   at lambda_method403(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:35:34.047 +03:00 [INF] Error response sent with status code 400
2025-10-16 18:35:34.048 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/{d32310b3-a863-448d-b280-6d1978d8476e}/units - 400 null application/json; charset=utf-8 46.3249ms
2025-10-16 18:35:51.068 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7168/api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/units - application/json 87
2025-10-16 18:35:51.073 +03:00 [INF] CORS policy execution successful.
2025-10-16 18:35:51.076 +03:00 [INF] Request started
2025-10-16 18:35:51.078 +03:00 [INF] === Incoming Request ===
2025-10-16 18:35:51.079 +03:00 [INF] Path: /api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/units
2025-10-16 18:35:51.080 +03:00 [INF] Method: POST
2025-10-16 18:35:51.081 +03:00 [INF] === Headers ===
2025-10-16 18:35:51.083 +03:00 [INF] Accept: ["text/plain"]
2025-10-16 18:35:51.084 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:35:51.086 +03:00 [INF] User-Agent: ["Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36 Edg/141.0.0.0"]
2025-10-16 18:35:51.088 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br, zstd"]
2025-10-16 18:35:51.089 +03:00 [INF] Accept-Language: ["en-US,en;q=0.9"]
2025-10-16 18:35:51.091 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:35:51.092 +03:00 [INF] Origin: ["https://localhost:7168"]
2025-10-16 18:35:51.094 +03:00 [INF] Referer: ["https://localhost:7168/swagger/index.html"]
2025-10-16 18:35:51.096 +03:00 [INF] Content-Length: ["87"]
2025-10-16 18:35:51.097 +03:00 [INF] sec-ch-ua-platform: ["\"Windows\""]
2025-10-16 18:35:51.099 +03:00 [INF] sec-ch-ua: ["\"Microsoft Edge\";v=\"141\", \"Not?A_Brand\";v=\"8\", \"Chromium\";v=\"141\""]
2025-10-16 18:35:51.101 +03:00 [INF] sec-ch-ua-mobile: ["?0"]
2025-10-16 18:35:51.103 +03:00 [INF] sec-fetch-site: ["same-origin"]
2025-10-16 18:35:51.104 +03:00 [INF] sec-fetch-mode: ["cors"]
2025-10-16 18:35:51.106 +03:00 [INF] sec-fetch-dest: ["empty"]
2025-10-16 18:35:51.107 +03:00 [INF] priority: ["u=1, i"]
2025-10-16 18:35:51.109 +03:00 [INF] 🔍 TenantService returned: 'NULL'
2025-10-16 18:35:51.113 +03:00 [INF] Request completed successfully with status code 400
2025-10-16 18:35:51.114 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7168/api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/units - 400 null application/json 45.8734ms
2025-10-16 18:38:14.898 +03:00 [INF] Starting web host...
2025-10-16 18:38:15.917 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:38:15.986 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 18:38:16.061 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:38:16.067 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 18:38:16.083 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 18:38:16.138 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 18:38:16.153 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:38:16.157 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 18:38:16.164 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 18:38:16.175 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 18:38:16.181 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 18:38:16.367 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 18:38:16.374 +03:00 [INF] Master database initialized successfully
2025-10-16 18:38:18.027 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 18:38:18.132 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 18:38:18.134 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 18:38:18.207 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 18:38:18.209 +03:00 [INF] Hosting environment: Development
2025-10-16 18:38:18.210 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 18:38:18.332 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 18:38:18.475 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 144.5327ms
2025-10-16 18:38:18.479 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 18:38:18.484 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 18:38:18.492 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.1447ms
2025-10-16 18:38:18.514 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 35.3823ms
2025-10-16 18:38:18.596 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 18:38:18.774 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 177.7793ms
2025-10-16 18:38:26.061 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/{d32310b3-a863-448d-b280-6d1978d8476e}/units - application/json 90
2025-10-16 18:38:26.084 +03:00 [INF] Request started
2025-10-16 18:38:26.087 +03:00 [INF] === Incoming Request ===
2025-10-16 18:38:26.089 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:38:26.090 +03:00 [INF] Method: POST
2025-10-16 18:38:26.091 +03:00 [INF] === Headers ===
2025-10-16 18:38:26.095 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:38:26.099 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:38:26.101 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:38:26.103 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:38:26.106 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:38:26.107 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:38:26.109 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:38:26.111 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:38:26.113 +03:00 [INF] Postman-Token: ["d1689809-393d-4ffa-b30b-5909f05e4f5e"]
2025-10-16 18:38:26.120 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:38:26.121 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:38:26.123 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:38:26.145 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:38:26.284 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 18:38:26.821 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 18:38:26.846 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 692.8962ms
2025-10-16 18:38:26.849 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:38:26.852 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"Name":["Name is required"],"BaseUnitName":["Base unit name is required"],"BaseUnitShortName":["Base unit short name is required"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create(CreateUnitTemplateDto dto, CreateUnitTemplateHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 64
   at lambda_method99(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:38:26.925 +03:00 [INF] Error response sent with status code 400
2025-10-16 18:38:26.931 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/{d32310b3-a863-448d-b280-6d1978d8476e}/units - 400 null application/json; charset=utf-8 869.716ms
2025-10-16 18:40:53.911 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units - application/json 90
2025-10-16 18:40:53.923 +03:00 [INF] Request started
2025-10-16 18:40:53.925 +03:00 [INF] === Incoming Request ===
2025-10-16 18:40:53.926 +03:00 [INF] Path: /api/UnitTemplates/%7Bd32310b3-a863-448d-b280-6d1978d8476e%7D/units
2025-10-16 18:40:53.927 +03:00 [INF] Method: POST
2025-10-16 18:40:53.928 +03:00 [INF] === Headers ===
2025-10-16 18:40:53.929 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:40:53.931 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:40:53.933 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:40:53.935 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:40:53.936 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:40:53.938 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:40:53.939 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:40:53.941 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:40:53.942 +03:00 [INF] Postman-Token: ["d19090b9-230a-4b44-bba1-f8c166889d88"]
2025-10-16 18:40:53.947 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:40:53.953 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:40:53.955 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:40:53.963 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:40:54.352 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 357.1928ms
2025-10-16 18:40:54.355 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:40:54.357 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitConversions_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:a98dedcf-7881-4751-ad97-24a67b259861
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler.Handle(AddUnitConversionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\AddUnitConversionHandler.cs:line 59
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion(Guid id, CreateUnitConversionDto dto, AddUnitConversionHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 135
   at lambda_method168(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:40:54.392 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:40:54.396 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units - 500 null application/json; charset=utf-8 484.36ms
2025-10-16 18:41:10.382 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/d32310b3-a863-448d-b280-6d1978d8476e/units - application/json 90
2025-10-16 18:41:10.388 +03:00 [INF] Request started
2025-10-16 18:41:10.389 +03:00 [INF] === Incoming Request ===
2025-10-16 18:41:10.390 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:41:10.391 +03:00 [INF] Method: POST
2025-10-16 18:41:10.393 +03:00 [INF] === Headers ===
2025-10-16 18:41:10.394 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:41:10.395 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:41:10.397 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:41:10.398 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:41:10.400 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:41:10.401 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:41:10.403 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:41:10.404 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:41:10.405 +03:00 [INF] Postman-Token: ["c8002c1c-eb77-43dd-9a41-79533fe481e0"]
2025-10-16 18:41:10.407 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:41:10.408 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:41:10.410 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:41:10.411 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:41:10.418 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 3.6464ms
2025-10-16 18:41:10.420 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:41:10.422 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"Name":["Name is required"],"BaseUnitName":["Base unit name is required"],"BaseUnitShortName":["Base unit short name is required"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create(CreateUnitTemplateDto dto, CreateUnitTemplateHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 64
   at lambda_method99(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:41:10.438 +03:00 [INF] Error response sent with status code 400
2025-10-16 18:41:10.440 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/d32310b3-a863-448d-b280-6d1978d8476e/units - 400 null application/json; charset=utf-8 58.1047ms
2025-10-16 18:41:29.384 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/units - application/json 90
2025-10-16 18:41:29.390 +03:00 [INF] Request started
2025-10-16 18:41:29.391 +03:00 [INF] === Incoming Request ===
2025-10-16 18:41:29.393 +03:00 [INF] Path: /api/UnitTemplates
2025-10-16 18:41:29.394 +03:00 [INF] Method: POST
2025-10-16 18:41:29.395 +03:00 [INF] === Headers ===
2025-10-16 18:41:29.396 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:41:29.397 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:41:29.398 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:41:29.400 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:41:29.401 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:41:29.403 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:41:29.405 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:41:29.408 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:41:29.409 +03:00 [INF] Postman-Token: ["c895c179-5df8-409e-a3ce-174df8e51343"]
2025-10-16 18:41:29.411 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:41:29.412 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:41:29.413 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:41:29.414 +03:00 [INF] Route matched with {action = "Create", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitTemplateDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitTemplateDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.CreateUnitTemplateHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:41:29.419 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP) in 2.5399ms
2025-10-16 18:41:29.423 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create (ModularERP)'
2025-10-16 18:41:29.424 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"Name":["Name is required"],"BaseUnitName":["Base unit name is required"],"BaseUnitShortName":["Base unit short name is required"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.Create(CreateUnitTemplateDto dto, CreateUnitTemplateHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 64
   at lambda_method99(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:41:29.437 +03:00 [INF] Error response sent with status code 400
2025-10-16 18:41:29.438 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/units - 400 null application/json; charset=utf-8 54.2718ms
2025-10-16 18:41:55.668 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbfunits - application/json 90
2025-10-16 18:41:55.672 +03:00 [INF] Request started
2025-10-16 18:41:55.672 +03:00 [INF] === Incoming Request ===
2025-10-16 18:41:55.673 +03:00 [INF] Path: /api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/
2025-10-16 18:41:55.674 +03:00 [INF] Method: POST
2025-10-16 18:41:55.675 +03:00 [INF] === Headers ===
2025-10-16 18:41:55.676 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:41:55.679 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:41:55.680 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:41:55.682 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:41:55.683 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:41:55.684 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:41:55.686 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:41:55.688 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:41:55.689 +03:00 [INF] Postman-Token: ["3ffe3e80-5538-4a3e-b37d-1061925c0ec5"]
2025-10-16 18:41:55.691 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:41:55.692 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:41:55.694 +03:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-10-16 18:41:55.695 +03:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-10-16 18:41:55.696 +03:00 [INF] Request completed successfully with status code 405
2025-10-16 18:41:55.698 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbfunits - 405 0 null 29.7637ms
2025-10-16 18:42:13.177 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/units - application/json 90
2025-10-16 18:42:13.180 +03:00 [INF] Request started
2025-10-16 18:42:13.181 +03:00 [INF] === Incoming Request ===
2025-10-16 18:42:13.181 +03:00 [INF] Path: /api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/
2025-10-16 18:42:13.182 +03:00 [INF] Method: POST
2025-10-16 18:42:13.183 +03:00 [INF] === Headers ===
2025-10-16 18:42:13.184 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:42:13.185 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:42:13.187 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:42:13.189 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:42:13.191 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:42:13.193 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:42:13.194 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:42:13.196 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:42:13.197 +03:00 [INF] Postman-Token: ["7e1fec54-09b0-423b-8b9c-6a33a3748485"]
2025-10-16 18:42:13.199 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:42:13.199 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:42:13.200 +03:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-10-16 18:42:13.202 +03:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-10-16 18:42:13.203 +03:00 [INF] Request completed successfully with status code 405
2025-10-16 18:42:13.204 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf/units - 405 0 null 26.8637ms
2025-10-16 18:43:03.914 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/units?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - application/json 90
2025-10-16 18:43:03.918 +03:00 [INF] Request started
2025-10-16 18:43:03.919 +03:00 [INF] === Incoming Request ===
2025-10-16 18:43:03.919 +03:00 [INF] Path: /api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/units
2025-10-16 18:43:03.920 +03:00 [INF] Method: POST
2025-10-16 18:43:03.922 +03:00 [INF] === Headers ===
2025-10-16 18:43:03.923 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:43:03.925 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:43:03.926 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:43:03.928 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:43:03.929 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:43:03.930 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:43:03.932 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:43:03.933 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:43:03.934 +03:00 [INF] Postman-Token: ["e1ad8c14-e7f6-4bc9-a39c-d4878dfd2593"]
2025-10-16 18:43:03.936 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:43:03.938 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:43:03.940 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:43:03.941 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:43:03.969 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 24.4847ms
2025-10-16 18:43:03.972 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:43:03.973 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitConversions_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:a98dedcf-7881-4751-ad97-24a67b259861
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler.Handle(AddUnitConversionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\AddUnitConversionHandler.cs:line 59
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion(Guid id, CreateUnitConversionDto dto, AddUnitConversionHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 135
   at lambda_method168(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:43:03.996 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:43:03.997 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/units?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - 500 null application/json; charset=utf-8 82.7412ms
2025-10-16 18:44:29.930 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/units?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - application/json 90
2025-10-16 18:44:29.937 +03:00 [INF] Request started
2025-10-16 18:44:29.938 +03:00 [INF] === Incoming Request ===
2025-10-16 18:44:29.939 +03:00 [INF] Path: /api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/units
2025-10-16 18:44:29.940 +03:00 [INF] Method: POST
2025-10-16 18:44:29.941 +03:00 [INF] === Headers ===
2025-10-16 18:44:29.944 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:44:29.947 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:44:29.949 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:44:29.951 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:44:29.952 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:44:29.954 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:44:29.957 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:44:29.959 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:44:29.961 +03:00 [INF] Postman-Token: ["f1b90ccc-2615-488e-b0f4-e8ac507a869b"]
2025-10-16 18:44:29.963 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:44:29.965 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:44:29.967 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:44:29.969 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:44:29.985 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 12.3997ms
2025-10-16 18:44:29.987 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:44:29.988 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitConversions_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:a98dedcf-7881-4751-ad97-24a67b259861
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler.Handle(AddUnitConversionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\AddUnitConversionHandler.cs:line 59
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion(Guid id, CreateUnitConversionDto dto, AddUnitConversionHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 135
   at lambda_method168(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:44:30.039 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:44:30.040 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/d32310b3-a863-448d-b280-6d1978d8476e/units?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - 500 null application/json; charset=utf-8 110.239ms
2025-10-16 18:47:09.953 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units - null 0
2025-10-16 18:47:09.957 +03:00 [INF] Request started
2025-10-16 18:47:09.958 +03:00 [INF] === Incoming Request ===
2025-10-16 18:47:09.959 +03:00 [INF] Path: /api/UnitTemplates/%7Bd32310b3-a863-448d-b280-6d1978d8476e%7D/units
2025-10-16 18:47:09.961 +03:00 [INF] Method: POST
2025-10-16 18:47:09.962 +03:00 [INF] === Headers ===
2025-10-16 18:47:09.965 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:47:09.966 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:47:09.968 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:47:09.969 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:47:09.971 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:47:09.972 +03:00 [INF] Content-Length: ["0"]
2025-10-16 18:47:09.975 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:47:09.977 +03:00 [INF] Postman-Token: ["45bb1c60-b41f-4998-a134-3a12f0674198"]
2025-10-16 18:47:09.979 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:47:09.980 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:47:09.981 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:47:09.983 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:47:09.994 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-10-16 18:47:10.007 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 20.2088ms
2025-10-16 18:47:10.010 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:47:10.012 +03:00 [INF] Request completed successfully with status code 415
2025-10-16 18:47:10.014 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units - 415 null application/problem+json; charset=utf-8 60.5608ms
2025-10-16 18:47:22.553 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units - application/json 90
2025-10-16 18:47:22.557 +03:00 [INF] Request started
2025-10-16 18:47:22.558 +03:00 [INF] === Incoming Request ===
2025-10-16 18:47:22.559 +03:00 [INF] Path: /api/UnitTemplates/%7Bd32310b3-a863-448d-b280-6d1978d8476e%7D/units
2025-10-16 18:47:22.560 +03:00 [INF] Method: POST
2025-10-16 18:47:22.561 +03:00 [INF] === Headers ===
2025-10-16 18:47:22.562 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:47:22.565 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:47:22.566 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:47:22.568 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:47:22.570 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:47:22.572 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:47:22.574 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:47:22.576 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:47:22.577 +03:00 [INF] Postman-Token: ["e24de8bf-358f-43b8-a0b0-b3073099578b"]
2025-10-16 18:47:22.579 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:47:22.580 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:47:22.581 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:47:22.584 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:47:22.597 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 8.468ms
2025-10-16 18:47:22.600 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:47:22.602 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitConversions_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:a98dedcf-7881-4751-ad97-24a67b259861
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler.Handle(AddUnitConversionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\AddUnitConversionHandler.cs:line 59
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion(Guid id, CreateUnitConversionDto dto, AddUnitConversionHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 135
   at lambda_method168(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:47:22.649 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:47:22.651 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units - 500 null application/json; charset=utf-8 97.1274ms
2025-10-16 18:49:28.813 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf%0A - application/json 90
2025-10-16 18:49:28.821 +03:00 [INF] Request started
2025-10-16 18:49:28.822 +03:00 [INF] === Incoming Request ===
2025-10-16 18:49:28.823 +03:00 [INF] Path: /api/UnitTemplates/%7Bd32310b3-a863-448d-b280-6d1978d8476e%7D/units
2025-10-16 18:49:28.824 +03:00 [INF] Method: POST
2025-10-16 18:49:28.825 +03:00 [INF] === Headers ===
2025-10-16 18:49:28.828 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:49:28.831 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:49:28.835 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:49:28.838 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:49:28.839 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:49:28.841 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:49:28.842 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:49:28.844 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:49:28.848 +03:00 [INF] Postman-Token: ["eddf216f-2603-4f0b-8d5b-bfbf95267288"]
2025-10-16 18:49:28.851 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:49:28.852 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:49:28.853 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:49:28.854 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:49:28.872 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 12.0892ms
2025-10-16 18:49:28.874 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:49:28.877 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_UnitConversions_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:a98dedcf-7881-4751-ad97-24a67b259861
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler.Handle(AddUnitConversionCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_UnitTemplates\AddUnitConversionHandler.cs:line 59
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion(Guid id, CreateUnitConversionDto dto, AddUnitConversionHandler handler) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\UnitTemplatesController.cs:line 135
   at lambda_method168(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 18:49:28.925 +03:00 [INF] Error response sent with status code 500
2025-10-16 18:49:28.927 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf%0A - 500 null application/json; charset=utf-8 114.1856ms
2025-10-16 18:51:50.569 +03:00 [INF] Starting web host...
2025-10-16 18:51:51.553 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:51:51.626 +03:00 [INF] Executed DbCommand (57ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 18:51:51.708 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:51:51.714 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 18:51:51.732 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 18:51:51.791 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 18:51:51.807 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 18:51:51.812 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 18:51:51.820 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 18:51:51.831 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 18:51:51.839 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 18:51:52.059 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 18:51:52.068 +03:00 [INF] Master database initialized successfully
2025-10-16 18:51:53.793 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 18:51:53.899 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 18:51:53.902 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 18:51:53.987 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 18:51:53.989 +03:00 [INF] Hosting environment: Development
2025-10-16 18:51:53.990 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 18:51:54.002 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 18:51:54.122 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 121.2831ms
2025-10-16 18:51:54.131 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 18:51:54.131 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 18:51:54.139 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.2838ms
2025-10-16 18:51:54.162 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 31.3365ms
2025-10-16 18:51:54.330 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 18:51:54.532 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 201.6309ms
2025-10-16 18:52:03.930 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - application/json 90
2025-10-16 18:52:03.949 +03:00 [INF] Request started
2025-10-16 18:52:03.951 +03:00 [INF] === Incoming Request ===
2025-10-16 18:52:03.954 +03:00 [INF] Path: /api/UnitTemplates/%7Bd32310b3-a863-448d-b280-6d1978d8476e%7D/units
2025-10-16 18:52:03.955 +03:00 [INF] Method: POST
2025-10-16 18:52:03.956 +03:00 [INF] === Headers ===
2025-10-16 18:52:03.960 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:52:03.963 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:52:03.965 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:52:03.967 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:52:03.970 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:52:03.972 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:52:03.974 +03:00 [INF] Content-Length: ["90"]
2025-10-16 18:52:03.976 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:52:03.980 +03:00 [INF] Postman-Token: ["7988e6c0-cabf-467e-a22d-c311119635d6"]
2025-10-16 18:52:03.985 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:52:03.987 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:52:03.988 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:52:04.021 +03:00 [INF] Route matched with {action = "AddUnitConversion", controller = "UnitTemplates"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto]]] AddUnitConversion(System.Guid, ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.CreateUnitConversionDto, ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_UnitTemplates.AddUnitConversionHandler) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController (ModularERP).
2025-10-16 18:52:04.157 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 18:52:04.802 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 18:52:05.078 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_UnitTemplates.UnitConversionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 18:52:05.104 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP) in 1075.8366ms
2025-10-16 18:52:05.106 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.UnitTemplatesController.AddUnitConversion (ModularERP)'
2025-10-16 18:52:05.109 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 18:52:05.115 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/UnitTemplates/{d32310b3-a863-448d-b280-6d1978d8476e}/units?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf - 200 null application/json; charset=utf-8 1185.0207ms
2025-10-16 18:58:01.634 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/CustomField - application/json 287
2025-10-16 18:58:01.644 +03:00 [INF] Request started
2025-10-16 18:58:01.645 +03:00 [INF] === Incoming Request ===
2025-10-16 18:58:01.647 +03:00 [INF] Path: /api/CustomField
2025-10-16 18:58:01.648 +03:00 [INF] Method: POST
2025-10-16 18:58:01.649 +03:00 [INF] === Headers ===
2025-10-16 18:58:01.649 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:58:01.651 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:58:01.652 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:58:01.653 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:58:01.655 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:58:01.656 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:58:01.658 +03:00 [INF] Content-Length: ["287"]
2025-10-16 18:58:01.660 +03:00 [INF] X-Tenant-ID: ["8bed874f-cf2a-4ffa-a188-4cfef779774a","6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:58:01.661 +03:00 [INF] Postman-Token: ["2a49cfa9-c004-4ccf-bd58-2faa9920f3b8"]
2025-10-16 18:58:01.665 +03:00 [INF] 🔍 TenantService returned: '8bed874f-cf2a-4ffa-a188-4cfef779774a'
2025-10-16 18:58:01.666 +03:00 [INF] ✅ Processing request for tenant: 8bed874f-cf2a-4ffa-a188-4cfef779774a
2025-10-16 18:58:01.667 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP)'
2025-10-16 18:58:01.672 +03:00 [INF] Route matched with {action = "Create", controller = "CustomField"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Custom.CustomFieldResponseDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.Commends.Command_Custom.CreateCustomFieldCommand) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController (ModularERP).
2025-10-16 18:58:01.730 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 18:58:01.896 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Custom.CustomFieldResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 18:58:01.905 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP) in 230.0046ms
2025-10-16 18:58:01.909 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP)'
2025-10-16 18:58:01.911 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 18:58:01.912 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/CustomField - 200 null application/json; charset=utf-8 278.2955ms
2025-10-16 18:59:07.052 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/CustomField - null null
2025-10-16 18:59:07.060 +03:00 [INF] Request started
2025-10-16 18:59:07.061 +03:00 [INF] === Incoming Request ===
2025-10-16 18:59:07.062 +03:00 [INF] Path: /api/CustomField
2025-10-16 18:59:07.063 +03:00 [INF] Method: GET
2025-10-16 18:59:07.065 +03:00 [INF] === Headers ===
2025-10-16 18:59:07.066 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:59:07.067 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:59:07.069 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:59:07.070 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:59:07.072 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:59:07.073 +03:00 [INF] X-Tenant-ID: ["8bed874f-cf2a-4ffa-a188-4cfef779774a","6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:59:07.075 +03:00 [INF] Postman-Token: ["da06de50-b8d4-444c-9595-fe42e8eb0f2e"]
2025-10-16 18:59:07.076 +03:00 [INF] 🔍 TenantService returned: '8bed874f-cf2a-4ffa-a188-4cfef779774a'
2025-10-16 18:59:07.078 +03:00 [INF] ✅ Processing request for tenant: 8bed874f-cf2a-4ffa-a188-4cfef779774a
2025-10-16 18:59:07.080 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.GetAll (ModularERP)'
2025-10-16 18:59:07.084 +03:00 [INF] Route matched with {action = "GetAll", controller = "CustomField"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Custom.CustomFieldResponseDto]]]] GetAll() on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController (ModularERP).
2025-10-16 18:59:07.104 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 18:59:07.154 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Custom.CustomFieldResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 18:59:07.159 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.GetAll (ModularERP) in 69.1343ms
2025-10-16 18:59:07.161 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.GetAll (ModularERP)'
2025-10-16 18:59:07.163 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 18:59:07.164 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/CustomField - 200 null application/json; charset=utf-8 111.2611ms
2025-10-16 18:59:20.773 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/CustomField - application/json 287
2025-10-16 18:59:20.776 +03:00 [INF] Request started
2025-10-16 18:59:20.777 +03:00 [INF] === Incoming Request ===
2025-10-16 18:59:20.777 +03:00 [INF] Path: /api/CustomField
2025-10-16 18:59:20.778 +03:00 [INF] Method: POST
2025-10-16 18:59:20.780 +03:00 [INF] === Headers ===
2025-10-16 18:59:20.781 +03:00 [INF] Accept: ["*/*"]
2025-10-16 18:59:20.783 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 18:59:20.785 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 18:59:20.787 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 18:59:20.788 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 18:59:20.789 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 18:59:20.791 +03:00 [INF] Content-Length: ["287"]
2025-10-16 18:59:20.792 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 18:59:20.793 +03:00 [INF] Postman-Token: ["d5aca11e-44f9-4aa4-8610-2d5ec9ce5d2c"]
2025-10-16 18:59:20.795 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 18:59:20.797 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 18:59:20.798 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP)'
2025-10-16 18:59:20.799 +03:00 [INF] Route matched with {action = "Create", controller = "CustomField"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Custom.CustomFieldResponseDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.Commends.Command_Custom.CreateCustomFieldCommand) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController (ModularERP).
2025-10-16 18:59:20.828 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Custom.CustomFieldResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 18:59:20.830 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP) in 27.7806ms
2025-10-16 18:59:20.832 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP)'
2025-10-16 18:59:20.834 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 18:59:20.836 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/CustomField - 200 null application/json; charset=utf-8 62.772ms
2025-10-16 19:01:14.697 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/CustomField - application/json 287
2025-10-16 19:01:14.702 +03:00 [INF] Request started
2025-10-16 19:01:14.703 +03:00 [INF] === Incoming Request ===
2025-10-16 19:01:14.704 +03:00 [INF] Path: /api/CustomField
2025-10-16 19:01:14.705 +03:00 [INF] Method: POST
2025-10-16 19:01:14.706 +03:00 [INF] === Headers ===
2025-10-16 19:01:14.708 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:01:14.709 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:01:14.712 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:01:14.713 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:01:14.714 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:01:14.717 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:01:14.719 +03:00 [INF] Content-Length: ["287"]
2025-10-16 19:01:14.720 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:01:14.722 +03:00 [INF] Postman-Token: ["3a02ae74-ff08-462f-8e9b-1822a3a7fa2b"]
2025-10-16 19:01:14.724 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:01:14.725 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:01:14.726 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP)'
2025-10-16 19:01:14.728 +03:00 [INF] Route matched with {action = "Create", controller = "CustomField"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Custom.CustomFieldResponseDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.Commends.Command_Custom.CreateCustomFieldCommand) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController (ModularERP).
2025-10-16 19:01:14.750 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP) in 18.3062ms
2025-10-16 19:01:14.752 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP)'
2025-10-16 19:01:14.755 +03:00 [WRN] Business logic exception occurred: Custom field with name 'emailAddress' already exists
ModularERP.Common.Exceptions.BusinessLogicException: Custom field with name 'emailAddress' already exists
   at ModularERP.Modules.Inventory.Features.ProductSettings.Service.CustomFieldService.CreateAsync(CreateCustomFieldCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Service\CustomFieldService.cs:line 36
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handler_CustomField.CreateCustomFieldHandler.Handle(CreateCustomFieldCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handler_CustomField\CreateCustomFieldHandler.cs:line 41
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create(CreateCustomFieldCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\CustomFieldController.cs:line 42
   at lambda_method404(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 19:01:14.810 +03:00 [INF] Error response sent with status code 400
2025-10-16 19:01:14.813 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/CustomField - 400 null application/json; charset=utf-8 115.2362ms
2025-10-16 19:01:19.118 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/CustomField - application/json 287
2025-10-16 19:01:19.121 +03:00 [INF] Request started
2025-10-16 19:01:19.121 +03:00 [INF] === Incoming Request ===
2025-10-16 19:01:19.123 +03:00 [INF] Path: /api/CustomField
2025-10-16 19:01:19.124 +03:00 [INF] Method: POST
2025-10-16 19:01:19.125 +03:00 [INF] === Headers ===
2025-10-16 19:01:19.126 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:01:19.127 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:01:19.129 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:01:19.131 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:01:19.132 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:01:19.133 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:01:19.135 +03:00 [INF] Content-Length: ["287"]
2025-10-16 19:01:19.136 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:01:19.138 +03:00 [INF] Postman-Token: ["d5a600ec-66d6-44ec-8340-cce35149ae6c"]
2025-10-16 19:01:19.139 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:01:19.141 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:01:19.142 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP)'
2025-10-16 19:01:19.144 +03:00 [INF] Route matched with {action = "Create", controller = "CustomField"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Custom.CustomFieldResponseDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.Commends.Command_Custom.CreateCustomFieldCommand) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController (ModularERP).
2025-10-16 19:01:19.148 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP) in 1.9035ms
2025-10-16 19:01:19.150 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP)'
2025-10-16 19:01:19.152 +03:00 [WRN] Business logic exception occurred: Custom field with name 'emailAddress' already exists
ModularERP.Common.Exceptions.BusinessLogicException: Custom field with name 'emailAddress' already exists
   at ModularERP.Modules.Inventory.Features.ProductSettings.Service.CustomFieldService.CreateAsync(CreateCustomFieldCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Service\CustomFieldService.cs:line 36
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handler_CustomField.CreateCustomFieldHandler.Handle(CreateCustomFieldCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handler_CustomField\CreateCustomFieldHandler.cs:line 41
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create(CreateCustomFieldCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\CustomFieldController.cs:line 42
   at lambda_method404(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 19:01:19.163 +03:00 [INF] Error response sent with status code 400
2025-10-16 19:01:19.165 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/CustomField - 400 null application/json; charset=utf-8 46.8907ms
2025-10-16 19:01:25.881 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/CustomField - application/json 286
2025-10-16 19:01:25.885 +03:00 [INF] Request started
2025-10-16 19:01:25.886 +03:00 [INF] === Incoming Request ===
2025-10-16 19:01:25.887 +03:00 [INF] Path: /api/CustomField
2025-10-16 19:01:25.887 +03:00 [INF] Method: POST
2025-10-16 19:01:25.888 +03:00 [INF] === Headers ===
2025-10-16 19:01:25.889 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:01:25.891 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:01:25.893 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:01:25.895 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:01:25.896 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:01:25.897 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:01:25.899 +03:00 [INF] Content-Length: ["286"]
2025-10-16 19:01:25.900 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:01:25.901 +03:00 [INF] Postman-Token: ["6228bdb1-a341-4bad-9b19-083b24eaeb12"]
2025-10-16 19:01:25.903 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:01:25.904 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:01:25.905 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP)'
2025-10-16 19:01:25.907 +03:00 [INF] Route matched with {action = "Create", controller = "CustomField"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Custom.CustomFieldResponseDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.Commends.Command_Custom.CreateCustomFieldCommand) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController (ModularERP).
2025-10-16 19:01:25.921 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Custom.CustomFieldResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 19:01:25.923 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP) in 13.3255ms
2025-10-16 19:01:25.925 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CustomFieldController.Create (ModularERP)'
2025-10-16 19:01:25.928 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 19:01:25.930 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/CustomField - 200 null application/json; charset=utf-8 48.6378ms
2025-10-16 19:02:49.906 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/BarcodeSettings - application/json 253
2025-10-16 19:02:49.909 +03:00 [INF] Request started
2025-10-16 19:02:49.910 +03:00 [INF] === Incoming Request ===
2025-10-16 19:02:49.911 +03:00 [INF] Path: /api/BarcodeSettings
2025-10-16 19:02:49.912 +03:00 [INF] Method: POST
2025-10-16 19:02:49.913 +03:00 [INF] === Headers ===
2025-10-16 19:02:49.914 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:02:49.916 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:02:49.917 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:02:49.919 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:02:49.920 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:02:49.921 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:02:49.923 +03:00 [INF] Content-Length: ["253"]
2025-10-16 19:02:49.924 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:02:49.926 +03:00 [INF] Postman-Token: ["0405f618-12f1-41ff-b5a5-956fbd5f904e"]
2025-10-16 19:02:49.928 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:02:49.929 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:02:49.930 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.CreateBarcodeSettings (ModularERP)'
2025-10-16 19:02:49.934 +03:00 [INF] Route matched with {action = "CreateBarcodeSettings", controller = "BarcodeSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateBarcodeSettings(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Barcode.CreateBarcodeSettingsDto) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController (ModularERP).
2025-10-16 19:02:49.938 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 19:02:50.036 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.CreateBarcodeSettings (ModularERP) in 98.9056ms
2025-10-16 19:02:50.038 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.CreateBarcodeSettings (ModularERP)'
2025-10-16 19:02:50.040 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_BarcodeSettings_Companies_CompanyId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.Companies", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e6984c13-d16a-4fc0-a50b-a9b2ff57fb98
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handler_Barcode.CreateBarcodeSettingsHandler.Handle(CreateBarcodeSettingsCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handler_Barcode\CreateBarcodeSettingsHandler.cs:line 46
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.CreateBarcodeSettings(CreateBarcodeSettingsDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\BarcodeSettingsController.cs:line 67
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 19:02:50.072 +03:00 [INF] Error response sent with status code 500
2025-10-16 19:02:50.073 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/BarcodeSettings - 500 null application/json; charset=utf-8 166.8305ms
2025-10-16 19:03:26.127 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/BarcodeSettings - null null
2025-10-16 19:03:26.133 +03:00 [INF] Request started
2025-10-16 19:03:26.133 +03:00 [INF] === Incoming Request ===
2025-10-16 19:03:26.134 +03:00 [INF] Path: /api/BarcodeSettings
2025-10-16 19:03:26.135 +03:00 [INF] Method: GET
2025-10-16 19:03:26.136 +03:00 [INF] === Headers ===
2025-10-16 19:03:26.138 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:03:26.140 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:03:26.141 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:03:26.142 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:03:26.144 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:03:26.145 +03:00 [INF] X-Tenant-ID: ["8bed874f-cf2a-4ffa-a188-4cfef779774a","6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:03:26.147 +03:00 [INF] Postman-Token: ["ed80159b-7317-46fb-90c5-b6d6aea70363"]
2025-10-16 19:03:26.148 +03:00 [INF] 🔍 TenantService returned: '8bed874f-cf2a-4ffa-a188-4cfef779774a'
2025-10-16 19:03:26.150 +03:00 [INF] ✅ Processing request for tenant: 8bed874f-cf2a-4ffa-a188-4cfef779774a
2025-10-16 19:03:26.151 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.GetBarcodeSettings (ModularERP)'
2025-10-16 19:03:26.154 +03:00 [INF] Route matched with {action = "GetBarcodeSettings", controller = "BarcodeSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetBarcodeSettings() on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController (ModularERP).
2025-10-16 19:03:26.177 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 19:03:26.210 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.GetBarcodeSettings (ModularERP) in 52.9846ms
2025-10-16 19:03:26.212 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.GetBarcodeSettings (ModularERP)'
2025-10-16 19:03:26.214 +03:00 [ERR] Application exception occurred: No default barcode settings found
ModularERP.Common.Exceptions.NotFoundException: No default barcode settings found
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handler_Barcode.GetBarcodeSettingsHandler.Handle(GetBarcodeSettingsQuery request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handler_Barcode\GetBarcodeSettingsHandler.cs:line 35
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.GetBarcodeSettings() in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\BarcodeSettingsController.cs:line 31
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 19:03:26.224 +03:00 [INF] Error response sent with status code 404
2025-10-16 19:03:26.225 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/BarcodeSettings - 404 null application/json; charset=utf-8 98.3068ms
2025-10-16 19:05:28.050 +03:00 [INF] Starting web host...
2025-10-16 19:05:29.301 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 19:05:29.361 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 19:05:29.455 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 19:05:29.462 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 19:05:29.477 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 19:05:29.557 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 19:05:29.573 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 19:05:29.578 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 19:05:29.586 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 19:05:29.598 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 19:05:29.605 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 19:05:29.778 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 19:05:29.785 +03:00 [INF] Master database initialized successfully
2025-10-16 19:05:31.308 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 19:05:31.423 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 19:05:31.425 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 19:05:31.531 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 19:05:31.533 +03:00 [INF] Hosting environment: Development
2025-10-16 19:05:31.534 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 19:05:31.873 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 19:05:31.993 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 120.8244ms
2025-10-16 19:05:31.993 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 19:05:31.993 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 19:05:32.007 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.6963ms
2025-10-16 19:05:32.029 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 35.8744ms
2025-10-16 19:05:32.187 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 19:05:32.374 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 187.1079ms
2025-10-16 19:05:34.203 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/BarcodeSettings - application/json 253
2025-10-16 19:05:34.224 +03:00 [INF] Request started
2025-10-16 19:05:34.227 +03:00 [INF] === Incoming Request ===
2025-10-16 19:05:34.229 +03:00 [INF] Path: /api/BarcodeSettings
2025-10-16 19:05:34.230 +03:00 [INF] Method: POST
2025-10-16 19:05:34.231 +03:00 [INF] === Headers ===
2025-10-16 19:05:34.234 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:05:34.237 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:05:34.239 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:05:34.241 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:05:34.243 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:05:34.245 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:05:34.247 +03:00 [INF] Content-Length: ["253"]
2025-10-16 19:05:34.250 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:05:34.251 +03:00 [INF] Postman-Token: ["b5c30379-52f3-483a-86f3-da323256cd62"]
2025-10-16 19:05:34.256 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:05:34.258 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:05:34.260 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.CreateBarcodeSettings (ModularERP)'
2025-10-16 19:05:34.281 +03:00 [INF] Route matched with {action = "CreateBarcodeSettings", controller = "BarcodeSettings"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateBarcodeSettings(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Barcode.CreateBarcodeSettingsDto) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController (ModularERP).
2025-10-16 19:05:34.287 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 19:05:34.422 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 19:05:34.977 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 19:05:35.235 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Barcode.BarcodeSettingsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 19:05:35.261 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.CreateBarcodeSettings (ModularERP) in 973.4134ms
2025-10-16 19:05:35.263 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BarcodeSettingsController.CreateBarcodeSettings (ModularERP)'
2025-10-16 19:05:35.265 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 19:05:35.270 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/BarcodeSettings - 200 null application/json; charset=utf-8 1066.4976ms
2025-10-16 19:27:39.592 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Warehouses - application/json 166
2025-10-16 19:27:39.601 +03:00 [INF] Request started
2025-10-16 19:27:39.603 +03:00 [INF] === Incoming Request ===
2025-10-16 19:27:39.604 +03:00 [INF] Path: /api/Warehouses
2025-10-16 19:27:39.606 +03:00 [INF] Method: POST
2025-10-16 19:27:39.607 +03:00 [INF] === Headers ===
2025-10-16 19:27:39.609 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:27:39.610 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:27:39.613 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:27:39.615 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:27:39.616 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:27:39.617 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:27:39.619 +03:00 [INF] Content-Length: ["166"]
2025-10-16 19:27:39.620 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:27:39.624 +03:00 [INF] Postman-Token: ["a3e741ff-c943-403e-9adf-1209b09a5562"]
2025-10-16 19:27:39.629 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:27:39.630 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:27:39.632 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Warehouses.Controllers.WarehousesController.CreateWarehouse (ModularERP)'
2025-10-16 19:27:39.639 +03:00 [INF] Route matched with {action = "CreateWarehouse", controller = "Warehouses"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Warehouses.DTO.WarehouseDto]]] CreateWarehouse(ModularERP.Modules.Inventory.Features.Warehouses.DTO.CreateWarehouseDto) on controller ModularERP.Modules.Inventory.Features.Warehouses.Controllers.WarehousesController (ModularERP).
2025-10-16 19:27:39.709 +03:00 [INF] Creating new warehouse: Wahehouse2 for CompanyId: "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 19:27:39.797 +03:00 [INF] Warehouse created successfully: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-10-16 19:27:39.807 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Warehouses.DTO.WarehouseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 19:27:39.826 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Warehouses.Controllers.WarehousesController.CreateWarehouse (ModularERP) in 182.2116ms
2025-10-16 19:27:39.829 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Warehouses.Controllers.WarehousesController.CreateWarehouse (ModularERP)'
2025-10-16 19:27:39.830 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 19:27:39.832 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Warehouses - 201 null application/json; charset=utf-8 239.6348ms
2025-10-16 19:28:07.406 +03:00 [INF] Request starting HTTP/1.1 DELETE https://localhost:7168/api/Warehouses/{e5d0bbaa-9099-43e1-bb16-f9744078a9ea} - null null
2025-10-16 19:28:07.411 +03:00 [INF] Request started
2025-10-16 19:28:07.412 +03:00 [INF] === Incoming Request ===
2025-10-16 19:28:07.414 +03:00 [INF] Path: /api/Warehouses/%7Be5d0bbaa-9099-43e1-bb16-f9744078a9ea%7D
2025-10-16 19:28:07.416 +03:00 [INF] Method: DELETE
2025-10-16 19:28:07.418 +03:00 [INF] === Headers ===
2025-10-16 19:28:07.419 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:28:07.421 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:28:07.423 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:28:07.424 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:28:07.427 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:28:07.428 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:28:07.430 +03:00 [INF] Postman-Token: ["184721c8-a5eb-4205-a112-e911e23212cd"]
2025-10-16 19:28:07.432 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:28:07.434 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:28:07.436 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Warehouses.Controllers.WarehousesController.DeleteWarehouse (ModularERP)'
2025-10-16 19:28:07.440 +03:00 [INF] Route matched with {action = "DeleteWarehouse", controller = "Warehouses"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Boolean]]] DeleteWarehouse(System.Guid) on controller ModularERP.Modules.Inventory.Features.Warehouses.Controllers.WarehousesController (ModularERP).
2025-10-16 19:28:07.449 +03:00 [INF] Deleting warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-10-16 19:28:07.466 +03:00 [WRN] Cannot delete primary warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-10-16 19:28:07.469 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Warehouses.Controllers.WarehousesController.DeleteWarehouse (ModularERP) in 25.7964ms
2025-10-16 19:28:07.470 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Warehouses.Controllers.WarehousesController.DeleteWarehouse (ModularERP)'
2025-10-16 19:28:07.473 +03:00 [WRN] Business logic exception occurred: Cannot delete primary warehouse. Please set another warehouse as primary first
ModularERP.Common.Exceptions.BusinessLogicException: Cannot delete primary warehouse. Please set another warehouse as primary first
   at ModularERP.Modules.Inventory.Features.Warehouses.Handlers.DeleteWarehouseCommandHandler.Handle(DeleteWarehouseCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Warehouses\Handlers\DeleteWarehouseCommandHandler.cs:line 42
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Warehouses.Controllers.WarehousesController.DeleteWarehouse(Guid id) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Warehouses\Controllers\WarehousesController.cs:line 158
   at lambda_method525(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 19:28:07.538 +03:00 [INF] Error response sent with status code 400
2025-10-16 19:28:07.540 +03:00 [INF] Request finished HTTP/1.1 DELETE https://localhost:7168/api/Warehouses/{e5d0bbaa-9099-43e1-bb16-f9744078a9ea} - 400 null application/json; charset=utf-8 134.2938ms
2025-10-16 19:29:40.631 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Categories - multipart/form-data; boundary=--------------------------201154821934846977961271 56495
2025-10-16 19:29:40.635 +03:00 [INF] Request started
2025-10-16 19:29:40.636 +03:00 [INF] === Incoming Request ===
2025-10-16 19:29:40.637 +03:00 [INF] Path: /api/Categories
2025-10-16 19:29:40.638 +03:00 [INF] Method: POST
2025-10-16 19:29:40.640 +03:00 [INF] === Headers ===
2025-10-16 19:29:40.642 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:29:40.643 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:29:40.646 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:29:40.648 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:29:40.650 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:29:40.657 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------201154821934846977961271"]
2025-10-16 19:29:40.659 +03:00 [INF] Content-Length: ["56495"]
2025-10-16 19:29:40.661 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:29:40.663 +03:00 [INF] Postman-Token: ["0738864a-4ff3-4fb5-b4b8-d1d663968ddc"]
2025-10-16 19:29:40.667 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:29:40.669 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:29:40.670 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CategoriesController.Create (ModularERP)'
2025-10-16 19:29:40.681 +03:00 [INF] Route matched with {action = "Create", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Category.CreateCategoryDto) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CategoriesController (ModularERP).
2025-10-16 19:29:40.788 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CategoriesController.Create (ModularERP) in 102.8534ms
2025-10-16 19:29:40.791 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CategoriesController.Create (ModularERP)'
2025-10-16 19:29:40.794 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_CategoryAttachments_AspNetUsers_UploadedBy". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9858ef3f-4dd7-4e2f-9ca4-51c245f209cb
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Inventory.Features.ProductSettings.Handlers.Handelrs_Category.CreateCategoryHandler.Handle(CreateCategoryCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Handlers\Handelrs_Category\CreateCategoryHandler.cs:line 52
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CategoriesController.Create(CreateCategoryDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\ProductSettings\Controllers\CategoriesController.cs:line 65
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 19:29:40.852 +03:00 [INF] Error response sent with status code 500
2025-10-16 19:29:40.855 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Categories - 500 null application/json; charset=utf-8 223.4953ms
2025-10-16 19:32:34.736 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Categories - multipart/form-data; boundary=--------------------------602950290062082681578921 56495
2025-10-16 19:32:34.741 +03:00 [INF] Request started
2025-10-16 19:32:34.743 +03:00 [INF] === Incoming Request ===
2025-10-16 19:32:34.744 +03:00 [INF] Path: /api/Categories
2025-10-16 19:32:34.745 +03:00 [INF] Method: POST
2025-10-16 19:32:34.746 +03:00 [INF] === Headers ===
2025-10-16 19:32:34.747 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:32:34.748 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:32:34.749 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:32:34.751 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:32:34.752 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:32:34.753 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------602950290062082681578921"]
2025-10-16 19:32:34.755 +03:00 [INF] Content-Length: ["56495"]
2025-10-16 19:32:34.756 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:32:34.758 +03:00 [INF] Postman-Token: ["f4ffa723-6171-414d-b5a0-e31d2d985ad3"]
2025-10-16 19:32:34.760 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:32:34.761 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:32:34.762 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CategoriesController.Create (ModularERP)'
2025-10-16 19:32:34.764 +03:00 [INF] Route matched with {action = "Create", controller = "Categories"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Category.CreateCategoryDto) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CategoriesController (ModularERP).
2025-10-16 19:32:34.839 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Category.CategoryResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 19:32:34.850 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CategoriesController.Create (ModularERP) in 84.1633ms
2025-10-16 19:32:34.853 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.CategoriesController.Create (ModularERP)'
2025-10-16 19:32:34.855 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 19:32:34.856 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Categories - 201 null application/json; charset=utf-8 119.6652ms
2025-10-16 19:32:57.890 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Brands - application/json 584
2025-10-16 19:32:57.894 +03:00 [INF] Request started
2025-10-16 19:32:57.895 +03:00 [INF] === Incoming Request ===
2025-10-16 19:32:57.896 +03:00 [INF] Path: /api/Brands
2025-10-16 19:32:57.897 +03:00 [INF] Method: POST
2025-10-16 19:32:57.899 +03:00 [INF] === Headers ===
2025-10-16 19:32:57.901 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:32:57.902 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:32:57.904 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:32:57.906 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:32:57.907 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:32:57.909 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:32:57.910 +03:00 [INF] Content-Length: ["584"]
2025-10-16 19:32:57.912 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:32:57.913 +03:00 [INF] Postman-Token: ["91a2dafa-f4b8-4d9a-8588-ea599259e447"]
2025-10-16 19:32:57.914 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:32:57.916 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:32:57.917 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BrandsController.Create (ModularERP)'
2025-10-16 19:32:57.921 +03:00 [INF] Route matched with {action = "Create", controller = "Brands"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Brand.BrandDto]]] Create(ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Brand.CreateBrandDto) on controller ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BrandsController (ModularERP).
2025-10-16 19:32:57.976 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.ProductSettings.DTO.DTO_Brand.BrandDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 19:32:57.980 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BrandsController.Create (ModularERP) in 54.6012ms
2025-10-16 19:32:57.982 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.ProductSettings.Controllers.BrandsController.Create (ModularERP)'
2025-10-16 19:32:57.984 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 19:32:57.985 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Brands - 200 null application/json; charset=utf-8 95.1458ms
2025-10-16 19:36:57.393 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/ItemGroup - application/json 167
2025-10-16 19:36:57.397 +03:00 [INF] Request started
2025-10-16 19:36:57.397 +03:00 [INF] === Incoming Request ===
2025-10-16 19:36:57.398 +03:00 [INF] Path: /api/ItemGroup
2025-10-16 19:36:57.399 +03:00 [INF] Method: POST
2025-10-16 19:36:57.401 +03:00 [INF] === Headers ===
2025-10-16 19:36:57.402 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:36:57.403 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:36:57.405 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:36:57.407 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:36:57.409 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:36:57.410 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:36:57.412 +03:00 [INF] Content-Length: ["167"]
2025-10-16 19:36:57.413 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:36:57.414 +03:00 [INF] Postman-Token: ["3ce9f734-2881-48b8-9f1b-af246963fc9b"]
2025-10-16 19:36:57.416 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:36:57.417 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:36:57.418 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ItemGroupController.Create (ModularERP)'
2025-10-16 19:36:57.422 +03:00 [INF] Route matched with {action = "Create", controller = "ItemGroup"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ItemGroup.ItemGroupDto]]] Create(ModularERP.Modules.Inventory.Features.Products.Commends.Commands_ItemGroup.CreateItemGroupCommand) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ItemGroupController (ModularERP).
2025-10-16 19:36:57.721 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.DTO_ItemGroup.ItemGroupDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 19:36:57.726 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ItemGroupController.Create (ModularERP) in 300.3833ms
2025-10-16 19:36:57.728 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ItemGroupController.Create (ModularERP)'
2025-10-16 19:36:57.729 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 19:36:57.731 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/ItemGroup - 200 null application/json; charset=utf-8 337.8129ms
2025-10-16 19:37:42.960 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products - application/json 925
2025-10-16 19:37:42.963 +03:00 [INF] Request started
2025-10-16 19:37:42.964 +03:00 [INF] === Incoming Request ===
2025-10-16 19:37:42.965 +03:00 [INF] Path: /api/Products
2025-10-16 19:37:42.966 +03:00 [INF] Method: POST
2025-10-16 19:37:42.968 +03:00 [INF] === Headers ===
2025-10-16 19:37:42.968 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:37:42.970 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:37:42.971 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:37:42.975 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:37:42.978 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:37:42.979 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:37:42.981 +03:00 [INF] Content-Length: ["925"]
2025-10-16 19:37:42.982 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:37:42.983 +03:00 [INF] Postman-Token: ["d66dd510-b26a-4b1b-8558-e007e3f6b812"]
2025-10-16 19:37:42.986 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:37:42.987 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:37:42.988 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-10-16 19:37:42.993 +03:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(ModularERP.Modules.Inventory.Features.Products.DTO.CreateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 19:37:43.008 +03:00 [INF] Creating new product with SKU SKU-101 for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 19:37:43.293 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 19:37:43.300 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP) in 304.4363ms
2025-10-16 19:37:43.303 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-10-16 19:37:43.304 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 19:37:43.305 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products - 200 null application/json; charset=utf-8 344.8025ms
2025-10-16 19:54:33.721 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 19:54:33.733 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 12.2205ms
2025-10-16 19:54:33.746 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 19:54:33.746 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 19:54:33.751 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.3676ms
2025-10-16 19:54:33.762 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 15.4839ms
2025-10-16 19:54:33.953 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 19:54:34.119 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 166.4304ms
2025-10-16 19:56:39.297 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products - application/json 925
2025-10-16 19:56:39.301 +03:00 [INF] Request started
2025-10-16 19:56:39.302 +03:00 [INF] === Incoming Request ===
2025-10-16 19:56:39.303 +03:00 [INF] Path: /api/Products
2025-10-16 19:56:39.305 +03:00 [INF] Method: POST
2025-10-16 19:56:39.305 +03:00 [INF] === Headers ===
2025-10-16 19:56:39.306 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:56:39.308 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:56:39.309 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:56:39.311 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:56:39.312 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:56:39.314 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:56:39.316 +03:00 [INF] Content-Length: ["925"]
2025-10-16 19:56:39.317 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:56:39.318 +03:00 [INF] Postman-Token: ["8b923375-503e-4ba3-92fe-008bcb22ea6e"]
2025-10-16 19:56:39.320 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:56:39.321 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:56:39.322 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-10-16 19:56:39.325 +03:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(ModularERP.Modules.Inventory.Features.Products.DTO.CreateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 19:56:39.333 +03:00 [INF] Creating new product with SKU SKU-102 for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 19:56:39.386 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 19:56:39.393 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP) in 64.659ms
2025-10-16 19:56:39.396 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-10-16 19:56:39.397 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 19:56:39.398 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products - 200 null application/json; charset=utf-8 101.0046ms
2025-10-16 19:58:12.430 +03:00 [INF] Starting web host...
2025-10-16 19:58:15.622 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 19:58:15.706 +03:00 [INF] Executed DbCommand (65ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 19:58:15.794 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 19:58:15.799 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 19:58:15.818 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 19:58:15.874 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 19:58:15.890 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 19:58:15.895 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 19:58:15.902 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 19:58:15.914 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 19:58:15.921 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 19:58:16.087 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 19:58:16.095 +03:00 [INF] Master database initialized successfully
2025-10-16 19:58:18.227 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 19:58:18.449 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 19:58:18.451 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 19:58:18.529 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 19:58:18.531 +03:00 [INF] Hosting environment: Development
2025-10-16 19:58:18.532 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 19:58:18.973 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 19:58:19.119 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 147.7009ms
2025-10-16 19:58:19.207 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 19:58:19.206 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 19:58:19.215 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.176ms
2025-10-16 19:58:19.237 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.488ms
2025-10-16 19:58:19.275 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 19:58:19.481 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 206.7198ms
2025-10-16 19:58:22.283 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products - application/json 925
2025-10-16 19:58:22.302 +03:00 [INF] Request started
2025-10-16 19:58:22.310 +03:00 [INF] === Incoming Request ===
2025-10-16 19:58:22.312 +03:00 [INF] Path: /api/Products
2025-10-16 19:58:22.314 +03:00 [INF] Method: POST
2025-10-16 19:58:22.316 +03:00 [INF] === Headers ===
2025-10-16 19:58:22.318 +03:00 [INF] Accept: ["*/*"]
2025-10-16 19:58:22.322 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 19:58:22.323 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 19:58:22.325 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 19:58:22.327 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 19:58:22.329 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 19:58:22.332 +03:00 [INF] Content-Length: ["925"]
2025-10-16 19:58:22.334 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 19:58:22.336 +03:00 [INF] Postman-Token: ["09e56a8c-ca90-4326-8b0c-706f13f1d613"]
2025-10-16 19:58:22.343 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 19:58:22.345 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 19:58:22.347 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-10-16 19:58:22.372 +03:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(ModularERP.Modules.Inventory.Features.Products.DTO.CreateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 19:58:22.378 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 19:58:22.446 +03:00 [INF] Creating new product with SKU SKU-103 for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 19:58:22.514 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 19:58:23.237 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 19:58:23.993 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 19:58:24.024 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP) in 1645.859ms
2025-10-16 19:58:24.028 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-10-16 19:58:24.031 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 19:58:24.038 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products - 200 null application/json; charset=utf-8 1755.2301ms
2025-10-16 20:02:06.733 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products - application/json 925
2025-10-16 20:02:06.744 +03:00 [INF] Request started
2025-10-16 20:02:06.745 +03:00 [INF] === Incoming Request ===
2025-10-16 20:02:06.746 +03:00 [INF] Path: /api/Products
2025-10-16 20:02:06.747 +03:00 [INF] Method: POST
2025-10-16 20:02:06.748 +03:00 [INF] === Headers ===
2025-10-16 20:02:06.749 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:02:06.750 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:02:06.752 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:02:06.754 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:02:06.756 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:02:06.758 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:02:06.759 +03:00 [INF] Content-Length: ["925"]
2025-10-16 20:02:06.761 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:02:06.762 +03:00 [INF] Postman-Token: ["6622803e-11c1-471d-9927-3e008e633b4e"]
2025-10-16 20:02:06.765 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:02:06.766 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:02:06.767 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-10-16 20:02:06.770 +03:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(ModularERP.Modules.Inventory.Features.Products.DTO.CreateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:02:06.774 +03:00 [INF] Creating new product with SKU SKU-104 for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:02:06.862 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 20:02:06.865 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP) in 92.9151ms
2025-10-16 20:02:06.867 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-10-16 20:02:06.868 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 20:02:06.870 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products - 200 null application/json; charset=utf-8 137.848ms
2025-10-16 20:07:06.951 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{c2c5790c-9d94-41b1-818a-060d9a0e0b6a} - application/json 925
2025-10-16 20:07:06.957 +03:00 [INF] Request started
2025-10-16 20:07:06.959 +03:00 [INF] === Incoming Request ===
2025-10-16 20:07:06.960 +03:00 [INF] Path: /api/Products/%7Bc2c5790c-9d94-41b1-818a-060d9a0e0b6a%7D
2025-10-16 20:07:06.961 +03:00 [INF] Method: PUT
2025-10-16 20:07:06.962 +03:00 [INF] === Headers ===
2025-10-16 20:07:06.962 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:07:06.964 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:07:06.965 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:07:06.967 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:07:06.968 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:07:06.970 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:07:06.972 +03:00 [INF] Content-Length: ["925"]
2025-10-16 20:07:06.974 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:07:06.975 +03:00 [INF] Postman-Token: ["2bf3f30c-0aaa-4534-972c-cc7426ad25dc"]
2025-10-16 20:07:06.977 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:07:06.977 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:07:06.978 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:07:06.983 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:07:07.003 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Object, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 20:07:07.007 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 19.434ms
2025-10-16 20:07:07.009 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:07:07.010 +03:00 [INF] Request completed successfully with status code 400
2025-10-16 20:07:07.011 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{c2c5790c-9d94-41b1-818a-060d9a0e0b6a} - 400 null application/json; charset=utf-8 60.2051ms
2025-10-16 20:07:32.926 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 925
2025-10-16 20:07:32.930 +03:00 [INF] Request started
2025-10-16 20:07:32.931 +03:00 [INF] === Incoming Request ===
2025-10-16 20:07:32.932 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:07:32.934 +03:00 [INF] Method: PUT
2025-10-16 20:07:32.936 +03:00 [INF] === Headers ===
2025-10-16 20:07:32.936 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:07:32.938 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:07:32.939 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:07:32.940 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:07:32.942 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:07:32.944 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:07:32.946 +03:00 [INF] Content-Length: ["925"]
2025-10-16 20:07:32.947 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:07:32.949 +03:00 [INF] Postman-Token: ["90651cb6-87b8-4ef7-af70-78de7468ecfb"]
2025-10-16 20:07:32.951 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:07:32.952 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:07:32.953 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:07:32.954 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:07:32.957 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Object, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-16 20:07:32.959 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 2.994ms
2025-10-16 20:07:32.961 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:07:32.962 +03:00 [INF] Request completed successfully with status code 400
2025-10-16 20:07:32.963 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 400 null application/json; charset=utf-8 37.5917ms
2025-10-16 20:08:20.124 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:08:20.127 +03:00 [INF] Request started
2025-10-16 20:08:20.128 +03:00 [INF] === Incoming Request ===
2025-10-16 20:08:20.129 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:08:20.130 +03:00 [INF] Method: PUT
2025-10-16 20:08:20.131 +03:00 [INF] === Headers ===
2025-10-16 20:08:20.132 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:08:20.134 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:08:20.136 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:08:20.137 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:08:20.139 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:08:20.140 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:08:20.141 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:08:20.143 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:08:20.144 +03:00 [INF] Postman-Token: ["3935dc43-b2e6-420d-aaff-a35221bef669"]
2025-10-16 20:08:20.147 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:08:20.148 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:08:20.149 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:08:20.151 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:08:20.154 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:08:20.280 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 126.5761ms
2025-10-16 20:08:20.282 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:08:20.284 +03:00 [ERR] Unexpected error occurred
System.InvalidOperationException: The instance of entity type 'ProductTaxProfile' cannot be tracked because another instance with the same key value for {'ProductId', 'TaxProfileId'} is already being tracked. When attaching existing entities, ensure that only one entity instance with a given key value is attached. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the conflicting key values.
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.ThrowIdentityConflict(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry, Boolean updateDuplicate)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NullableKeyIdentityMap`1.Add(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.StartTracking(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState oldState, EntityState newState, Boolean acceptChanges, Boolean modifyProperties)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityStateAsync(EntityState entityState, Boolean acceptChanges, Boolean modifyProperties, Nullable`1 forceStateWhenUnknownKey, Nullable`1 fallbackState, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.PaintActionAsync(EntityEntryGraphNode`1 node, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraphAsync[TState](EntityEntryGraphNode`1 node, Func`3 handleNode, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.AttachGraphAsync(InternalEntityEntry rootEntry, EntityState targetState, EntityState storeGeneratedWithKeySetTargetState, Boolean forceStateWhenUnknownKey, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.AddRangeAsync(IEnumerable`1 entities, CancellationToken cancellationToken)
   at ModularERP.Shared.Repository.JoinTableRepository`1.AddRangeAsync(IEnumerable`1 entities) in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\JoinTableRepository.cs:line 80
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.UpdateProductCommandHandler.Handle(UpdateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\UpdateProductCommandHandler.cs:line 168
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct(Guid id, UpdateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 20:08:20.341 +03:00 [INF] Error response sent with status code 500
2025-10-16 20:08:20.344 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 500 null application/json; charset=utf-8 220.2893ms
2025-10-16 20:11:32.088 +03:00 [INF] Starting web host...
2025-10-16 20:11:33.353 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:11:33.424 +03:00 [INF] Executed DbCommand (55ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:11:33.517 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:11:33.523 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:11:33.539 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:11:33.597 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:11:33.615 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:11:33.620 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:11:33.627 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:11:33.642 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:11:33.651 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:11:33.819 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:11:33.826 +03:00 [INF] Master database initialized successfully
2025-10-16 20:11:35.444 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:11:35.552 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:11:35.554 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:11:35.630 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:11:35.632 +03:00 [INF] Hosting environment: Development
2025-10-16 20:11:35.633 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:11:35.936 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:11:36.061 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 126.0231ms
2025-10-16 20:11:36.201 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:11:36.201 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:11:36.208 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.5962ms
2025-10-16 20:11:36.227 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.046ms
2025-10-16 20:11:36.274 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:11:36.448 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 173.9593ms
2025-10-16 20:11:58.061 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:11:58.084 +03:00 [INF] Request started
2025-10-16 20:11:58.087 +03:00 [INF] === Incoming Request ===
2025-10-16 20:11:58.089 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:11:58.090 +03:00 [INF] Method: PUT
2025-10-16 20:11:58.091 +03:00 [INF] === Headers ===
2025-10-16 20:11:58.095 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:11:58.098 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:11:58.099 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:11:58.100 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:11:58.102 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:11:58.103 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:11:58.105 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:11:58.107 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:11:58.108 +03:00 [INF] Postman-Token: ["df2155f6-6784-4757-bd45-5be53724d9d0"]
2025-10-16 20:11:58.113 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:11:58.115 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:11:58.116 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:11:58.137 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:11:58.144 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:11:58.193 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:11:58.274 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 20:11:58.975 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:11:59.530 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 1385.605ms
2025-10-16 20:11:59.532 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:11:59.534 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_ProductTaxProfiles'. Cannot insert duplicate key in object 'dbo.ProductTaxProfiles'. The duplicate key value is (1455fbe8-d0b2-4615-b998-5b00ed509ab7, 2fcc534d-38e7-40f7-a2ea-08de0cc77d86).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:104abdb4-c2a5-4253-8f5c-e80c424236b6
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.Shared.Repository.JoinTableRepository`1.SaveChangesAsync() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\JoinTableRepository.cs:line 176
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.UpdateProductCommandHandler.Handle(UpdateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\UpdateProductCommandHandler.cs:line 225
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct(Guid id, UpdateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 20:11:59.614 +03:00 [INF] Error response sent with status code 500
2025-10-16 20:11:59.621 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 500 null application/json; charset=utf-8 1559.8697ms
2025-10-16 20:13:09.016 +03:00 [INF] Starting web host...
2025-10-16 20:13:10.039 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:13:10.099 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:13:10.177 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:13:10.182 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:13:10.198 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:13:10.253 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:13:10.269 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:13:10.274 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:13:10.281 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:13:10.294 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:13:10.301 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:13:10.459 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:13:10.466 +03:00 [INF] Master database initialized successfully
2025-10-16 20:13:11.872 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:13:11.974 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:13:11.976 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:13:12.048 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:13:12.050 +03:00 [INF] Hosting environment: Development
2025-10-16 20:13:12.051 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:13:12.356 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:13:12.472 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 116.9803ms
2025-10-16 20:13:12.474 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:13:12.474 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:13:12.486 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 12.6311ms
2025-10-16 20:13:12.505 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 31.7722ms
2025-10-16 20:13:12.579 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:13:12.734 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 155.0925ms
2025-10-16 20:13:17.148 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:13:17.164 +03:00 [INF] Request started
2025-10-16 20:13:17.166 +03:00 [INF] === Incoming Request ===
2025-10-16 20:13:17.168 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:13:17.169 +03:00 [INF] Method: PUT
2025-10-16 20:13:17.170 +03:00 [INF] === Headers ===
2025-10-16 20:13:17.173 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:13:17.176 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:13:17.178 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:13:17.179 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:13:17.181 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:13:17.183 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:13:17.184 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:13:17.186 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:13:17.187 +03:00 [INF] Postman-Token: ["bbf135e6-c872-418c-8304-02f471b7b3f6"]
2025-10-16 20:13:17.192 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:13:17.193 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:13:17.195 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:13:17.213 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:13:17.219 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:13:17.271 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:13:17.349 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 20:13:17.906 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:13:18.409 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 1189.9472ms
2025-10-16 20:13:18.412 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:13:18.415 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_ProductTaxProfiles'. Cannot insert duplicate key in object 'dbo.ProductTaxProfiles'. The duplicate key value is (1455fbe8-d0b2-4615-b998-5b00ed509ab7, 2fcc534d-38e7-40f7-a2ea-08de0cc77d86).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4b5e7c53-952c-4af8-812b-91a49f5cf018
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.Shared.Repository.JoinTableRepository`1.SaveChangesAsync() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\JoinTableRepository.cs:line 176
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.UpdateProductCommandHandler.Handle(UpdateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\UpdateProductCommandHandler.cs:line 231
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct(Guid id, UpdateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 20:13:18.489 +03:00 [INF] Error response sent with status code 500
2025-10-16 20:13:18.497 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 500 null application/json; charset=utf-8 1348.7881ms
2025-10-16 20:14:05.788 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 902
2025-10-16 20:14:05.802 +03:00 [INF] Request started
2025-10-16 20:14:05.804 +03:00 [INF] === Incoming Request ===
2025-10-16 20:14:05.805 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:14:05.806 +03:00 [INF] Method: PUT
2025-10-16 20:14:05.808 +03:00 [INF] === Headers ===
2025-10-16 20:14:05.809 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:14:05.811 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:14:05.813 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:14:05.815 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:14:05.817 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:14:05.820 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:14:05.822 +03:00 [INF] Content-Length: ["902"]
2025-10-16 20:14:05.823 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:14:05.826 +03:00 [INF] Postman-Token: ["eddd4bd0-5ad7-40f0-bce7-67ebf35cb2c8"]
2025-10-16 20:14:05.829 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:14:05.832 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:14:05.834 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:14:05.836 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:14:05.841 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:14:06.086 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 20:14:06.103 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 263.4473ms
2025-10-16 20:14:06.106 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:14:06.108 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 20:14:06.109 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 200 null application/json; charset=utf-8 321.084ms
2025-10-16 20:14:51.459 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 902
2025-10-16 20:14:51.464 +03:00 [INF] Request started
2025-10-16 20:14:51.465 +03:00 [INF] === Incoming Request ===
2025-10-16 20:14:51.466 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:14:51.467 +03:00 [INF] Method: PUT
2025-10-16 20:14:51.470 +03:00 [INF] === Headers ===
2025-10-16 20:14:51.472 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:14:51.474 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:14:51.476 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:14:51.477 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:14:51.480 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:14:51.482 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:14:51.484 +03:00 [INF] Content-Length: ["902"]
2025-10-16 20:14:51.486 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:14:51.489 +03:00 [INF] Postman-Token: ["dc7733cf-1821-401e-aec1-0b20b5ad17d6"]
2025-10-16 20:14:51.491 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:14:51.492 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:14:51.493 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:14:51.495 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:14:51.503 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:14:51.560 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 20:14:51.563 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 60.5575ms
2025-10-16 20:14:51.566 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:14:51.568 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 20:14:51.569 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 200 null application/json; charset=utf-8 110.4964ms
2025-10-16 20:15:39.498 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 902
2025-10-16 20:15:39.503 +03:00 [INF] Request started
2025-10-16 20:15:39.504 +03:00 [INF] === Incoming Request ===
2025-10-16 20:15:39.505 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:15:39.506 +03:00 [INF] Method: PUT
2025-10-16 20:15:39.509 +03:00 [INF] === Headers ===
2025-10-16 20:15:39.510 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:15:39.512 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:15:39.513 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:15:39.515 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:15:39.519 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:15:39.521 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:15:39.523 +03:00 [INF] Content-Length: ["902"]
2025-10-16 20:15:39.525 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:15:39.527 +03:00 [INF] Postman-Token: ["0d42f1bf-7402-4c19-a767-b86ead8b2251"]
2025-10-16 20:15:39.529 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:15:39.530 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:15:39.531 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:15:39.534 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:15:39.540 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:15:39.600 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 20:15:39.603 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 63.6548ms
2025-10-16 20:15:39.605 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:15:39.607 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 20:15:39.610 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 200 null application/json; charset=utf-8 112.6121ms
2025-10-16 20:15:50.338 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 902
2025-10-16 20:15:50.344 +03:00 [INF] Request started
2025-10-16 20:15:50.345 +03:00 [INF] === Incoming Request ===
2025-10-16 20:15:50.347 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:15:50.349 +03:00 [INF] Method: PUT
2025-10-16 20:15:50.350 +03:00 [INF] === Headers ===
2025-10-16 20:15:50.351 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:15:50.353 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:15:50.354 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:15:50.357 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:15:50.361 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:15:50.363 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:15:50.365 +03:00 [INF] Content-Length: ["902"]
2025-10-16 20:15:50.366 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:15:50.369 +03:00 [INF] Postman-Token: ["b8cc530d-7834-4e94-84ed-7f84a99c4b2f"]
2025-10-16 20:15:50.371 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:15:50.372 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:15:50.373 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:15:50.375 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:15:50.380 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:15:50.415 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 20:15:50.418 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 38.2626ms
2025-10-16 20:15:50.420 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:15:50.422 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 20:15:50.423 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 200 null application/json; charset=utf-8 85.1736ms
2025-10-16 20:17:04.303 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 906
2025-10-16 20:17:04.307 +03:00 [INF] Request started
2025-10-16 20:17:04.308 +03:00 [INF] === Incoming Request ===
2025-10-16 20:17:04.309 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:17:04.311 +03:00 [INF] Method: PUT
2025-10-16 20:17:04.312 +03:00 [INF] === Headers ===
2025-10-16 20:17:04.314 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:17:04.315 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:17:04.317 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:17:04.318 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:17:04.320 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:17:04.324 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:17:04.326 +03:00 [INF] Content-Length: ["906"]
2025-10-16 20:17:04.327 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:17:04.329 +03:00 [INF] Postman-Token: ["625f1b35-8b1e-44fe-bc2f-b7f56bfc8218"]
2025-10-16 20:17:04.330 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:17:04.331 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:17:04.334 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:17:04.335 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:17:04.340 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:17:04.386 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 20:17:04.392 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 52.9243ms
2025-10-16 20:17:04.396 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:17:04.398 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 20:17:04.399 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 200 null application/json; charset=utf-8 96.3094ms
2025-10-16 20:18:32.330 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:18:32.335 +03:00 [INF] Request started
2025-10-16 20:18:32.336 +03:00 [INF] === Incoming Request ===
2025-10-16 20:18:32.337 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:18:32.338 +03:00 [INF] Method: PUT
2025-10-16 20:18:32.340 +03:00 [INF] === Headers ===
2025-10-16 20:18:32.342 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:18:32.345 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:18:32.346 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:18:32.348 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:18:32.351 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:18:32.353 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:18:32.355 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:18:32.357 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:18:32.360 +03:00 [INF] Postman-Token: ["2e7e4e1a-c3a9-4c7f-b3e0-bddd2bc340db"]
2025-10-16 20:18:32.362 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:18:32.363 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:18:32.364 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:18:32.367 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:18:32.371 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:18:32.414 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 43.4018ms
2025-10-16 20:18:32.417 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:18:32.419 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_ProductTaxProfiles'. Cannot insert duplicate key in object 'dbo.ProductTaxProfiles'. The duplicate key value is (1455fbe8-d0b2-4615-b998-5b00ed509ab7, 2fcc534d-38e7-40f7-a2ea-08de0cc77d86).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4b5e7c53-952c-4af8-812b-91a49f5cf018
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.Shared.Repository.JoinTableRepository`1.SaveChangesAsync() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\JoinTableRepository.cs:line 176
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.UpdateProductCommandHandler.Handle(UpdateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\UpdateProductCommandHandler.cs:line 231
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct(Guid id, UpdateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 20:18:32.473 +03:00 [INF] Error response sent with status code 500
2025-10-16 20:18:32.477 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 500 null application/json; charset=utf-8 146.4175ms
2025-10-16 20:20:37.247 +03:00 [INF] Starting web host...
2025-10-16 20:20:38.251 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:20:38.311 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:20:38.383 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:20:38.389 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:20:38.406 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:20:38.462 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:20:38.477 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:20:38.481 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:20:38.488 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:20:38.498 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:20:38.505 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:20:38.670 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:20:38.677 +03:00 [INF] Master database initialized successfully
2025-10-16 20:20:40.112 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:20:40.213 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:20:40.215 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:20:40.307 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:20:40.309 +03:00 [INF] Hosting environment: Development
2025-10-16 20:20:40.310 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:20:40.633 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:20:40.752 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 120.4415ms
2025-10-16 20:20:40.814 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:20:40.814 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:20:40.822 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.55ms
2025-10-16 20:20:40.840 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.1098ms
2025-10-16 20:20:40.885 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:20:41.034 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 149.5266ms
2025-10-16 20:20:42.776 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:20:42.813 +03:00 [INF] Request started
2025-10-16 20:20:42.815 +03:00 [INF] === Incoming Request ===
2025-10-16 20:20:42.817 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:20:42.818 +03:00 [INF] Method: PUT
2025-10-16 20:20:42.819 +03:00 [INF] === Headers ===
2025-10-16 20:20:42.822 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:20:42.825 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:20:42.827 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:20:42.828 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:20:42.830 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:20:42.831 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:20:42.832 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:20:42.834 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:20:42.835 +03:00 [INF] Postman-Token: ["afc8ca82-3789-4168-80c0-1f10fc11d16a"]
2025-10-16 20:20:42.840 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:20:42.841 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:20:42.843 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:20:42.859 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:20:42.870 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:20:42.917 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:20:42.985 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 20:20:43.473 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:20:43.889 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 1023.4417ms
2025-10-16 20:20:43.892 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:20:43.894 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_ProductTaxProfiles'. Cannot insert duplicate key in object 'dbo.ProductTaxProfiles'. The duplicate key value is (1455fbe8-d0b2-4615-b998-5b00ed509ab7, 2fcc534d-38e7-40f7-a2ea-08de0cc77d86).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:26e57a61-c2c2-42c4-9a3e-90dd4eca3769
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.Shared.Repository.JoinTableRepository`1.SaveChangesAsync() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\JoinTableRepository.cs:line 176
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.UpdateProductCommandHandler.Handle(UpdateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\UpdateProductCommandHandler.cs:line 231
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct(Guid id, UpdateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 20:20:43.946 +03:00 [INF] Error response sent with status code 500
2025-10-16 20:20:43.952 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 500 null application/json; charset=utf-8 1176.3748ms
2025-10-16 20:21:00.620 +03:00 [INF] Starting web host...
2025-10-16 20:21:03.280 +03:00 [INF] Executed DbCommand (64ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:21:03.469 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:21:03.642 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:21:03.653 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:21:03.660 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:21:03.803 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:21:03.835 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:21:03.841 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:21:03.853 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:21:03.875 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:21:03.882 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:21:04.172 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:21:04.183 +03:00 [INF] Master database initialized successfully
2025-10-16 20:21:06.671 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:21:07.098 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:21:07.100 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:21:07.268 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:21:07.273 +03:00 [INF] Hosting environment: Development
2025-10-16 20:21:07.274 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:21:07.842 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:21:08.353 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 520.4064ms
2025-10-16 20:21:08.362 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:21:08.366 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:21:08.397 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 35.3626ms
2025-10-16 20:21:08.445 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 83.7739ms
2025-10-16 20:21:08.539 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:21:08.978 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 439.4146ms
2025-10-16 20:21:19.415 +03:00 [INF] Starting web host...
2025-10-16 20:21:21.660 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:21:21.726 +03:00 [INF] Executed DbCommand (46ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:21:21.803 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:21:21.809 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:21:21.823 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:21:21.888 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:21:21.904 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:21:21.909 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:21:21.915 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:21:21.928 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:21:21.933 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:21:22.181 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:21:22.191 +03:00 [INF] Master database initialized successfully
2025-10-16 20:21:23.974 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:21:24.219 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:21:24.221 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:21:24.308 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:21:24.310 +03:00 [INF] Hosting environment: Development
2025-10-16 20:21:24.312 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:21:24.895 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:21:25.098 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 208.5104ms
2025-10-16 20:21:25.100 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:21:25.100 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:21:25.122 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 22.4481ms
2025-10-16 20:21:25.148 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 48.61ms
2025-10-16 20:21:25.204 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:21:25.410 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 206.1419ms
2025-10-16 20:21:28.391 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:21:28.408 +03:00 [INF] Request started
2025-10-16 20:21:28.410 +03:00 [INF] === Incoming Request ===
2025-10-16 20:21:28.412 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:21:28.413 +03:00 [INF] Method: PUT
2025-10-16 20:21:28.414 +03:00 [INF] === Headers ===
2025-10-16 20:21:28.418 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:21:28.422 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:21:28.424 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:21:28.425 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:21:28.427 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:21:28.429 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:21:28.430 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:21:28.432 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:21:28.434 +03:00 [INF] Postman-Token: ["1518cfe3-0996-4dba-b396-f3c1f48be1fd"]
2025-10-16 20:21:28.440 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:21:28.441 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:21:28.443 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:21:28.471 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:21:28.477 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:21:28.541 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:21:28.631 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 20:21:29.330 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:21:41.360 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 12883.3438ms
2025-10-16 20:21:41.364 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:28:00.326 +03:00 [INF] Starting web host...
2025-10-16 20:28:02.973 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:28:03.115 +03:00 [INF] Executed DbCommand (105ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:28:03.300 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:28:03.314 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:28:03.321 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:28:03.477 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:28:03.540 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:28:03.545 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:28:03.557 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:28:03.577 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:28:03.582 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:28:03.863 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:28:03.871 +03:00 [INF] Master database initialized successfully
2025-10-16 20:28:05.638 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:28:05.908 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:28:05.910 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:28:06.017 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:28:06.020 +03:00 [INF] Hosting environment: Development
2025-10-16 20:28:06.021 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:28:06.691 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:28:07.083 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:28:07.085 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 406.7852ms
2025-10-16 20:28:07.086 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:28:07.106 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 23.5744ms
2025-10-16 20:28:07.215 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 128.7001ms
2025-10-16 20:28:07.265 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:28:07.654 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 388.9755ms
2025-10-16 20:28:14.636 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:28:14.650 +03:00 [INF] Request started
2025-10-16 20:28:14.653 +03:00 [INF] === Incoming Request ===
2025-10-16 20:28:14.657 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:28:14.658 +03:00 [INF] Method: PUT
2025-10-16 20:28:14.661 +03:00 [INF] === Headers ===
2025-10-16 20:28:14.665 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:28:14.671 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:28:14.673 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:28:14.676 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:28:14.678 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:28:14.680 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:28:14.681 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:28:14.684 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:28:14.685 +03:00 [INF] Postman-Token: ["54a73c9d-6508-4dc7-ac68-1d1d2638d5f6"]
2025-10-16 20:28:14.690 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:28:14.692 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:28:14.693 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:28:14.713 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:28:14.721 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:28:14.784 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:28:14.848 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 20:28:15.389 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:28:53.113 +03:00 [INF] Starting web host...
2025-10-16 20:28:55.700 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:28:55.779 +03:00 [INF] Executed DbCommand (47ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:28:55.871 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:28:55.878 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:28:55.883 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:28:55.974 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:28:55.994 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:28:56.000 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:28:56.009 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:28:56.021 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:28:56.025 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:28:56.224 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:28:56.231 +03:00 [INF] Master database initialized successfully
2025-10-16 20:28:58.324 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:28:58.620 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:28:58.622 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:28:58.709 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:28:58.711 +03:00 [INF] Hosting environment: Development
2025-10-16 20:28:58.712 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:28:59.160 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:28:59.471 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 321.5059ms
2025-10-16 20:28:59.472 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:28:59.474 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:28:59.499 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 24.6266ms
2025-10-16 20:28:59.520 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 48.1653ms
2025-10-16 20:28:59.566 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:28:59.900 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 333.8088ms
2025-10-16 20:29:02.631 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:29:02.648 +03:00 [INF] Request started
2025-10-16 20:29:02.651 +03:00 [INF] === Incoming Request ===
2025-10-16 20:29:02.654 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:29:02.655 +03:00 [INF] Method: PUT
2025-10-16 20:29:02.657 +03:00 [INF] === Headers ===
2025-10-16 20:29:02.661 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:29:02.665 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:29:02.667 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:29:02.669 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:29:02.671 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:29:02.673 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:29:02.674 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:29:02.677 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:29:02.678 +03:00 [INF] Postman-Token: ["3f16369b-65c6-4023-96a5-89d59bff3060"]
2025-10-16 20:29:02.685 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:29:02.687 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:29:02.689 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:29:02.718 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:29:02.726 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:29:02.828 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:29:02.928 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 20:29:03.681 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:32:49.189 +03:00 [INF] Starting web host...
2025-10-16 20:32:51.472 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:32:51.539 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:32:51.621 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:32:51.629 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:32:51.634 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:32:51.702 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:32:51.719 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:32:51.723 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:32:51.731 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:32:51.743 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:32:51.748 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:32:51.982 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:32:51.989 +03:00 [INF] Master database initialized successfully
2025-10-16 20:32:53.639 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:32:53.905 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:32:53.907 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:32:54.035 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:32:54.038 +03:00 [INF] Hosting environment: Development
2025-10-16 20:32:54.040 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:32:54.168 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:32:54.425 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 272.8111ms
2025-10-16 20:32:54.427 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:32:54.427 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:32:54.448 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 21.2456ms
2025-10-16 20:32:54.490 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 62.5358ms
2025-10-16 20:32:54.538 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:32:54.822 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 283.5465ms
2025-10-16 20:32:55.298 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:32:55.311 +03:00 [INF] Request started
2025-10-16 20:32:55.314 +03:00 [INF] === Incoming Request ===
2025-10-16 20:32:55.316 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:32:55.317 +03:00 [INF] Method: PUT
2025-10-16 20:32:55.318 +03:00 [INF] === Headers ===
2025-10-16 20:32:55.321 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:32:55.325 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:32:55.328 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:32:55.329 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:32:55.330 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:32:55.332 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:32:55.333 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:32:55.335 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:32:55.336 +03:00 [INF] Postman-Token: ["1e3ccbd3-8158-4004-b113-0dc3e4bf5e90"]
2025-10-16 20:32:55.341 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:32:55.342 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:32:55.345 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:32:55.364 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:32:55.372 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:32:55.427 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:32:55.490 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 20:32:56.019 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:37:49.410 +03:00 [INF] Starting web host...
2025-10-16 20:37:50.516 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:37:50.574 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:37:50.653 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:37:50.660 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:37:50.665 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:37:50.718 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:37:50.733 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:37:50.738 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:37:50.744 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:37:50.754 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:37:50.759 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:37:50.953 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:37:50.959 +03:00 [INF] Master database initialized successfully
2025-10-16 20:37:52.512 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:37:52.611 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:37:52.613 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:37:52.705 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:37:52.709 +03:00 [INF] Hosting environment: Development
2025-10-16 20:37:52.710 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:37:52.791 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:37:52.968 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 179.9923ms
2025-10-16 20:37:52.969 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:37:52.969 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:37:52.986 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 16.8979ms
2025-10-16 20:37:53.040 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 71.1081ms
2025-10-16 20:37:53.079 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:37:53.255 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 175.6686ms
2025-10-16 20:37:56.430 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:37:56.447 +03:00 [INF] Request started
2025-10-16 20:37:56.450 +03:00 [INF] === Incoming Request ===
2025-10-16 20:37:56.452 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:37:56.453 +03:00 [INF] Method: PUT
2025-10-16 20:37:56.454 +03:00 [INF] === Headers ===
2025-10-16 20:37:56.456 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:37:56.459 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:37:56.461 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:37:56.463 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:37:56.465 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:37:56.466 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:37:56.468 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:37:56.469 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:37:56.471 +03:00 [INF] Postman-Token: ["7080a973-3291-419f-84d1-8496540d3eac"]
2025-10-16 20:37:56.476 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:37:56.478 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:37:56.479 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:37:56.494 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:37:56.500 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:37:56.538 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:37:56.596 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 20:37:57.091 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:37:57.564 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 1062.9935ms
2025-10-16 20:37:57.567 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:37:57.572 +03:00 [ERR] Unexpected error occurred
System.InvalidOperationException: The instance of entity type 'ProductTaxProfile' cannot be tracked because another instance with the same key value for {'ProductId', 'TaxProfileId'} is already being tracked. When attaching existing entities, ensure that only one entity instance with a given key value is attached. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the conflicting key values.
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.ThrowIdentityConflict(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry, Boolean updateDuplicate)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NullableKeyIdentityMap`1.Add(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.StartTracking(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState oldState, EntityState newState, Boolean acceptChanges, Boolean modifyProperties)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityStateAsync(EntityState entityState, Boolean acceptChanges, Boolean modifyProperties, Nullable`1 forceStateWhenUnknownKey, Nullable`1 fallbackState, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.PaintActionAsync(EntityEntryGraphNode`1 node, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraphAsync[TState](EntityEntryGraphNode`1 node, Func`3 handleNode, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.AttachGraphAsync(InternalEntityEntry rootEntry, EntityState targetState, EntityState storeGeneratedWithKeySetTargetState, Boolean forceStateWhenUnknownKey, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.AddRangeAsync(IEnumerable`1 entities, CancellationToken cancellationToken)
   at ModularERP.Shared.Repository.JoinTableRepository`1.AddRangeAsync(IEnumerable`1 entities) in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\JoinTableRepository.cs:line 80
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.UpdateProductCommandHandler.Handle(UpdateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\UpdateProductCommandHandler.cs:line 230
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct(Guid id, UpdateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 20:37:57.620 +03:00 [INF] Error response sent with status code 500
2025-10-16 20:37:57.627 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 500 null application/json; charset=utf-8 1196.5882ms
2025-10-16 20:38:49.035 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - application/json 974
2025-10-16 20:38:49.046 +03:00 [INF] Request started
2025-10-16 20:38:49.048 +03:00 [INF] === Incoming Request ===
2025-10-16 20:38:49.049 +03:00 [INF] Path: /api/Products/%7B1455fbe8-d0b2-4615-b998-5b00ed509ab7%7D
2025-10-16 20:38:49.050 +03:00 [INF] Method: PUT
2025-10-16 20:38:49.051 +03:00 [INF] === Headers ===
2025-10-16 20:38:49.052 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:38:49.053 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:38:49.055 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:38:49.057 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:38:49.059 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:38:49.061 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:38:49.063 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:38:49.064 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:38:49.066 +03:00 [INF] Postman-Token: ["320fa1d2-1f96-40ec-b8f7-66cc1f053c77"]
2025-10-16 20:38:49.070 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:38:49.073 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:38:49.074 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:38:49.076 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:38:49.081 +03:00 [INF] Updating product "1455fbe8-d0b2-4615-b998-5b00ed509ab7" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:38:49.135 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 56.0652ms
2025-10-16 20:38:49.138 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:38:49.140 +03:00 [ERR] Unexpected error occurred
System.InvalidOperationException: The instance of entity type 'ProductTaxProfile' cannot be tracked because another instance with the same key value for {'ProductId', 'TaxProfileId'} is already being tracked. When attaching existing entities, ensure that only one entity instance with a given key value is attached. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the conflicting key values.
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.ThrowIdentityConflict(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry, Boolean updateDuplicate)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NullableKeyIdentityMap`1.Add(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.StartTracking(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState oldState, EntityState newState, Boolean acceptChanges, Boolean modifyProperties)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityStateAsync(EntityState entityState, Boolean acceptChanges, Boolean modifyProperties, Nullable`1 forceStateWhenUnknownKey, Nullable`1 fallbackState, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.PaintActionAsync(EntityEntryGraphNode`1 node, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraphAsync[TState](EntityEntryGraphNode`1 node, Func`3 handleNode, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.AttachGraphAsync(InternalEntityEntry rootEntry, EntityState targetState, EntityState storeGeneratedWithKeySetTargetState, Boolean forceStateWhenUnknownKey, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.AddRangeAsync(IEnumerable`1 entities, CancellationToken cancellationToken)
   at ModularERP.Shared.Repository.JoinTableRepository`1.AddRangeAsync(IEnumerable`1 entities) in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\JoinTableRepository.cs:line 80
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.UpdateProductCommandHandler.Handle(UpdateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\UpdateProductCommandHandler.cs:line 230
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct(Guid id, UpdateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 20:38:49.160 +03:00 [INF] Error response sent with status code 500
2025-10-16 20:38:49.162 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{1455fbe8-d0b2-4615-b998-5b00ed509ab7} - 500 null application/json; charset=utf-8 127.2355ms
2025-10-16 20:41:02.028 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{379e5c26-417b-4c1f-83e1-d44cd995b078} - application/json 974
2025-10-16 20:41:02.035 +03:00 [INF] Request started
2025-10-16 20:41:02.036 +03:00 [INF] === Incoming Request ===
2025-10-16 20:41:02.037 +03:00 [INF] Path: /api/Products/%7B379e5c26-417b-4c1f-83e1-d44cd995b078%7D
2025-10-16 20:41:02.038 +03:00 [INF] Method: PUT
2025-10-16 20:41:02.039 +03:00 [INF] === Headers ===
2025-10-16 20:41:02.040 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:41:02.041 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:41:02.043 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:41:02.045 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:41:02.046 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:41:02.048 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:41:02.049 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:41:02.050 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:41:02.052 +03:00 [INF] Postman-Token: ["ff4fbe7c-0656-4eb4-934c-74c38bc6aac4"]
2025-10-16 20:41:02.053 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:41:02.054 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:41:02.055 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:41:02.057 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:41:02.060 +03:00 [INF] Updating product "379e5c26-417b-4c1f-83e1-d44cd995b078" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:41:02.100 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 39.8856ms
2025-10-16 20:41:02.102 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:41:02.103 +03:00 [ERR] Unexpected error occurred
System.InvalidOperationException: The instance of entity type 'ProductTaxProfile' cannot be tracked because another instance with the same key value for {'ProductId', 'TaxProfileId'} is already being tracked. When attaching existing entities, ensure that only one entity instance with a given key value is attached. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see the conflicting key values.
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.ThrowIdentityConflict(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry, Boolean updateDuplicate)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.IdentityMap`1.Add(TKey key, InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.NullableKeyIdentityMap`1.Add(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.StartTracking(InternalEntityEntry entry)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityState(EntityState oldState, EntityState newState, Boolean acceptChanges, Boolean modifyProperties)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.InternalEntityEntry.SetEntityStateAsync(EntityState entityState, Boolean acceptChanges, Boolean modifyProperties, Nullable`1 forceStateWhenUnknownKey, Nullable`1 fallbackState, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.PaintActionAsync(EntityEntryGraphNode`1 node, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityEntryGraphIterator.TraverseGraphAsync[TState](EntityEntryGraphNode`1 node, Func`3 handleNode, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.EntityGraphAttacher.AttachGraphAsync(InternalEntityEntry rootEntry, EntityState targetState, EntityState storeGeneratedWithKeySetTargetState, Boolean forceStateWhenUnknownKey, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Internal.InternalDbSet`1.AddRangeAsync(IEnumerable`1 entities, CancellationToken cancellationToken)
   at ModularERP.Shared.Repository.JoinTableRepository`1.AddRangeAsync(IEnumerable`1 entities) in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\JoinTableRepository.cs:line 80
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.UpdateProductCommandHandler.Handle(UpdateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\UpdateProductCommandHandler.cs:line 230
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct(Guid id, UpdateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 20:41:02.120 +03:00 [INF] Error response sent with status code 500
2025-10-16 20:41:02.121 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{379e5c26-417b-4c1f-83e1-d44cd995b078} - 500 null application/json; charset=utf-8 93.2726ms
2025-10-16 20:51:50.823 +03:00 [INF] Starting web host...
2025-10-16 20:51:52.041 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:51:52.097 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:51:52.169 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:51:52.175 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:51:52.190 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:51:52.251 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:51:52.268 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:51:52.273 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:51:52.281 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:51:52.294 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:51:52.300 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:51:52.508 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:51:52.516 +03:00 [INF] Master database initialized successfully
2025-10-16 20:51:54.529 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:51:54.644 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:51:54.646 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:51:54.703 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:51:54.740 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:51:54.741 +03:00 [INF] Hosting environment: Development
2025-10-16 20:51:54.743 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:51:54.869 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 167.4434ms
2025-10-16 20:51:54.874 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:51:54.874 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:51:54.887 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.4119ms
2025-10-16 20:51:54.915 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 40.7444ms
2025-10-16 20:51:55.141 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:51:55.350 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 208.6669ms
2025-10-16 20:51:57.281 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{379e5c26-417b-4c1f-83e1-d44cd995b078} - application/json 974
2025-10-16 20:51:57.303 +03:00 [INF] Request started
2025-10-16 20:51:57.305 +03:00 [INF] === Incoming Request ===
2025-10-16 20:51:57.307 +03:00 [INF] Path: /api/Products/%7B379e5c26-417b-4c1f-83e1-d44cd995b078%7D
2025-10-16 20:51:57.309 +03:00 [INF] Method: PUT
2025-10-16 20:51:57.310 +03:00 [INF] === Headers ===
2025-10-16 20:51:57.314 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:51:57.318 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:51:57.319 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:51:57.321 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:51:57.324 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:51:57.326 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:51:57.328 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:51:57.330 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:51:57.333 +03:00 [INF] Postman-Token: ["35b38d6f-2541-43c1-a9d6-2a7a97ea7681"]
2025-10-16 20:51:57.338 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:51:57.340 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:51:57.342 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:51:57.365 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:51:57.371 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:51:57.415 +03:00 [INF] Updating product "379e5c26-417b-4c1f-83e1-d44cd995b078" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:51:57.492 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 20:51:58.135 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:51:58.705 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 1334.443ms
2025-10-16 20:51:58.708 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:51:58.711 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Violation of PRIMARY KEY constraint 'PK_ProductTaxProfiles'. Cannot insert duplicate key in object 'dbo.ProductTaxProfiles'. The duplicate key value is (379e5c26-417b-4c1f-83e1-d44cd995b078, 2fcc534d-38e7-40f7-a2ea-08de0cc77d86).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:7057e3f6-d13c-4571-aeaf-e14ff5949c11
Error Number:2627,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 1934
   at ModularERP.Shared.Repository.JoinTableRepository`1.SaveChangesAsync() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\JoinTableRepository.cs:line 208
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.UpdateProductCommandHandler.Handle(UpdateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\UpdateProductCommandHandler.cs:line 231
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct(Guid id, UpdateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 349
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 302
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-16 20:51:58.811 +03:00 [INF] Error response sent with status code 500
2025-10-16 20:51:58.821 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{379e5c26-417b-4c1f-83e1-d44cd995b078} - 500 null application/json; charset=utf-8 1539.7703ms
2025-10-16 20:57:25.959 +03:00 [INF] Starting web host...
2025-10-16 20:57:27.107 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:57:27.153 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-16 20:57:27.222 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:57:27.228 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-16 20:57:27.232 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-16 20:57:27.291 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-16 20:57:27.306 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-16 20:57:27.310 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-16 20:57:27.317 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-16 20:57:27.329 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-16 20:57:27.334 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-16 20:57:27.526 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-16 20:57:27.535 +03:00 [INF] Master database initialized successfully
2025-10-16 20:57:29.413 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-16 20:57:29.517 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-16 20:57:29.520 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-16 20:57:29.596 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-16 20:57:29.597 +03:00 [INF] Hosting environment: Development
2025-10-16 20:57:29.598 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-16 20:57:30.035 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-16 20:57:30.176 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 142.0791ms
2025-10-16 20:57:30.320 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-16 20:57:30.320 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-16 20:57:30.326 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.8341ms
2025-10-16 20:57:30.347 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 26.688ms
2025-10-16 20:57:30.381 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-16 20:57:30.637 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 256.297ms
2025-10-16 20:57:53.431 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{379e5c26-417b-4c1f-83e1-d44cd995b078} - application/json 974
2025-10-16 20:57:53.451 +03:00 [INF] Request started
2025-10-16 20:57:53.454 +03:00 [INF] === Incoming Request ===
2025-10-16 20:57:53.456 +03:00 [INF] Path: /api/Products/%7B379e5c26-417b-4c1f-83e1-d44cd995b078%7D
2025-10-16 20:57:53.457 +03:00 [INF] Method: PUT
2025-10-16 20:57:53.458 +03:00 [INF] === Headers ===
2025-10-16 20:57:53.461 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:57:53.464 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:57:53.467 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:57:53.468 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:57:53.470 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:57:53.471 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:57:53.472 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:57:53.474 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:57:53.476 +03:00 [INF] Postman-Token: ["3cd8b40e-1437-4d2e-9916-1c6ce42ffab4"]
2025-10-16 20:57:53.481 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:57:53.483 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:57:53.484 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:57:53.505 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:57:53.511 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:57:53.560 +03:00 [INF] Updating product "379e5c26-417b-4c1f-83e1-d44cd995b078" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:57:53.629 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-16 20:57:54.203 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-16 20:57:54.904 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 20:57:54.930 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 1419.8826ms
2025-10-16 20:57:54.933 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:57:54.935 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 20:57:54.940 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{379e5c26-417b-4c1f-83e1-d44cd995b078} - 200 null application/json; charset=utf-8 1509.831ms
2025-10-16 20:58:27.473 +03:00 [INF] Request starting HTTP/1.1 PUT https://localhost:7168/api/Products/{379e5c26-417b-4c1f-83e1-d44cd995b078} - application/json 974
2025-10-16 20:58:27.482 +03:00 [INF] Request started
2025-10-16 20:58:27.484 +03:00 [INF] === Incoming Request ===
2025-10-16 20:58:27.486 +03:00 [INF] Path: /api/Products/%7B379e5c26-417b-4c1f-83e1-d44cd995b078%7D
2025-10-16 20:58:27.487 +03:00 [INF] Method: PUT
2025-10-16 20:58:27.488 +03:00 [INF] === Headers ===
2025-10-16 20:58:27.489 +03:00 [INF] Accept: ["*/*"]
2025-10-16 20:58:27.490 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 20:58:27.492 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 20:58:27.493 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 20:58:27.495 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 20:58:27.496 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 20:58:27.497 +03:00 [INF] Content-Length: ["974"]
2025-10-16 20:58:27.500 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 20:58:27.502 +03:00 [INF] Postman-Token: ["b8a5b881-dd57-43ab-b2e4-8735dfe08627"]
2025-10-16 20:58:27.505 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 20:58:27.506 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 20:58:27.507 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:58:27.508 +03:00 [INF] Route matched with {action = "UpdateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateProduct(System.Guid, ModularERP.Modules.Inventory.Features.Products.DTO.DTO_Product.UpdateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-10-16 20:58:27.511 +03:00 [INF] Updating product "379e5c26-417b-4c1f-83e1-d44cd995b078" for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-10-16 20:58:27.749 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 20:58:27.753 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP) in 242.2162ms
2025-10-16 20:58:27.757 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.UpdateProduct (ModularERP)'
2025-10-16 20:58:27.759 +03:00 [INF] Request completed successfully with status code 200
2025-10-16 20:58:27.762 +03:00 [INF] Request finished HTTP/1.1 PUT https://localhost:7168/api/Products/{379e5c26-417b-4c1f-83e1-d44cd995b078} - 200 null application/json; charset=utf-8 288.5642ms
2025-10-16 21:15:32.735 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/StockTransactions - application/json 236
2025-10-16 21:15:32.740 +03:00 [INF] Request started
2025-10-16 21:15:32.741 +03:00 [INF] === Incoming Request ===
2025-10-16 21:15:32.742 +03:00 [INF] Path: /api/StockTransactions
2025-10-16 21:15:32.743 +03:00 [INF] Method: POST
2025-10-16 21:15:32.744 +03:00 [INF] === Headers ===
2025-10-16 21:15:32.745 +03:00 [INF] Accept: ["*/*"]
2025-10-16 21:15:32.746 +03:00 [INF] Connection: ["keep-alive"]
2025-10-16 21:15:32.748 +03:00 [INF] Host: ["localhost:7168"]
2025-10-16 21:15:32.750 +03:00 [INF] User-Agent: ["PostmanRuntime/7.48.0"]
2025-10-16 21:15:32.752 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-16 21:15:32.753 +03:00 [INF] Content-Type: ["application/json"]
2025-10-16 21:15:32.755 +03:00 [INF] Content-Length: ["236"]
2025-10-16 21:15:32.756 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-16 21:15:32.758 +03:00 [INF] Postman-Token: ["b9750f32-e95a-481b-bd3c-b49fd83b6549"]
2025-10-16 21:15:32.759 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-16 21:15:32.760 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-16 21:15:32.761 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 21:15:32.766 +03:00 [INF] Route matched with {action = "Create", controller = "StockTransactions"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto]]] Create(ModularERP.Modules.Inventory.Features.StockTransactions.DTO.CreateStockTransactionDto) on controller ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController (ModularERP).
2025-10-16 21:15:32.975 +03:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.StockTransactions.DTO.StockTransactionDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-16 21:15:32.994 +03:00 [INF] Executed action ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP) in 224.2247ms
2025-10-16 21:15:32.997 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.StockTransactions.Controllers.StockTransactionsController.Create (ModularERP)'
2025-10-16 21:15:32.999 +03:00 [INF] Request completed successfully with status code 201
2025-10-16 21:15:33.000 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/StockTransactions - 201 null application/json; charset=utf-8 264.5925ms
