2025-10-27 00:31:48.530 +03:00 [INF] Starting web host...
2025-10-27 00:31:52.613 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 00:31:52.774 +03:00 [INF] Executed DbCommand (146ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-27 00:31:52.864 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 00:31:52.870 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-27 00:31:52.900 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-27 00:31:52.961 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-27 00:31:52.976 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 00:31:52.985 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-27 00:31:53.000 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-27 00:31:53.011 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-27 00:31:53.027 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-27 00:31:53.206 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-27 00:31:53.213 +03:00 [INF] Master database initialized successfully
2025-10-27 00:31:55.853 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-27 00:31:56.114 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-27 00:31:56.115 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-27 00:31:56.201 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-27 00:31:56.203 +03:00 [INF] Hosting environment: Development
2025-10-27 00:31:56.204 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-27 00:31:56.953 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-27 00:31:57.180 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 230.5045ms
2025-10-27 00:31:57.192 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-27 00:31:57.199 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 6.6676ms
2025-10-27 00:31:57.203 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-27 00:31:57.263 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 60.0389ms
2025-10-27 00:31:57.311 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-27 00:31:57.676 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 364.1862ms
2025-10-27 15:50:13.898 +03:00 [INF] Starting web host...
2025-10-27 15:50:18.381 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 15:50:18.460 +03:00 [INF] Executed DbCommand (64ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-27 15:50:18.543 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 15:50:18.549 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-27 15:50:18.560 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-27 15:50:18.643 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-27 15:50:18.661 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 15:50:18.665 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-27 15:50:18.672 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-27 15:50:18.682 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-27 15:50:18.688 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-27 15:50:18.913 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-27 15:50:18.924 +03:00 [INF] Master database initialized successfully
2025-10-27 15:50:20.975 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-27 15:50:21.169 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-27 15:50:21.171 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-27 15:50:21.280 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-27 15:50:21.282 +03:00 [INF] Hosting environment: Development
2025-10-27 15:50:21.283 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-27 15:50:21.565 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-27 15:50:21.743 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 179.3679ms
2025-10-27 15:50:21.748 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-27 15:50:21.751 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-27 15:50:21.758 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.5429ms
2025-10-27 15:50:21.804 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 52.7494ms
2025-10-27 15:50:21.941 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-27 15:50:22.189 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 248.0516ms
2025-10-27 17:58:51.863 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf&SupplierId=b4c57f6f-47c9-43d1-8021-0ff57a3b4e79&CurrencyCode=EGP&PoDate=2025-10-27T12:51:56.603Z&PaymentTerms=string&Notes=string&Terms=string&LineItems=[{%22ProductId%22:%221455fbe8-d0b2-4615-b998-5b00ed509ab7%22,%22Description%22:%22string%22,%22Quantity%22:1%22UnitPrice%22:20,%22DiscountPercent%22:10,%22TaxProfileId%22:%222fcc534d-38e7-40f7-a2ea-08de0cc77d86%22}]&Deposits=[{%22Amount%22:0,%22Percentage%22:0,%22PaymentMethod%22:%22string%22,%22ReferenceNumber%22:%22string%22,%22AlreadyPaid%22:true,%22PaymentDate%22:%222025-10-27T12:51:56.603Z%22,%22Notes%22:%22string%22}]&ShippingCharges=[{%22ShippingFee%22:0,%22TaxProfileId%22:%222fcc534d-38e7-40f7-a2ea-08de0cc77d86%22,%22Description%22:%22string%22}]&Discounts=[{%22DiscountType%22:%22string%22,%22DiscountValue%22:0,%22Description%22:%22string%22}]&Adjustments=[{%22AdjustmentType%22:%22string%22,%22Amount%22:0,%22Notes%22:%22string%22}]&PoNotes=[%22string%22] - null 0
2025-10-27 17:58:51.890 +03:00 [INF] Request started
2025-10-27 17:58:51.892 +03:00 [INF] === Incoming Request ===
2025-10-27 17:58:51.893 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 17:58:51.895 +03:00 [INF] Method: POST
2025-10-27 17:58:51.895 +03:00 [INF] === Headers ===
2025-10-27 17:58:51.898 +03:00 [INF] Accept: ["*/*"]
2025-10-27 17:58:51.901 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 17:58:51.903 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 17:58:51.904 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 17:58:51.905 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 17:58:51.907 +03:00 [INF] Content-Length: ["0"]
2025-10-27 17:58:51.908 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 17:58:51.909 +03:00 [INF] Postman-Token: ["972a61b6-42a3-448a-8750-32fa7c77db42"]
2025-10-27 17:58:51.919 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 17:58:51.920 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 17:58:51.922 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 17:58:51.951 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 17:58:51.956 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 17:58:52.083 +03:00 [WRN] Validation failed for CreatePurchaseOrderCommand. Errors: [{"PropertyName":"CompanyId","ErrorMessage":"Company is required"},{"PropertyName":"SupplierId","ErrorMessage":"Supplier is required"},{"PropertyName":"LineItems","ErrorMessage":"At least one line item is required"},{"PropertyName":"LineItems","ErrorMessage":"Purchase order must contain at least one line item"}]
2025-10-27 17:58:52.104 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 147.8715ms
2025-10-27 17:58:52.106 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 17:58:52.113 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"CompanyId":["Company is required"],"SupplierId":["Supplier is required"],"LineItems":["At least one line item is required","Purchase order must contain at least one line item"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 44
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 17:58:52.195 +03:00 [INF] Error response sent with status code 400
2025-10-27 17:58:52.198 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf&SupplierId=b4c57f6f-47c9-43d1-8021-0ff57a3b4e79&CurrencyCode=EGP&PoDate=2025-10-27T12:51:56.603Z&PaymentTerms=string&Notes=string&Terms=string&LineItems=[{%22ProductId%22:%221455fbe8-d0b2-4615-b998-5b00ed509ab7%22,%22Description%22:%22string%22,%22Quantity%22:1%22UnitPrice%22:20,%22DiscountPercent%22:10,%22TaxProfileId%22:%222fcc534d-38e7-40f7-a2ea-08de0cc77d86%22}]&Deposits=[{%22Amount%22:0,%22Percentage%22:0,%22PaymentMethod%22:%22string%22,%22ReferenceNumber%22:%22string%22,%22AlreadyPaid%22:true,%22PaymentDate%22:%222025-10-27T12:51:56.603Z%22,%22Notes%22:%22string%22}]&ShippingCharges=[{%22ShippingFee%22:0,%22TaxProfileId%22:%222fcc534d-38e7-40f7-a2ea-08de0cc77d86%22,%22Description%22:%22string%22}]&Discounts=[{%22DiscountType%22:%22string%22,%22DiscountValue%22:0,%22Description%22:%22string%22}]&Adjustments=[{%22AdjustmentType%22:%22string%22,%22Amount%22:0,%22Notes%22:%22string%22}]&PoNotes=[%22string%22] - 400 null application/json; charset=utf-8 335.3619ms
2025-10-27 17:59:21.959 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf&SupplierId=b4c57f6f-47c9-43d1-8021-0ff57a3b4e79&CurrencyCode=EGP&PoDate=2025-10-27T12:51:56.603Z&PaymentTerms=string&Notes=string&Terms=string&LineItems=[{%22ProductId%22:%221455fbe8-d0b2-4615-b998-5b00ed509ab7%22,%22Description%22:%22string%22,%22Quantity%22:1%22UnitPrice%22:20,%22DiscountPercent%22:10,%22TaxProfileId%22:%222fcc534d-38e7-40f7-a2ea-08de0cc77d86%22}]&Deposits=[{%22Amount%22:0,%22Percentage%22:0,%22PaymentMethod%22:%22string%22,%22ReferenceNumber%22:%22string%22,%22AlreadyPaid%22:true,%22PaymentDate%22:%222025-10-27T12:51:56.603Z%22,%22Notes%22:%22string%22}]&ShippingCharges=[{%22ShippingFee%22:0,%22TaxProfileId%22:%222fcc534d-38e7-40f7-a2ea-08de0cc77d86%22,%22Description%22:%22string%22}]&Discounts=[{%22DiscountType%22:%22string%22,%22DiscountValue%22:0,%22Description%22:%22string%22}]&Adjustments=[{%22AdjustmentType%22:%22string%22,%22Amount%22:0,%22Notes%22:%22string%22}]&PoNotes=[%22string%22] - null 0
2025-10-27 17:59:21.969 +03:00 [INF] Request started
2025-10-27 17:59:21.971 +03:00 [INF] === Incoming Request ===
2025-10-27 17:59:21.972 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 17:59:21.973 +03:00 [INF] Method: POST
2025-10-27 17:59:21.975 +03:00 [INF] === Headers ===
2025-10-27 17:59:21.976 +03:00 [INF] Accept: ["*/*"]
2025-10-27 17:59:21.977 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 17:59:21.979 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 17:59:21.980 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 17:59:21.981 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 17:59:21.983 +03:00 [INF] Content-Length: ["0"]
2025-10-27 17:59:21.984 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 17:59:21.986 +03:00 [INF] Postman-Token: ["2ca929dd-3a34-44ff-bf3e-1362496f07f5"]
2025-10-27 17:59:21.989 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 17:59:21.991 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 17:59:21.992 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 17:59:21.993 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 17:59:21.997 +03:00 [WRN] Validation failed for CreatePurchaseOrderCommand. Errors: [{"PropertyName":"CompanyId","ErrorMessage":"Company is required"},{"PropertyName":"SupplierId","ErrorMessage":"Supplier is required"},{"PropertyName":"LineItems","ErrorMessage":"At least one line item is required"},{"PropertyName":"LineItems","ErrorMessage":"Purchase order must contain at least one line item"}]
2025-10-27 17:59:22.006 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 10.7481ms
2025-10-27 17:59:22.008 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 17:59:22.009 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"CompanyId":["Company is required"],"SupplierId":["Supplier is required"],"LineItems":["At least one line item is required","Purchase order must contain at least one line item"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 44
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 17:59:22.022 +03:00 [INF] Error response sent with status code 400
2025-10-27 17:59:22.023 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder?CompanyId=90137c92-382d-404c-bade-e5fefb1e8dbf&SupplierId=b4c57f6f-47c9-43d1-8021-0ff57a3b4e79&CurrencyCode=EGP&PoDate=2025-10-27T12:51:56.603Z&PaymentTerms=string&Notes=string&Terms=string&LineItems=[{%22ProductId%22:%221455fbe8-d0b2-4615-b998-5b00ed509ab7%22,%22Description%22:%22string%22,%22Quantity%22:1%22UnitPrice%22:20,%22DiscountPercent%22:10,%22TaxProfileId%22:%222fcc534d-38e7-40f7-a2ea-08de0cc77d86%22}]&Deposits=[{%22Amount%22:0,%22Percentage%22:0,%22PaymentMethod%22:%22string%22,%22ReferenceNumber%22:%22string%22,%22AlreadyPaid%22:true,%22PaymentDate%22:%222025-10-27T12:51:56.603Z%22,%22Notes%22:%22string%22}]&ShippingCharges=[{%22ShippingFee%22:0,%22TaxProfileId%22:%222fcc534d-38e7-40f7-a2ea-08de0cc77d86%22,%22Description%22:%22string%22}]&Discounts=[{%22DiscountType%22:%22string%22,%22DiscountValue%22:0,%22Description%22:%22string%22}]&Adjustments=[{%22AdjustmentType%22:%22string%22,%22Amount%22:0,%22Notes%22:%22string%22}]&PoNotes=[%22string%22] - 400 null application/json; charset=utf-8 64.6927ms
2025-10-27 18:02:03.202 +03:00 [INF] Starting web host...
2025-10-27 18:02:06.904 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 18:02:06.947 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-27 18:02:07.013 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 18:02:07.019 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-27 18:02:07.023 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-27 18:02:07.084 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-27 18:02:07.098 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 18:02:07.102 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-27 18:02:07.108 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-27 18:02:07.118 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-27 18:02:07.122 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-27 18:02:07.269 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-27 18:02:07.276 +03:00 [INF] Master database initialized successfully
2025-10-27 18:02:09.334 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-27 18:02:09.492 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-27 18:02:09.494 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-27 18:02:09.599 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-27 18:02:09.601 +03:00 [INF] Hosting environment: Development
2025-10-27 18:02:09.603 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-27 18:02:09.650 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-27 18:02:09.852 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 203.1067ms
2025-10-27 18:02:09.857 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-27 18:02:09.859 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-27 18:02:09.868 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 10.4845ms
2025-10-27 18:02:09.895 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 35.5634ms
2025-10-27 18:02:10.048 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-27 18:02:10.391 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 343.6576ms
2025-10-27 18:04:52.416 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------944635674085042403751076 3784056
2025-10-27 18:04:52.437 +03:00 [INF] Request started
2025-10-27 18:04:52.440 +03:00 [INF] === Incoming Request ===
2025-10-27 18:04:52.442 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 18:04:52.443 +03:00 [INF] Method: POST
2025-10-27 18:04:52.444 +03:00 [INF] === Headers ===
2025-10-27 18:04:52.447 +03:00 [INF] Accept: ["*/*"]
2025-10-27 18:04:52.450 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 18:04:52.452 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 18:04:52.453 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 18:04:52.454 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 18:04:52.456 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------944635674085042403751076"]
2025-10-27 18:04:52.457 +03:00 [INF] Content-Length: ["3784056"]
2025-10-27 18:04:52.460 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 18:04:52.461 +03:00 [INF] Postman-Token: ["8c2f700d-ae99-4cd5-b3b4-b62748fad499"]
2025-10-27 18:04:52.466 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 18:04:52.467 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 18:04:52.469 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:04:52.489 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 18:04:52.494 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 18:04:52.631 +03:00 [WRN] Validation failed for CreatePurchaseOrderCommand. Errors: [{"PropertyName":"LineItems","ErrorMessage":"At least one line item is required"},{"PropertyName":"LineItems","ErrorMessage":"Purchase order must contain at least one line item"}]
2025-10-27 18:04:52.643 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 148.3305ms
2025-10-27 18:04:52.645 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:04:52.648 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"LineItems":["At least one line item is required","Purchase order must contain at least one line item"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 44
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 18:04:52.681 +03:00 [INF] Error response sent with status code 400
2025-10-27 18:04:52.693 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 400 null application/json; charset=utf-8 276.7255ms
2025-10-27 18:08:17.016 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------491862223255345563698027 3784057
2025-10-27 18:08:17.035 +03:00 [INF] Request started
2025-10-27 18:08:17.037 +03:00 [INF] === Incoming Request ===
2025-10-27 18:08:17.039 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 18:08:17.041 +03:00 [INF] Method: POST
2025-10-27 18:08:17.043 +03:00 [INF] === Headers ===
2025-10-27 18:08:17.044 +03:00 [INF] Accept: ["*/*"]
2025-10-27 18:08:17.046 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 18:08:17.049 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 18:08:17.050 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 18:08:17.052 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 18:08:17.053 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------491862223255345563698027"]
2025-10-27 18:08:17.055 +03:00 [INF] Content-Length: ["3784057"]
2025-10-27 18:08:17.056 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 18:08:17.059 +03:00 [INF] Postman-Token: ["d1a10e33-ec06-49b4-adb5-e77a633a635d"]
2025-10-27 18:08:17.064 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 18:08:17.065 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 18:08:17.067 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:08:17.069 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 18:08:17.099 +03:00 [WRN] Validation failed for CreatePurchaseOrderCommand. Errors: [{"PropertyName":"LineItems","ErrorMessage":"At least one line item is required"},{"PropertyName":"LineItems","ErrorMessage":"Purchase order must contain at least one line item"}]
2025-10-27 18:08:17.105 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 33.8225ms
2025-10-27 18:08:17.107 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:08:17.110 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"LineItems":["At least one line item is required","Purchase order must contain at least one line item"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 44
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 18:08:17.130 +03:00 [INF] Error response sent with status code 400
2025-10-27 18:08:17.133 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 400 null application/json; charset=utf-8 116.2759ms
2025-10-27 18:11:08.605 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------092392055952651458063131 3784057
2025-10-27 18:11:08.619 +03:00 [INF] Request started
2025-10-27 18:11:08.621 +03:00 [INF] === Incoming Request ===
2025-10-27 18:11:08.623 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 18:11:08.624 +03:00 [INF] Method: POST
2025-10-27 18:11:08.625 +03:00 [INF] === Headers ===
2025-10-27 18:11:08.626 +03:00 [INF] Accept: ["*/*"]
2025-10-27 18:11:08.627 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 18:11:08.628 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 18:11:08.630 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 18:11:08.631 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 18:11:08.632 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------092392055952651458063131"]
2025-10-27 18:11:08.634 +03:00 [INF] Content-Length: ["3784057"]
2025-10-27 18:11:08.636 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 18:11:08.637 +03:00 [INF] Postman-Token: ["fe1059f8-2131-4e4b-a549-e245b7133910"]
2025-10-27 18:11:08.640 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 18:11:08.641 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 18:11:08.642 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:11:08.643 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 18:11:08.670 +03:00 [WRN] Validation failed for CreatePurchaseOrderCommand. Errors: [{"PropertyName":"LineItems","ErrorMessage":"At least one line item is required"},{"PropertyName":"LineItems","ErrorMessage":"Purchase order must contain at least one line item"}]
2025-10-27 18:11:08.676 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 30.1553ms
2025-10-27 18:11:08.677 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:11:08.679 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"LineItems":["At least one line item is required","Purchase order must contain at least one line item"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 44
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 18:11:08.690 +03:00 [INF] Error response sent with status code 400
2025-10-27 18:11:08.691 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 400 null application/json; charset=utf-8 86.3683ms
2025-10-27 18:12:13.041 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------463450728594883015365595 3781966
2025-10-27 18:12:13.047 +03:00 [INF] Request started
2025-10-27 18:12:13.048 +03:00 [INF] === Incoming Request ===
2025-10-27 18:12:13.049 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 18:12:13.051 +03:00 [INF] Method: POST
2025-10-27 18:12:13.052 +03:00 [INF] === Headers ===
2025-10-27 18:12:13.053 +03:00 [INF] Accept: ["*/*"]
2025-10-27 18:12:13.055 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 18:12:13.056 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 18:12:13.058 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 18:12:13.060 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 18:12:13.062 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------463450728594883015365595"]
2025-10-27 18:12:13.064 +03:00 [INF] Content-Length: ["3781966"]
2025-10-27 18:12:13.066 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 18:12:13.068 +03:00 [INF] Postman-Token: ["3cd7c4c1-39f7-4f95-91a3-141208edf5db"]
2025-10-27 18:12:13.070 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 18:12:13.071 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 18:12:13.072 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:12:13.073 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 18:12:13.095 +03:00 [WRN] Validation failed for CreatePurchaseOrderCommand. Errors: [{"PropertyName":"CompanyId","ErrorMessage":"Company is required"},{"PropertyName":"SupplierId","ErrorMessage":"Supplier is required"},{"PropertyName":"LineItems","ErrorMessage":"At least one line item is required"},{"PropertyName":"LineItems","ErrorMessage":"Purchase order must contain at least one line item"}]
2025-10-27 18:12:13.103 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 27.8172ms
2025-10-27 18:12:13.104 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:12:13.106 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"CompanyId":["Company is required"],"SupplierId":["Supplier is required"],"LineItems":["At least one line item is required","Purchase order must contain at least one line item"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 44
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 18:12:13.118 +03:00 [INF] Error response sent with status code 400
2025-10-27 18:12:13.120 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 400 null application/json; charset=utf-8 78.8734ms
2025-10-27 18:12:50.638 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------922604859293705755932015 3784057
2025-10-27 18:12:50.642 +03:00 [INF] Request started
2025-10-27 18:12:50.643 +03:00 [INF] === Incoming Request ===
2025-10-27 18:12:50.644 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 18:12:50.645 +03:00 [INF] Method: POST
2025-10-27 18:12:50.646 +03:00 [INF] === Headers ===
2025-10-27 18:12:50.647 +03:00 [INF] Accept: ["*/*"]
2025-10-27 18:12:50.649 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 18:12:50.650 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 18:12:50.652 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 18:12:50.653 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 18:12:50.654 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------922604859293705755932015"]
2025-10-27 18:12:50.656 +03:00 [INF] Content-Length: ["3784057"]
2025-10-27 18:12:50.657 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 18:12:50.658 +03:00 [INF] Postman-Token: ["7b1f9ff7-4088-43ad-b522-dcbef53bc1f3"]
2025-10-27 18:12:50.660 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 18:12:50.660 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 18:12:50.661 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:12:50.663 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 18:12:50.684 +03:00 [WRN] Validation failed for CreatePurchaseOrderCommand. Errors: [{"PropertyName":"LineItems","ErrorMessage":"At least one line item is required"},{"PropertyName":"LineItems","ErrorMessage":"Purchase order must contain at least one line item"}]
2025-10-27 18:12:50.689 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 24.0833ms
2025-10-27 18:12:50.690 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:12:50.695 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"LineItems":["At least one line item is required","Purchase order must contain at least one line item"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 44
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 18:12:50.708 +03:00 [INF] Error response sent with status code 400
2025-10-27 18:12:50.710 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 400 null application/json; charset=utf-8 72.3521ms
2025-10-27 18:17:52.475 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------503049319146334380908608 3785861
2025-10-27 18:17:52.483 +03:00 [INF] Request started
2025-10-27 18:17:52.484 +03:00 [INF] === Incoming Request ===
2025-10-27 18:17:52.486 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 18:17:52.487 +03:00 [INF] Method: POST
2025-10-27 18:17:52.490 +03:00 [INF] === Headers ===
2025-10-27 18:17:52.491 +03:00 [INF] Accept: ["*/*"]
2025-10-27 18:17:52.494 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 18:17:52.496 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 18:17:52.499 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 18:17:52.503 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 18:17:52.505 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------503049319146334380908608"]
2025-10-27 18:17:52.507 +03:00 [INF] Content-Length: ["3785861"]
2025-10-27 18:17:52.509 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 18:17:52.510 +03:00 [INF] Postman-Token: ["49c09fe9-6787-463f-bcad-3c8a2b990752"]
2025-10-27 18:17:52.512 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 18:17:52.513 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 18:17:52.515 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:17:52.519 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 18:17:52.568 +03:00 [WRN] Validation failed for CreatePurchaseOrderCommand. Errors: [{"PropertyName":"Deposits[0].Amount","ErrorMessage":"Deposit amount must be greater than 0"},{"PropertyName":"Deposits[0].PaymentMethod","ErrorMessage":"Invalid payment method"},{"PropertyName":"Discounts[0].DiscountType","ErrorMessage":"Discount type must be either 'Percentage' or 'Fixed'"},{"PropertyName":"Discounts[0].DiscountValue","ErrorMessage":"Discount value must be greater than 0"}]
2025-10-27 18:17:52.579 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 56.3783ms
2025-10-27 18:17:52.581 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:17:52.583 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"Deposits[0].Amount":["Deposit amount must be greater than 0"],"Deposits[0].PaymentMethod":["Invalid payment method"],"Discounts[0].DiscountType":["Discount type must be either 'Percentage' or 'Fixed'"],"Discounts[0].DiscountValue":["Discount value must be greater than 0"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 44
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 18:17:52.606 +03:00 [INF] Error response sent with status code 400
2025-10-27 18:17:52.610 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 400 null application/json; charset=utf-8 134.4906ms
2025-10-27 18:19:29.333 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------189510844233912079451794 3785983
2025-10-27 18:19:29.337 +03:00 [INF] Request started
2025-10-27 18:19:29.339 +03:00 [INF] === Incoming Request ===
2025-10-27 18:19:29.341 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 18:19:29.344 +03:00 [INF] Method: POST
2025-10-27 18:19:29.345 +03:00 [INF] === Headers ===
2025-10-27 18:19:29.346 +03:00 [INF] Accept: ["*/*"]
2025-10-27 18:19:29.348 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 18:19:29.350 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 18:19:29.352 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 18:19:29.357 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 18:19:29.360 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------189510844233912079451794"]
2025-10-27 18:19:29.361 +03:00 [INF] Content-Length: ["3785983"]
2025-10-27 18:19:29.364 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 18:19:29.366 +03:00 [INF] Postman-Token: ["b04e008a-94ed-4c98-8aae-e7b002d2a1a8"]
2025-10-27 18:19:29.367 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 18:19:29.369 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 18:19:29.370 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:19:29.374 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 18:19:29.509 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-27 18:19:30.190 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 18:19:30.203 +03:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-10-27 18:19:30.531 +03:00 [INF] Purchase Order created with ID: "c9419c66-ab1f-4857-a967-37221b235ea5", Number: PO-202510-0001
2025-10-27 18:19:30.782 +03:00 [ERR] Error creating purchase order
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_POAttachments_AspNetUsers_UploadedBy". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:f699a434-2c92-4898-875f-e27cc8ebbaa6
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2516
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.AddAttachments(Guid purchaseOrderId, List`1 attachments, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 371
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 124
2025-10-27 18:19:30.843 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 1465.8324ms
2025-10-27 18:19:30.845 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:19:30.847 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_POAttachments_AspNetUsers_UploadedBy". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:f699a434-2c92-4898-875f-e27cc8ebbaa6
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2516
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.AddAttachments(Guid purchaseOrderId, List`1 attachments, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 371
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 124
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 18:19:30.902 +03:00 [INF] Error response sent with status code 500
2025-10-27 18:19:30.907 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 1574.8512ms
2025-10-27 18:20:27.968 +03:00 [INF] Starting web host...
2025-10-27 18:20:29.171 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 18:20:29.251 +03:00 [INF] Executed DbCommand (64ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-27 18:20:29.327 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 18:20:29.333 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-27 18:20:29.342 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-27 18:20:29.395 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-27 18:20:29.411 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 18:20:29.415 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-27 18:20:29.428 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-27 18:20:29.439 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-27 18:20:29.447 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-27 18:20:29.812 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-27 18:20:30.226 +03:00 [INF] Master database initialized successfully
2025-10-27 18:20:32.826 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-27 18:20:32.932 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-27 18:20:32.935 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-27 18:20:33.033 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-27 18:20:33.035 +03:00 [INF] Hosting environment: Development
2025-10-27 18:20:33.037 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-27 18:20:33.398 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-27 18:20:33.521 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 124.9136ms
2025-10-27 18:20:33.532 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-27 18:20:33.532 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-27 18:20:33.539 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.367ms
2025-10-27 18:20:33.566 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 34.4277ms
2025-10-27 18:20:33.748 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-27 18:20:34.023 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 275.602ms
2025-10-27 18:20:35.893 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------187071987001015543454579 3785983
2025-10-27 18:20:35.921 +03:00 [INF] Request started
2025-10-27 18:20:35.923 +03:00 [INF] === Incoming Request ===
2025-10-27 18:20:35.925 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 18:20:35.926 +03:00 [INF] Method: POST
2025-10-27 18:20:35.927 +03:00 [INF] === Headers ===
2025-10-27 18:20:35.930 +03:00 [INF] Accept: ["*/*"]
2025-10-27 18:20:35.934 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 18:20:35.935 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 18:20:35.937 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 18:20:35.938 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 18:20:35.941 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------187071987001015543454579"]
2025-10-27 18:20:35.943 +03:00 [INF] Content-Length: ["3785983"]
2025-10-27 18:20:35.945 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 18:20:35.946 +03:00 [INF] Postman-Token: ["5b058396-d663-4c22-b1f6-4a77928e8c30"]
2025-10-27 18:20:35.958 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 18:20:35.959 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 18:20:35.961 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:20:35.989 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 18:20:35.998 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 18:20:36.254 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-27 18:20:36.936 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 18:20:36.947 +03:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-10-27 18:20:37.335 +03:00 [INF] Purchase Order created with ID: "155e65a5-bee6-4e35-bad4-9822b43c9705", Number: PO-202510-0002
2025-10-27 18:20:37.620 +03:00 [ERR] Error creating purchase order
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_POAttachments_AspNetUsers_UploadedBy". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:2a80b213-f0d7-4647-b64e-173f56c489a2
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2516
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.AddAttachments(Guid purchaseOrderId, List`1 attachments, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 371
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 124
2025-10-27 18:20:37.693 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 1695.2968ms
2025-10-27 18:20:37.697 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:20:37.700 +03:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_POAttachments_AspNetUsers_UploadedBy". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.AspNetUsers", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:2a80b213-f0d7-4647-b64e-173f56c489a2
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2516
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.AddAttachments(Guid purchaseOrderId, List`1 attachments, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 371
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_PurchaseOrder.CreatePurchaseOrderHandler.Handle(CreatePurchaseOrderCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_PurchaseOrder\CreatePurchaseOrderHandler.cs:line 124
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 18:20:37.783 +03:00 [INF] Error response sent with status code 500
2025-10-27 18:20:37.791 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 500 null application/json; charset=utf-8 1898.0545ms
2025-10-27 18:22:30.621 +03:00 [INF] Starting web host...
2025-10-27 18:22:31.849 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 18:22:31.909 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-27 18:22:31.994 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 18:22:31.999 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-27 18:22:32.012 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-27 18:22:32.070 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-27 18:22:32.085 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 18:22:32.090 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-27 18:22:32.098 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-27 18:22:32.110 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-27 18:22:32.118 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-27 18:22:32.276 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-27 18:22:32.283 +03:00 [INF] Master database initialized successfully
2025-10-27 18:22:34.383 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-27 18:22:34.510 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-27 18:22:34.512 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-27 18:22:34.602 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-27 18:22:34.604 +03:00 [INF] Hosting environment: Development
2025-10-27 18:22:34.605 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-27 18:22:35.046 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-27 18:22:35.172 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 126.495ms
2025-10-27 18:22:35.181 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-27 18:22:35.181 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-27 18:22:35.193 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.6158ms
2025-10-27 18:22:35.212 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.996ms
2025-10-27 18:22:35.285 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-27 18:22:35.574 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 288.869ms
2025-10-27 18:22:45.132 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------642459419266965523691225 3785983
2025-10-27 18:22:45.151 +03:00 [INF] Request started
2025-10-27 18:22:45.155 +03:00 [INF] === Incoming Request ===
2025-10-27 18:22:45.157 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 18:22:45.159 +03:00 [INF] Method: POST
2025-10-27 18:22:45.161 +03:00 [INF] === Headers ===
2025-10-27 18:22:45.163 +03:00 [INF] Accept: ["*/*"]
2025-10-27 18:22:45.165 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 18:22:45.167 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 18:22:45.168 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 18:22:45.172 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 18:22:45.174 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------642459419266965523691225"]
2025-10-27 18:22:45.176 +03:00 [INF] Content-Length: ["3785983"]
2025-10-27 18:22:45.177 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 18:22:45.179 +03:00 [INF] Postman-Token: ["1a148a79-e966-4a6d-8e80-356c092fca11"]
2025-10-27 18:22:45.184 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 18:22:45.186 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 18:22:45.188 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:22:45.209 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 18:22:45.215 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 18:22:45.407 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-27 18:22:45.933 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 18:22:45.939 +03:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-10-27 18:22:46.165 +03:00 [INF] Purchase Order created with ID: "ac851397-a046-4c04-add7-a4d6ef90bb58", Number: PO-202510-0003
2025-10-27 18:22:46.438 +03:00 [INF] Purchase Order PO-202510-0003 created successfully
2025-10-27 18:22:46.447 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.CreatePurchaseOrderDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-27 18:22:46.471 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 1255.6041ms
2025-10-27 18:22:46.475 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 18:22:46.477 +03:00 [INF] Request completed successfully with status code 200
2025-10-27 18:22:46.483 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 200 null application/json; charset=utf-8 1351.6021ms
2025-10-27 21:49:24.038 +03:00 [INF] Starting web host...
2025-10-27 21:49:28.819 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 21:49:28.901 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-27 21:49:29.020 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 21:49:29.026 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-27 21:49:29.046 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-27 21:49:29.102 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-27 21:49:29.119 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 21:49:29.123 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-27 21:49:29.131 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-27 21:49:29.143 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-27 21:49:29.150 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-27 21:49:29.311 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-27 21:49:29.319 +03:00 [INF] Master database initialized successfully
2025-10-27 21:49:31.743 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-27 21:49:31.856 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-27 21:49:31.857 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-27 21:49:31.959 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-27 21:49:31.960 +03:00 [INF] Hosting environment: Development
2025-10-27 21:49:31.961 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-27 21:49:32.317 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-27 21:49:32.468 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 153.8267ms
2025-10-27 21:49:32.477 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-27 21:49:32.477 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-27 21:49:32.503 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 25.9028ms
2025-10-27 21:49:32.518 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 40.9711ms
2025-10-27 21:49:32.621 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-27 21:49:32.863 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 242.0162ms
2025-10-27 21:49:51.847 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------747400144377933446157113 3785983
2025-10-27 21:49:51.884 +03:00 [INF] Request started
2025-10-27 21:49:51.886 +03:00 [INF] === Incoming Request ===
2025-10-27 21:49:51.888 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 21:49:51.889 +03:00 [INF] Method: POST
2025-10-27 21:49:51.891 +03:00 [INF] === Headers ===
2025-10-27 21:49:51.894 +03:00 [INF] Accept: ["*/*"]
2025-10-27 21:49:51.897 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 21:49:51.899 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 21:49:51.900 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 21:49:51.901 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 21:49:51.904 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------747400144377933446157113"]
2025-10-27 21:49:51.905 +03:00 [INF] Content-Length: ["3785983"]
2025-10-27 21:49:51.908 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 21:49:51.909 +03:00 [INF] Postman-Token: ["30acd380-9180-4da7-8e1f-2a59bf88b7cc"]
2025-10-27 21:49:51.913 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 21:49:51.915 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 21:49:51.916 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 21:49:51.940 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 21:49:51.945 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 21:49:52.117 +03:00 [WRN] Validation failed for CreatePurchaseOrderCommand. Errors: [{"PropertyName":"Deposits","ErrorMessage":"Total deposit amount (100.00) cannot exceed the estimated purchase order total (87.20)"}]
2025-10-27 21:49:52.137 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 191.1921ms
2025-10-27 21:49:52.142 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 21:49:52.151 +03:00 [WRN] Validation exception occurred: Validation failed. Validation errors: {"Deposits":["Total deposit amount (100.00) cannot exceed the estimated purchase order total (87.20)"]}
ModularERP.Common.Exceptions.ValidationException: Validation failed
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 44
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder(CreatePurchaseOrderCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\PurchaseOrderController.cs:line 32
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 354
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 307
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-10-27 21:49:52.246 +03:00 [INF] Error response sent with status code 400
2025-10-27 21:49:52.251 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 400 null application/json; charset=utf-8 404.4376ms
2025-10-27 21:52:41.733 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------738299014166778517389089 3785985
2025-10-27 21:52:41.746 +03:00 [INF] Request started
2025-10-27 21:52:41.747 +03:00 [INF] === Incoming Request ===
2025-10-27 21:52:41.749 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 21:52:41.751 +03:00 [INF] Method: POST
2025-10-27 21:52:41.754 +03:00 [INF] === Headers ===
2025-10-27 21:52:41.755 +03:00 [INF] Accept: ["*/*"]
2025-10-27 21:52:41.757 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 21:52:41.758 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 21:52:41.761 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 21:52:41.763 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 21:52:41.764 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------738299014166778517389089"]
2025-10-27 21:52:41.766 +03:00 [INF] Content-Length: ["3785985"]
2025-10-27 21:52:41.768 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 21:52:41.769 +03:00 [INF] Postman-Token: ["3c22e69b-1aea-4130-b02c-0488dc213e73"]
2025-10-27 21:52:41.774 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 21:52:41.775 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 21:52:41.776 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 21:52:41.778 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 21:52:41.874 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-27 21:52:42.472 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 21:52:42.476 +03:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-10-27 21:52:42.823 +03:00 [INF] Purchase Order created with ID: "1325b776-88de-45b5-ac18-9191d44344e2", Number: PO-202510-0004
2025-10-27 21:52:43.140 +03:00 [INF] Purchase Order PO-202510-0004 created successfully
2025-10-27 21:52:43.147 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.CreatePurchaseOrderDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-27 21:52:43.177 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 1392.8339ms
2025-10-27 21:52:43.180 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 21:52:43.182 +03:00 [INF] Request completed successfully with status code 200
2025-10-27 21:52:43.187 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 200 null application/json; charset=utf-8 1454.0903ms
2025-10-27 22:09:59.743 +03:00 [INF] Starting web host...
2025-10-27 22:10:01.032 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 22:10:01.105 +03:00 [INF] Executed DbCommand (53ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-27 22:10:01.177 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 22:10:01.182 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-27 22:10:01.200 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-27 22:10:01.276 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-27 22:10:01.292 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 22:10:01.297 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-27 22:10:01.305 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-27 22:10:01.318 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-27 22:10:01.324 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-27 22:10:01.506 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-27 22:10:01.514 +03:00 [INF] Master database initialized successfully
2025-10-27 22:10:03.901 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-27 22:10:04.017 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-27 22:10:04.019 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-27 22:10:04.093 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-27 22:10:04.127 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-27 22:10:04.129 +03:00 [INF] Hosting environment: Development
2025-10-27 22:10:04.131 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-27 22:10:04.266 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 173.7823ms
2025-10-27 22:10:04.429 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-27 22:10:04.429 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-27 22:10:04.435 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 5.7549ms
2025-10-27 22:10:04.460 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 30.5417ms
2025-10-27 22:10:04.513 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-27 22:10:04.843 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 329.8753ms
2025-10-27 22:11:26.360 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-27 22:11:26.372 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 11.9401ms
2025-10-27 22:11:26.380 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-27 22:11:26.380 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-27 22:11:26.388 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.337ms
2025-10-27 22:11:26.396 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 15.0163ms
2025-10-27 22:11:26.465 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-27 22:11:26.733 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 268.3635ms
2025-10-27 22:16:59.204 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------259118034087786359364161 3785985
2025-10-27 22:16:59.224 +03:00 [INF] Request started
2025-10-27 22:16:59.227 +03:00 [INF] === Incoming Request ===
2025-10-27 22:16:59.228 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 22:16:59.229 +03:00 [INF] Method: POST
2025-10-27 22:16:59.230 +03:00 [INF] === Headers ===
2025-10-27 22:16:59.233 +03:00 [INF] Accept: ["*/*"]
2025-10-27 22:16:59.238 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 22:16:59.239 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 22:16:59.241 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 22:16:59.243 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 22:16:59.245 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------259118034087786359364161"]
2025-10-27 22:16:59.246 +03:00 [INF] Content-Length: ["3785985"]
2025-10-27 22:16:59.248 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 22:16:59.250 +03:00 [INF] Postman-Token: ["18dedb8f-a2ee-4555-8b09-75d856b3e7a7"]
2025-10-27 22:16:59.256 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 22:16:59.257 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 22:16:59.259 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 22:16:59.279 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 22:16:59.286 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 22:16:59.502 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-27 22:17:00.009 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 22:17:00.016 +03:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-10-27 22:17:00.352 +03:00 [INF] Purchase Order created with ID: "23d49ad7-c8f3-4545-9bb3-6957cdf43515", Number: PO-202510-0005
2025-10-27 22:17:00.767 +03:00 [INF] Purchase Order PO-202510-0005 created successfully
2025-10-27 22:17:00.775 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.CreatePurchaseOrderDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-27 22:17:00.814 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 1527.9823ms
2025-10-27 22:17:00.817 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 22:17:00.820 +03:00 [INF] Request completed successfully with status code 200
2025-10-27 22:17:00.830 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 200 null application/json; charset=utf-8 1625.8843ms
2025-10-27 22:44:58.242 +03:00 [INF] Starting web host...
2025-10-27 22:44:59.787 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 22:44:59.885 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-10-27 22:44:59.963 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 22:44:59.969 +03:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-10-27 22:44:59.984 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-10-27 22:45:00.071 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-10-27 22:45:00.090 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-10-27 22:45:00.095 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-10-27 22:45:00.106 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-10-27 22:45:00.122 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-10-27 22:45:00.129 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-10-27 22:45:00.307 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-10-27 22:45:00.316 +03:00 [INF] Master database initialized successfully
2025-10-27 22:45:02.582 +03:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-10-27 22:45:02.726 +03:00 [INF] Now listening on: https://localhost:7168
2025-10-27 22:45:02.728 +03:00 [INF] Now listening on: http://localhost:5004
2025-10-27 22:45:02.821 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-10-27 22:45:02.822 +03:00 [INF] Hosting environment: Development
2025-10-27 22:45:02.824 +03:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-10-27 22:45:03.095 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-27 22:45:03.247 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 153.5759ms
2025-10-27 22:45:03.386 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-27 22:45:03.386 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-27 22:45:03.397 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.1426ms
2025-10-27 22:45:03.416 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 29.839ms
2025-10-27 22:45:03.466 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-27 22:45:03.713 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 247.1675ms
2025-10-27 22:45:11.408 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------003747436537630093913907 3785985
2025-10-27 22:45:11.432 +03:00 [INF] Request started
2025-10-27 22:45:11.435 +03:00 [INF] === Incoming Request ===
2025-10-27 22:45:11.437 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 22:45:11.438 +03:00 [INF] Method: POST
2025-10-27 22:45:11.439 +03:00 [INF] === Headers ===
2025-10-27 22:45:11.442 +03:00 [INF] Accept: ["*/*"]
2025-10-27 22:45:11.445 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 22:45:11.446 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 22:45:11.447 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 22:45:11.449 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 22:45:11.450 +03:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------003747436537630093913907"]
2025-10-27 22:45:11.452 +03:00 [INF] Content-Length: ["3785985"]
2025-10-27 22:45:11.453 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 22:45:11.455 +03:00 [INF] Postman-Token: ["cbcd7a48-0253-41fa-87fd-13751e6aff83"]
2025-10-27 22:45:11.460 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 22:45:11.462 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 22:45:11.464 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 22:45:11.488 +03:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 22:45:11.494 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 22:45:11.741 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-10-27 22:45:12.415 +03:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-10-27 22:45:12.425 +03:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-10-27 22:45:12.624 +03:00 [INF] Starting PO amount calculations
2025-10-27 22:45:12.626 +03:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-10-27 22:45:12.628 +03:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-10-27 22:45:12.629 +03:00 [INF] Adjustments Total: 10
2025-10-27 22:45:12.630 +03:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-10-27 22:45:12.631 +03:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-10-27 22:45:12.633 +03:00 [WRN] ⚠️ Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-10-27 22:45:12.635 +03:00 [INF] Total Deposit Amount: 43.6500
2025-10-27 22:45:12.636 +03:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-10-27 22:45:12.638 +03:00 [INF] ✅ Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-10-27 22:45:12.850 +03:00 [INF] Purchase Order created with ID: "46187d2b-b8b5-4d3c-b3a9-f839ea5881b9", Number: PO-202510-0006
2025-10-27 22:45:13.283 +03:00 [INF] Purchase Order PO-202510-0006 created successfully
2025-10-27 22:45:13.290 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.CreatePurchaseOrderDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-27 22:45:13.332 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 1837.6399ms
2025-10-27 22:45:13.335 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-10-27 22:45:13.338 +03:00 [INF] Request completed successfully with status code 200
2025-10-27 22:45:13.346 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 200 null application/json; charset=utf-8 1938.671ms
2025-10-27 22:55:59.179 +03:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PurchaseOrder - null null
2025-10-27 22:55:59.193 +03:00 [INF] Request started
2025-10-27 22:55:59.194 +03:00 [INF] === Incoming Request ===
2025-10-27 22:55:59.195 +03:00 [INF] Path: /api/PurchaseOrder
2025-10-27 22:55:59.196 +03:00 [INF] Method: GET
2025-10-27 22:55:59.197 +03:00 [INF] === Headers ===
2025-10-27 22:55:59.198 +03:00 [INF] Accept: ["*/*"]
2025-10-27 22:55:59.199 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 22:55:59.200 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 22:55:59.202 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 22:55:59.203 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 22:55:59.205 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 22:55:59.207 +03:00 [INF] Postman-Token: ["40250ccf-be12-48e3-a1ea-08464c9e142c"]
2025-10-27 22:55:59.212 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 22:55:59.213 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 22:55:59.214 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.GetPurchaseOrders (ModularERP)'
2025-10-27 22:55:59.227 +03:00 [INF] Route matched with {action = "GetPurchaseOrders", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetPurchaseOrders(ModularERP.Modules.Purchases.Purchase_Order_Management.Qeuries.Qeuries_PurchaseOrder.GetPurchaseOrderListQuery) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 22:55:59.245 +03:00 [INF] Retrieving purchase orders list with filters
2025-10-27 22:55:59.382 +03:00 [INF] Retrieved 6 purchase orders (Page 1 of 1)
2025-10-27 22:55:59.385 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.PagedResult`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.PurchaseOrderListDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-10-27 22:55:59.391 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.GetPurchaseOrders (ModularERP) in 161.2918ms
2025-10-27 22:55:59.394 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.GetPurchaseOrders (ModularERP)'
2025-10-27 22:55:59.395 +03:00 [INF] Request completed successfully with status code 200
2025-10-27 22:55:59.397 +03:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PurchaseOrder - 200 null application/json; charset=utf-8 217.3274ms
2025-10-27 23:03:25.796 +03:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder/{46187d2b-b8b5-4d3c-b3a9-f839ea5881b9}/submit - application/json 61
2025-10-27 23:03:25.809 +03:00 [INF] Request started
2025-10-27 23:03:25.811 +03:00 [INF] === Incoming Request ===
2025-10-27 23:03:25.812 +03:00 [INF] Path: /api/PurchaseOrder/%7B46187d2b-b8b5-4d3c-b3a9-f839ea5881b9%7D/submit
2025-10-27 23:03:25.814 +03:00 [INF] Method: POST
2025-10-27 23:03:25.815 +03:00 [INF] === Headers ===
2025-10-27 23:03:25.816 +03:00 [INF] Accept: ["*/*"]
2025-10-27 23:03:25.817 +03:00 [INF] Connection: ["keep-alive"]
2025-10-27 23:03:25.818 +03:00 [INF] Host: ["localhost:7168"]
2025-10-27 23:03:25.820 +03:00 [INF] User-Agent: ["PostmanRuntime/7.49.0"]
2025-10-27 23:03:25.821 +03:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-10-27 23:03:25.823 +03:00 [INF] Content-Type: ["application/json"]
2025-10-27 23:03:25.824 +03:00 [INF] Content-Length: ["61"]
2025-10-27 23:03:25.826 +03:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-10-27 23:03:25.829 +03:00 [INF] Postman-Token: ["dff57736-0b7f-4900-b8eb-5336341d1d54"]
2025-10-27 23:03:25.830 +03:00 [INF] 🔍 TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-10-27 23:03:25.831 +03:00 [INF] ✅ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-10-27 23:03:25.832 +03:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.SubmitPurchaseOrder (ModularERP)'
2025-10-27 23:03:25.836 +03:00 [INF] Route matched with {action = "SubmitPurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SubmitPurchaseOrder(System.Guid, SubmitPurchaseOrderRequest) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-10-27 23:03:25.855 +03:00 [INF] Submitting purchase order with ID: "46187d2b-b8b5-4d3c-b3a9-f839ea5881b9"
2025-10-27 23:03:25.897 +03:00 [INF] Purchase order PO-202510-0006 submitted successfully
2025-10-27 23:03:25.900 +03:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-10-27 23:03:25.902 +03:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.SubmitPurchaseOrder (ModularERP) in 63.4088ms
2025-10-27 23:03:25.904 +03:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.SubmitPurchaseOrder (ModularERP)'
2025-10-27 23:03:25.905 +03:00 [INF] Request completed successfully with status code 200
2025-10-27 23:03:25.907 +03:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder/{46187d2b-b8b5-4d3c-b3a9-f839ea5881b9}/submit - 200 null application/json; charset=utf-8 110.374ms
2025-10-27 23:05:26.551 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-10-27 23:05:26.559 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 8.4618ms
2025-10-27 23:05:26.568 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-10-27 23:05:26.568 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-10-27 23:05:26.572 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 3.5051ms
2025-10-27 23:05:26.583 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 14.6761ms
2025-10-27 23:05:26.750 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-10-27 23:05:27.026 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 275.7418ms
