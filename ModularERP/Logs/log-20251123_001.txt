2025-11-23 15:25:48.271 +02:00 [INF] Starting web host...
2025-11-23 15:25:49.407 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 258
2025-11-23 15:26:22.133 +02:00 [INF] Starting web host...
2025-11-23 15:26:23.033 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 258
2025-11-23 15:26:40.373 +02:00 [INF] Starting web host...
2025-11-23 15:26:41.258 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 258
2025-11-23 15:28:44.073 +02:00 [INF] Starting web host...
2025-11-23 15:28:44.810 +02:00 [FTL] Host terminated unexpectedly
Microsoft.Extensions.Hosting.HostAbortedException: The host was aborted.
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.ThrowHostAborted()
   at Microsoft.Extensions.Hosting.HostFactoryResolver.HostingListener.OnNext(KeyValuePair`2 value)
   at System.Diagnostics.DiagnosticListener.Write(String name, Object value)
   at Microsoft.Extensions.Hosting.HostBuilder.ResolveHost(IServiceProvider serviceProvider, DiagnosticListener diagnosticListener)
   at Microsoft.Extensions.Hosting.HostApplicationBuilder.Build()
   at Microsoft.AspNetCore.Builder.WebApplicationBuilder.Build()
   at ModularERP.Program.Main(String[] args) in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 258
2025-11-23 15:56:39.248 +02:00 [INF] Starting web host...
2025-11-23 15:56:43.429 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 15:56:43.501 +02:00 [INF] Executed DbCommand (56ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 15:56:43.582 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 15:56:43.589 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 15:56:43.601 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 15:56:43.671 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 15:56:43.692 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 15:56:43.697 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 15:56:43.707 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 15:56:43.720 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 15:56:43.727 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 15:56:43.921 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 15:56:43.928 +02:00 [INF] Master database initialized successfully
2025-11-23 15:56:46.488 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 15:56:46.680 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 15:56:46.682 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 15:56:46.821 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 15:56:46.823 +02:00 [INF] Hosting environment: Development
2025-11-23 15:56:46.825 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 15:56:47.543 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 15:56:47.711 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 170.2272ms
2025-11-23 15:56:47.728 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 15:56:47.737 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 15:56:47.741 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 12.4934ms
2025-11-23 15:56:47.801 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 63.9991ms
2025-11-23 15:56:48.042 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 15:56:48.318 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 276.1374ms
2025-11-23 15:57:16.604 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 15:57:16.629 +02:00 [INF] Request started
2025-11-23 15:57:16.631 +02:00 [INF] === Incoming Request ===
2025-11-23 15:57:16.633 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 15:57:16.634 +02:00 [INF] Method: POST
2025-11-23 15:57:16.635 +02:00 [INF] === Headers ===
2025-11-23 15:57:16.637 +02:00 [INF] Accept: ["*/*"]
2025-11-23 15:57:16.643 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 15:57:16.644 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 15:57:16.646 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 15:57:16.649 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 15:57:16.650 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 15:57:16.652 +02:00 [INF] Content-Length: ["288"]
2025-11-23 15:57:16.654 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 15:57:16.655 +02:00 [INF] Postman-Token: ["8123bb97-ec08-45c4-8072-966a3f0cb2de"]
2025-11-23 15:57:16.662 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 15:57:16.664 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 15:57:16.666 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 15:57:16.688 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 15:57:16.696 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 15:57:16.736 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 15:57:16.863 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 15:57:17.645 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 15:57:17.662 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 15:57:18.155 +02:00 [INF] Created Debit Note: DN-20251123-00003 for Refund: REF-20251123-00004
2025-11-23 15:57:18.318 +02:00 [ERR] Error creating refund from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.PurchaseRefunds' with unique index 'IX_PurchaseRefund_RefundNumber'. The duplicate key value is (REF-20251123-00004).
The INSERT statement conflicted with the FOREIGN KEY constraint "FK_RefundLineItems_PurchaseRefunds_RefundId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.PurchaseRefunds", column 'Id'.
The statement has been terminated.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:162a470f-d381-4e5f-9394-f19aff59322a
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2537
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 203
2025-11-23 15:57:18.418 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 1722.5493ms
2025-11-23 15:57:18.423 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 15:57:18.427 +02:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.PurchaseRefunds' with unique index 'IX_PurchaseRefund_RefundNumber'. The duplicate key value is (REF-20251123-00004).
The INSERT statement conflicted with the FOREIGN KEY constraint "FK_RefundLineItems_PurchaseRefunds_RefundId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.PurchaseRefunds", column 'Id'.
The statement has been terminated.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:162a470f-d381-4e5f-9394-f19aff59322a
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2537
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 203
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice(Guid invoiceId, CreateRefundFromInvoiceCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Controllers\PurchaseInvoiceRefundsController.cs:line 43
   at lambda_method118(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 15:57:18.500 +02:00 [INF] Error response sent with status code 500
2025-11-23 15:57:18.507 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 500 null application/json; charset=utf-8 1903.4457ms
2025-11-23 15:59:09.684 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 15:59:09.702 +02:00 [INF] Request started
2025-11-23 15:59:09.704 +02:00 [INF] === Incoming Request ===
2025-11-23 15:59:09.706 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 15:59:09.707 +02:00 [INF] Method: POST
2025-11-23 15:59:09.708 +02:00 [INF] === Headers ===
2025-11-23 15:59:09.709 +02:00 [INF] Accept: ["*/*"]
2025-11-23 15:59:09.711 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 15:59:09.713 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 15:59:09.715 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 15:59:09.717 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 15:59:09.718 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 15:59:09.720 +02:00 [INF] Content-Length: ["288"]
2025-11-23 15:59:09.723 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 15:59:09.725 +02:00 [INF] Postman-Token: ["7a81da68-da04-4f09-8fd5-f483048585ed"]
2025-11-23 15:59:09.728 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 15:59:09.729 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 15:59:09.731 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 15:59:09.735 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 15:59:09.742 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 15:59:09.746 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 15:59:09.790 +02:00 [INF] Created Debit Note: DN-20251123-00003 for Refund: REF-20251123-00004
2025-11-23 15:59:09.807 +02:00 [INF] Successfully created refund: REF-20251123-00004 from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 15:59:10.030 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 15:59:10.043 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 302.9028ms
2025-11-23 15:59:10.046 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 15:59:10.048 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 15:59:10.050 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 200 null application/json; charset=utf-8 366.325ms
2025-11-23 15:59:34.035 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 15:59:34.041 +02:00 [INF] Request started
2025-11-23 15:59:34.043 +02:00 [INF] === Incoming Request ===
2025-11-23 15:59:34.045 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 15:59:34.047 +02:00 [INF] Method: POST
2025-11-23 15:59:34.049 +02:00 [INF] === Headers ===
2025-11-23 15:59:34.050 +02:00 [INF] Accept: ["*/*"]
2025-11-23 15:59:34.052 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 15:59:34.057 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 15:59:34.060 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 15:59:34.061 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 15:59:34.063 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 15:59:34.067 +02:00 [INF] Content-Length: ["288"]
2025-11-23 15:59:34.069 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 15:59:34.071 +02:00 [INF] Postman-Token: ["729f3a53-706a-403e-9028-24d3dc267cb9"]
2025-11-23 15:59:34.073 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 15:59:34.074 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 15:59:34.077 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 15:59:34.082 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 15:59:34.087 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 15:59:34.094 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 15:59:34.133 +02:00 [INF] Created Debit Note: DN-20251123-00003 for Refund: REF-20251123-00005
2025-11-23 15:59:34.144 +02:00 [INF] Successfully created refund: REF-20251123-00005 from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 15:59:34.166 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 15:59:34.169 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 82.3784ms
2025-11-23 15:59:34.171 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 15:59:34.173 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 15:59:34.174 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 200 null application/json; charset=utf-8 139.2161ms
2025-11-23 16:02:46.311 +02:00 [INF] Starting web host...
2025-11-23 16:02:47.766 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:02:47.835 +02:00 [INF] Executed DbCommand (54ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 16:02:47.902 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:02:47.908 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 16:02:47.927 +02:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 16:02:47.982 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 16:02:47.998 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:02:48.003 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 16:02:48.012 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 16:02:48.025 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 16:02:48.033 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 16:02:48.196 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 16:02:48.204 +02:00 [INF] Master database initialized successfully
2025-11-23 16:02:50.332 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 16:02:50.443 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 16:02:50.445 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 16:02:50.536 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 16:02:50.538 +02:00 [INF] Hosting environment: Development
2025-11-23 16:02:50.539 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 16:02:50.825 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 16:02:50.978 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 153.0361ms
2025-11-23 16:02:51.136 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 16:02:51.137 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 16:02:51.144 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 7.2866ms
2025-11-23 16:02:51.170 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 33.5728ms
2025-11-23 16:02:51.256 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 16:02:51.546 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 290.7062ms
2025-11-23 16:03:09.394 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 16:03:09.415 +02:00 [INF] Request started
2025-11-23 16:03:09.418 +02:00 [INF] === Incoming Request ===
2025-11-23 16:03:09.419 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:03:09.421 +02:00 [INF] Method: POST
2025-11-23 16:03:09.422 +02:00 [INF] === Headers ===
2025-11-23 16:03:09.425 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:03:09.429 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:03:09.431 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:03:09.432 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:03:09.433 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:03:09.435 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:03:09.436 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:03:09.438 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:03:09.440 +02:00 [INF] Postman-Token: ["f4573b43-d8b9-480e-984e-dc881fae17df"]
2025-11-23 16:03:09.446 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:03:09.448 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:03:09.449 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:03:09.465 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:03:09.470 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 16:03:09.499 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:03:09.615 +02:00 [INF] Executed DbCommand (20ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 16:03:10.251 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 16:03:10.259 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:03:11.017 +02:00 [INF] Created Debit Note: DN-20251123-00003 for Refund: REF-20251123-00006
2025-11-23 16:03:11.183 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception Fully Received ‚Üí PartiallyReceived, Payment: PartiallyPaid
2025-11-23 16:03:11.231 +02:00 [INF] Successfully created refund: REF-20251123-00006 from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:03:11.242 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:03:11.270 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 1799.9022ms
2025-11-23 16:03:11.274 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:03:11.276 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:03:11.281 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 200 null application/json; charset=utf-8 1887.1041ms
2025-11-23 16:10:36.643 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 16:10:36.661 +02:00 [INF] Request started
2025-11-23 16:10:36.663 +02:00 [INF] === Incoming Request ===
2025-11-23 16:10:36.664 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:10:36.665 +02:00 [INF] Method: POST
2025-11-23 16:10:36.666 +02:00 [INF] === Headers ===
2025-11-23 16:10:36.667 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:10:36.669 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:10:36.670 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:10:36.671 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:10:36.673 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:10:36.675 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:10:36.677 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:10:36.678 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:10:36.680 +02:00 [INF] Postman-Token: ["cd370737-f696-4e9d-9aa9-885bd18361ad"]
2025-11-23 16:10:36.683 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:10:36.685 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:10:36.686 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:10:36.688 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:10:36.692 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:10:36.701 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:10:36.781 +02:00 [INF] Created Debit Note: DN-20251123-00003 for Refund: REF-20251123-00007
2025-11-23 16:10:36.787 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception PartiallyReceived ‚Üí PartiallyReceived, Payment: PartiallyPaid
2025-11-23 16:10:36.804 +02:00 [INF] Successfully created refund: REF-20251123-00007 from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:10:36.808 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:10:36.811 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 121.2098ms
2025-11-23 16:10:36.814 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:10:36.815 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:10:36.817 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 200 null application/json; charset=utf-8 173.344ms
2025-11-23 16:15:17.254 +02:00 [INF] Starting web host...
2025-11-23 16:15:18.868 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:15:18.940 +02:00 [INF] Executed DbCommand (55ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 16:15:19.015 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:15:19.021 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 16:15:19.052 +02:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 16:15:19.112 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 16:15:19.130 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:15:19.135 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 16:15:19.142 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 16:15:19.154 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 16:15:19.164 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 16:15:19.330 +02:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 16:15:19.338 +02:00 [INF] Master database initialized successfully
2025-11-23 16:15:21.259 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 16:15:21.376 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 16:15:21.378 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 16:15:21.511 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 16:15:21.513 +02:00 [INF] Hosting environment: Development
2025-11-23 16:15:21.515 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 16:15:21.637 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 16:15:21.790 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 154.9106ms
2025-11-23 16:15:21.792 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 16:15:21.792 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 16:15:21.805 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 12.8398ms
2025-11-23 16:15:21.832 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 39.4401ms
2025-11-23 16:15:21.924 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 16:15:22.248 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 324.4535ms
2025-11-23 16:15:25.356 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 16:15:25.408 +02:00 [INF] Request started
2025-11-23 16:15:25.422 +02:00 [INF] === Incoming Request ===
2025-11-23 16:15:25.426 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:15:25.427 +02:00 [INF] Method: POST
2025-11-23 16:15:25.430 +02:00 [INF] === Headers ===
2025-11-23 16:15:25.435 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:15:25.437 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:15:25.439 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:15:25.441 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:15:25.443 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:15:25.444 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:15:25.446 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:15:25.450 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:15:25.451 +02:00 [INF] Postman-Token: ["52f63453-3fba-42db-a7d5-507fb7278044"]
2025-11-23 16:15:25.455 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:15:25.456 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:15:25.459 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:15:25.477 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:15:25.485 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 16:15:25.518 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:15:25.627 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 16:15:26.379 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 16:15:26.387 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:15:27.365 +02:00 [INF] Created Debit Note: DN-20251123-00003 for Refund: REF-20251123-00008
2025-11-23 16:15:27.442 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception PartiallyReceived ‚Üí PartiallyReceived, Payment: PartiallyPaid
2025-11-23 16:15:27.484 +02:00 [INF] Successfully created refund: REF-20251123-00008 from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:15:27.494 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:15:27.521 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 2037.1008ms
2025-11-23 16:15:27.525 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:15:27.528 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:15:27.533 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 200 null application/json; charset=utf-8 2177.8054ms
2025-11-23 16:16:14.255 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 16:16:14.273 +02:00 [INF] Request started
2025-11-23 16:16:14.275 +02:00 [INF] === Incoming Request ===
2025-11-23 16:16:14.277 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:16:14.278 +02:00 [INF] Method: POST
2025-11-23 16:16:14.279 +02:00 [INF] === Headers ===
2025-11-23 16:16:14.282 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:16:14.285 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:16:14.287 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:16:14.288 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:16:14.290 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:16:14.293 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:16:14.295 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:16:14.297 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:16:14.299 +02:00 [INF] Postman-Token: ["5cee5850-e9e7-49be-a0a7-fd5adc3fd7d2"]
2025-11-23 16:16:14.303 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:16:14.304 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:16:14.307 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:16:14.392 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:16:14.398 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:16:14.411 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:16:14.521 +02:00 [INF] Created Debit Note: DN-20251123-00003 for Refund: REF-20251123-00009
2025-11-23 16:16:14.528 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception PartiallyReceived ‚Üí PartiallyReceived, Payment: PartiallyPaid
2025-11-23 16:16:14.548 +02:00 [INF] Successfully created refund: REF-20251123-00009 from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:16:14.551 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:16:14.553 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 156.8007ms
2025-11-23 16:16:14.555 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:16:14.558 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:16:14.560 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 200 null application/json; charset=utf-8 305.2609ms
2025-11-23 16:20:34.153 +02:00 [INF] Starting web host...
2025-11-23 16:20:35.705 +02:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:20:35.769 +02:00 [INF] Executed DbCommand (45ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 16:20:35.850 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:20:35.856 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 16:20:35.873 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 16:20:35.935 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 16:20:35.951 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:20:35.956 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 16:20:35.964 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 16:20:35.975 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 16:20:35.983 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 16:20:36.161 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 16:20:36.168 +02:00 [INF] Master database initialized successfully
2025-11-23 16:20:38.110 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 16:20:38.223 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 16:20:38.226 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 16:20:38.315 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 16:20:38.317 +02:00 [INF] Hosting environment: Development
2025-11-23 16:20:38.319 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 16:20:38.693 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 16:20:39.033 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 341.9087ms
2025-11-23 16:20:39.038 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 16:20:39.049 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 16:20:39.053 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 14.4656ms
2025-11-23 16:20:39.110 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 61.0285ms
2025-11-23 16:20:39.168 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 16:20:39.540 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 371.801ms
2025-11-23 16:20:53.125 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 16:20:53.148 +02:00 [INF] Request started
2025-11-23 16:20:53.150 +02:00 [INF] === Incoming Request ===
2025-11-23 16:20:53.151 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:20:53.152 +02:00 [INF] Method: POST
2025-11-23 16:20:53.154 +02:00 [INF] === Headers ===
2025-11-23 16:20:53.157 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:20:53.160 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:20:53.161 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:20:53.163 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:20:53.164 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:20:53.166 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:20:53.167 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:20:53.169 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:20:53.172 +02:00 [INF] Postman-Token: ["e6e8ee67-d99f-4320-a82a-0855ea96406d"]
2025-11-23 16:20:53.176 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:20:53.178 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:20:53.180 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:20:53.199 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:20:53.206 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 16:20:53.252 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:20:53.375 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 16:20:54.113 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 16:20:54.127 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:20:54.751 +02:00 [INF] Updated POLineItem "172d5908-2ebf-4fa0-5816-08de25364791": ReturnedQuantity = 1.000
2025-11-23 16:20:54.935 +02:00 [INF] Saved POLineItem ReturnedQuantity updates to database
2025-11-23 16:20:55.067 +02:00 [INF] Created Debit Note: DN-20251123-00003 for Refund: REF-20251123-00010
2025-11-23 16:20:55.098 +02:00 [INF] PO PO-202510-0001 Calculations: Ordered=10.000, Received=5.000, Returned=0.000, Net=5.000
2025-11-23 16:20:55.142 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception PartiallyReceived ‚Üí PartiallyReceived, Payment: PartiallyPaid
2025-11-23 16:20:55.180 +02:00 [INF] Successfully created refund: REF-20251123-00010 from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:20:55.189 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:20:55.212 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 2006.1171ms
2025-11-23 16:20:55.215 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:20:55.217 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:20:55.223 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 200 null application/json; charset=utf-8 2098.0427ms
2025-11-23 16:25:50.601 +02:00 [INF] Starting web host...
2025-11-23 16:25:52.088 +02:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:25:52.156 +02:00 [INF] Executed DbCommand (51ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 16:25:52.225 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:25:52.231 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 16:25:52.259 +02:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 16:25:52.319 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 16:25:52.336 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:25:52.342 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 16:25:52.349 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 16:25:52.364 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 16:25:52.373 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 16:25:52.542 +02:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 16:25:52.549 +02:00 [INF] Master database initialized successfully
2025-11-23 16:25:54.659 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 16:25:54.765 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 16:25:54.767 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 16:25:54.858 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 16:25:54.860 +02:00 [INF] Hosting environment: Development
2025-11-23 16:25:54.861 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 16:25:54.986 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 16:25:55.160 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 174.7289ms
2025-11-23 16:25:55.310 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 16:25:55.310 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 16:25:55.322 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 11.855ms
2025-11-23 16:25:55.338 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 27.6034ms
2025-11-23 16:25:55.394 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 16:25:55.658 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 263.6496ms
2025-11-23 16:26:00.531 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 16:26:00.554 +02:00 [INF] Request started
2025-11-23 16:26:00.557 +02:00 [INF] === Incoming Request ===
2025-11-23 16:26:00.558 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:26:00.559 +02:00 [INF] Method: POST
2025-11-23 16:26:00.560 +02:00 [INF] === Headers ===
2025-11-23 16:26:00.563 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:26:00.566 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:26:00.569 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:26:00.571 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:26:00.573 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:26:00.575 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:26:00.577 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:26:00.579 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:26:00.580 +02:00 [INF] Postman-Token: ["065577aa-b7f3-4af5-90ac-712a34309381"]
2025-11-23 16:26:00.587 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:26:00.589 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:26:00.591 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:26:00.613 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:26:00.621 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 16:26:00.657 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:26:00.783 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 16:26:01.630 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 16:26:01.643 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:26:02.701 +02:00 [ERR] Error creating refund from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_DebitNotes_PurchaseRefunds_RefundId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.PurchaseRefunds", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:cd402cdb-ba40-41a3-a1db-742d5d4c3aad
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2537
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 282
2025-11-23 16:26:02.784 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 2163.6584ms
2025-11-23 16:26:02.788 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:26:02.791 +02:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_DebitNotes_PurchaseRefunds_RefundId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.PurchaseRefunds", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:cd402cdb-ba40-41a3-a1db-742d5d4c3aad
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2537
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 282
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice(Guid invoiceId, CreateRefundFromInvoiceCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Controllers\PurchaseInvoiceRefundsController.cs:line 43
   at lambda_method118(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 16:26:02.865 +02:00 [INF] Error response sent with status code 500
2025-11-23 16:26:02.872 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 500 null application/json; charset=utf-8 2341.8549ms
2025-11-23 16:27:57.096 +02:00 [INF] Starting web host...
2025-11-23 16:27:58.597 +02:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:27:58.655 +02:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 16:27:58.728 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:27:58.741 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 16:27:58.764 +02:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 16:27:58.850 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 16:27:58.873 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 16:27:58.876 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 16:27:58.885 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 16:27:58.906 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 16:27:58.917 +02:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 16:27:59.090 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 16:27:59.098 +02:00 [INF] Master database initialized successfully
2025-11-23 16:28:01.237 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 16:28:01.344 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 16:28:01.346 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 16:28:01.434 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 16:28:01.437 +02:00 [INF] Hosting environment: Development
2025-11-23 16:28:01.439 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 16:28:01.492 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 16:28:01.625 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 133.6816ms
2025-11-23 16:28:01.760 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 16:28:01.760 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 16:28:01.770 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 9.6999ms
2025-11-23 16:28:01.786 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 25.2136ms
2025-11-23 16:28:01.827 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 16:28:02.085 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 257.8863ms
2025-11-23 16:28:03.699 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 16:28:03.714 +02:00 [INF] Request started
2025-11-23 16:28:03.716 +02:00 [INF] === Incoming Request ===
2025-11-23 16:28:03.719 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:28:03.720 +02:00 [INF] Method: POST
2025-11-23 16:28:03.721 +02:00 [INF] === Headers ===
2025-11-23 16:28:03.723 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:28:03.725 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:28:03.728 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:28:03.730 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:28:03.732 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:28:03.734 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:28:03.735 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:28:03.738 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:28:03.739 +02:00 [INF] Postman-Token: ["4ea42178-4b2e-423b-a768-b80d5e925ea2"]
2025-11-23 16:28:03.744 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:28:03.747 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:28:03.749 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:28:03.767 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:28:03.774 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 16:28:03.803 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:28:03.899 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 16:28:04.499 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 16:28:04.507 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:28:05.507 +02:00 [INF] Refund saved to database: REF-20251123-00011
2025-11-23 16:28:05.543 +02:00 [INF] Created Debit Note: DN-20251123-00003 for Refund: REF-20251123-00011
2025-11-23 16:28:05.597 +02:00 [INF] PO PO-202510-0001 Calculations: Ordered=10.000, Received=0.000, Returned=8.000, Net=-8.000
2025-11-23 16:28:05.649 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception PartiallyReceived ‚Üí PartiallyReceived, Payment: PaidInFull
2025-11-23 16:28:05.652 +02:00 [INF] Successfully created refund: REF-20251123-00011 from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:28:05.662 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:28:05.686 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 1912.4869ms
2025-11-23 16:28:05.690 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:28:05.693 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:28:05.702 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 200 null application/json; charset=utf-8 2003.294ms
2025-11-23 16:29:01.716 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - application/json 288
2025-11-23 16:29:01.734 +02:00 [INF] Request started
2025-11-23 16:29:01.735 +02:00 [INF] === Incoming Request ===
2025-11-23 16:29:01.737 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:29:01.738 +02:00 [INF] Method: POST
2025-11-23 16:29:01.739 +02:00 [INF] === Headers ===
2025-11-23 16:29:01.740 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:29:01.742 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:29:01.746 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:29:01.747 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:29:01.749 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:29:01.750 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:29:01.752 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:29:01.755 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:29:01.757 +02:00 [INF] Postman-Token: ["9864c79c-b40b-4133-a806-91426ee92712"]
2025-11-23 16:29:01.762 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:29:01.765 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:29:01.766 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:29:01.768 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:29:01.774 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:29:01.785 +02:00 [INF] Creating refund from Purchase Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:29:01.852 +02:00 [INF] Refund saved to database: REF-20251123-00012
2025-11-23 16:29:01.859 +02:00 [INF] Created Debit Note: DN-20251123-00004 for Refund: REF-20251123-00012
2025-11-23 16:29:01.873 +02:00 [INF] PO PO-202510-0001 Calculations: Ordered=10.000, Received=0.000, Returned=9.000, Net=-9.000
2025-11-23 16:29:01.883 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception PartiallyReceived ‚Üí PartiallyReceived, Payment: PaidInFull
2025-11-23 16:29:01.885 +02:00 [INF] Successfully created refund: REF-20251123-00012 from Invoice: "af1aab03-bfc2-4e9d-b992-0105a7527a37"
2025-11-23 16:29:01.888 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:29:01.890 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 118.3415ms
2025-11-23 16:29:01.894 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:29:01.897 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:29:01.899 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=af1aab03-bfc2-4e9d-b992-0105a7527a37 - 200 null application/json; charset=utf-8 183.289ms
2025-11-23 16:39:12.519 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrderRefunds/return?poId=23d49ad7-c8f3-4545-9bb3-6957cdf43515 - application/json 297
2025-11-23 16:39:12.532 +02:00 [INF] Request started
2025-11-23 16:39:12.533 +02:00 [INF] === Incoming Request ===
2025-11-23 16:39:12.535 +02:00 [INF] Path: /api/PurchaseOrderRefunds/return
2025-11-23 16:39:12.536 +02:00 [INF] Method: POST
2025-11-23 16:39:12.538 +02:00 [INF] === Headers ===
2025-11-23 16:39:12.541 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:39:12.543 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:39:12.545 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:39:12.547 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:39:12.550 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:39:12.552 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:39:12.554 +02:00 [INF] Content-Length: ["297"]
2025-11-23 16:39:12.556 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:39:12.560 +02:00 [INF] Postman-Token: ["c0727dbd-9d71-432b-89fb-24ac61d41537"]
2025-11-23 16:39:12.563 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:39:12.564 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:39:12.565 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseOrderRefundsController.CreateRefundFromPO (ModularERP)'
2025-11-23 16:39:12.573 +02:00 [INF] Route matched with {action = "CreateRefundFromPO", controller = "PurchaseOrderRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromPO(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromPOCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseOrderRefundsController (ModularERP).
2025-11-23 16:39:12.583 +02:00 [INF] Creating refund from Purchase Order: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 16:39:12.614 +02:00 [INF] Creating refund from Purchase Order: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 16:39:12.771 +02:00 [INF] Warehouse Stock updated: Product "1455fbe8-d0b2-4615-b998-5b00ed509ab7", Warehouse "e5d0bbaa-9099-43e1-bb16-f9744078a9ea", Old Qty: 99.000, Returned: 1, New Qty: 98.000
2025-11-23 16:39:12.797 +02:00 [WRN] Supplier model does not have Balance property. Skipping balance update.
2025-11-23 16:39:12.798 +02:00 [INF] Created Debit Note: DN-20251123-00005 for Refund: REF-20251123-00013
2025-11-23 16:39:12.800 +02:00 [INF] Successfully created refund: REF-20251123-00013 from PO: PO-202510-0005
2025-11-23 16:39:12.908 +02:00 [INF] PO Status Updated: PO-202510-0005 - Reception: FullyReceived, Payment: Refunded
2025-11-23 16:39:12.987 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:39:12.990 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseOrderRefundsController.CreateRefundFromPO (ModularERP) in 411.4076ms
2025-11-23 16:39:12.992 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseOrderRefundsController.CreateRefundFromPO (ModularERP)'
2025-11-23 16:39:12.994 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:39:12.997 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrderRefunds/return?poId=23d49ad7-c8f3-4545-9bb3-6957cdf43515 - 200 null application/json; charset=utf-8 478.0928ms
2025-11-23 16:41:03.487 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - application/json 288
2025-11-23 16:41:03.492 +02:00 [INF] Request started
2025-11-23 16:41:03.493 +02:00 [INF] === Incoming Request ===
2025-11-23 16:41:03.494 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:41:03.497 +02:00 [INF] Method: POST
2025-11-23 16:41:03.499 +02:00 [INF] === Headers ===
2025-11-23 16:41:03.500 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:41:03.502 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:41:03.505 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:41:03.508 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:41:03.510 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:41:03.513 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:41:03.514 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:41:03.517 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:41:03.519 +02:00 [INF] Postman-Token: ["26875684-2191-4882-a451-3302e678712d"]
2025-11-23 16:41:03.521 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:41:03.522 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:41:03.523 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:41:03.525 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:41:03.529 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 16:41:03.541 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 16:41:03.593 +02:00 [INF] Refund saved to database: REF-20251123-00014
2025-11-23 16:41:03.599 +02:00 [INF] Created Debit Note: DN-20251123-00006 for Refund: REF-20251123-00014
2025-11-23 16:41:03.613 +02:00 [INF] PO PO-202510-0001 Calculations: Ordered=10.000, Received=0.000, Returned=9.000, Net=-9.000
2025-11-23 16:41:03.623 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception PartiallyReceived ‚Üí PartiallyReceived, Payment: Refunded
2025-11-23 16:41:03.625 +02:00 [INF] Successfully created refund: REF-20251123-00014 from Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 16:41:03.627 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:41:03.630 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 100.9717ms
2025-11-23 16:41:03.633 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:41:03.636 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:41:03.637 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - 200 null application/json; charset=utf-8 150.2037ms
2025-11-23 16:42:40.905 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - application/json 288
2025-11-23 16:42:40.910 +02:00 [INF] Request started
2025-11-23 16:42:40.912 +02:00 [INF] === Incoming Request ===
2025-11-23 16:42:40.916 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:42:40.917 +02:00 [INF] Method: POST
2025-11-23 16:42:40.920 +02:00 [INF] === Headers ===
2025-11-23 16:42:40.922 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:42:40.923 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:42:40.927 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:42:40.929 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:42:40.930 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:42:40.933 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:42:40.937 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:42:40.939 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:42:40.941 +02:00 [INF] Postman-Token: ["dbc36766-7389-4728-9e4f-1727db39383b"]
2025-11-23 16:42:40.946 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:42:40.947 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:42:40.949 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:42:40.951 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:42:40.957 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 16:42:40.961 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 16:42:41.013 +02:00 [INF] Refund saved to database: REF-20251123-00015
2025-11-23 16:42:41.019 +02:00 [INF] Created Debit Note: DN-20251123-00007 for Refund: REF-20251123-00015
2025-11-23 16:42:41.032 +02:00 [INF] PO PO-202510-0001 Calculations: Ordered=10.000, Received=0.000, Returned=10.000, Net=-10.000
2025-11-23 16:42:41.040 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception PartiallyReceived ‚Üí PartiallyReceived, Payment: Refunded
2025-11-23 16:42:41.044 +02:00 [INF] Successfully created refund: REF-20251123-00015 from Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 16:42:41.046 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:42:41.048 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 91.8992ms
2025-11-23 16:42:41.052 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:42:41.055 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:42:41.056 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - 200 null application/json; charset=utf-8 150.8789ms
2025-11-23 16:46:47.382 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoice - application/json 590
2025-11-23 16:46:47.385 +02:00 [INF] Request started
2025-11-23 16:46:47.386 +02:00 [INF] === Incoming Request ===
2025-11-23 16:46:47.388 +02:00 [INF] Path: /api/PurchaseInvoice
2025-11-23 16:46:47.389 +02:00 [INF] Method: POST
2025-11-23 16:46:47.391 +02:00 [INF] === Headers ===
2025-11-23 16:46:47.394 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:46:47.395 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:46:47.397 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:46:47.398 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:46:47.400 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:46:47.403 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:46:47.408 +02:00 [INF] Content-Length: ["590"]
2025-11-23 16:46:47.410 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:46:47.411 +02:00 [INF] Postman-Token: ["38687ecc-26b2-4e1f-b26b-5e0bff97a744"]
2025-11-23 16:46:47.415 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:46:47.416 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:46:47.417 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PurchaseInvoiceController.CreateInvoice (ModularERP)'
2025-11-23 16:46:47.427 +02:00 [INF] Route matched with {action = "CreateInvoice", controller = "PurchaseInvoice"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_Invoice.PurchaseInvoiceDto]]] CreateInvoice(ModularERP.Modules.Purchases.Invoicing.Commends.Commands_Invoice.CreatePurchaseInvoiceCommand, System.Threading.CancellationToken) on controller ModularERP.Modules.Purchases.Invoicing.Controllers.PurchaseInvoiceController (ModularERP).
2025-11-23 16:46:47.449 +02:00 [INF] Creating purchase invoice for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 16:46:47.487 +02:00 [INF] Starting creation of purchase invoice for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 16:46:47.544 +02:00 [INF] Purchase invoice created: "711ec9dc-2511-4b74-bf26-ef4549616d82", Number: INV-202511-0004
2025-11-23 16:46:47.582 +02:00 [INF] Created 1 line items for invoice: "711ec9dc-2511-4b74-bf26-ef4549616d82"
2025-11-23 16:46:47.601 +02:00 [INF] Updated PO "23d49ad7-c8f3-4545-9bb3-6957cdf43515" payment status to: PartiallyPaid
2025-11-23 16:46:47.656 +02:00 [INF] Successfully created purchase invoice: "711ec9dc-2511-4b74-bf26-ef4549616d82"
2025-11-23 16:46:47.659 +02:00 [INF] Purchase invoice created successfully: "711ec9dc-2511-4b74-bf26-ef4549616d82"
2025-11-23 16:46:47.668 +02:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Invoicing.DTO.DTO_Invoice.PurchaseInvoiceDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:46:47.698 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Invoicing.Controllers.PurchaseInvoiceController.CreateInvoice (ModularERP) in 266.8483ms
2025-11-23 16:46:47.702 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Invoicing.Controllers.PurchaseInvoiceController.CreateInvoice (ModularERP)'
2025-11-23 16:46:47.705 +02:00 [INF] Request completed successfully with status code 201
2025-11-23 16:46:47.706 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoice - 201 null application/json; charset=utf-8 324.0666ms
2025-11-23 16:47:11.740 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=711ec9dc-2511-4b74-bf26-ef4549616d82 - application/json 288
2025-11-23 16:47:11.749 +02:00 [INF] Request started
2025-11-23 16:47:11.751 +02:00 [INF] === Incoming Request ===
2025-11-23 16:47:11.752 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 16:47:11.753 +02:00 [INF] Method: POST
2025-11-23 16:47:11.755 +02:00 [INF] === Headers ===
2025-11-23 16:47:11.756 +02:00 [INF] Accept: ["*/*"]
2025-11-23 16:47:11.760 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 16:47:11.761 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 16:47:11.764 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 16:47:11.766 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 16:47:11.769 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 16:47:11.771 +02:00 [INF] Content-Length: ["288"]
2025-11-23 16:47:11.773 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 16:47:11.775 +02:00 [INF] Postman-Token: ["60694943-50ef-4aa2-a8b8-bfebe0a74b72"]
2025-11-23 16:47:11.776 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 16:47:11.779 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 16:47:11.782 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:47:11.783 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 16:47:11.788 +02:00 [INF] Creating refund from Purchase Invoice: "711ec9dc-2511-4b74-bf26-ef4549616d82"
2025-11-23 16:47:11.792 +02:00 [INF] Creating refund from Purchase Invoice: "711ec9dc-2511-4b74-bf26-ef4549616d82"
2025-11-23 16:47:11.863 +02:00 [INF] Refund saved to database: REF-20251123-00016
2025-11-23 16:47:11.872 +02:00 [INF] Created Debit Note: DN-20251123-00008 for Refund: REF-20251123-00016
2025-11-23 16:47:11.887 +02:00 [INF] PO PO-202510-0005 Calculations: Ordered=10.000, Received=18.000, Returned=5.000, Net=13.000
2025-11-23 16:47:11.896 +02:00 [INF] Updated PO PO-202510-0005 statuses: Reception FullyReceived ‚Üí FullyReceived, Payment: Refunded
2025-11-23 16:47:11.900 +02:00 [INF] Successfully created refund: REF-20251123-00016 from Invoice: "711ec9dc-2511-4b74-bf26-ef4549616d82"
2025-11-23 16:47:11.902 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 16:47:11.904 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 116.9795ms
2025-11-23 16:47:11.906 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 16:47:11.907 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 16:47:11.910 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=711ec9dc-2511-4b74-bf26-ef4549616d82 - 200 null application/json; charset=utf-8 170.7769ms
2025-11-23 18:02:49.366 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Tenants/create - application/json 61
2025-11-23 18:02:49.378 +02:00 [INF] Request started
2025-11-23 18:02:49.382 +02:00 [INF] === Incoming Request ===
2025-11-23 18:02:49.384 +02:00 [INF] Path: /api/Tenants/create
2025-11-23 18:02:49.397 +02:00 [INF] Method: POST
2025-11-23 18:02:49.406 +02:00 [INF] === Headers ===
2025-11-23 18:02:49.409 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:02:49.411 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:02:49.414 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:02:49.415 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:02:49.419 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:02:49.421 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:02:49.422 +02:00 [INF] Content-Length: ["61"]
2025-11-23 18:02:49.424 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:02:49.426 +02:00 [INF] Postman-Token: ["c819eebe-d191-4654-8702-d34d200cacf9"]
2025-11-23 18:02:49.431 +02:00 [INF] Executing endpoint 'ModularERP.Common.Controller.TenantsController.CreateTenant (ModularERP)'
2025-11-23 18:02:49.435 +02:00 [INF] Route matched with {action = "CreateTenant", controller = "Tenants"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateTenant(ModularERP.Common.Controller.CreateTenantRequest) on controller ModularERP.Common.Controller.TenantsController (ModularERP).
2025-11-23 18:02:49.537 +02:00 [INF] Executed DbCommand (25ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = DateTime2), @p2='?' (Size = 3), @p3='?' (Size = 4000), @p4='?' (Size = 100), @p5='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [MasterCompanies] ([Id], [CreatedAt], [CurrencyCode], [DatabaseName], [Name], [Status])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-11-23 18:02:49.544 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 18:02:53.093 +02:00 [INF] Applied 11 migrations to database ModularERP_Tenant_43ae70c33d2445f48d81f2de8da4bd0f
2025-11-23 18:02:53.096 +02:00 [INF] Created tenant database for company "e2df7064-dda2-4036-b7b7-15df2cef885f": ModularERP_Tenant_43ae70c33d2445f48d81f2de8da4bd0f
2025-11-23 18:02:53.099 +02:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType1`5[[System.Guid, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.DateTime, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-23 18:02:53.104 +02:00 [INF] Executed action ModularERP.Common.Controller.TenantsController.CreateTenant (ModularERP) in 3665.1624ms
2025-11-23 18:02:53.105 +02:00 [INF] Executed endpoint 'ModularERP.Common.Controller.TenantsController.CreateTenant (ModularERP)'
2025-11-23 18:02:53.107 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 18:02:53.108 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Tenants/create - 200 null application/json; charset=utf-8 3741.978ms
2025-11-23 18:14:02.076 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - application/json 288
2025-11-23 18:14:02.081 +02:00 [INF] Request started
2025-11-23 18:14:02.083 +02:00 [INF] === Incoming Request ===
2025-11-23 18:14:02.086 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 18:14:02.088 +02:00 [INF] Method: POST
2025-11-23 18:14:02.092 +02:00 [INF] === Headers ===
2025-11-23 18:14:02.094 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:14:02.098 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:14:02.100 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:14:02.102 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:14:02.104 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:14:02.107 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:14:02.110 +02:00 [INF] Content-Length: ["288"]
2025-11-23 18:14:02.112 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:14:02.115 +02:00 [INF] Postman-Token: ["065b4b1d-6aeb-4e85-83f4-14d7135c4d7e"]
2025-11-23 18:14:02.117 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:14:02.118 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:14:02.119 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:14:02.121 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 18:14:02.127 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:14:02.142 +02:00 [INF] Executed DbCommand (7ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 18:14:02.148 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:14:02.206 +02:00 [ERR] Error creating refund from Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
ModularERP.Common.Exceptions.BusinessLogicException: Return quantity (1) exceeds available quantity (0.000) for product  Product
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 134
2025-11-23 18:14:02.267 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 140.4764ms
2025-11-23 18:14:02.276 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:14:02.280 +02:00 [WRN] Business logic exception occurred: Return quantity (1) exceeds available quantity (0.000) for product  Product
ModularERP.Common.Exceptions.BusinessLogicException: Return quantity (1) exceeds available quantity (0.000) for product  Product
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 134
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice(Guid invoiceId, CreateRefundFromInvoiceCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Controllers\PurchaseInvoiceRefundsController.cs:line 43
   at lambda_method118(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:14:02.318 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:14:02.320 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - 400 null application/json; charset=utf-8 244.4804ms
2025-11-23 18:14:15.712 +02:00 [INF] Starting web host...
2025-11-23 18:14:19.222 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 18:14:19.282 +02:00 [INF] Executed DbCommand (44ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 18:14:19.365 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 18:14:19.371 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 18:14:19.384 +02:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 18:14:19.445 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 18:14:19.467 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 18:14:19.472 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 18:14:19.482 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 18:14:19.492 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 18:14:19.500 +02:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 18:14:19.661 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 18:14:19.672 +02:00 [INF] Master database initialized successfully
2025-11-23 18:14:21.762 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 18:14:21.932 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 18:14:21.935 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 18:14:22.067 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 18:14:22.115 +02:00 [INF] Hosting environment: Development
2025-11-23 18:14:22.126 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 18:14:22.383 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 18:14:22.553 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 171.6704ms
2025-11-23 18:14:22.562 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 18:14:22.562 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 18:14:22.576 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 13.4704ms
2025-11-23 18:14:22.610 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 47.6739ms
2025-11-23 18:14:22.675 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 18:14:22.982 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 307.0134ms
2025-11-23 18:14:30.836 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - application/json 288
2025-11-23 18:14:30.853 +02:00 [INF] Request started
2025-11-23 18:14:30.857 +02:00 [INF] === Incoming Request ===
2025-11-23 18:14:30.859 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 18:14:30.860 +02:00 [INF] Method: POST
2025-11-23 18:14:30.861 +02:00 [INF] === Headers ===
2025-11-23 18:14:30.865 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:14:30.868 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:14:30.871 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:14:30.873 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:14:30.875 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:14:30.876 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:14:30.877 +02:00 [INF] Content-Length: ["288"]
2025-11-23 18:14:30.880 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:14:30.882 +02:00 [INF] Postman-Token: ["d031700f-876a-4426-8b41-9c794075a2b1"]
2025-11-23 18:14:30.887 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:14:30.888 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:14:30.889 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:14:30.904 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 18:14:30.909 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 18:14:30.941 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:14:31.030 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 18:14:31.618 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 18:14:31.703 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:14:32.169 +02:00 [ERR] Error creating refund from Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
ModularERP.Common.Exceptions.BusinessLogicException: Return quantity (1) exceeds available quantity (0.000) for product  Product
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 134
2025-11-23 18:14:32.183 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 1274.0767ms
2025-11-23 18:14:32.186 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:14:32.189 +02:00 [WRN] Business logic exception occurred: Return quantity (1) exceeds available quantity (0.000) for product  Product
ModularERP.Common.Exceptions.BusinessLogicException: Return quantity (1) exceeds available quantity (0.000) for product  Product
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 134
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice(Guid invoiceId, CreateRefundFromInvoiceCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Controllers\PurchaseInvoiceRefundsController.cs:line 43
   at lambda_method118(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:14:32.221 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:14:32.226 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - 400 null application/json; charset=utf-8 1390.6366ms
2025-11-23 18:15:05.501 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - application/json 288
2025-11-23 18:15:05.518 +02:00 [INF] Request started
2025-11-23 18:15:05.520 +02:00 [INF] === Incoming Request ===
2025-11-23 18:15:05.521 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 18:15:05.523 +02:00 [INF] Method: POST
2025-11-23 18:15:05.524 +02:00 [INF] === Headers ===
2025-11-23 18:15:05.525 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:15:05.526 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:15:05.527 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:15:05.529 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:15:05.530 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:15:05.531 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:15:05.533 +02:00 [INF] Content-Length: ["288"]
2025-11-23 18:15:05.534 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:15:05.537 +02:00 [INF] Postman-Token: ["f0b1630d-a777-488f-9aef-f9bd27cd8dcc"]
2025-11-23 18:15:05.540 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:15:05.541 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:15:05.542 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:15:05.544 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 18:15:05.547 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:15:05.553 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:15:05.597 +02:00 [ERR] Error creating refund from Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
ModularERP.Common.Exceptions.BusinessLogicException: Return quantity (1) exceeds available quantity (0.000) for product  Product
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 134
2025-11-23 18:15:05.600 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 53.7188ms
2025-11-23 18:15:05.601 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:15:05.603 +02:00 [WRN] Business logic exception occurred: Return quantity (1) exceeds available quantity (0.000) for product  Product
ModularERP.Common.Exceptions.BusinessLogicException: Return quantity (1) exceeds available quantity (0.000) for product  Product
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 134
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice(Guid invoiceId, CreateRefundFromInvoiceCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Controllers\PurchaseInvoiceRefundsController.cs:line 43
   at lambda_method118(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:15:05.616 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:15:05.617 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - 400 null application/json; charset=utf-8 116.1855ms
2025-11-23 18:16:11.009 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/7e24b170-0fd2-4461-c5dd-08de25d935fb/items - application/json 215
2025-11-23 18:16:11.016 +02:00 [INF] Request started
2025-11-23 18:16:11.018 +02:00 [INF] === Incoming Request ===
2025-11-23 18:16:11.020 +02:00 [INF] Path: /api/goods-receipts/7e24b170-0fd2-4461-c5dd-08de25d935fb/items
2025-11-23 18:16:11.021 +02:00 [INF] Method: POST
2025-11-23 18:16:11.023 +02:00 [INF] === Headers ===
2025-11-23 18:16:11.024 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:16:11.025 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:16:11.026 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:16:11.029 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:16:11.031 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:16:11.033 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:16:11.035 +02:00 [INF] Content-Length: ["215"]
2025-11-23 18:16:11.036 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:16:11.038 +02:00 [INF] Postman-Token: ["0c3e8245-6018-46e0-8c02-78328d1936c7"]
2025-11-23 18:16:11.040 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:16:11.041 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:16:11.043 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 18:16:11.053 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 18:16:11.060 +02:00 [INF] Adding item to GRN "7e24b170-0fd2-4461-c5dd-08de25d935fb"
2025-11-23 18:16:11.081 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "7e24b170-0fd2-4461-c5dd-08de25d935fb" | POLineItemId: "b9d99ef5-ecd2-452b-4f82-08de25d684bd" | Qty: 1
2025-11-23 18:16:11.106 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00003 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 18:16:11.124 +02:00 [INF] ‚úÖ POLineItem found | Item: ' Product' | Ordered: 5.000 | Received: 5.000 | Remaining: 0.000
2025-11-23 18:16:11.130 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 73.2766ms
2025-11-23 18:16:11.132 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 18:16:11.134 +02:00 [WRN] Business logic exception occurred: Cannot receive ' Product'. Already fully received
ModularERP.Common.Exceptions.BusinessLogicException: Cannot receive ' Product'. Already fully received
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 141
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 273
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem(Guid id, AddGRNItemCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GRNItemsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:16:11.154 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:16:11.155 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/7e24b170-0fd2-4461-c5dd-08de25d935fb/items - 400 null application/json; charset=utf-8 146.8466ms
2025-11-23 18:16:39.186 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - application/json 514
2025-11-23 18:16:39.190 +02:00 [INF] Request started
2025-11-23 18:16:39.191 +02:00 [INF] === Incoming Request ===
2025-11-23 18:16:39.192 +02:00 [INF] Path: /api/GoodsReceipts
2025-11-23 18:16:39.194 +02:00 [INF] Method: POST
2025-11-23 18:16:39.195 +02:00 [INF] === Headers ===
2025-11-23 18:16:39.196 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:16:39.198 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:16:39.200 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:16:39.202 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:16:39.203 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:16:39.204 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:16:39.206 +02:00 [INF] Content-Length: ["514"]
2025-11-23 18:16:39.208 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:16:39.210 +02:00 [INF] Postman-Token: ["983b2c5d-6861-434d-b21a-321230b6fce4"]
2025-11-23 18:16:39.212 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:16:39.213 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:16:39.215 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:16:39.219 +02:00 [INF] Route matched with {action = "CreateGRN", controller = "GoodsReceipts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGRN(ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.CreateGRNDto, System.Threading.CancellationToken) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController (ModularERP).
2025-11-23 18:16:39.234 +02:00 [INF] API: Creating new GRN for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:16:39.257 +02:00 [INF] Creating new GRN for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:16:39.265 +02:00 [INF] PO found: PO-202510-0005 | DocumentStatus: Approved | ReceptionStatus: FullyReceived
2025-11-23 18:16:39.327 +02:00 [INF] Validating | POLineItemId: "b9d99ef5-ecd2-452b-4f82-08de25d684bd" | Item: ' Product' | Ordered: 5.000 | Received: 5.000 | Pending: 0.000 | Attempting: 1
2025-11-23 18:16:39.330 +02:00 [ERR] ‚ùå Error creating GRN. Transaction rolled back. PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot receive ' Product'. Already fully received.
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 168
2025-11-23 18:16:39.338 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP) in 116.3112ms
2025-11-23 18:16:39.340 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:16:39.342 +02:00 [WRN] Business logic exception occurred: Cannot receive ' Product'. Already fully received.
ModularERP.Common.Exceptions.BusinessLogicException: Cannot receive ' Product'. Already fully received.
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 168
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 332
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN(CreateGRNDto request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GoodsReceiptsController.cs:line 35
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:16:39.353 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:16:39.355 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - 400 null application/json; charset=utf-8 168.9399ms
2025-11-23 18:17:12.709 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products - application/json 925
2025-11-23 18:17:12.714 +02:00 [INF] Request started
2025-11-23 18:17:12.715 +02:00 [INF] === Incoming Request ===
2025-11-23 18:17:12.716 +02:00 [INF] Path: /api/Products
2025-11-23 18:17:12.717 +02:00 [INF] Method: POST
2025-11-23 18:17:12.718 +02:00 [INF] === Headers ===
2025-11-23 18:17:12.719 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:17:12.720 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:17:12.722 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:17:12.723 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:17:12.724 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:17:12.726 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:17:12.728 +02:00 [INF] Content-Length: ["925"]
2025-11-23 18:17:12.729 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:17:12.731 +02:00 [INF] Postman-Token: ["6c4931e9-77b9-439c-95ab-36405689d9c5"]
2025-11-23 18:17:12.733 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:17:12.734 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:17:12.735 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-11-23 18:17:12.743 +02:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(ModularERP.Modules.Inventory.Features.Products.DTO.CreateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-11-23 18:17:12.774 +02:00 [INF] Creating new product with SKU SKU-106 for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-11-23 18:17:12.816 +02:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP) in 68.9286ms
2025-11-23 18:17:12.818 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-11-23 18:17:12.820 +02:00 [WRN] Validation exception occurred: Product validation failed. Validation errors: {"SKU":["SKU already exists for this company"],"Barcode":["Barcode already exists for this company"]}
ModularERP.Common.Exceptions.ValidationException: Product validation failed
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.CreateProductCommandHandler.ValidateProduct(CreateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\CreateProductCommandHandler.cs:line 181
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.CreateProductCommandHandler.Handle(CreateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\CreateProductCommandHandler.cs:line 61
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct(CreateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 74
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:17:12.846 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:17:12.849 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products - 400 null application/json; charset=utf-8 139.336ms
2025-11-23 18:17:24.101 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products - application/json 925
2025-11-23 18:17:24.104 +02:00 [INF] Request started
2025-11-23 18:17:24.105 +02:00 [INF] === Incoming Request ===
2025-11-23 18:17:24.106 +02:00 [INF] Path: /api/Products
2025-11-23 18:17:24.107 +02:00 [INF] Method: POST
2025-11-23 18:17:24.109 +02:00 [INF] === Headers ===
2025-11-23 18:17:24.110 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:17:24.112 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:17:24.113 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:17:24.116 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:17:24.117 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:17:24.118 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:17:24.120 +02:00 [INF] Content-Length: ["925"]
2025-11-23 18:17:24.121 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:17:24.122 +02:00 [INF] Postman-Token: ["1da1aa6a-25c9-487b-b2cd-a82078cf8920"]
2025-11-23 18:17:24.124 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:17:24.126 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:17:24.127 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-11-23 18:17:24.128 +02:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(ModularERP.Modules.Inventory.Features.Products.DTO.CreateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-11-23 18:17:24.131 +02:00 [INF] Creating new product with SKU SKU-107 for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-11-23 18:17:24.139 +02:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP) in 8.231ms
2025-11-23 18:17:24.142 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-11-23 18:17:24.143 +02:00 [WRN] Validation exception occurred: Product validation failed. Validation errors: {"Barcode":["Barcode already exists for this company"]}
ModularERP.Common.Exceptions.ValidationException: Product validation failed
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.CreateProductCommandHandler.ValidateProduct(CreateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\CreateProductCommandHandler.cs:line 181
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.CreateProductCommandHandler.Handle(CreateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\CreateProductCommandHandler.cs:line 61
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct(CreateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 74
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:17:24.156 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:17:24.157 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products - 400 null application/json; charset=utf-8 56.1681ms
2025-11-23 18:17:33.313 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products - application/json 925
2025-11-23 18:17:33.316 +02:00 [INF] Request started
2025-11-23 18:17:33.316 +02:00 [INF] === Incoming Request ===
2025-11-23 18:17:33.317 +02:00 [INF] Path: /api/Products
2025-11-23 18:17:33.318 +02:00 [INF] Method: POST
2025-11-23 18:17:33.319 +02:00 [INF] === Headers ===
2025-11-23 18:17:33.320 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:17:33.322 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:17:33.323 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:17:33.325 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:17:33.327 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:17:33.328 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:17:33.330 +02:00 [INF] Content-Length: ["925"]
2025-11-23 18:17:33.331 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:17:33.332 +02:00 [INF] Postman-Token: ["c62a13ad-6b32-4c20-9057-4723eab4160c"]
2025-11-23 18:17:33.334 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:17:33.335 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:17:33.336 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-11-23 18:17:33.338 +02:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(ModularERP.Modules.Inventory.Features.Products.DTO.CreateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-11-23 18:17:33.341 +02:00 [INF] Creating new product with SKU SKU-107 for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-11-23 18:17:33.802 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 18:17:33.816 +02:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP) in 475.8982ms
2025-11-23 18:17:33.818 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-11-23 18:17:33.820 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 18:17:33.821 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products - 200 null application/json; charset=utf-8 508.8178ms
2025-11-23 18:17:46.766 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{23d49ad7-c8f3-4545-9bb3-6957cdf43515}/items - application/json 306
2025-11-23 18:17:46.771 +02:00 [INF] Request started
2025-11-23 18:17:46.771 +02:00 [INF] === Incoming Request ===
2025-11-23 18:17:46.772 +02:00 [INF] Path: /api/purchase-orders/%7B23d49ad7-c8f3-4545-9bb3-6957cdf43515%7D/items
2025-11-23 18:17:46.773 +02:00 [INF] Method: POST
2025-11-23 18:17:46.774 +02:00 [INF] === Headers ===
2025-11-23 18:17:46.775 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:17:46.776 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:17:46.778 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:17:46.779 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:17:46.780 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:17:46.782 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:17:46.784 +02:00 [INF] Content-Length: ["306"]
2025-11-23 18:17:46.786 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:17:46.787 +02:00 [INF] Postman-Token: ["c1d4ee7f-25c0-4729-a255-f41328cd9d3f"]
2025-11-23 18:17:46.789 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:17:46.790 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:17:46.791 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:17:46.800 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 18:17:46.815 +02:00 [INF] POST request received to create line item for PO "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:17:46.826 +02:00 [INF] Creating line item for Purchase Order "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:17:46.837 +02:00 [ERR] Error creating line item for Purchase Order "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
2025-11-23 18:17:46.841 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 35.4598ms
2025-11-23 18:17:46.842 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:17:46.843 +02:00 [WRN] Business logic exception occurred: Cannot add items to Purchase Order in Approved status
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem(Guid purchaseOrderId, CreatePOLineItemDto lineItem) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\POLineItemController.cs:line 104
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:17:46.856 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:17:46.857 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{23d49ad7-c8f3-4545-9bb3-6957cdf43515}/items - 400 null application/json; charset=utf-8 91.9241ms
2025-11-23 18:17:57.839 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - multipart/form-data; boundary=--------------------------648814641230080477295488 4075
2025-11-23 18:17:57.842 +02:00 [INF] Request started
2025-11-23 18:17:57.843 +02:00 [INF] === Incoming Request ===
2025-11-23 18:17:57.844 +02:00 [INF] Path: /api/PurchaseOrder
2025-11-23 18:17:57.845 +02:00 [INF] Method: POST
2025-11-23 18:17:57.846 +02:00 [INF] === Headers ===
2025-11-23 18:17:57.847 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:17:57.848 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:17:57.850 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:17:57.852 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:17:57.853 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:17:57.854 +02:00 [INF] Content-Type: ["multipart/form-data; boundary=--------------------------648814641230080477295488"]
2025-11-23 18:17:57.856 +02:00 [INF] Content-Length: ["4075"]
2025-11-23 18:17:57.857 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:17:57.859 +02:00 [INF] Postman-Token: ["07cd8e38-f3e8-4d27-a5d0-6da273c8a74e"]
2025-11-23 18:17:57.860 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:17:57.861 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:17:57.863 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-23 18:17:57.871 +02:00 [INF] Route matched with {action = "CreatePurchaseOrder", controller = "PurchaseOrder"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreatePurchaseOrder(ModularERP.Modules.Purchases.Purchase_Order_Management.Commends.Commends_PurchaseOrder.CreatePurchaseOrderCommand) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController (ModularERP).
2025-11-23 18:17:57.962 +02:00 [INF] Creating purchase order for Company: "90137c92-382d-404c-bade-e5fefb1e8dbf", Supplier: "b4c57f6f-47c9-43d1-8021-0ff57a3b4e79"
2025-11-23 18:17:58.036 +02:00 [INF] Starting PO amount calculations
2025-11-23 18:17:58.037 +02:00 [INF] Line Items Summary - Gross: 20, Net: 18.0, Tax: 2.700
2025-11-23 18:17:58.039 +02:00 [INF] After PO Discount - Discount: 0.900, Net: 17.100
2025-11-23 18:17:58.040 +02:00 [INF] Adjustments Total: 10
2025-11-23 18:17:58.041 +02:00 [INF] Shipping Summary - Fee: 50, Tax: 7.50
2025-11-23 18:17:58.042 +02:00 [INF] Grand Total Calculation: Net=17.100 + Adj=10 + Ship=50 + Tax=10.200 = 87.300
2025-11-23 18:17:58.044 +02:00 [WRN] ‚ö†Ô∏è Deposit Mismatch: Provided Amount=87.20, Calculated from 50%=43.6500. Using calculated value.
2025-11-23 18:17:58.046 +02:00 [INF] Total Deposit Amount: 43.6500
2025-11-23 18:17:58.047 +02:00 [INF] Amount Due: 87.300 - 43.6500 = 43.6500
2025-11-23 18:17:58.049 +02:00 [INF] ‚úÖ Final Calculations Complete - Subtotal: 20, Discount: 0.900, Adjustment: 10, Shipping: 50, Tax: 10.200, Total: 87.300, Deposit: 43.6500, Due: 43.6500
2025-11-23 18:17:58.095 +02:00 [INF] Purchase Order created with ID: "c9fe6356-33a0-4702-9163-c600c1acc33a", Number: PO-202511-0001
2025-11-23 18:17:58.304 +02:00 [INF] Purchase Order PO-202511-0001 created successfully
2025-11-23 18:17:58.307 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_PurchaseOrder.CreatePurchaseOrderDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 18:17:58.318 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP) in 443.7373ms
2025-11-23 18:17:58.321 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.PurchaseOrderController.CreatePurchaseOrder (ModularERP)'
2025-11-23 18:17:58.323 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 18:17:58.324 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseOrder - 200 null application/json; charset=utf-8 484.3136ms
2025-11-23 18:18:10.573 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{23d49ad7-c8f3-4545-9bb3-6957cdf43515}/items - application/json 306
2025-11-23 18:18:10.578 +02:00 [INF] Request started
2025-11-23 18:18:10.579 +02:00 [INF] === Incoming Request ===
2025-11-23 18:18:10.580 +02:00 [INF] Path: /api/purchase-orders/%7B23d49ad7-c8f3-4545-9bb3-6957cdf43515%7D/items
2025-11-23 18:18:10.581 +02:00 [INF] Method: POST
2025-11-23 18:18:10.582 +02:00 [INF] === Headers ===
2025-11-23 18:18:10.583 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:18:10.584 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:18:10.586 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:18:10.587 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:18:10.589 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:18:10.591 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:18:10.593 +02:00 [INF] Content-Length: ["306"]
2025-11-23 18:18:10.594 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:18:10.595 +02:00 [INF] Postman-Token: ["52938b5f-b625-4fd7-9df3-f1695599a01b"]
2025-11-23 18:18:10.597 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:18:10.598 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:18:10.600 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:18:10.601 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 18:18:10.604 +02:00 [INF] POST request received to create line item for PO "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:18:10.606 +02:00 [INF] Creating line item for Purchase Order "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:18:10.612 +02:00 [ERR] Error creating line item for Purchase Order "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
2025-11-23 18:18:10.616 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 12.1882ms
2025-11-23 18:18:10.617 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:18:10.619 +02:00 [WRN] Business logic exception occurred: Cannot add items to Purchase Order in Approved status
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem(Guid purchaseOrderId, CreatePOLineItemDto lineItem) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\POLineItemController.cs:line 104
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:18:10.630 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:18:10.631 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{23d49ad7-c8f3-4545-9bb3-6957cdf43515}/items - 400 null application/json; charset=utf-8 58.4302ms
2025-11-23 18:18:29.283 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9fe6356-33a0-4702-9163-c600c1acc33a}/items - application/json 306
2025-11-23 18:18:29.288 +02:00 [INF] Request started
2025-11-23 18:18:29.289 +02:00 [INF] === Incoming Request ===
2025-11-23 18:18:29.291 +02:00 [INF] Path: /api/purchase-orders/%7Bc9fe6356-33a0-4702-9163-c600c1acc33a%7D/items
2025-11-23 18:18:29.292 +02:00 [INF] Method: POST
2025-11-23 18:18:29.293 +02:00 [INF] === Headers ===
2025-11-23 18:18:29.295 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:18:29.296 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:18:29.297 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:18:29.298 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:18:29.300 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:18:29.301 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:18:29.303 +02:00 [INF] Content-Length: ["306"]
2025-11-23 18:18:29.304 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:18:29.306 +02:00 [INF] Postman-Token: ["fb6dcb83-a37c-4072-81ac-b78503c755ed"]
2025-11-23 18:18:29.308 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:18:29.309 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:18:29.310 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:18:29.312 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 18:18:29.314 +02:00 [INF] POST request received to create line item for PO "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:18:29.318 +02:00 [INF] Creating line item for Purchase Order "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:18:29.394 +02:00 [INF] Line item "4a06bf9b-14b1-4550-bad0-08de2aabddbb" created successfully for PO "c9fe6356-33a0-4702-9163-c600c1acc33a". Subtotal: 75000, Discount: 7500.0, Tax: 10125.0000, Total: 77625.0000
2025-11-23 18:18:29.426 +02:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.POLineItemResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 18:18:29.443 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 129.3536ms
2025-11-23 18:18:29.446 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:18:29.447 +02:00 [INF] Request completed successfully with status code 201
2025-11-23 18:18:29.448 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9fe6356-33a0-4702-9163-c600c1acc33a}/items - 201 null application/json; charset=utf-8 165.0187ms
2025-11-23 18:18:42.242 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - application/json 514
2025-11-23 18:18:42.245 +02:00 [INF] Request started
2025-11-23 18:18:42.247 +02:00 [INF] === Incoming Request ===
2025-11-23 18:18:42.249 +02:00 [INF] Path: /api/GoodsReceipts
2025-11-23 18:18:42.250 +02:00 [INF] Method: POST
2025-11-23 18:18:42.250 +02:00 [INF] === Headers ===
2025-11-23 18:18:42.252 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:18:42.253 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:18:42.255 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:18:42.257 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:18:42.259 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:18:42.260 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:18:42.261 +02:00 [INF] Content-Length: ["514"]
2025-11-23 18:18:42.263 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:18:42.264 +02:00 [INF] Postman-Token: ["f8ba71fd-1fe9-4317-bab5-1494fde3017a"]
2025-11-23 18:18:42.266 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:18:42.267 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:18:42.268 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:18:42.270 +02:00 [INF] Route matched with {action = "CreateGRN", controller = "GoodsReceipts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGRN(ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.CreateGRNDto, System.Threading.CancellationToken) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController (ModularERP).
2025-11-23 18:18:42.273 +02:00 [INF] API: Creating new GRN for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:18:42.278 +02:00 [INF] Creating new GRN for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:18:42.283 +02:00 [INF] PO found: PO-202510-0005 | DocumentStatus: Approved | ReceptionStatus: FullyReceived
2025-11-23 18:18:42.295 +02:00 [ERR] ‚ùå Error creating GRN. Transaction rolled back. PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
ModularERP.Common.Exceptions.BusinessLogicException: Line items 4a06bf9b-14b1-4550-bad0-08de2aabddbb do not belong to Purchase Order 23d49ad7-c8f3-4545-9bb3-6957cdf43515
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 137
2025-11-23 18:18:42.298 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP) in 26.012ms
2025-11-23 18:18:42.300 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:18:42.303 +02:00 [WRN] Business logic exception occurred: Line items 4a06bf9b-14b1-4550-bad0-08de2aabddbb do not belong to Purchase Order 23d49ad7-c8f3-4545-9bb3-6957cdf43515
ModularERP.Common.Exceptions.BusinessLogicException: Line items 4a06bf9b-14b1-4550-bad0-08de2aabddbb do not belong to Purchase Order 23d49ad7-c8f3-4545-9bb3-6957cdf43515
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 137
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 332
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN(CreateGRNDto request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GoodsReceiptsController.cs:line 35
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:18:42.314 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:18:42.316 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - 400 null application/json; charset=utf-8 73.1353ms
2025-11-23 18:19:10.525 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - application/json 514
2025-11-23 18:19:10.527 +02:00 [INF] Request started
2025-11-23 18:19:10.528 +02:00 [INF] === Incoming Request ===
2025-11-23 18:19:10.529 +02:00 [INF] Path: /api/GoodsReceipts
2025-11-23 18:19:10.530 +02:00 [INF] Method: POST
2025-11-23 18:19:10.531 +02:00 [INF] === Headers ===
2025-11-23 18:19:10.532 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:19:10.533 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:19:10.535 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:19:10.536 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:19:10.537 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:19:10.539 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:19:10.540 +02:00 [INF] Content-Length: ["514"]
2025-11-23 18:19:10.543 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:19:10.544 +02:00 [INF] Postman-Token: ["c1779e24-30e3-4450-95e1-ca51eb60ff38"]
2025-11-23 18:19:10.546 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:19:10.548 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:19:10.550 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:19:10.551 +02:00 [INF] Route matched with {action = "CreateGRN", controller = "GoodsReceipts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGRN(ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.CreateGRNDto, System.Threading.CancellationToken) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController (ModularERP).
2025-11-23 18:19:10.554 +02:00 [INF] API: Creating new GRN for PO: "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:19:10.561 +02:00 [INF] Creating new GRN for PO: "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:19:10.566 +02:00 [INF] PO found: PO-202511-0001 | DocumentStatus: Draft | ReceptionStatus: NotReceived
2025-11-23 18:19:10.568 +02:00 [ERR] ‚ùå Error creating GRN. Transaction rolled back. PO: "c9fe6356-33a0-4702-9163-c600c1acc33a"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot create GRN for a Purchase Order in Draft status.
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 81
2025-11-23 18:19:10.570 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP) in 16.5664ms
2025-11-23 18:19:10.572 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:19:10.574 +02:00 [WRN] Business logic exception occurred: Cannot create GRN for a Purchase Order in Draft status.
ModularERP.Common.Exceptions.BusinessLogicException: Cannot create GRN for a Purchase Order in Draft status.
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 81
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 332
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN(CreateGRNDto request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GoodsReceiptsController.cs:line 35
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:19:10.585 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:19:10.587 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - 400 null application/json; charset=utf-8 62.1794ms
2025-11-23 18:19:52.308 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - application/json 514
2025-11-23 18:19:52.312 +02:00 [INF] Request started
2025-11-23 18:19:52.313 +02:00 [INF] === Incoming Request ===
2025-11-23 18:19:52.314 +02:00 [INF] Path: /api/GoodsReceipts
2025-11-23 18:19:52.315 +02:00 [INF] Method: POST
2025-11-23 18:19:52.316 +02:00 [INF] === Headers ===
2025-11-23 18:19:52.317 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:19:52.319 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:19:52.320 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:19:52.321 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:19:52.322 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:19:52.324 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:19:52.326 +02:00 [INF] Content-Length: ["514"]
2025-11-23 18:19:52.327 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:19:52.329 +02:00 [INF] Postman-Token: ["ace25d43-400b-4368-87e1-0d73c97e64fb"]
2025-11-23 18:19:52.330 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:19:52.331 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:19:52.332 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:19:52.333 +02:00 [INF] Route matched with {action = "CreateGRN", controller = "GoodsReceipts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGRN(ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.CreateGRNDto, System.Threading.CancellationToken) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController (ModularERP).
2025-11-23 18:19:52.336 +02:00 [INF] API: Creating new GRN for PO: "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:19:52.339 +02:00 [INF] Creating new GRN for PO: "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:19:52.342 +02:00 [INF] PO found: PO-202511-0001 | DocumentStatus: Approved | ReceptionStatus: NotReceived
2025-11-23 18:19:52.351 +02:00 [INF] Validating | POLineItemId: "4a06bf9b-14b1-4550-bad0-08de2aabddbb" | Item: ' Product' | Ordered: 5.000 | Received: 0.000 | Pending: 5.000 | Attempting: 1
2025-11-23 18:19:52.375 +02:00 [INF] Generated GRN Number: GRN-2025-00005
2025-11-23 18:19:52.416 +02:00 [INF] ‚úÖ GRN entity created with Id: "b08e49c0-5034-4b6e-83c5-08de2aac21d9"
2025-11-23 18:19:52.432 +02:00 [INF] ‚úÖ Updated PO Line Item | POLineItemId: "4a06bf9b-14b1-4550-bad0-08de2aabddbb" | Previous: 0.000 | New: 1.000 | Increment: 1
2025-11-23 18:19:52.435 +02:00 [INF] üîÑ Starting Warehouse Stock update...
2025-11-23 18:19:52.456 +02:00 [INF] ‚úÖ Stock Updated | ProductId: "3682b908-2698-409b-91be-266ecb7aa3ee" | Product: ' Product' | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea" | Previous Qty: 50.000 | Added: 1 | New Qty: 51.000
2025-11-23 18:19:52.460 +02:00 [INF] ‚úÖ Warehouse Stock update completed successfully
2025-11-23 18:19:52.467 +02:00 [INF] üìä PO Status Update | PO: PO-202511-0001 | Previous: NotReceived | New: Partially Received
2025-11-23 18:19:52.480 +02:00 [INF] ‚úÖ‚úÖ‚úÖ GRN created successfully | GRN: GRN-2025-00005 | PO: PO-202511-0001
2025-11-23 18:19:52.526 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.GRNResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 18:19:52.535 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP) in 199.2567ms
2025-11-23 18:19:52.537 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:19:52.538 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 18:19:52.540 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - 200 null application/json; charset=utf-8 231.2377ms
2025-11-23 18:20:38.434 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items - application/json 215
2025-11-23 18:20:38.438 +02:00 [INF] Request started
2025-11-23 18:20:38.445 +02:00 [INF] === Incoming Request ===
2025-11-23 18:20:38.447 +02:00 [INF] Path: /api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items
2025-11-23 18:20:38.449 +02:00 [INF] Method: POST
2025-11-23 18:20:38.450 +02:00 [INF] === Headers ===
2025-11-23 18:20:38.452 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:20:38.454 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:20:38.456 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:20:38.457 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:20:38.459 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:20:38.461 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:20:38.462 +02:00 [INF] Content-Length: ["215"]
2025-11-23 18:20:38.464 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:20:38.465 +02:00 [INF] Postman-Token: ["c2a7688d-5093-438f-9fd2-82390d83165d"]
2025-11-23 18:20:38.467 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:20:38.468 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:20:38.469 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 18:20:38.471 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 18:20:38.474 +02:00 [INF] Adding item to GRN "b08e49c0-5034-4b6e-83c5-08de2aac21d9"
2025-11-23 18:20:38.479 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "b08e49c0-5034-4b6e-83c5-08de2aac21d9" | POLineItemId: "4a06bf9b-14b1-4550-bad0-08de2aabddbb" | Qty: 1
2025-11-23 18:20:38.486 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00005 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 18:20:38.492 +02:00 [INF] ‚úÖ POLineItem found | Item: ' Product' | Ordered: 5.000 | Received: 1.000 | Remaining: 4.000
2025-11-23 18:20:38.502 +02:00 [INF] ‚úÖ GRN Line Item created | Id: "8e29764b-36b9-4f10-b7c0-40bfda567369"
2025-11-23 18:20:38.508 +02:00 [INF] ‚úÖ POLineItem updated | Id: "4a06bf9b-14b1-4550-bad0-08de2aabddbb" | Received: 1.000 ‚Üí 2.000 | Remaining: 4.000 ‚Üí 3.000
2025-11-23 18:20:38.514 +02:00 [INF] üîÑ Updating stock | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea" | Product: "3682b908-2698-409b-91be-266ecb7aa3ee" | Qty: 1
2025-11-23 18:20:38.526 +02:00 [INF] ‚úÖ Stock updated | Product: ' Product' | Qty: 51.000 ‚Üí 52.000 | Available: 51.000 ‚Üí 52.000
2025-11-23 18:20:38.530 +02:00 [INF] ‚úÖ‚úÖ‚úÖ GRN Item added successfully | LineItemId: "8e29764b-36b9-4f10-b7c0-40bfda567369"
2025-11-23 18:20:38.549 +02:00 [INF] Executing CreatedAtActionResult, writing value of type '<>f__AnonymousType145`3[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.GRNLineItemResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-23 18:20:38.555 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 81.4153ms
2025-11-23 18:20:38.557 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 18:20:38.560 +02:00 [INF] Request completed successfully with status code 201
2025-11-23 18:20:38.561 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items - 201 null application/json; charset=utf-8 126.5162ms
2025-11-23 18:20:58.260 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - application/json 288
2025-11-23 18:20:58.264 +02:00 [INF] Request started
2025-11-23 18:20:58.265 +02:00 [INF] === Incoming Request ===
2025-11-23 18:20:58.266 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 18:20:58.267 +02:00 [INF] Method: POST
2025-11-23 18:20:58.268 +02:00 [INF] === Headers ===
2025-11-23 18:20:58.269 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:20:58.271 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:20:58.272 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:20:58.274 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:20:58.275 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:20:58.277 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:20:58.278 +02:00 [INF] Content-Length: ["288"]
2025-11-23 18:20:58.280 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:20:58.281 +02:00 [INF] Postman-Token: ["2d6b1c0d-464b-43c7-b821-fe8ee5c96bda"]
2025-11-23 18:20:58.283 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:20:58.283 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:20:58.285 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:20:58.287 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 18:20:58.290 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:20:58.296 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:20:58.465 +02:00 [INF] Refund saved to database: REF-20251123-00017
2025-11-23 18:20:58.497 +02:00 [INF] Created Debit Note: DN-20251123-00009 for Refund: REF-20251123-00017
2025-11-23 18:20:58.531 +02:00 [INF] PO PO-202510-0001 Calculations: Ordered=10.000, Received=0.000, Returned=11.000, Net=-11.000
2025-11-23 18:20:58.544 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception PartiallyReceived ‚Üí PartiallyReceived, Payment: Refunded
2025-11-23 18:20:58.546 +02:00 [INF] Successfully created refund: REF-20251123-00017 from Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:20:58.550 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 18:20:58.560 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 270.401ms
2025-11-23 18:20:58.563 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:20:58.564 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 18:20:58.565 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - 200 null application/json; charset=utf-8 304.9923ms
2025-11-23 18:24:03.743 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - application/json 288
2025-11-23 18:24:03.747 +02:00 [INF] Request started
2025-11-23 18:24:03.748 +02:00 [INF] === Incoming Request ===
2025-11-23 18:24:03.748 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 18:24:03.749 +02:00 [INF] Method: POST
2025-11-23 18:24:03.750 +02:00 [INF] === Headers ===
2025-11-23 18:24:03.751 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:24:03.752 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:24:03.754 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:24:03.755 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:24:03.757 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:24:03.759 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:24:03.761 +02:00 [INF] Content-Length: ["288"]
2025-11-23 18:24:03.762 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:24:03.764 +02:00 [INF] Postman-Token: ["4929bead-44a5-450f-b77e-8c68b9b864e3"]
2025-11-23 18:24:03.765 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:24:03.766 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:24:03.767 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:24:03.768 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 18:24:03.771 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:24:03.773 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:24:03.807 +02:00 [ERR] Error creating refund from Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
ModularERP.Common.Exceptions.BusinessLogicException: Return quantity (1) exceeds available quantity (0.000) for product  Product
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 134
2025-11-23 18:24:03.811 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 40.2355ms
2025-11-23 18:24:03.812 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:24:03.813 +02:00 [WRN] Business logic exception occurred: Return quantity (1) exceeds available quantity (0.000) for product  Product
ModularERP.Common.Exceptions.BusinessLogicException: Return quantity (1) exceeds available quantity (0.000) for product  Product
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 134
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice(Guid invoiceId, CreateRefundFromInvoiceCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Controllers\PurchaseInvoiceRefundsController.cs:line 43
   at lambda_method118(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:24:03.825 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:24:03.827 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - 400 null application/json; charset=utf-8 83.459ms
2025-11-23 18:24:19.195 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - application/json 288
2025-11-23 18:24:19.199 +02:00 [INF] Request started
2025-11-23 18:24:19.200 +02:00 [INF] === Incoming Request ===
2025-11-23 18:24:19.200 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 18:24:19.202 +02:00 [INF] Method: POST
2025-11-23 18:24:19.203 +02:00 [INF] === Headers ===
2025-11-23 18:24:19.204 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:24:19.206 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:24:19.207 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:24:19.209 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:24:19.211 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:24:19.213 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:24:19.214 +02:00 [INF] Content-Length: ["288"]
2025-11-23 18:24:19.216 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:24:19.217 +02:00 [INF] Postman-Token: ["0db26e7b-277a-4e9b-b01a-fed7cb980b50"]
2025-11-23 18:24:19.219 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:24:19.220 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:24:19.222 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:24:19.223 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 18:24:19.226 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:24:19.230 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:24:19.281 +02:00 [INF] Refund saved to database: REF-20251123-00018
2025-11-23 18:24:19.292 +02:00 [INF] Created Debit Note: DN-20251123-00010 for Refund: REF-20251123-00018
2025-11-23 18:24:19.306 +02:00 [INF] PO PO-202510-0001 Calculations: Ordered=10.000, Received=0.000, Returned=12.000, Net=-12.000
2025-11-23 18:24:19.315 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception PartiallyReceived ‚Üí PartiallyReceived, Payment: Refunded
2025-11-23 18:24:19.317 +02:00 [INF] Successfully created refund: REF-20251123-00018 from Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:24:19.320 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 18:24:19.321 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 95.4467ms
2025-11-23 18:24:19.324 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:24:19.326 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 18:24:19.327 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - 200 null application/json; charset=utf-8 131.802ms
2025-11-23 18:45:44.054 +02:00 [INF] Starting web host...
2025-11-23 18:45:45.642 +02:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 18:45:45.726 +02:00 [INF] Executed DbCommand (66ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 18:45:45.835 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 18:45:45.840 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 18:45:45.856 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 18:45:45.931 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 18:45:45.948 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 18:45:45.952 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 18:45:45.959 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 18:45:45.972 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 18:45:45.978 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 18:45:46.165 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 18:45:46.172 +02:00 [INF] Master database initialized successfully
2025-11-23 18:45:48.377 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 18:45:48.505 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 18:45:48.507 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 18:45:48.604 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 18:45:48.606 +02:00 [INF] Hosting environment: Development
2025-11-23 18:45:48.608 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 18:45:48.824 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 18:45:48.993 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 169.5029ms
2025-11-23 18:45:48.998 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 18:45:48.998 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 18:45:49.007 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.9273ms
2025-11-23 18:45:49.035 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 37.3137ms
2025-11-23 18:45:49.227 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 18:45:49.581 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 353.4646ms
2025-11-23 18:45:58.705 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - application/json 288
2025-11-23 18:45:58.729 +02:00 [INF] Request started
2025-11-23 18:45:58.732 +02:00 [INF] === Incoming Request ===
2025-11-23 18:45:58.733 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 18:45:58.734 +02:00 [INF] Method: POST
2025-11-23 18:45:58.735 +02:00 [INF] === Headers ===
2025-11-23 18:45:58.737 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:45:58.740 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:45:58.742 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:45:58.744 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:45:58.746 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:45:58.747 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:45:58.748 +02:00 [INF] Content-Length: ["288"]
2025-11-23 18:45:58.750 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:45:58.751 +02:00 [INF] Postman-Token: ["759c9a18-2012-4b6e-927e-ac24c7273a35"]
2025-11-23 18:45:58.755 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:45:58.757 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:45:58.759 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:45:58.781 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 18:45:58.787 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 18:45:58.821 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:45:58.936 +02:00 [INF] Executed DbCommand (12ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 18:45:59.687 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 18:45:59.705 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:46:00.217 +02:00 [ERR] Error creating refund from Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
ModularERP.Common.Exceptions.BusinessLogicException: GRN Line Item 6d7d5c6e-2c58-4d33-9adc-6c99f4381bfc belongs to PO 23d49ad7-c8f3-4545-9bb3-6957cdf43515, but invoice is for PO c9419c66-ab1f-4857-a967-37221b235ea5. Cannot create refund across different Purchase Orders.
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 127
2025-11-23 18:46:00.271 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 1484.4636ms
2025-11-23 18:46:00.274 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:46:00.282 +02:00 [WRN] Business logic exception occurred: GRN Line Item 6d7d5c6e-2c58-4d33-9adc-6c99f4381bfc belongs to PO 23d49ad7-c8f3-4545-9bb3-6957cdf43515, but invoice is for PO c9419c66-ab1f-4857-a967-37221b235ea5. Cannot create refund across different Purchase Orders.
ModularERP.Common.Exceptions.BusinessLogicException: GRN Line Item 6d7d5c6e-2c58-4d33-9adc-6c99f4381bfc belongs to PO 23d49ad7-c8f3-4545-9bb3-6957cdf43515, but invoice is for PO c9419c66-ab1f-4857-a967-37221b235ea5. Cannot create refund across different Purchase Orders.
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 127
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice(Guid invoiceId, CreateRefundFromInvoiceCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Controllers\PurchaseInvoiceRefundsController.cs:line 43
   at lambda_method118(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:46:00.315 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:46:00.320 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - 400 null application/json; charset=utf-8 1615.0586ms
2025-11-23 18:46:31.221 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items - application/json 216
2025-11-23 18:46:31.239 +02:00 [INF] Request started
2025-11-23 18:46:31.240 +02:00 [INF] === Incoming Request ===
2025-11-23 18:46:31.241 +02:00 [INF] Path: /api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items
2025-11-23 18:46:31.243 +02:00 [INF] Method: POST
2025-11-23 18:46:31.244 +02:00 [INF] === Headers ===
2025-11-23 18:46:31.245 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:46:31.246 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:46:31.248 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:46:31.250 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:46:31.251 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:46:31.253 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:46:31.254 +02:00 [INF] Content-Length: ["216"]
2025-11-23 18:46:31.256 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:46:31.257 +02:00 [INF] Postman-Token: ["f2809280-c244-4a8e-8e8c-3f007f19afda"]
2025-11-23 18:46:31.260 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:46:31.261 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:46:31.262 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 18:46:31.273 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 18:46:31.286 +02:00 [INF] Adding item to GRN "b08e49c0-5034-4b6e-83c5-08de2aac21d9"
2025-11-23 18:46:31.306 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "b08e49c0-5034-4b6e-83c5-08de2aac21d9" | POLineItemId: "4a06bf9b-14b1-4550-bad0-08de2aabddbb" | Qty: 10
2025-11-23 18:46:31.336 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00005 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 18:46:31.348 +02:00 [INF] ‚úÖ POLineItem found | Item: ' Product' | Ordered: 5.000 | Received: 2.000 | Remaining: 3.000
2025-11-23 18:46:31.359 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 82.2086ms
2025-11-23 18:46:31.361 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 18:46:31.362 +02:00 [WRN] Business logic exception occurred: Cannot receive 10 units of ' Product'. Only 3.000 units pending
ModularERP.Common.Exceptions.BusinessLogicException: Cannot receive 10 units of ' Product'. Only 3.000 units pending
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 149
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 273
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem(Guid id, AddGRNItemCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GRNItemsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:46:31.380 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:46:31.382 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items - 400 null application/json; charset=utf-8 160.9616ms
2025-11-23 18:48:40.701 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items - application/json 215
2025-11-23 18:48:40.706 +02:00 [INF] Request started
2025-11-23 18:48:40.708 +02:00 [INF] === Incoming Request ===
2025-11-23 18:48:40.709 +02:00 [INF] Path: /api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items
2025-11-23 18:48:40.710 +02:00 [INF] Method: POST
2025-11-23 18:48:40.711 +02:00 [INF] === Headers ===
2025-11-23 18:48:40.712 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:48:40.713 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:48:40.715 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:48:40.716 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:48:40.718 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:48:40.719 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:48:40.724 +02:00 [INF] Content-Length: ["215"]
2025-11-23 18:48:40.727 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:48:40.730 +02:00 [INF] Postman-Token: ["aeee77b1-f5a4-4baa-b2b8-1cf4ab8d5759"]
2025-11-23 18:48:40.731 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:48:40.732 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:48:40.733 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 18:48:40.734 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 18:48:40.738 +02:00 [INF] Adding item to GRN "b08e49c0-5034-4b6e-83c5-08de2aac21d9"
2025-11-23 18:48:40.749 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "b08e49c0-5034-4b6e-83c5-08de2aac21d9" | POLineItemId: "4a06bf9b-14b1-4550-bad0-08de2aabddbb" | Qty: 3
2025-11-23 18:48:40.763 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00005 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 18:48:40.772 +02:00 [INF] ‚úÖ POLineItem found | Item: ' Product' | Ordered: 5.000 | Received: 2.000 | Remaining: 3.000
2025-11-23 18:48:40.879 +02:00 [INF] ‚úÖ GRN Line Item created | Id: "93fa1a06-609c-4634-ae85-9d31e9ac9ac6"
2025-11-23 18:48:40.914 +02:00 [INF] ‚úÖ POLineItem updated | Id: "4a06bf9b-14b1-4550-bad0-08de2aabddbb" | Received: 2.000 ‚Üí 5.000 | Remaining: 3.000 ‚Üí 0.000
2025-11-23 18:48:40.918 +02:00 [INF] üîÑ Updating stock | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea" | Product: "3682b908-2698-409b-91be-266ecb7aa3ee" | Qty: 3
2025-11-23 18:48:40.982 +02:00 [INF] ‚úÖ Stock updated | Product: ' Product' | Qty: 51.000 ‚Üí 54.000 | Available: 51.000 ‚Üí 54.000
2025-11-23 18:48:40.985 +02:00 [INF] ‚úÖ‚úÖ‚úÖ GRN Item added successfully | LineItemId: "93fa1a06-609c-4634-ae85-9d31e9ac9ac6"
2025-11-23 18:48:41.017 +02:00 [INF] Executing CreatedAtActionResult, writing value of type '<>f__AnonymousType145`3[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.GRNLineItemResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-23 18:48:41.042 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 305.4934ms
2025-11-23 18:48:41.044 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 18:48:41.045 +02:00 [INF] Request completed successfully with status code 201
2025-11-23 18:48:41.046 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items - 201 null application/json; charset=utf-8 345.7272ms
2025-11-23 18:49:05.224 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - application/json 288
2025-11-23 18:49:05.228 +02:00 [INF] Request started
2025-11-23 18:49:05.229 +02:00 [INF] === Incoming Request ===
2025-11-23 18:49:05.231 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 18:49:05.232 +02:00 [INF] Method: POST
2025-11-23 18:49:05.234 +02:00 [INF] === Headers ===
2025-11-23 18:49:05.235 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:49:05.237 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:49:05.239 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:49:05.241 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:49:05.242 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:49:05.243 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:49:05.245 +02:00 [INF] Content-Length: ["288"]
2025-11-23 18:49:05.246 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:49:05.249 +02:00 [INF] Postman-Token: ["189e429b-6889-4138-985c-e9e7b4da0de2"]
2025-11-23 18:49:05.250 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:49:05.252 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:49:05.253 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:49:05.254 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 18:49:05.258 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:49:05.263 +02:00 [INF] Creating refund from Purchase Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
2025-11-23 18:49:05.304 +02:00 [ERR] Error creating refund from Invoice: "e2b2b134-64f7-4af9-b25b-18f0afae3203"
ModularERP.Common.Exceptions.BusinessLogicException: GRN Line Item 93fa1a06-609c-4634-ae85-9d31e9ac9ac6 belongs to PO c9fe6356-33a0-4702-9163-c600c1acc33a, but invoice is for PO c9419c66-ab1f-4857-a967-37221b235ea5. Cannot create refund across different Purchase Orders.
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 127
2025-11-23 18:49:05.308 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 50.3689ms
2025-11-23 18:49:05.309 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 18:49:05.310 +02:00 [WRN] Business logic exception occurred: GRN Line Item 93fa1a06-609c-4634-ae85-9d31e9ac9ac6 belongs to PO c9fe6356-33a0-4702-9163-c600c1acc33a, but invoice is for PO c9419c66-ab1f-4857-a967-37221b235ea5. Cannot create refund across different Purchase Orders.
ModularERP.Common.Exceptions.BusinessLogicException: GRN Line Item 93fa1a06-609c-4634-ae85-9d31e9ac9ac6 belongs to PO c9fe6356-33a0-4702-9163-c600c1acc33a, but invoice is for PO c9419c66-ab1f-4857-a967-37221b235ea5. Cannot create refund across different Purchase Orders.
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 127
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice(Guid invoiceId, CreateRefundFromInvoiceCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Controllers\PurchaseInvoiceRefundsController.cs:line 43
   at lambda_method118(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:49:05.323 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:49:05.324 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e2b2b134-64f7-4af9-b25b-18f0afae3203 - 400 null application/json; charset=utf-8 100.2654ms
2025-11-23 18:53:40.454 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9fe6356-33a0-4702-9163-c600c1acc33a}/items - application/json 306
2025-11-23 18:53:40.460 +02:00 [INF] Request started
2025-11-23 18:53:40.462 +02:00 [INF] === Incoming Request ===
2025-11-23 18:53:40.463 +02:00 [INF] Path: /api/purchase-orders/%7Bc9fe6356-33a0-4702-9163-c600c1acc33a%7D/items
2025-11-23 18:53:40.464 +02:00 [INF] Method: POST
2025-11-23 18:53:40.465 +02:00 [INF] === Headers ===
2025-11-23 18:53:40.466 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:53:40.468 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:53:40.469 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:53:40.470 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:53:40.473 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:53:40.475 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:53:40.477 +02:00 [INF] Content-Length: ["306"]
2025-11-23 18:53:40.478 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:53:40.479 +02:00 [INF] Postman-Token: ["e6ee08a7-fcc1-4e65-8bc2-bc5f07409f46"]
2025-11-23 18:53:40.481 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:53:40.482 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:53:40.483 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:53:40.492 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 18:53:40.506 +02:00 [INF] POST request received to create line item for PO "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:53:40.520 +02:00 [INF] Creating line item for Purchase Order "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:53:40.542 +02:00 [ERR] Error creating line item for Purchase Order "c9fe6356-33a0-4702-9163-c600c1acc33a"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
2025-11-23 18:53:40.551 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 55.0981ms
2025-11-23 18:53:40.552 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:53:40.554 +02:00 [WRN] Business logic exception occurred: Cannot add items to Purchase Order in Approved status
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem(Guid purchaseOrderId, CreatePOLineItemDto lineItem) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\POLineItemController.cs:line 104
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:53:40.566 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:53:40.567 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9fe6356-33a0-4702-9163-c600c1acc33a}/items - 400 null application/json; charset=utf-8 112.7436ms
2025-11-23 18:56:47.733 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - application/json 514
2025-11-23 18:56:47.737 +02:00 [INF] Request started
2025-11-23 18:56:47.738 +02:00 [INF] === Incoming Request ===
2025-11-23 18:56:47.738 +02:00 [INF] Path: /api/GoodsReceipts
2025-11-23 18:56:47.739 +02:00 [INF] Method: POST
2025-11-23 18:56:47.740 +02:00 [INF] === Headers ===
2025-11-23 18:56:47.741 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:56:47.742 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:56:47.745 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:56:47.747 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:56:47.748 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:56:47.750 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:56:47.751 +02:00 [INF] Content-Length: ["514"]
2025-11-23 18:56:47.752 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:56:47.754 +02:00 [INF] Postman-Token: ["c71d0bdc-887c-4a75-a54c-14495442715b"]
2025-11-23 18:56:47.755 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:56:47.756 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:56:47.757 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:56:47.761 +02:00 [INF] Route matched with {action = "CreateGRN", controller = "GoodsReceipts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGRN(ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.CreateGRNDto, System.Threading.CancellationToken) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController (ModularERP).
2025-11-23 18:56:47.776 +02:00 [INF] API: Creating new GRN for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:56:47.803 +02:00 [INF] Creating new GRN for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:56:47.817 +02:00 [INF] PO found: PO-202510-0005 | DocumentStatus: Approved | ReceptionStatus: FullyReceived
2025-11-23 18:56:47.870 +02:00 [ERR] ‚ùå Error creating GRN. Transaction rolled back. PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
ModularERP.Common.Exceptions.BusinessLogicException: Line items 4a06bf9b-14b1-4550-bad0-08de2aabddbb do not belong to Purchase Order 23d49ad7-c8f3-4545-9bb3-6957cdf43515
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 137
2025-11-23 18:56:47.874 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP) in 109.6607ms
2025-11-23 18:56:47.875 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:56:47.877 +02:00 [WRN] Business logic exception occurred: Line items 4a06bf9b-14b1-4550-bad0-08de2aabddbb do not belong to Purchase Order 23d49ad7-c8f3-4545-9bb3-6957cdf43515
ModularERP.Common.Exceptions.BusinessLogicException: Line items 4a06bf9b-14b1-4550-bad0-08de2aabddbb do not belong to Purchase Order 23d49ad7-c8f3-4545-9bb3-6957cdf43515
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 137
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 332
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN(CreateGRNDto request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GoodsReceiptsController.cs:line 35
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:56:47.889 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:56:47.891 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - 400 null application/json; charset=utf-8 157.2138ms
2025-11-23 18:57:41.168 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9fe6356-33a0-4702-9163-c600c1acc33a}/items - application/json 306
2025-11-23 18:57:41.173 +02:00 [INF] Request started
2025-11-23 18:57:41.174 +02:00 [INF] === Incoming Request ===
2025-11-23 18:57:41.175 +02:00 [INF] Path: /api/purchase-orders/%7Bc9fe6356-33a0-4702-9163-c600c1acc33a%7D/items
2025-11-23 18:57:41.176 +02:00 [INF] Method: POST
2025-11-23 18:57:41.177 +02:00 [INF] === Headers ===
2025-11-23 18:57:41.178 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:57:41.179 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:57:41.181 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:57:41.182 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:57:41.183 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:57:41.185 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:57:41.186 +02:00 [INF] Content-Length: ["306"]
2025-11-23 18:57:41.188 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:57:41.189 +02:00 [INF] Postman-Token: ["1b214605-cfbe-4ede-b8fe-87c32ed1d777"]
2025-11-23 18:57:41.190 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:57:41.192 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:57:41.193 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:57:41.194 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 18:57:41.198 +02:00 [INF] POST request received to create line item for PO "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:57:41.200 +02:00 [INF] Creating line item for Purchase Order "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:57:41.204 +02:00 [ERR] Error creating line item for Purchase Order "c9fe6356-33a0-4702-9163-c600c1acc33a"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
2025-11-23 18:57:41.206 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 9.0115ms
2025-11-23 18:57:41.208 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:57:41.209 +02:00 [WRN] Business logic exception occurred: Cannot add items to Purchase Order in Approved status
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem(Guid purchaseOrderId, CreatePOLineItemDto lineItem) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\POLineItemController.cs:line 104
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:57:41.226 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:57:41.227 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9fe6356-33a0-4702-9163-c600c1acc33a}/items - 400 null application/json; charset=utf-8 58.4147ms
2025-11-23 18:58:05.764 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9fe6356-33a0-4702-9163-c600c1acc33a}/items - application/json 306
2025-11-23 18:58:05.767 +02:00 [INF] Request started
2025-11-23 18:58:05.768 +02:00 [INF] === Incoming Request ===
2025-11-23 18:58:05.769 +02:00 [INF] Path: /api/purchase-orders/%7Bc9fe6356-33a0-4702-9163-c600c1acc33a%7D/items
2025-11-23 18:58:05.771 +02:00 [INF] Method: POST
2025-11-23 18:58:05.772 +02:00 [INF] === Headers ===
2025-11-23 18:58:05.773 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:58:05.774 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:58:05.775 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:58:05.777 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:58:05.778 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:58:05.779 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:58:05.781 +02:00 [INF] Content-Length: ["306"]
2025-11-23 18:58:05.782 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:58:05.785 +02:00 [INF] Postman-Token: ["ad4d1960-ee48-4e85-b445-62344c101682"]
2025-11-23 18:58:05.786 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:58:05.787 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:58:05.788 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:58:05.789 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 18:58:05.792 +02:00 [INF] POST request received to create line item for PO "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:58:05.795 +02:00 [INF] Creating line item for Purchase Order "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 18:58:05.797 +02:00 [ERR] Error creating line item for Purchase Order "c9fe6356-33a0-4702-9163-c600c1acc33a"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
2025-11-23 18:58:05.799 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 7.7275ms
2025-11-23 18:58:05.802 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:58:05.803 +02:00 [WRN] Business logic exception occurred: Cannot add items to Purchase Order in Approved status
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem(Guid purchaseOrderId, CreatePOLineItemDto lineItem) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\POLineItemController.cs:line 104
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:58:05.813 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:58:05.814 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9fe6356-33a0-4702-9163-c600c1acc33a}/items - 400 null application/json; charset=utf-8 49.9817ms
2025-11-23 18:58:23.225 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{23d49ad7-c8f3-4545-9bb3-6957cdf43515}/items - application/json 306
2025-11-23 18:58:23.229 +02:00 [INF] Request started
2025-11-23 18:58:23.230 +02:00 [INF] === Incoming Request ===
2025-11-23 18:58:23.231 +02:00 [INF] Path: /api/purchase-orders/%7B23d49ad7-c8f3-4545-9bb3-6957cdf43515%7D/items
2025-11-23 18:58:23.232 +02:00 [INF] Method: POST
2025-11-23 18:58:23.234 +02:00 [INF] === Headers ===
2025-11-23 18:58:23.235 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:58:23.237 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:58:23.238 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:58:23.240 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:58:23.242 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:58:23.243 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:58:23.246 +02:00 [INF] Content-Length: ["306"]
2025-11-23 18:58:23.248 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:58:23.249 +02:00 [INF] Postman-Token: ["380ae5ab-9e49-4263-837c-5992e605afcd"]
2025-11-23 18:58:23.251 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:58:23.253 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:58:23.254 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:58:23.255 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 18:58:23.258 +02:00 [INF] POST request received to create line item for PO "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:58:23.260 +02:00 [INF] Creating line item for Purchase Order "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 18:58:23.263 +02:00 [ERR] Error creating line item for Purchase Order "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
2025-11-23 18:58:23.266 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 8.6427ms
2025-11-23 18:58:23.269 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:58:23.270 +02:00 [WRN] Business logic exception occurred: Cannot add items to Purchase Order in Approved status
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem(Guid purchaseOrderId, CreatePOLineItemDto lineItem) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\POLineItemController.cs:line 104
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:58:23.282 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:58:23.284 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{23d49ad7-c8f3-4545-9bb3-6957cdf43515}/items - 400 null application/json; charset=utf-8 59.0267ms
2025-11-23 18:58:58.012 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - application/json 514
2025-11-23 18:58:58.016 +02:00 [INF] Request started
2025-11-23 18:58:58.018 +02:00 [INF] === Incoming Request ===
2025-11-23 18:58:58.019 +02:00 [INF] Path: /api/GoodsReceipts
2025-11-23 18:58:58.020 +02:00 [INF] Method: POST
2025-11-23 18:58:58.021 +02:00 [INF] === Headers ===
2025-11-23 18:58:58.022 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:58:58.023 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:58:58.025 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:58:58.026 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:58:58.027 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:58:58.029 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:58:58.031 +02:00 [INF] Content-Length: ["514"]
2025-11-23 18:58:58.032 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:58:58.033 +02:00 [INF] Postman-Token: ["065cc2ba-f3b9-4766-a4ef-e7272a7bf7f2"]
2025-11-23 18:58:58.035 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:58:58.036 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:58:58.037 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:58:58.038 +02:00 [INF] Route matched with {action = "CreateGRN", controller = "GoodsReceipts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGRN(ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.CreateGRNDto, System.Threading.CancellationToken) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController (ModularERP).
2025-11-23 18:58:58.041 +02:00 [INF] API: Creating new GRN for PO: "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 18:58:58.044 +02:00 [INF] Creating new GRN for PO: "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 18:58:58.048 +02:00 [INF] PO found: PO-202510-0001 | DocumentStatus: Approved | ReceptionStatus: PartiallyReceived
2025-11-23 18:58:58.066 +02:00 [ERR] ‚ùå Error creating GRN. Transaction rolled back. PO: "c9419c66-ab1f-4857-a967-37221b235ea5"
ModularERP.Common.Exceptions.BusinessLogicException: Line items 4a06bf9b-14b1-4550-bad0-08de2aabddbb do not belong to Purchase Order c9419c66-ab1f-4857-a967-37221b235ea5
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 137
2025-11-23 18:58:58.071 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP) in 30.2499ms
2025-11-23 18:58:58.073 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 18:58:58.074 +02:00 [WRN] Business logic exception occurred: Line items 4a06bf9b-14b1-4550-bad0-08de2aabddbb do not belong to Purchase Order c9419c66-ab1f-4857-a967-37221b235ea5
ModularERP.Common.Exceptions.BusinessLogicException: Line items 4a06bf9b-14b1-4550-bad0-08de2aabddbb do not belong to Purchase Order c9419c66-ab1f-4857-a967-37221b235ea5
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 137
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 332
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN(CreateGRNDto request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GoodsReceiptsController.cs:line 35
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:58:58.085 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:58:58.086 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - 400 null application/json; charset=utf-8 74.5144ms
2025-11-23 18:59:13.290 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9419c66-ab1f-4857-a967-37221b235ea5}/items - application/json 306
2025-11-23 18:59:13.294 +02:00 [INF] Request started
2025-11-23 18:59:13.296 +02:00 [INF] === Incoming Request ===
2025-11-23 18:59:13.296 +02:00 [INF] Path: /api/purchase-orders/%7Bc9419c66-ab1f-4857-a967-37221b235ea5%7D/items
2025-11-23 18:59:13.297 +02:00 [INF] Method: POST
2025-11-23 18:59:13.298 +02:00 [INF] === Headers ===
2025-11-23 18:59:13.299 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:59:13.301 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:59:13.302 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:59:13.303 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:59:13.305 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:59:13.306 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:59:13.307 +02:00 [INF] Content-Length: ["306"]
2025-11-23 18:59:13.309 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:59:13.310 +02:00 [INF] Postman-Token: ["db167234-71b5-4c86-b9aa-53226a932dd3"]
2025-11-23 18:59:13.312 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:59:13.313 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:59:13.314 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:59:13.316 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 18:59:13.319 +02:00 [INF] POST request received to create line item for PO "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 18:59:13.322 +02:00 [INF] Creating line item for Purchase Order "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 18:59:13.326 +02:00 [ERR] Error creating line item for Purchase Order "c9419c66-ab1f-4857-a967-37221b235ea5"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
2025-11-23 18:59:13.330 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 11.0751ms
2025-11-23 18:59:13.332 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:59:13.334 +02:00 [WRN] Business logic exception occurred: Cannot add items to Purchase Order in Approved status
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem(Guid purchaseOrderId, CreatePOLineItemDto lineItem) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\POLineItemController.cs:line 104
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 18:59:13.344 +02:00 [INF] Error response sent with status code 400
2025-11-23 18:59:13.346 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9419c66-ab1f-4857-a967-37221b235ea5}/items - 400 null application/json; charset=utf-8 55.636ms
2025-11-23 18:59:40.178 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9419c66-ab1f-4857-a967-37221b235ea5}/items - application/json 306
2025-11-23 18:59:40.181 +02:00 [INF] Request started
2025-11-23 18:59:40.182 +02:00 [INF] === Incoming Request ===
2025-11-23 18:59:40.183 +02:00 [INF] Path: /api/purchase-orders/%7Bc9419c66-ab1f-4857-a967-37221b235ea5%7D/items
2025-11-23 18:59:40.184 +02:00 [INF] Method: POST
2025-11-23 18:59:40.185 +02:00 [INF] === Headers ===
2025-11-23 18:59:40.186 +02:00 [INF] Accept: ["*/*"]
2025-11-23 18:59:40.188 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 18:59:40.189 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 18:59:40.191 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 18:59:40.192 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 18:59:40.194 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 18:59:40.195 +02:00 [INF] Content-Length: ["306"]
2025-11-23 18:59:40.197 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 18:59:40.198 +02:00 [INF] Postman-Token: ["6dce7d4c-aec1-4ebc-97e9-26a105e8ee68"]
2025-11-23 18:59:40.200 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 18:59:40.201 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 18:59:40.202 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:59:40.204 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 18:59:40.207 +02:00 [INF] POST request received to create line item for PO "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 18:59:40.210 +02:00 [INF] Creating line item for Purchase Order "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 18:59:40.316 +02:00 [INF] Line item "1858baec-01c3-414b-7256-08de2ab1b129" created successfully for PO "c9419c66-ab1f-4857-a967-37221b235ea5". Subtotal: 75000, Discount: 7500.0, Tax: 10125.0000, Total: 77625.0000
2025-11-23 18:59:40.347 +02:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.POLineItemResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 18:59:40.356 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 149.7793ms
2025-11-23 18:59:40.359 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 18:59:40.360 +02:00 [INF] Request completed successfully with status code 201
2025-11-23 18:59:40.361 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9419c66-ab1f-4857-a967-37221b235ea5}/items - 201 null application/json; charset=utf-8 182.7374ms
2025-11-23 19:00:04.601 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - application/json 514
2025-11-23 19:00:04.605 +02:00 [INF] Request started
2025-11-23 19:00:04.606 +02:00 [INF] === Incoming Request ===
2025-11-23 19:00:04.607 +02:00 [INF] Path: /api/GoodsReceipts
2025-11-23 19:00:04.608 +02:00 [INF] Method: POST
2025-11-23 19:00:04.609 +02:00 [INF] === Headers ===
2025-11-23 19:00:04.610 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:00:04.611 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:00:04.613 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:00:04.615 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:00:04.617 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:00:04.618 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:00:04.619 +02:00 [INF] Content-Length: ["514"]
2025-11-23 19:00:04.620 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:00:04.622 +02:00 [INF] Postman-Token: ["f4503f4a-eaf1-4446-ab46-ef94eb28d6c2"]
2025-11-23 19:00:04.624 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:00:04.625 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:00:04.626 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 19:00:04.627 +02:00 [INF] Route matched with {action = "CreateGRN", controller = "GoodsReceipts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGRN(ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.CreateGRNDto, System.Threading.CancellationToken) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController (ModularERP).
2025-11-23 19:00:04.631 +02:00 [INF] API: Creating new GRN for PO: "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:00:04.636 +02:00 [INF] Creating new GRN for PO: "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:00:04.650 +02:00 [INF] PO found: PO-202510-0001 | DocumentStatus: Approved | ReceptionStatus: PartiallyReceived
2025-11-23 19:00:04.661 +02:00 [INF] Validating | POLineItemId: "1858baec-01c3-414b-7256-08de2ab1b129" | Item: ' Product' | Ordered: 5.000 | Received: 0.000 | Pending: 5.000 | Attempting: 1
2025-11-23 19:00:04.681 +02:00 [INF] Generated GRN Number: GRN-2025-00006
2025-11-23 19:00:04.715 +02:00 [INF] ‚úÖ GRN entity created with Id: "41ba1408-43be-4085-2c0b-08de2ab1bfb2"
2025-11-23 19:00:04.721 +02:00 [INF] ‚úÖ Updated PO Line Item | POLineItemId: "1858baec-01c3-414b-7256-08de2ab1b129" | Previous: 0.000 | New: 1.000 | Increment: 1
2025-11-23 19:00:04.723 +02:00 [INF] üîÑ Starting Warehouse Stock update...
2025-11-23 19:00:04.733 +02:00 [INF] ‚úÖ Stock Updated | ProductId: "3682b908-2698-409b-91be-266ecb7aa3ee" | Product: ' Product' | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea" | Previous Qty: 54.000 | Added: 1 | New Qty: 55.000
2025-11-23 19:00:04.737 +02:00 [INF] ‚úÖ Warehouse Stock update completed successfully
2025-11-23 19:00:04.745 +02:00 [INF] üìä PO Status Update | PO: PO-202510-0001 | Previous: PartiallyReceived | New: Partially Received
2025-11-23 19:00:04.781 +02:00 [INF] ‚úÖ‚úÖ‚úÖ GRN created successfully | GRN: GRN-2025-00006 | PO: PO-202510-0001
2025-11-23 19:00:04.827 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.GRNResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 19:00:04.836 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP) in 205.1475ms
2025-11-23 19:00:04.838 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 19:00:04.840 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 19:00:04.841 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - 200 null application/json; charset=utf-8 240.0134ms
2025-11-23 19:00:18.244 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items - application/json 215
2025-11-23 19:00:18.247 +02:00 [INF] Request started
2025-11-23 19:00:18.248 +02:00 [INF] === Incoming Request ===
2025-11-23 19:00:18.249 +02:00 [INF] Path: /api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items
2025-11-23 19:00:18.250 +02:00 [INF] Method: POST
2025-11-23 19:00:18.251 +02:00 [INF] === Headers ===
2025-11-23 19:00:18.252 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:00:18.253 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:00:18.254 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:00:18.257 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:00:18.258 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:00:18.260 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:00:18.262 +02:00 [INF] Content-Length: ["215"]
2025-11-23 19:00:18.263 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:00:18.265 +02:00 [INF] Postman-Token: ["e9c187a6-dc19-4d1f-b528-1631e7e32a49"]
2025-11-23 19:00:18.266 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:00:18.267 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:00:18.268 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 19:00:18.269 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 19:00:18.272 +02:00 [INF] Adding item to GRN "b08e49c0-5034-4b6e-83c5-08de2aac21d9"
2025-11-23 19:00:18.277 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "b08e49c0-5034-4b6e-83c5-08de2aac21d9" | POLineItemId: "4a06bf9b-14b1-4550-bad0-08de2aabddbb" | Qty: 3
2025-11-23 19:00:18.281 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00005 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 19:00:18.285 +02:00 [INF] ‚úÖ POLineItem found | Item: ' Product' | Ordered: 5.000 | Received: 5.000 | Remaining: 0.000
2025-11-23 19:00:18.287 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 15.5433ms
2025-11-23 19:00:18.290 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 19:00:18.291 +02:00 [WRN] Business logic exception occurred: Cannot receive ' Product'. Already fully received
ModularERP.Common.Exceptions.BusinessLogicException: Cannot receive ' Product'. Already fully received
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 141
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 273
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem(Guid id, AddGRNItemCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GRNItemsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:00:18.302 +02:00 [INF] Error response sent with status code 400
2025-11-23 19:00:18.303 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items - 400 null application/json; charset=utf-8 59.4255ms
2025-11-23 19:00:47.891 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items - application/json 215
2025-11-23 19:00:47.895 +02:00 [INF] Request started
2025-11-23 19:00:47.896 +02:00 [INF] === Incoming Request ===
2025-11-23 19:00:47.897 +02:00 [INF] Path: /api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items
2025-11-23 19:00:47.898 +02:00 [INF] Method: POST
2025-11-23 19:00:47.899 +02:00 [INF] === Headers ===
2025-11-23 19:00:47.900 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:00:47.902 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:00:47.903 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:00:47.905 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:00:47.906 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:00:47.907 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:00:47.909 +02:00 [INF] Content-Length: ["215"]
2025-11-23 19:00:47.910 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:00:47.912 +02:00 [INF] Postman-Token: ["c99fa038-deb4-4c47-a3a9-0069a2515b4c"]
2025-11-23 19:00:47.914 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:00:47.915 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:00:47.917 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 19:00:47.918 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 19:00:47.921 +02:00 [INF] Adding item to GRN "b08e49c0-5034-4b6e-83c5-08de2aac21d9"
2025-11-23 19:00:47.924 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "b08e49c0-5034-4b6e-83c5-08de2aac21d9" | POLineItemId: "1858baec-01c3-414b-7256-08de2ab1b129" | Qty: 3
2025-11-23 19:00:47.926 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00005 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 19:00:47.928 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 7.7777ms
2025-11-23 19:00:47.930 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 19:00:47.932 +02:00 [WRN] Business logic exception occurred: Line item does not belong to the same Purchase Order
ModularERP.Common.Exceptions.BusinessLogicException: Line item does not belong to the same Purchase Order
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 111
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 273
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem(Guid id, AddGRNItemCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GRNItemsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:00:47.943 +02:00 [INF] Error response sent with status code 400
2025-11-23 19:00:47.944 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/b08e49c0-5034-4b6e-83c5-08de2aac21d9/items - 400 null application/json; charset=utf-8 52.6999ms
2025-11-23 19:01:09.120 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/c9419c66-ab1f-4857-a967-37221b235ea5/items - application/json 215
2025-11-23 19:01:09.123 +02:00 [INF] Request started
2025-11-23 19:01:09.124 +02:00 [INF] === Incoming Request ===
2025-11-23 19:01:09.125 +02:00 [INF] Path: /api/goods-receipts/c9419c66-ab1f-4857-a967-37221b235ea5/items
2025-11-23 19:01:09.127 +02:00 [INF] Method: POST
2025-11-23 19:01:09.128 +02:00 [INF] === Headers ===
2025-11-23 19:01:09.129 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:01:09.131 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:01:09.132 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:01:09.134 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:01:09.135 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:01:09.136 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:01:09.138 +02:00 [INF] Content-Length: ["215"]
2025-11-23 19:01:09.140 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:01:09.141 +02:00 [INF] Postman-Token: ["9403dc36-3d71-4363-91b7-32103709647f"]
2025-11-23 19:01:09.143 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:01:09.144 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:01:09.145 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 19:01:09.146 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 19:01:09.148 +02:00 [INF] Adding item to GRN "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:01:09.151 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "c9419c66-ab1f-4857-a967-37221b235ea5" | POLineItemId: "1858baec-01c3-414b-7256-08de2ab1b129" | Qty: 3
2025-11-23 19:01:09.155 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 7.0809ms
2025-11-23 19:01:09.158 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 19:01:09.160 +02:00 [ERR] Application exception occurred: GRN with ID c9419c66-ab1f-4857-a967-37221b235ea5 not found
ModularERP.Common.Exceptions.NotFoundException: GRN with ID c9419c66-ab1f-4857-a967-37221b235ea5 not found
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 72
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 273
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem(Guid id, AddGRNItemCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GRNItemsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:01:09.170 +02:00 [INF] Error response sent with status code 404
2025-11-23 19:01:09.171 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/c9419c66-ab1f-4857-a967-37221b235ea5/items - 404 null application/json; charset=utf-8 51.6045ms
2025-11-23 19:01:26.172 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items - application/json 215
2025-11-23 19:01:26.176 +02:00 [INF] Request started
2025-11-23 19:01:26.177 +02:00 [INF] === Incoming Request ===
2025-11-23 19:01:26.178 +02:00 [INF] Path: /api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items
2025-11-23 19:01:26.179 +02:00 [INF] Method: POST
2025-11-23 19:01:26.180 +02:00 [INF] === Headers ===
2025-11-23 19:01:26.181 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:01:26.182 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:01:26.184 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:01:26.186 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:01:26.188 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:01:26.190 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:01:26.191 +02:00 [INF] Content-Length: ["215"]
2025-11-23 19:01:26.192 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:01:26.194 +02:00 [INF] Postman-Token: ["f127f64f-d1a4-4325-948b-260a1df526e0"]
2025-11-23 19:01:26.195 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:01:26.196 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:01:26.198 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 19:01:26.199 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 19:01:26.203 +02:00 [INF] Adding item to GRN "41ba1408-43be-4085-2c0b-08de2ab1bfb2"
2025-11-23 19:01:26.229 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "41ba1408-43be-4085-2c0b-08de2ab1bfb2" | POLineItemId: "1858baec-01c3-414b-7256-08de2ab1b129" | Qty: 3
2025-11-23 19:01:26.232 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00006 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 19:01:26.239 +02:00 [INF] ‚úÖ POLineItem found | Item: ' Product' | Ordered: 5.000 | Received: 1.000 | Remaining: 4.000
2025-11-23 19:01:26.244 +02:00 [INF] ‚úÖ GRN Line Item created | Id: "d51989e0-5513-4a5f-8894-2e003c05ebfa"
2025-11-23 19:01:26.250 +02:00 [INF] ‚úÖ POLineItem updated | Id: "1858baec-01c3-414b-7256-08de2ab1b129" | Received: 1.000 ‚Üí 4.000 | Remaining: 4.000 ‚Üí 1.000
2025-11-23 19:01:26.254 +02:00 [INF] üîÑ Updating stock | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea" | Product: "3682b908-2698-409b-91be-266ecb7aa3ee" | Qty: 3
2025-11-23 19:01:26.262 +02:00 [INF] ‚úÖ Stock updated | Product: ' Product' | Qty: 55.000 ‚Üí 58.000 | Available: 55.000 ‚Üí 58.000
2025-11-23 19:01:26.265 +02:00 [INF] ‚úÖ‚úÖ‚úÖ GRN Item added successfully | LineItemId: "d51989e0-5513-4a5f-8894-2e003c05ebfa"
2025-11-23 19:01:26.272 +02:00 [INF] Executing CreatedAtActionResult, writing value of type '<>f__AnonymousType145`3[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.GRNLineItemResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-23 19:01:26.275 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 72.6023ms
2025-11-23 19:01:26.277 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 19:01:26.278 +02:00 [INF] Request completed successfully with status code 201
2025-11-23 19:01:26.280 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items - 201 null application/json; charset=utf-8 107.6008ms
2025-11-23 19:01:45.471 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e711ec9dc-2511-4b74-bf26-ef4549616d82 - application/json 288
2025-11-23 19:01:45.475 +02:00 [INF] Request started
2025-11-23 19:01:45.475 +02:00 [INF] === Incoming Request ===
2025-11-23 19:01:45.476 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 19:01:45.477 +02:00 [INF] Method: POST
2025-11-23 19:01:45.479 +02:00 [INF] === Headers ===
2025-11-23 19:01:45.480 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:01:45.481 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:01:45.483 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:01:45.485 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:01:45.487 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:01:45.488 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:01:45.490 +02:00 [INF] Content-Length: ["288"]
2025-11-23 19:01:45.491 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:01:45.492 +02:00 [INF] Postman-Token: ["95c97aa7-ba72-4890-b247-3e14e725b1a3"]
2025-11-23 19:01:45.494 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:01:45.495 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:01:45.497 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 19:01:45.498 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 19:01:45.512 +02:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-11-23 19:01:45.528 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 28.13ms
2025-11-23 19:01:45.531 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 19:01:45.533 +02:00 [INF] Request completed successfully with status code 400
2025-11-23 19:01:45.535 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=e711ec9dc-2511-4b74-bf26-ef4549616d82 - 400 null application/problem+json; charset=utf-8 63.3669ms
2025-11-23 19:02:01.462 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=711ec9dc-2511-4b74-bf26-ef4549616d82 - application/json 288
2025-11-23 19:02:01.465 +02:00 [INF] Request started
2025-11-23 19:02:01.466 +02:00 [INF] === Incoming Request ===
2025-11-23 19:02:01.467 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 19:02:01.468 +02:00 [INF] Method: POST
2025-11-23 19:02:01.469 +02:00 [INF] === Headers ===
2025-11-23 19:02:01.470 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:02:01.472 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:02:01.474 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:02:01.476 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:02:01.478 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:02:01.480 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:02:01.481 +02:00 [INF] Content-Length: ["288"]
2025-11-23 19:02:01.483 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:02:01.484 +02:00 [INF] Postman-Token: ["9e6f7431-c2dd-421c-b0b4-7ad8a10f8b2f"]
2025-11-23 19:02:01.485 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:02:01.487 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:02:01.488 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 19:02:01.489 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 19:02:01.492 +02:00 [INF] Creating refund from Purchase Invoice: "711ec9dc-2511-4b74-bf26-ef4549616d82"
2025-11-23 19:02:01.498 +02:00 [INF] Creating refund from Purchase Invoice: "711ec9dc-2511-4b74-bf26-ef4549616d82"
2025-11-23 19:02:01.535 +02:00 [ERR] Error creating refund from Invoice: "711ec9dc-2511-4b74-bf26-ef4549616d82"
ModularERP.Common.Exceptions.BusinessLogicException: GRN Line Item d51989e0-5513-4a5f-8894-2e003c05ebfa belongs to PO c9419c66-ab1f-4857-a967-37221b235ea5, but invoice is for PO 23d49ad7-c8f3-4545-9bb3-6957cdf43515. Cannot create refund across different Purchase Orders.
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 127
2025-11-23 19:02:01.539 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 47.2289ms
2025-11-23 19:02:01.542 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 19:02:01.545 +02:00 [WRN] Business logic exception occurred: GRN Line Item d51989e0-5513-4a5f-8894-2e003c05ebfa belongs to PO c9419c66-ab1f-4857-a967-37221b235ea5, but invoice is for PO 23d49ad7-c8f3-4545-9bb3-6957cdf43515. Cannot create refund across different Purchase Orders.
ModularERP.Common.Exceptions.BusinessLogicException: GRN Line Item d51989e0-5513-4a5f-8894-2e003c05ebfa belongs to PO c9419c66-ab1f-4857-a967-37221b235ea5, but invoice is for PO 23d49ad7-c8f3-4545-9bb3-6957cdf43515. Cannot create refund across different Purchase Orders.
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_InvoceRefund.CreateRefundFromInvoiceHandler.Handle(CreateRefundFromInvoiceCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_InvoceRefund\CreateRefundFromInvoiceHandler.cs:line 127
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice(Guid invoiceId, CreateRefundFromInvoiceCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Controllers\PurchaseInvoiceRefundsController.cs:line 43
   at lambda_method118(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:02:01.562 +02:00 [INF] Error response sent with status code 400
2025-11-23 19:02:01.564 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=711ec9dc-2511-4b74-bf26-ef4549616d82 - 400 null application/json; charset=utf-8 102.1301ms
2025-11-23 19:03:17.959 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=6814cb5b-07e5-45c1-8de9-70a1e29676ae - application/json 288
2025-11-23 19:03:17.962 +02:00 [INF] Request started
2025-11-23 19:03:17.963 +02:00 [INF] === Incoming Request ===
2025-11-23 19:03:17.965 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 19:03:17.966 +02:00 [INF] Method: POST
2025-11-23 19:03:17.967 +02:00 [INF] === Headers ===
2025-11-23 19:03:17.970 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:03:17.972 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:03:17.973 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:03:17.975 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:03:17.977 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:03:17.978 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:03:17.980 +02:00 [INF] Content-Length: ["288"]
2025-11-23 19:03:17.982 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:03:17.983 +02:00 [INF] Postman-Token: ["4796f535-339d-4bcb-8f49-0933e3428a8e"]
2025-11-23 19:03:17.985 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:03:17.986 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:03:17.987 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 19:03:17.988 +02:00 [INF] Route matched with {action = "CreateRefundFromInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefundFromInvoice(System.Guid, ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundFromInvoiceCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 19:03:17.991 +02:00 [INF] Creating refund from Purchase Invoice: "6814cb5b-07e5-45c1-8de9-70a1e29676ae"
2025-11-23 19:03:17.994 +02:00 [INF] Creating refund from Purchase Invoice: "6814cb5b-07e5-45c1-8de9-70a1e29676ae"
2025-11-23 19:03:18.025 +02:00 [INF] Validated GRNLineItem "d51989e0-5513-4a5f-8894-2e003c05ebfa": GRN.POId="c9419c66-ab1f-4857-a967-37221b235ea5", Invoice.POId="c9419c66-ab1f-4857-a967-37221b235ea5", Match=true
2025-11-23 19:03:18.196 +02:00 [INF] Refund saved to database: REF-20251123-00019
2025-11-23 19:03:18.229 +02:00 [INF] Created Debit Note: DN-20251123-00011 for Refund: REF-20251123-00019
2025-11-23 19:03:18.272 +02:00 [INF] PO PO-202510-0001: Found 2 GRN line items linked to this PO
2025-11-23 19:03:18.293 +02:00 [INF] PO PO-202510-0001 Calculations: Ordered=15.000, Received=4.000, Returned=1.000, Net=3.000, GRNLineCount=2
2025-11-23 19:03:18.308 +02:00 [INF] Updated PO PO-202510-0001 statuses: Reception Partially Received ‚Üí PartiallyReceived, Payment: Refunded
2025-11-23 19:03:18.310 +02:00 [INF] Successfully created refund: REF-20251123-00019 from Invoice: "6814cb5b-07e5-45c1-8de9-70a1e29676ae"
2025-11-23 19:03:18.314 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 19:03:18.323 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP) in 331.8943ms
2025-11-23 19:03:18.325 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.CreateRefundFromInvoice (ModularERP)'
2025-11-23 19:03:18.327 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 19:03:18.328 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=6814cb5b-07e5-45c1-8de9-70a1e29676ae - 200 null application/json; charset=utf-8 368.656ms
2025-11-23 19:08:32.971 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=711ec9dc-2511-4b74-bf26-ef4549616d82 - null null
2025-11-23 19:08:32.978 +02:00 [INF] Request started
2025-11-23 19:08:32.979 +02:00 [INF] === Incoming Request ===
2025-11-23 19:08:32.980 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 19:08:32.982 +02:00 [INF] Method: GET
2025-11-23 19:08:32.984 +02:00 [INF] === Headers ===
2025-11-23 19:08:32.985 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:08:32.987 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:08:32.989 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:08:32.990 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:08:32.992 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:08:32.994 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:08:32.996 +02:00 [INF] Postman-Token: ["3eafe9b4-5d8f-4ce8-88b3-0b6cd8de4a1f"]
2025-11-23 19:08:32.998 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:08:32.999 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:08:33.000 +02:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-11-23 19:08:33.002 +02:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-11-23 19:08:33.003 +02:00 [INF] Request completed successfully with status code 405
2025-11-23 19:08:33.004 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=711ec9dc-2511-4b74-bf26-ef4549616d82 - 405 0 null 33.3562ms
2025-11-23 19:08:37.221 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=711ec9dc-2511-4b74-bf26-ef4549616d82 - null null
2025-11-23 19:08:37.227 +02:00 [INF] Request started
2025-11-23 19:08:37.229 +02:00 [INF] === Incoming Request ===
2025-11-23 19:08:37.229 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 19:08:37.231 +02:00 [INF] Method: GET
2025-11-23 19:08:37.232 +02:00 [INF] === Headers ===
2025-11-23 19:08:37.233 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:08:37.234 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:08:37.236 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:08:37.237 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:08:37.238 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:08:37.240 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:08:37.242 +02:00 [INF] Postman-Token: ["063ed79a-68aa-4cca-a547-d24d91d77d95"]
2025-11-23 19:08:37.244 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:08:37.246 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:08:37.247 +02:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-11-23 19:08:37.248 +02:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-11-23 19:08:37.249 +02:00 [INF] Request completed successfully with status code 405
2025-11-23 19:08:37.250 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=711ec9dc-2511-4b74-bf26-ef4549616d82 - 405 0 null 29.028ms
2025-11-23 19:10:01.409 +02:00 [INF] Starting web host...
2025-11-23 19:10:02.846 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:10:02.946 +02:00 [INF] Executed DbCommand (84ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 19:10:03.014 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:10:03.020 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 19:10:03.037 +02:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 19:10:03.091 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 19:10:03.107 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:10:03.113 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 19:10:03.122 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 19:10:03.134 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 19:10:03.140 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 19:10:03.308 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 19:10:03.316 +02:00 [INF] Master database initialized successfully
2025-11-23 19:10:05.255 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 19:10:05.363 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 19:10:05.365 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 19:10:05.462 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 19:10:05.464 +02:00 [INF] Hosting environment: Development
2025-11-23 19:10:05.466 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 19:10:05.478 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 19:10:05.603 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 125.9845ms
2025-11-23 19:10:05.604 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 19:10:05.604 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 19:10:05.625 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 20.5398ms
2025-11-23 19:10:05.643 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 39.0445ms
2025-11-23 19:10:05.809 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 19:10:06.086 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 276.5471ms
2025-11-23 19:10:12.514 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=711ec9dc-2511-4b74-bf26-ef4549616d82 - null null
2025-11-23 19:10:12.530 +02:00 [INF] Request started
2025-11-23 19:10:12.533 +02:00 [INF] === Incoming Request ===
2025-11-23 19:10:12.535 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds/return
2025-11-23 19:10:12.536 +02:00 [INF] Method: GET
2025-11-23 19:10:12.537 +02:00 [INF] === Headers ===
2025-11-23 19:10:12.539 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:10:12.542 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:10:12.544 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:10:12.545 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:10:12.547 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:10:12.549 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:10:12.550 +02:00 [INF] Postman-Token: ["e9d10a68-77d0-4dd8-9769-a3d77776c632"]
2025-11-23 19:10:12.554 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:10:12.556 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:10:12.557 +02:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-11-23 19:10:12.558 +02:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-11-23 19:10:12.560 +02:00 [INF] Request completed successfully with status code 405
2025-11-23 19:10:12.564 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PurchaseInvoiceRefunds/return?InvoiceId=711ec9dc-2511-4b74-bf26-ef4549616d82 - 405 0 null 49.8705ms
2025-11-23 19:11:58.030 +02:00 [INF] Request starting HTTP/1.1 GET https://localhost:7168/api/PurchaseInvoiceRefunds?InvoiceId=6814cb5b-07e5-45c1-8de9-70a1e29676ae - null null
2025-11-23 19:11:58.050 +02:00 [INF] Request started
2025-11-23 19:11:58.052 +02:00 [INF] === Incoming Request ===
2025-11-23 19:11:58.053 +02:00 [INF] Path: /api/PurchaseInvoiceRefunds
2025-11-23 19:11:58.054 +02:00 [INF] Method: GET
2025-11-23 19:11:58.055 +02:00 [INF] === Headers ===
2025-11-23 19:11:58.056 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:11:58.060 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:11:58.063 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:11:58.064 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:11:58.066 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:11:58.067 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:11:58.070 +02:00 [INF] Postman-Token: ["e3878b51-f965-42da-a056-a8850b7c1140"]
2025-11-23 19:11:58.074 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:11:58.076 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:11:58.077 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.GetRefundsByInvoice (ModularERP)'
2025-11-23 19:11:58.093 +02:00 [INF] Route matched with {action = "GetRefundsByInvoice", controller = "PurchaseInvoiceRefunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[System.Collections.Generic.List`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]]] GetRefundsByInvoice(System.Guid) on controller ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController (ModularERP).
2025-11-23 19:11:58.101 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 19:11:58.111 +02:00 [INF] Retrieving refunds for Purchase Invoice: "6814cb5b-07e5-45c1-8de9-70a1e29676ae"
2025-11-23 19:11:58.181 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:11:58.753 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 19:11:58.758 +02:00 [INF] Retrieving refunds for Invoice: "6814cb5b-07e5-45c1-8de9-70a1e29676ae"
2025-11-23 19:11:59.266 +02:00 [INF] Retrieved 1 refund(s) for Invoice: "6814cb5b-07e5-45c1-8de9-70a1e29676ae"
2025-11-23 19:11:59.273 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[System.Collections.Generic.List`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-23 19:11:59.302 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.GetRefundsByInvoice (ModularERP) in 1201.2137ms
2025-11-23 19:11:59.305 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.PurchaseInvoiceRefundsController.GetRefundsByInvoice (ModularERP)'
2025-11-23 19:11:59.307 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 19:11:59.312 +02:00 [INF] Request finished HTTP/1.1 GET https://localhost:7168/api/PurchaseInvoiceRefunds?InvoiceId=6814cb5b-07e5-45c1-8de9-70a1e29676ae - 200 null application/json; charset=utf-8 1281.2596ms
2025-11-23 19:20:56.638 +02:00 [INF] Starting web host...
2025-11-23 19:20:58.126 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:20:58.212 +02:00 [INF] Executed DbCommand (70ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 19:20:58.305 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:20:58.312 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 19:20:58.329 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 19:20:58.396 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 19:20:58.412 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:20:58.416 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 19:20:58.424 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 19:20:58.436 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 19:20:58.442 +02:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 19:20:58.611 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 19:20:58.619 +02:00 [INF] Master database initialized successfully
2025-11-23 19:21:00.626 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 19:21:00.742 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 19:21:00.745 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 19:21:00.829 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 19:21:00.831 +02:00 [INF] Hosting environment: Development
2025-11-23 19:21:00.832 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 19:21:01.021 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 19:21:01.181 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 160.1056ms
2025-11-23 19:21:01.317 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 19:21:01.317 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 19:21:01.326 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.2032ms
2025-11-23 19:21:01.339 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 22.0826ms
2025-11-23 19:21:01.388 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 19:21:01.686 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 297.3117ms
2025-11-23 19:33:07.007 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Refunds - application/json 398
2025-11-23 19:33:07.032 +02:00 [INF] Request started
2025-11-23 19:33:07.034 +02:00 [INF] === Incoming Request ===
2025-11-23 19:33:07.036 +02:00 [INF] Path: /api/Refunds
2025-11-23 19:33:07.038 +02:00 [INF] Method: POST
2025-11-23 19:33:07.039 +02:00 [INF] === Headers ===
2025-11-23 19:33:07.041 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:33:07.045 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:33:07.046 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:33:07.048 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:33:07.049 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:33:07.051 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:33:07.052 +02:00 [INF] Content-Length: ["398"]
2025-11-23 19:33:07.055 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:33:07.057 +02:00 [INF] Postman-Token: ["57825d67-8caf-4bb6-b908-060c3f921264"]
2025-11-23 19:33:07.062 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:33:07.064 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:33:07.067 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 19:33:07.085 +02:00 [INF] Route matched with {action = "CreateRefund", controller = "Refunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefund(ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController (ModularERP).
2025-11-23 19:33:07.093 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 19:33:07.129 +02:00 [INF] Creating new refund for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 19:33:07.259 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:33:08.034 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 19:33:08.044 +02:00 [INF] Starting refund creation for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 19:33:08.209 +02:00 [INF] Created Debit Note: DN-20251123-00012 for Refund: REF-20251123-00020
2025-11-23 19:33:08.324 +02:00 [ERR] Error creating refund for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_RefundLineItems_GRNLineItems_GRNLineItemId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.GRNLineItems", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:35f26a6e-47c4-4d6a-83a5-b0d11dc750c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2537
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_Refund.CreateRefundHandler.Handle(CreateRefundCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_Refund\CreateRefundHandler.cs:line 108
2025-11-23 19:33:08.386 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP) in 1293.0586ms
2025-11-23 19:33:08.389 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 19:33:08.392 +02:00 [ERR] Unexpected error occurred
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_RefundLineItems_GRNLineItems_GRNLineItemId". The conflict occurred in database "ModularERP_Tenant_ac68e928aa8044b69ff2ed99d02196e4", table "dbo.GRNLineItems", column 'Id'.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__211_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:35f26a6e-47c4-4d6a-83a5-b0d11dc750c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalDatabase.SaveChangesAsync(IList`1 entries, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ModularERP.Modules.Finance.Finance.Infrastructure.Data.FinanceDbContext.SaveChangesAsync(CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Finance\Finance.Infrastructure\Data\FinanceDbContext.cs:line 2537
   at ModularERP.SharedKernel.Repository.GeneralRepository`1.SaveChanges() in E:\ModelerERP\ModularERP\ModularERP\Shared\Repository\GeneralRepository.cs:line 157
   at ModularERP.Modules.Purchases.Refunds.Handlers.Handlers_Refund.CreateRefundHandler.Handle(CreateRefundCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Handlers\Handlers_Refund\CreateRefundHandler.cs:line 108
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund(CreateRefundCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Refunds\Controllers\RefundsController.cs:line 30
   at lambda_method118(Closure, Object)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:33:08.439 +02:00 [INF] Error response sent with status code 500
2025-11-23 19:33:08.446 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Refunds - 500 null application/json; charset=utf-8 1439.6922ms
2025-11-23 19:38:58.701 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Refunds - application/json 398
2025-11-23 19:38:58.720 +02:00 [INF] Request started
2025-11-23 19:38:58.724 +02:00 [INF] === Incoming Request ===
2025-11-23 19:38:58.725 +02:00 [INF] Path: /api/Refunds
2025-11-23 19:38:58.727 +02:00 [INF] Method: POST
2025-11-23 19:38:58.728 +02:00 [INF] === Headers ===
2025-11-23 19:38:58.729 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:38:58.730 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:38:58.732 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:38:58.733 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:38:58.734 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:38:58.736 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:38:58.738 +02:00 [INF] Content-Length: ["398"]
2025-11-23 19:38:58.740 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:38:58.741 +02:00 [INF] Postman-Token: ["e597e471-348c-4220-8692-2a1ef3c850f3"]
2025-11-23 19:38:58.744 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:38:58.745 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:38:58.747 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 19:38:58.749 +02:00 [INF] Route matched with {action = "CreateRefund", controller = "Refunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefund(ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController (ModularERP).
2025-11-23 19:38:58.752 +02:00 [INF] Creating new refund for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 19:38:58.790 +02:00 [INF] Starting refund creation for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 19:38:58.812 +02:00 [INF] Created Debit Note: DN-20251123-00012 for Refund: REF-20251123-00020
2025-11-23 19:38:58.830 +02:00 [INF] Successfully created refund: REF-20251123-00020
2025-11-23 19:38:58.861 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 19:38:58.874 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP) in 123.144ms
2025-11-23 19:38:58.877 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 19:38:58.879 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 19:38:58.880 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Refunds - 200 null application/json; charset=utf-8 179.5246ms
2025-11-23 19:43:59.317 +02:00 [INF] Starting web host...
2025-11-23 19:44:01.046 +02:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:44:01.112 +02:00 [INF] Executed DbCommand (49ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 19:44:01.196 +02:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:44:01.202 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 19:44:01.218 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 19:44:01.282 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 19:44:01.299 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:44:01.305 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 19:44:01.312 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 19:44:01.325 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 19:44:01.332 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 19:44:01.504 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 19:44:01.511 +02:00 [INF] Master database initialized successfully
2025-11-23 19:44:03.609 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 19:44:03.735 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 19:44:03.737 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 19:44:03.823 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 19:44:03.825 +02:00 [INF] Hosting environment: Development
2025-11-23 19:44:03.827 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 19:44:04.071 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 19:44:04.197 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 126.4507ms
2025-11-23 19:44:04.332 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 19:44:04.332 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 19:44:04.341 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.9142ms
2025-11-23 19:44:04.356 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 24.2488ms
2025-11-23 19:44:04.400 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 19:44:04.700 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 299.5761ms
2025-11-23 19:44:07.124 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Refunds - application/json 398
2025-11-23 19:44:07.146 +02:00 [INF] Request started
2025-11-23 19:44:07.149 +02:00 [INF] === Incoming Request ===
2025-11-23 19:44:07.152 +02:00 [INF] Path: /api/Refunds
2025-11-23 19:44:07.153 +02:00 [INF] Method: POST
2025-11-23 19:44:07.156 +02:00 [INF] === Headers ===
2025-11-23 19:44:07.160 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:44:07.164 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:44:07.167 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:44:07.168 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:44:07.170 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:44:07.172 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:44:07.175 +02:00 [INF] Content-Length: ["398"]
2025-11-23 19:44:07.179 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:44:07.180 +02:00 [INF] Postman-Token: ["cf63cdc8-907a-4bcd-ab8c-9b44c775c8c0"]
2025-11-23 19:44:07.187 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:44:07.190 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:44:07.192 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 19:44:07.214 +02:00 [INF] Route matched with {action = "CreateRefund", controller = "Refunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefund(ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController (ModularERP).
2025-11-23 19:44:07.221 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 19:44:07.267 +02:00 [INF] Creating new refund for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 19:44:07.415 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:44:08.233 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 19:44:08.247 +02:00 [INF] Starting refund creation for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 19:44:09.124 +02:00 [INF] Created Debit Note: DN-20251123-00012 for Refund: REF-20251123-00021
2025-11-23 19:44:09.195 +02:00 [INF] Updated PO PO-202510-0005 statuses - Reception: Returned, Payment: Refunded
2025-11-23 19:44:09.232 +02:00 [INF] Successfully created refund: REF-20251123-00021
2025-11-23 19:44:09.243 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 19:44:09.265 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP) in 2044.8125ms
2025-11-23 19:44:09.269 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 19:44:09.271 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 19:44:09.276 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Refunds - 200 null application/json; charset=utf-8 2152.1621ms
2025-11-23 19:47:25.925 +02:00 [INF] Starting web host...
2025-11-23 19:47:27.395 +02:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:47:27.512 +02:00 [INF] Executed DbCommand (101ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 19:47:27.583 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:47:27.589 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 19:47:27.610 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 19:47:27.671 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 19:47:27.687 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 19:47:27.691 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 19:47:27.698 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 19:47:27.712 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 19:47:27.719 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 19:47:27.880 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 19:47:27.888 +02:00 [INF] Master database initialized successfully
2025-11-23 19:47:29.898 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 19:47:30.010 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 19:47:30.012 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 19:47:30.098 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 19:47:30.101 +02:00 [INF] Hosting environment: Development
2025-11-23 19:47:30.102 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 19:47:30.369 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 19:47:30.514 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 145.7626ms
2025-11-23 19:47:30.584 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 19:47:30.584 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 19:47:30.592 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 8.3308ms
2025-11-23 19:47:30.606 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 22.6245ms
2025-11-23 19:47:30.634 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 19:47:30.973 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 338.785ms
2025-11-23 19:49:50.576 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Refunds - application/json 398
2025-11-23 19:49:50.592 +02:00 [INF] Request started
2025-11-23 19:49:50.595 +02:00 [INF] === Incoming Request ===
2025-11-23 19:49:50.597 +02:00 [INF] Path: /api/Refunds
2025-11-23 19:49:50.598 +02:00 [INF] Method: POST
2025-11-23 19:49:50.599 +02:00 [INF] === Headers ===
2025-11-23 19:49:50.602 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:49:50.607 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:49:50.609 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:49:50.611 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:49:50.613 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:49:50.615 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:49:50.616 +02:00 [INF] Content-Length: ["398"]
2025-11-23 19:49:50.618 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:49:50.620 +02:00 [INF] Postman-Token: ["bcbe0ffe-762a-4b24-91d5-7310dcb3c3cd"]
2025-11-23 19:49:50.628 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:49:50.630 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:49:50.631 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 19:49:50.648 +02:00 [INF] Route matched with {action = "CreateRefund", controller = "Refunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefund(ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController (ModularERP).
2025-11-23 19:49:50.656 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 19:49:50.684 +02:00 [INF] Creating new refund for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 19:49:50.798 +02:00 [INF] Executed DbCommand (13ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:49:51.442 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 19:49:51.449 +02:00 [INF] Starting refund creation for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 19:49:52.514 +02:00 [INF] Created Debit Note: DN-20251123-00012 for Refund: REF-20251123-00022
2025-11-23 19:49:52.552 +02:00 [INF] PO PO-202510-0005 is eligible for auto-closure
2025-11-23 19:49:52.610 +02:00 [INF] Updated PO PO-202510-0005 statuses - Reception: Returned, Payment: Refunded, NetReceived: -3.000/10.000, NetPayment: -60222.8000/87.2000
2025-11-23 19:49:52.658 +02:00 [INF] Successfully created refund: REF-20251123-00022
2025-11-23 19:49:52.667 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 19:49:52.694 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP) in 2038.1764ms
2025-11-23 19:49:52.697 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 19:49:52.700 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 19:49:52.706 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Refunds - 200 null application/json; charset=utf-8 2130.3153ms
2025-11-23 19:50:03.144 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Refunds - application/json 398
2025-11-23 19:50:03.160 +02:00 [INF] Request started
2025-11-23 19:50:03.162 +02:00 [INF] === Incoming Request ===
2025-11-23 19:50:03.164 +02:00 [INF] Path: /api/Refunds
2025-11-23 19:50:03.165 +02:00 [INF] Method: POST
2025-11-23 19:50:03.167 +02:00 [INF] === Headers ===
2025-11-23 19:50:03.169 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:50:03.170 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:50:03.173 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:50:03.175 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:50:03.176 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:50:03.178 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:50:03.179 +02:00 [INF] Content-Length: ["398"]
2025-11-23 19:50:03.182 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:50:03.187 +02:00 [INF] Postman-Token: ["c158d575-eded-4da0-ab3e-4ba01ca37ebb"]
2025-11-23 19:50:03.191 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:50:03.193 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:50:03.194 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 19:50:03.195 +02:00 [INF] Route matched with {action = "CreateRefund", controller = "Refunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefund(ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController (ModularERP).
2025-11-23 19:50:03.201 +02:00 [INF] Creating new refund for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 19:50:03.210 +02:00 [INF] Starting refund creation for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 19:50:03.234 +02:00 [INF] Created Debit Note: DN-20251123-00012 for Refund: REF-20251123-00023
2025-11-23 19:50:03.242 +02:00 [INF] PO PO-202510-0005 is eligible for auto-closure
2025-11-23 19:50:03.246 +02:00 [INF] Updated PO PO-202510-0005 statuses - Reception: Returned, Payment: Refunded, NetReceived: -4.000/10.000, NetPayment: -60372.8000/87.2000
2025-11-23 19:50:03.251 +02:00 [INF] Successfully created refund: REF-20251123-00023
2025-11-23 19:50:03.253 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 19:50:03.256 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP) in 57.4913ms
2025-11-23 19:50:03.259 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 19:50:03.261 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 19:50:03.262 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Refunds - 200 null application/json; charset=utf-8 118.3178ms
2025-11-23 19:54:10.366 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - application/json 514
2025-11-23 19:54:10.371 +02:00 [INF] Request started
2025-11-23 19:54:10.372 +02:00 [INF] === Incoming Request ===
2025-11-23 19:54:10.374 +02:00 [INF] Path: /api/GoodsReceipts
2025-11-23 19:54:10.376 +02:00 [INF] Method: POST
2025-11-23 19:54:10.377 +02:00 [INF] === Headers ===
2025-11-23 19:54:10.378 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:54:10.379 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:54:10.381 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:54:10.382 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:54:10.386 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:54:10.390 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:54:10.392 +02:00 [INF] Content-Length: ["514"]
2025-11-23 19:54:10.393 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:54:10.396 +02:00 [INF] Postman-Token: ["5aff4171-71a4-4322-8671-64660c72e559"]
2025-11-23 19:54:10.397 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:54:10.398 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:54:10.399 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 19:54:10.412 +02:00 [INF] Route matched with {action = "CreateGRN", controller = "GoodsReceipts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGRN(ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.CreateGRNDto, System.Threading.CancellationToken) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController (ModularERP).
2025-11-23 19:54:10.425 +02:00 [INF] API: Creating new GRN for PO: "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:54:10.440 +02:00 [INF] Creating new GRN for PO: "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:54:10.457 +02:00 [INF] PO found: PO-202510-0001 | DocumentStatus: Approved | ReceptionStatus: PartiallyReceived
2025-11-23 19:54:10.516 +02:00 [INF] Validating | POLineItemId: "1858baec-01c3-414b-7256-08de2ab1b129" | Item: ' Product' | Ordered: 5.000 | Received: 4.000 | Pending: 1.000 | Attempting: 3
2025-11-23 19:54:10.524 +02:00 [ERR] ‚ùå Error creating GRN. Transaction rolled back. PO: "c9419c66-ab1f-4857-a967-37221b235ea5"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot receive 3 units of ' Product'. Only 1.000 units pending.
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 174
2025-11-23 19:54:10.555 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP) in 138.6815ms
2025-11-23 19:54:10.557 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 19:54:10.560 +02:00 [WRN] Business logic exception occurred: Cannot receive 3 units of ' Product'. Only 1.000 units pending.
ModularERP.Common.Exceptions.BusinessLogicException: Cannot receive 3 units of ' Product'. Only 1.000 units pending.
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 174
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRN.CreateGRNHandler.Handle(CreateGRNCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRN\CreateGRNHandler.cs:line 332
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN(CreateGRNDto request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GoodsReceiptsController.cs:line 35
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:54:10.585 +02:00 [INF] Error response sent with status code 400
2025-11-23 19:54:10.587 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - 400 null application/json; charset=utf-8 221.1076ms
2025-11-23 19:55:00.364 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products/{c2c5790c-9d94-41b1-818a-060d9a0e0b6a}/clone?companyId=82b0fb02-1282-483c-ae26-c8466423707e - null 0
2025-11-23 19:55:00.369 +02:00 [INF] Request started
2025-11-23 19:55:00.370 +02:00 [INF] === Incoming Request ===
2025-11-23 19:55:00.372 +02:00 [INF] Path: /api/Products/%7Bc2c5790c-9d94-41b1-818a-060d9a0e0b6a%7D/clone
2025-11-23 19:55:00.374 +02:00 [INF] Method: POST
2025-11-23 19:55:00.376 +02:00 [INF] === Headers ===
2025-11-23 19:55:00.377 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:55:00.378 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:55:00.380 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:55:00.381 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:55:00.382 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:55:00.392 +02:00 [INF] Content-Length: ["0"]
2025-11-23 19:55:00.394 +02:00 [INF] X-Tenant-ID: ["8bed874f-cf2a-4ffa-a188-4cfef779774a","6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:55:00.396 +02:00 [INF] Postman-Token: ["4c5c9fe8-1236-40a7-8464-a67812292793"]
2025-11-23 19:55:00.398 +02:00 [INF] üîç TenantService returned: '8bed874f-cf2a-4ffa-a188-4cfef779774a'
2025-11-23 19:55:00.399 +02:00 [INF] ‚úÖ Processing request for tenant: 8bed874f-cf2a-4ffa-a188-4cfef779774a
2025-11-23 19:55:00.402 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CloneProduct (ModularERP)'
2025-11-23 19:55:00.408 +02:00 [INF] Route matched with {action = "CloneProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CloneProduct(System.Guid, System.Guid) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-11-23 19:55:00.424 +02:00 [INF] Cloning product "c2c5790c-9d94-41b1-818a-060d9a0e0b6a" for company "82b0fb02-1282-483c-ae26-c8466423707e"
2025-11-23 19:55:00.482 +02:00 [INF] Executed DbCommand (12ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:55:00.488 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:55:00.492 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:55:00.496 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:55:00.500 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:55:00.506 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:55:00.510 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:55:00.515 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:55:00.519 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 19:55:00.558 +02:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CloneProduct (ModularERP) in 144.9947ms
2025-11-23 19:55:00.561 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CloneProduct (ModularERP)'
2025-11-23 19:55:00.562 +02:00 [ERR] Application exception occurred: Product not found or does not belong to this company
ModularERP.Common.Exceptions.NotFoundException: Product not found or does not belong to this company
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.CloneProductCommandHandler.Handle(CloneProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\CloneProductCommandHandler.cs:line 60
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CloneProduct(Guid id, Guid companyId) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 142
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:55:00.582 +02:00 [INF] Error response sent with status code 404
2025-11-23 19:55:00.584 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products/{c2c5790c-9d94-41b1-818a-060d9a0e0b6a}/clone?companyId=82b0fb02-1282-483c-ae26-c8466423707e - 404 null application/json; charset=utf-8 219.6165ms
2025-11-23 19:55:03.001 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products/{c2c5790c-9d94-41b1-818a-060d9a0e0b6a}/clone?companyId=82b0fb02-1282-483c-ae26-c8466423707e - null 0
2025-11-23 19:55:03.007 +02:00 [INF] Request started
2025-11-23 19:55:03.008 +02:00 [INF] === Incoming Request ===
2025-11-23 19:55:03.009 +02:00 [INF] Path: /api/Products/%7Bc2c5790c-9d94-41b1-818a-060d9a0e0b6a%7D/clone
2025-11-23 19:55:03.012 +02:00 [INF] Method: POST
2025-11-23 19:55:03.013 +02:00 [INF] === Headers ===
2025-11-23 19:55:03.014 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:55:03.015 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:55:03.017 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:55:03.021 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:55:03.023 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:55:03.025 +02:00 [INF] Content-Length: ["0"]
2025-11-23 19:55:03.026 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:55:03.028 +02:00 [INF] Postman-Token: ["bca4f27a-a367-4d07-a3e6-7d8f4e28d761"]
2025-11-23 19:55:03.032 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:55:03.033 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:55:03.034 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CloneProduct (ModularERP)'
2025-11-23 19:55:03.036 +02:00 [INF] Route matched with {action = "CloneProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CloneProduct(System.Guid, System.Guid) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-11-23 19:55:03.041 +02:00 [INF] Cloning product "c2c5790c-9d94-41b1-818a-060d9a0e0b6a" for company "82b0fb02-1282-483c-ae26-c8466423707e"
2025-11-23 19:55:03.049 +02:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CloneProduct (ModularERP) in 8.0527ms
2025-11-23 19:55:03.054 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CloneProduct (ModularERP)'
2025-11-23 19:55:03.055 +02:00 [ERR] Application exception occurred: Product not found or does not belong to this company
ModularERP.Common.Exceptions.NotFoundException: Product not found or does not belong to this company
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.CloneProductCommandHandler.Handle(CloneProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\CloneProductCommandHandler.cs:line 60
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CloneProduct(Guid id, Guid companyId) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 142
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:55:03.078 +02:00 [INF] Error response sent with status code 404
2025-11-23 19:55:03.080 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products/{c2c5790c-9d94-41b1-818a-060d9a0e0b6a}/clone?companyId=82b0fb02-1282-483c-ae26-c8466423707e - 404 null application/json; charset=utf-8 79.4225ms
2025-11-23 19:55:19.017 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products - application/json 925
2025-11-23 19:55:19.166 +02:00 [INF] Request started
2025-11-23 19:55:19.167 +02:00 [INF] === Incoming Request ===
2025-11-23 19:55:19.168 +02:00 [INF] Path: /api/Products
2025-11-23 19:55:19.171 +02:00 [INF] Method: POST
2025-11-23 19:55:19.173 +02:00 [INF] === Headers ===
2025-11-23 19:55:19.174 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:55:19.175 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:55:19.177 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:55:19.181 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:55:19.183 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:55:19.185 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:55:19.186 +02:00 [INF] Content-Length: ["925"]
2025-11-23 19:55:19.188 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:55:19.191 +02:00 [INF] Postman-Token: ["41524224-4825-45e7-a9ec-169d43d66ede"]
2025-11-23 19:55:19.201 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:55:19.205 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:55:19.212 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-11-23 19:55:19.226 +02:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(ModularERP.Modules.Inventory.Features.Products.DTO.CreateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-11-23 19:55:19.248 +02:00 [INF] Creating new product with SKU SKU-107 for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-11-23 19:55:19.281 +02:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP) in 51.0411ms
2025-11-23 19:55:19.284 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-11-23 19:55:19.286 +02:00 [WRN] Validation exception occurred: Product validation failed. Validation errors: {"SKU":["SKU already exists for this company"],"Barcode":["Barcode already exists for this company"]}
ModularERP.Common.Exceptions.ValidationException: Product validation failed
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.CreateProductCommandHandler.ValidateProduct(CreateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\CreateProductCommandHandler.cs:line 181
   at ModularERP.Modules.Inventory.Features.Products.Handlers.Handlers_Product.CreateProductCommandHandler.Handle(CreateProductCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Handlers\Handlers_Product\CreateProductCommandHandler.cs:line 61
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct(CreateProductDto dto) in E:\ModelerERP\ModularERP\ModularERP\Modules\Inventory\Features\Products\Controllers\ProductsController.cs:line 74
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:55:19.321 +02:00 [INF] Error response sent with status code 400
2025-11-23 19:55:19.324 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products - 400 null application/json; charset=utf-8 307.0406ms
2025-11-23 19:55:44.634 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Products - application/json 925
2025-11-23 19:55:44.639 +02:00 [INF] Request started
2025-11-23 19:55:44.640 +02:00 [INF] === Incoming Request ===
2025-11-23 19:55:44.642 +02:00 [INF] Path: /api/Products
2025-11-23 19:55:44.645 +02:00 [INF] Method: POST
2025-11-23 19:55:44.647 +02:00 [INF] === Headers ===
2025-11-23 19:55:44.648 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:55:44.650 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:55:44.652 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:55:44.656 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:55:44.658 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:55:44.660 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:55:44.662 +02:00 [INF] Content-Length: ["925"]
2025-11-23 19:55:44.665 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:55:44.667 +02:00 [INF] Postman-Token: ["604b266f-2134-4e3d-ac83-8e729bf70bde"]
2025-11-23 19:55:44.669 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:55:44.670 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:55:44.672 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-11-23 19:55:44.677 +02:00 [INF] Route matched with {action = "CreateProduct", controller = "Products"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateProduct(ModularERP.Modules.Inventory.Features.Products.DTO.CreateProductDto) on controller ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController (ModularERP).
2025-11-23 19:55:44.682 +02:00 [INF] Creating new product with SKU SKU-108 for company "90137c92-382d-404c-bade-e5fefb1e8dbf"
2025-11-23 19:55:45.031 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Inventory.Features.Products.DTO.ProductDetailsDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 19:55:45.042 +02:00 [INF] Executed action ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP) in 360.47ms
2025-11-23 19:55:45.045 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Inventory.Features.Products.Controllers.ProductsController.CreateProduct (ModularERP)'
2025-11-23 19:55:45.046 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 19:55:45.048 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Products - 200 null application/json; charset=utf-8 413.3502ms
2025-11-23 19:56:18.055 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9419c66-ab1f-4857-a967-37221b235ea5}/items - application/json 306
2025-11-23 19:56:18.062 +02:00 [INF] Request started
2025-11-23 19:56:18.063 +02:00 [INF] === Incoming Request ===
2025-11-23 19:56:18.065 +02:00 [INF] Path: /api/purchase-orders/%7Bc9419c66-ab1f-4857-a967-37221b235ea5%7D/items
2025-11-23 19:56:18.066 +02:00 [INF] Method: POST
2025-11-23 19:56:18.067 +02:00 [INF] === Headers ===
2025-11-23 19:56:18.068 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:56:18.070 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:56:18.072 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:56:18.074 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:56:18.077 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:56:18.079 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:56:18.081 +02:00 [INF] Content-Length: ["306"]
2025-11-23 19:56:18.082 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:56:18.085 +02:00 [INF] Postman-Token: ["5ea503fd-7132-463e-a02b-33229fa88d49"]
2025-11-23 19:56:18.086 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:56:18.088 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:56:18.089 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 19:56:18.093 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 19:56:18.102 +02:00 [INF] POST request received to create line item for PO "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:56:18.107 +02:00 [INF] Creating line item for Purchase Order "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:56:18.118 +02:00 [ERR] Error creating line item for Purchase Order "c9419c66-ab1f-4857-a967-37221b235ea5"
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
2025-11-23 19:56:18.121 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 23.0111ms
2025-11-23 19:56:18.124 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 19:56:18.125 +02:00 [WRN] Business logic exception occurred: Cannot add items to Purchase Order in Approved status
ModularERP.Common.Exceptions.BusinessLogicException: Cannot add items to Purchase Order in Approved status
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Handlers.Handlers_POItme.CreatePOLineItemHandler.Handle(CreatePOLineItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Handlers\Handlers_POItme\CreatePOLineItemHandler.cs:line 59
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem(Guid purchaseOrderId, CreatePOLineItemDto lineItem) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Purchase_Order_Management\Controllers\POLineItemController.cs:line 104
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:56:18.148 +02:00 [INF] Error response sent with status code 400
2025-11-23 19:56:18.150 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9419c66-ab1f-4857-a967-37221b235ea5}/items - 400 null application/json; charset=utf-8 94.3891ms
2025-11-23 19:56:50.523 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9419c66-ab1f-4857-a967-37221b235ea5}/items - application/json 306
2025-11-23 19:56:50.528 +02:00 [INF] Request started
2025-11-23 19:56:50.529 +02:00 [INF] === Incoming Request ===
2025-11-23 19:56:50.531 +02:00 [INF] Path: /api/purchase-orders/%7Bc9419c66-ab1f-4857-a967-37221b235ea5%7D/items
2025-11-23 19:56:50.534 +02:00 [INF] Method: POST
2025-11-23 19:56:50.536 +02:00 [INF] === Headers ===
2025-11-23 19:56:50.537 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:56:50.539 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:56:50.541 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:56:50.542 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:56:50.545 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:56:50.547 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:56:50.549 +02:00 [INF] Content-Length: ["306"]
2025-11-23 19:56:50.550 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:56:50.552 +02:00 [INF] Postman-Token: ["f14a8af5-3951-4dae-83db-045f8f396472"]
2025-11-23 19:56:50.555 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:56:50.556 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:56:50.558 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 19:56:50.559 +02:00 [INF] Route matched with {action = "CreateLineItem", controller = "POLineItem"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateLineItem(System.Guid, ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.CreatePOLineItemDto) on controller ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController (ModularERP).
2025-11-23 19:56:50.562 +02:00 [INF] POST request received to create line item for PO "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:56:50.568 +02:00 [INF] Creating line item for Purchase Order "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:56:50.662 +02:00 [INF] Line item "3b740612-745b-4e16-0788-08de2ab9adcf" created successfully for PO "c9419c66-ab1f-4857-a967-37221b235ea5". Subtotal: 75000, Discount: 7500.0, Tax: 10125.0000, Total: 77625.0000
2025-11-23 19:56:50.691 +02:00 [INF] Executing CreatedAtActionResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Purchase_Order_Management.DTO.DTO_POItme.POLineItemResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 19:56:50.714 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP) in 152.1981ms
2025-11-23 19:56:50.717 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Purchase_Order_Management.Controllers.POLineItemController.CreateLineItem (ModularERP)'
2025-11-23 19:56:50.720 +02:00 [INF] Request completed successfully with status code 201
2025-11-23 19:56:50.721 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/purchase-orders/{c9419c66-ab1f-4857-a967-37221b235ea5}/items - 201 null application/json; charset=utf-8 197.4613ms
2025-11-23 19:57:24.153 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - application/json 514
2025-11-23 19:57:24.157 +02:00 [INF] Request started
2025-11-23 19:57:24.158 +02:00 [INF] === Incoming Request ===
2025-11-23 19:57:24.160 +02:00 [INF] Path: /api/GoodsReceipts
2025-11-23 19:57:24.163 +02:00 [INF] Method: POST
2025-11-23 19:57:24.165 +02:00 [INF] === Headers ===
2025-11-23 19:57:24.165 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:57:24.167 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:57:24.168 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:57:24.170 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:57:24.172 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:57:24.175 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:57:24.177 +02:00 [INF] Content-Length: ["514"]
2025-11-23 19:57:24.179 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:57:24.180 +02:00 [INF] Postman-Token: ["7f33e3e9-db42-4e27-bbaf-47ed7cb0addf"]
2025-11-23 19:57:24.182 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:57:24.184 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:57:24.185 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 19:57:24.188 +02:00 [INF] Route matched with {action = "CreateGRN", controller = "GoodsReceipts"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateGRN(ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.CreateGRNDto, System.Threading.CancellationToken) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController (ModularERP).
2025-11-23 19:57:24.192 +02:00 [INF] API: Creating new GRN for PO: "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:57:24.200 +02:00 [INF] Creating new GRN for PO: "c9419c66-ab1f-4857-a967-37221b235ea5"
2025-11-23 19:57:24.206 +02:00 [INF] PO found: PO-202510-0001 | DocumentStatus: Approved | ReceptionStatus: PartiallyReceived
2025-11-23 19:57:24.223 +02:00 [INF] Validating | POLineItemId: "3b740612-745b-4e16-0788-08de2ab9adcf" | Item: ' Product' | Ordered: 5.000 | Received: 0.000 | Pending: 5.000 | Attempting: 3
2025-11-23 19:57:24.240 +02:00 [INF] Generated GRN Number: GRN-2025-00007
2025-11-23 19:57:24.282 +02:00 [INF] ‚úÖ GRN entity created with Id: "6ad32dc9-cae7-48cd-6708-08de2ab9c1d5"
2025-11-23 19:57:24.289 +02:00 [INF] ‚úÖ Updated PO Line Item | POLineItemId: "3b740612-745b-4e16-0788-08de2ab9adcf" | Previous: 0.000 | New: 3.000 | Increment: 3
2025-11-23 19:57:24.293 +02:00 [INF] üîÑ Starting Warehouse Stock update...
2025-11-23 19:57:24.306 +02:00 [INF] ‚úÖ Stock Updated | ProductId: "cdd425c1-5c02-4617-a0e3-b9b35561fb61" | Product: ' Product' | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea" | Previous Qty: 50.000 | Added: 3 | New Qty: 53.000
2025-11-23 19:57:24.311 +02:00 [INF] ‚úÖ Warehouse Stock update completed successfully
2025-11-23 19:57:24.318 +02:00 [INF] üìä PO Status Update | PO: PO-202510-0001 | Previous: PartiallyReceived | New: Partially Received
2025-11-23 19:57:24.330 +02:00 [INF] ‚úÖ‚úÖ‚úÖ GRN created successfully | GRN: GRN-2025-00007 | PO: PO-202510-0001
2025-11-23 19:57:24.378 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.GRNResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 19:57:24.388 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP) in 196.5692ms
2025-11-23 19:57:24.391 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GoodsReceiptsController.CreateGRN (ModularERP)'
2025-11-23 19:57:24.393 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 19:57:24.395 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/GoodsReceipts - 200 null application/json; charset=utf-8 241.7197ms
2025-11-23 19:57:39.212 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items - application/json 215
2025-11-23 19:57:39.217 +02:00 [INF] Request started
2025-11-23 19:57:39.218 +02:00 [INF] === Incoming Request ===
2025-11-23 19:57:39.220 +02:00 [INF] Path: /api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items
2025-11-23 19:57:39.222 +02:00 [INF] Method: POST
2025-11-23 19:57:39.224 +02:00 [INF] === Headers ===
2025-11-23 19:57:39.225 +02:00 [INF] Accept: ["*/*"]
2025-11-23 19:57:39.226 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 19:57:39.228 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 19:57:39.230 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 19:57:39.233 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 19:57:39.236 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 19:57:39.238 +02:00 [INF] Content-Length: ["215"]
2025-11-23 19:57:39.239 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 19:57:39.242 +02:00 [INF] Postman-Token: ["1e10da58-1c12-46d4-87ca-96d5d064b312"]
2025-11-23 19:57:39.245 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 19:57:39.246 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 19:57:39.247 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 19:57:39.252 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 19:57:39.259 +02:00 [INF] Adding item to GRN "41ba1408-43be-4085-2c0b-08de2ab1bfb2"
2025-11-23 19:57:39.273 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "41ba1408-43be-4085-2c0b-08de2ab1bfb2" | POLineItemId: "1858baec-01c3-414b-7256-08de2ab1b129" | Qty: 3
2025-11-23 19:57:39.282 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00006 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 19:57:39.293 +02:00 [INF] ‚úÖ POLineItem found | Item: ' Product' | Ordered: 5.000 | Received: 4.000 | Remaining: 1.000
2025-11-23 19:57:39.297 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 40.5605ms
2025-11-23 19:57:39.299 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 19:57:39.302 +02:00 [WRN] Business logic exception occurred: Cannot receive 3 units of ' Product'. Only 1.000 units pending
ModularERP.Common.Exceptions.BusinessLogicException: Cannot receive 3 units of ' Product'. Only 1.000 units pending
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 149
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 273
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem(Guid id, AddGRNItemCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GRNItemsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 19:57:39.326 +02:00 [INF] Error response sent with status code 400
2025-11-23 19:57:39.327 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items - 400 null application/json; charset=utf-8 114.0474ms
2025-11-23 20:01:52.327 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items - application/json 215
2025-11-23 20:01:52.331 +02:00 [INF] Request started
2025-11-23 20:01:52.333 +02:00 [INF] === Incoming Request ===
2025-11-23 20:01:52.334 +02:00 [INF] Path: /api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items
2025-11-23 20:01:52.335 +02:00 [INF] Method: POST
2025-11-23 20:01:52.339 +02:00 [INF] === Headers ===
2025-11-23 20:01:52.341 +02:00 [INF] Accept: ["*/*"]
2025-11-23 20:01:52.342 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 20:01:52.344 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 20:01:52.345 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 20:01:52.349 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 20:01:52.351 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 20:01:52.354 +02:00 [INF] Content-Length: ["215"]
2025-11-23 20:01:52.356 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 20:01:52.358 +02:00 [INF] Postman-Token: ["5005f03c-8379-44a7-a8ee-4cbe62742431"]
2025-11-23 20:01:52.360 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 20:01:52.361 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 20:01:52.362 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 20:01:52.364 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 20:01:52.369 +02:00 [INF] Adding item to GRN "41ba1408-43be-4085-2c0b-08de2ab1bfb2"
2025-11-23 20:01:52.376 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "41ba1408-43be-4085-2c0b-08de2ab1bfb2" | POLineItemId: "1858baec-01c3-414b-7256-08de2ab1b129" | Qty: 3
2025-11-23 20:01:52.385 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00006 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 20:01:52.392 +02:00 [INF] ‚úÖ POLineItem found | Item: ' Product' | Ordered: 5.000 | Received: 4.000 | Remaining: 1.000
2025-11-23 20:01:52.396 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 28.2137ms
2025-11-23 20:01:52.398 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 20:01:52.401 +02:00 [WRN] Business logic exception occurred: Cannot receive 3 units of ' Product'. Only 1.000 units pending
ModularERP.Common.Exceptions.BusinessLogicException: Cannot receive 3 units of ' Product'. Only 1.000 units pending
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 149
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 273
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem(Guid id, AddGRNItemCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GRNItemsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 20:01:52.423 +02:00 [INF] Error response sent with status code 400
2025-11-23 20:01:52.425 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items - 400 null application/json; charset=utf-8 98.0052ms
2025-11-23 20:03:24.901 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items - application/json 215
2025-11-23 20:03:24.905 +02:00 [INF] Request started
2025-11-23 20:03:24.907 +02:00 [INF] === Incoming Request ===
2025-11-23 20:03:24.908 +02:00 [INF] Path: /api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items
2025-11-23 20:03:24.909 +02:00 [INF] Method: POST
2025-11-23 20:03:24.912 +02:00 [INF] === Headers ===
2025-11-23 20:03:24.913 +02:00 [INF] Accept: ["*/*"]
2025-11-23 20:03:24.914 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 20:03:24.916 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 20:03:24.918 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 20:03:24.922 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 20:03:24.924 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 20:03:24.925 +02:00 [INF] Content-Length: ["215"]
2025-11-23 20:03:24.927 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 20:03:24.928 +02:00 [INF] Postman-Token: ["8c7605f2-61d9-4984-be67-ef7c693d226d"]
2025-11-23 20:03:24.930 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 20:03:24.933 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 20:03:24.935 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 20:03:24.936 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 20:03:24.940 +02:00 [INF] Adding item to GRN "41ba1408-43be-4085-2c0b-08de2ab1bfb2"
2025-11-23 20:03:24.946 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "41ba1408-43be-4085-2c0b-08de2ab1bfb2" | POLineItemId: "4a06bf9b-14b1-4550-bad0-08de2aabddbb" | Qty: 3
2025-11-23 20:03:24.951 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00006 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 20:03:24.959 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 19.4907ms
2025-11-23 20:03:24.963 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 20:03:24.964 +02:00 [WRN] Business logic exception occurred: Line item does not belong to the same Purchase Order
ModularERP.Common.Exceptions.BusinessLogicException: Line item does not belong to the same Purchase Order
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 111
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 273
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem(Guid id, AddGRNItemCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GRNItemsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 20:03:24.988 +02:00 [INF] Error response sent with status code 400
2025-11-23 20:03:24.990 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/41ba1408-43be-4085-2c0b-08de2ab1bfb2/items - 400 null application/json; charset=utf-8 88.741ms
2025-11-23 20:05:08.849 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/c9fe6356-33a0-4702-9163-c600c1acc33a/items - application/json 215
2025-11-23 20:05:08.853 +02:00 [INF] Request started
2025-11-23 20:05:08.855 +02:00 [INF] === Incoming Request ===
2025-11-23 20:05:08.856 +02:00 [INF] Path: /api/goods-receipts/c9fe6356-33a0-4702-9163-c600c1acc33a/items
2025-11-23 20:05:08.857 +02:00 [INF] Method: POST
2025-11-23 20:05:08.861 +02:00 [INF] === Headers ===
2025-11-23 20:05:08.863 +02:00 [INF] Accept: ["*/*"]
2025-11-23 20:05:08.865 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 20:05:08.867 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 20:05:08.870 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 20:05:08.872 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 20:05:08.874 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 20:05:08.875 +02:00 [INF] Content-Length: ["215"]
2025-11-23 20:05:08.877 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 20:05:08.879 +02:00 [INF] Postman-Token: ["5d17af1e-7f15-49ea-969c-f6206c2150e1"]
2025-11-23 20:05:08.881 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 20:05:08.883 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 20:05:08.885 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 20:05:08.887 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 20:05:08.891 +02:00 [INF] Adding item to GRN "c9fe6356-33a0-4702-9163-c600c1acc33a"
2025-11-23 20:05:08.894 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "c9fe6356-33a0-4702-9163-c600c1acc33a" | POLineItemId: "4a06bf9b-14b1-4550-bad0-08de2aabddbb" | Qty: 3
2025-11-23 20:05:08.897 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 6.3002ms
2025-11-23 20:05:08.901 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 20:05:08.903 +02:00 [ERR] Application exception occurred: GRN with ID c9fe6356-33a0-4702-9163-c600c1acc33a not found
ModularERP.Common.Exceptions.NotFoundException: GRN with ID c9fe6356-33a0-4702-9163-c600c1acc33a not found
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 72
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 273
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem(Guid id, AddGRNItemCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GRNItemsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 20:05:08.925 +02:00 [INF] Error response sent with status code 404
2025-11-23 20:05:08.926 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/c9fe6356-33a0-4702-9163-c600c1acc33a/items - 404 null application/json; charset=utf-8 77.5149ms
2025-11-23 20:10:37.708 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/23d49ad7-c8f3-4545-9bb3-6957cdf43515/items - application/json 215
2025-11-23 20:10:37.712 +02:00 [INF] Request started
2025-11-23 20:10:37.713 +02:00 [INF] === Incoming Request ===
2025-11-23 20:10:37.714 +02:00 [INF] Path: /api/goods-receipts/23d49ad7-c8f3-4545-9bb3-6957cdf43515/items
2025-11-23 20:10:37.715 +02:00 [INF] Method: POST
2025-11-23 20:10:37.716 +02:00 [INF] === Headers ===
2025-11-23 20:10:37.717 +02:00 [INF] Accept: ["*/*"]
2025-11-23 20:10:37.720 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 20:10:37.721 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 20:10:37.723 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 20:10:37.725 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 20:10:37.729 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 20:10:37.730 +02:00 [INF] Content-Length: ["215"]
2025-11-23 20:10:37.732 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 20:10:37.733 +02:00 [INF] Postman-Token: ["f8e61e93-f7a3-45d8-808a-9f766cbd2320"]
2025-11-23 20:10:37.735 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 20:10:37.736 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 20:10:37.737 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 20:10:37.740 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 20:10:37.744 +02:00 [INF] Adding item to GRN "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 20:10:37.749 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "23d49ad7-c8f3-4545-9bb3-6957cdf43515" | POLineItemId: "172d5908-2ebf-4fa0-5816-08de25364791" | Qty: 3
2025-11-23 20:10:37.756 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 13.034ms
2025-11-23 20:10:37.759 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 20:10:37.761 +02:00 [ERR] Application exception occurred: GRN with ID 23d49ad7-c8f3-4545-9bb3-6957cdf43515 not found
ModularERP.Common.Exceptions.NotFoundException: GRN with ID 23d49ad7-c8f3-4545-9bb3-6957cdf43515 not found
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 72
   at ModularERP.Modules.Purchases.Goods_Receipt.Handlers.Handlers_GRNItem.AddGRNItemHandler.Handle(AddGRNItemCommand request, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Handlers\Handlers_GRNItem\AddGRNItemHandler.cs:line 273
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Common.Behaviors.ValidationBehavior`2.Handle(TRequest request, RequestHandlerDelegate`1 next, CancellationToken cancellationToken) in E:\ModelerERP\ModularERP\ModularERP\Common\Behaviors\ValidationBehavior.cs:line 48
   at ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem(Guid id, AddGRNItemCommand command) in E:\ModelerERP\ModularERP\ModularERP\Modules\Purchases\Goods_Receipt\Controllers\GRNItemsController.cs:line 37
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ModularERP.Program.<>c.<<Main>b__0_7>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 356
--- End of stack trace from previous location ---
   at ModularERP.Program.<>c.<<Main>b__0_6>d.MoveNext() in E:\ModelerERP\ModularERP\ModularERP\Program.cs:line 309
--- End of stack trace from previous location ---
   at ModularERP.Common.Middleware.GlobalErrorHandlerMiddleware.InvokeAsync(HttpContext context, RequestDelegate next) in E:\ModelerERP\ModularERP\ModularERP\Common\Middleware\GlobalErrorHandlerMiddleware.cs:line 40
2025-11-23 20:10:37.783 +02:00 [INF] Error response sent with status code 404
2025-11-23 20:10:37.785 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/23d49ad7-c8f3-4545-9bb3-6957cdf43515/items - 404 null application/json; charset=utf-8 76.9702ms
2025-11-23 20:10:56.443 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/goods-receipts/4551af5e-07dc-4e2e-845e-08de25d1f362/items - application/json 215
2025-11-23 20:10:56.447 +02:00 [INF] Request started
2025-11-23 20:10:56.448 +02:00 [INF] === Incoming Request ===
2025-11-23 20:10:56.449 +02:00 [INF] Path: /api/goods-receipts/4551af5e-07dc-4e2e-845e-08de25d1f362/items
2025-11-23 20:10:56.450 +02:00 [INF] Method: POST
2025-11-23 20:10:56.451 +02:00 [INF] === Headers ===
2025-11-23 20:10:56.454 +02:00 [INF] Accept: ["*/*"]
2025-11-23 20:10:56.455 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 20:10:56.457 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 20:10:56.458 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 20:10:56.460 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 20:10:56.461 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 20:10:56.464 +02:00 [INF] Content-Length: ["215"]
2025-11-23 20:10:56.465 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 20:10:56.467 +02:00 [INF] Postman-Token: ["cd245241-ffdb-4f59-8cf0-f82fe52fbe93"]
2025-11-23 20:10:56.469 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 20:10:56.471 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 20:10:56.472 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 20:10:56.475 +02:00 [INF] Route matched with {action = "AddGRNItem", controller = "GRNItems"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AddGRNItem(System.Guid, ModularERP.Modules.Purchases.Goods_Receipt.Commends.Commends_GRNItem.AddGRNItemCommand) on controller ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController (ModularERP).
2025-11-23 20:10:56.478 +02:00 [INF] Adding item to GRN "4551af5e-07dc-4e2e-845e-08de25d1f362"
2025-11-23 20:10:56.480 +02:00 [INF] üîµ Starting AddGRNItem | GRNId: "4551af5e-07dc-4e2e-845e-08de25d1f362" | POLineItemId: "172d5908-2ebf-4fa0-5816-08de25364791" | Qty: 3
2025-11-23 20:10:56.482 +02:00 [INF] ‚úÖ GRN found | Number: GRN-2025-00001 | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea"
2025-11-23 20:10:56.489 +02:00 [INF] ‚úÖ POLineItem found | Item: ' Product' | Ordered: 5.000 | Received: 1.000 | Remaining: 13.000
2025-11-23 20:10:56.502 +02:00 [INF] ‚úÖ GRN Line Item created | Id: "cb3e6031-1016-4627-9d69-0889c495bc22"
2025-11-23 20:10:56.509 +02:00 [INF] ‚úÖ POLineItem updated | Id: "172d5908-2ebf-4fa0-5816-08de25364791" | Received: 1.000 ‚Üí 4.000 | Remaining: 13.000 ‚Üí 1.000
2025-11-23 20:10:56.514 +02:00 [INF] üîÑ Updating stock | Warehouse: "e5d0bbaa-9099-43e1-bb16-f9744078a9ea" | Product: "1455fbe8-d0b2-4615-b998-5b00ed509ab7" | Qty: 3
2025-11-23 20:10:56.523 +02:00 [INF] ‚úÖ Stock updated | Product: ' Product' | Qty: 93.000 ‚Üí 96.000 | Available: 93.000 ‚Üí 96.000
2025-11-23 20:10:56.526 +02:00 [INF] ‚úÖ‚úÖ‚úÖ GRN Item added successfully | LineItemId: "cb3e6031-1016-4627-9d69-0889c495bc22"
2025-11-23 20:10:56.540 +02:00 [INF] Executing CreatedAtActionResult, writing value of type '<>f__AnonymousType145`3[[System.Boolean, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Goods_Receipt.DTO.DTO_GRN.GRNLineItemResponseDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]], ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null],[System.String, System.Private.CoreLib, Version=9.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-11-23 20:10:56.546 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP) in 68.3125ms
2025-11-23 20:10:56.550 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Goods_Receipt.Controllers.GRNItemsController.AddGRNItem (ModularERP)'
2025-11-23 20:10:56.554 +02:00 [INF] Request completed successfully with status code 201
2025-11-23 20:10:56.556 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/goods-receipts/4551af5e-07dc-4e2e-845e-08de25d1f362/items - 201 null application/json; charset=utf-8 113.0332ms
2025-11-23 20:11:12.938 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Refunds - application/json 398
2025-11-23 20:11:12.941 +02:00 [INF] Request started
2025-11-23 20:11:12.942 +02:00 [INF] === Incoming Request ===
2025-11-23 20:11:12.943 +02:00 [INF] Path: /api/Refunds
2025-11-23 20:11:12.945 +02:00 [INF] Method: POST
2025-11-23 20:11:12.946 +02:00 [INF] === Headers ===
2025-11-23 20:11:12.949 +02:00 [INF] Accept: ["*/*"]
2025-11-23 20:11:12.951 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 20:11:12.953 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 20:11:12.955 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 20:11:12.958 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 20:11:12.959 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 20:11:12.961 +02:00 [INF] Content-Length: ["398"]
2025-11-23 20:11:12.963 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 20:11:12.965 +02:00 [INF] Postman-Token: ["aa693e71-8d91-4a86-bfa8-f06fe316c0a3"]
2025-11-23 20:11:12.967 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 20:11:12.969 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 20:11:12.970 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 20:11:12.972 +02:00 [INF] Route matched with {action = "CreateRefund", controller = "Refunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefund(ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController (ModularERP).
2025-11-23 20:11:12.975 +02:00 [INF] Creating new refund for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 20:11:12.984 +02:00 [INF] Starting refund creation for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 20:11:13.030 +02:00 [INF] Created Debit Note: DN-20251123-00012 for Refund: REF-20251123-00024
2025-11-23 20:11:13.038 +02:00 [INF] PO PO-202510-0005 is eligible for auto-closure
2025-11-23 20:11:13.042 +02:00 [INF] Updated PO PO-202510-0005 statuses - Reception: Returned, Payment: Refunded, NetReceived: -2.000/10.000, NetPayment: -60522.8000/87.2000
2025-11-23 20:11:13.054 +02:00 [INF] Successfully created refund: REF-20251123-00024
2025-11-23 20:11:13.056 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 20:11:13.059 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP) in 83.576ms
2025-11-23 20:11:13.062 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 20:11:13.063 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 20:11:13.065 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Refunds - 200 null application/json; charset=utf-8 127.1872ms
2025-11-23 20:14:38.553 +02:00 [INF] Starting web host...
2025-11-23 20:14:40.121 +02:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 20:14:40.190 +02:00 [INF] Executed DbCommand (50ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']

IF EXISTS
    (SELECT *
     FROM [sys].[objects] o
     WHERE [o].[type] = 'U'
     AND [o].[is_ms_shipped] = 0
     AND NOT EXISTS (SELECT *
         FROM [sys].[extended_properties] AS [ep]
         WHERE [ep].[major_id] = [o].[object_id]
             AND [ep].[minor_id] = 0
             AND [ep].[class] = 1
             AND [ep].[name] = N'microsoft_database_tools_support'
    )
)
SELECT 1 ELSE SELECT 0
2025-11-23 20:14:40.271 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 20:14:40.277 +02:00 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-11-23 20:14:40.295 +02:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_getapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session', @LockMode = 'Exclusive';
SELECT @result
2025-11-23 20:14:40.378 +02:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF OBJECT_ID(N'[__EFMigrationsHistory]') IS NULL
BEGIN
    CREATE TABLE [__EFMigrationsHistory] (
        [MigrationId] nvarchar(150) NOT NULL,
        [ProductVersion] nvarchar(32) NOT NULL,
        CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
    );
END;
2025-11-23 20:14:40.393 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-11-23 20:14:40.397 +02:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-11-23 20:14:40.405 +02:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-11-23 20:14:40.416 +02:00 [INF] No migrations were applied. The database is already up to date.
2025-11-23 20:14:40.422 +02:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @result int;
EXEC @result = sp_releaseapplock @Resource = '__EFMigrationsLock', @LockOwner = 'Session';
SELECT @result
2025-11-23 20:14:40.603 +02:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [MasterCompanies] AS [m]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-11-23 20:14:40.615 +02:00 [INF] Master database initialized successfully
2025-11-23 20:14:42.726 +02:00 [INF] User profile is available. Using 'C:\Users\hossny D. monkey\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2025-11-23 20:14:42.883 +02:00 [INF] Now listening on: https://localhost:7168
2025-11-23 20:14:42.885 +02:00 [INF] Now listening on: http://localhost:5004
2025-11-23 20:14:42.981 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/index.html - null null
2025-11-23 20:14:43.026 +02:00 [INF] Application started. Press Ctrl+C to shut down.
2025-11-23 20:14:43.030 +02:00 [INF] Hosting environment: Development
2025-11-23 20:14:43.031 +02:00 [INF] Content root path: E:\ModelerERP\ModularERP\ModularERP
2025-11-23 20:14:43.143 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/index.html - 200 null text/html;charset=utf-8 162.5037ms
2025-11-23 20:14:43.150 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - null null
2025-11-23 20:14:43.150 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/_vs/browserLink - null null
2025-11-23 20:14:43.163 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_framework/aspnetcore-browser-refresh.js - 200 16505 application/javascript; charset=utf-8 12.5951ms
2025-11-23 20:14:43.185 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/_vs/browserLink - 200 null text/javascript; charset=UTF-8 35.4663ms
2025-11-23 20:14:43.340 +02:00 [INF] Request starting HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - null null
2025-11-23 20:14:43.639 +02:00 [INF] Request finished HTTP/2 GET https://localhost:7168/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 299.7175ms
2025-11-23 20:14:56.592 +02:00 [INF] Request starting HTTP/1.1 POST https://localhost:7168/api/Refunds - application/json 398
2025-11-23 20:14:56.613 +02:00 [INF] Request started
2025-11-23 20:14:56.615 +02:00 [INF] === Incoming Request ===
2025-11-23 20:14:56.617 +02:00 [INF] Path: /api/Refunds
2025-11-23 20:14:56.618 +02:00 [INF] Method: POST
2025-11-23 20:14:56.619 +02:00 [INF] === Headers ===
2025-11-23 20:14:56.623 +02:00 [INF] Accept: ["*/*"]
2025-11-23 20:14:56.627 +02:00 [INF] Connection: ["keep-alive"]
2025-11-23 20:14:56.628 +02:00 [INF] Host: ["localhost:7168"]
2025-11-23 20:14:56.630 +02:00 [INF] User-Agent: ["PostmanRuntime/7.49.1"]
2025-11-23 20:14:56.631 +02:00 [INF] Accept-Encoding: ["gzip, deflate, br"]
2025-11-23 20:14:56.634 +02:00 [INF] Content-Type: ["application/json"]
2025-11-23 20:14:56.635 +02:00 [INF] Content-Length: ["398"]
2025-11-23 20:14:56.637 +02:00 [INF] X-Tenant-ID: ["6f81c000-285c-4e6a-8125-bc36d14ac4ad"]
2025-11-23 20:14:56.639 +02:00 [INF] Postman-Token: ["7cecc0b3-599d-4aed-bb80-cb2f0adfa399"]
2025-11-23 20:14:56.644 +02:00 [INF] üîç TenantService returned: '6f81c000-285c-4e6a-8125-bc36d14ac4ad'
2025-11-23 20:14:56.645 +02:00 [INF] ‚úÖ Processing request for tenant: 6f81c000-285c-4e6a-8125-bc36d14ac4ad
2025-11-23 20:14:56.647 +02:00 [INF] Executing endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 20:14:56.668 +02:00 [INF] Route matched with {action = "CreateRefund", controller = "Refunds"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ModularERP.Common.ViewModel.ResponseViewModel`1[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto]]] CreateRefund(ModularERP.Modules.Purchases.Refunds.Commends.Commends_RefundInvoce.CreateRefundCommand) on controller ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController (ModularERP).
2025-11-23 20:14:56.674 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software MediatR. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 20:14:56.711 +02:00 [INF] Creating new refund for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 20:14:56.834 +02:00 [INF] Executed DbCommand (9ms) [Parameters=[@__companyId_0='?' (DbType = Guid)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[CurrencyCode], [m].[DatabaseName], [m].[Name], [m].[Status]
FROM [MasterCompanies] AS [m]
WHERE [m].[Id] = @__companyId_0 AND [m].[Status] = N'Active'
2025-11-23 20:14:57.642 +02:00 [WRN] You do not have a valid license key for the Lucky Penny software AutoMapper. This is allowed for development and testing scenarios. If you are running in production you are required to have a licensed version. Please visit https://luckypennysoftware.com to obtain a valid license.
2025-11-23 20:14:57.656 +02:00 [INF] Starting refund creation for PO: "23d49ad7-c8f3-4545-9bb3-6957cdf43515"
2025-11-23 20:14:58.239 +02:00 [INF] Created Debit Note: DN-20251123-00012 for Refund: REF-20251123-00025
2025-11-23 20:14:58.417 +02:00 [INF] Updated POLineItem "172d5908-2ebf-4fa0-5816-08de25364791": Ordered=5.000, Received=4.000, Returned=0, Remaining=1.000
2025-11-23 20:14:58.568 +02:00 [INF] PO PO-202510-0005 is eligible for auto-closure
2025-11-23 20:14:58.620 +02:00 [INF] Updated PO PO-202510-0005 statuses - Reception: Returned, Payment: Refunded, NetReceived: -3.000/10.000, NetPayment: -60822.8000/87.2000
2025-11-23 20:14:58.625 +02:00 [INF] Successfully created refund: REF-20251123-00025
2025-11-23 20:14:58.636 +02:00 [INF] Executing OkObjectResult, writing value of type 'ModularERP.Common.ViewModel.ResponseViewModel`1[[ModularERP.Modules.Purchases.Refunds.DTO.DTO_RefundInvoce.RefundDto, ModularERP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-11-23 20:14:58.660 +02:00 [INF] Executed action ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP) in 1985.8207ms
2025-11-23 20:14:58.663 +02:00 [INF] Executed endpoint 'ModularERP.Modules.Purchases.Refunds.Controllers.RefundsController.CreateRefund (ModularERP)'
2025-11-23 20:14:58.665 +02:00 [INF] Request completed successfully with status code 200
2025-11-23 20:14:58.670 +02:00 [INF] Request finished HTTP/1.1 POST https://localhost:7168/api/Refunds - 200 null application/json; charset=utf-8 2078.4693ms
